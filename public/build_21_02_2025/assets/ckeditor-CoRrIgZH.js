import{b as wr,t as vr,S as Cr,a as vs,i as hn,k as Cs,c as kr,d as gn,e as yr,f as _r,g as ks,h as Ir,j as ys,l as Tr,m as Er,n as ve,o as Ar,p as Sr,C as k,q as xr,O as Z,D as vt,r as Rr,E as Pn,T as Vr,s as Pr,P as Et,R as At,u as Br,v as te,w as L,V as T,L as _s,x as H,y as S,z as Is,A as f,B as y,F as Lr,G as X,K as ne,H as Bn,I as Ts,J as Dr,M as A,N as ze,Q as He,U as dt,W as C,X as de,Y as ue,Z as Fr,_ as Ln,$ as Mr,a0 as fn,a1 as N,a2 as Es,a3 as $,a4 as M,a5 as W,a6 as As,a7 as Ur,a8 as Ss,a9 as Or,aa as Dn,ab as pn,ac as re,ad as Fe,ae as Nr,af as ke,ag as zr,ah as Hr,ai as bn,aj as $r,ak as Ct,al as Wr,am as qr,an as D,ao as Gr,ap as Fn,aq as xs,ar as jr,as as Kr,at as Qr,au as $e,av as Gt,aw as Rs,ax as Zr,ay as Xr,az as Yr,aA as Jr,aB as We,aC as el,aD as Vs,aE as tl,aF as wn,aG as Ps,aH as Bs,aI as ie,aJ as vn,aK as nl,aL as Ls,aM as il,aN as Ds,aO as Fs,aP as Ms,aQ as sl,aR as St,aS as Ie,aT as Us,aU as Os,aV as ol,aW as rl}from"./sourceediting-D-Hsyexd.js";import{f as ll,a5 as al,a6 as cl,Q as Ae,r as Mn,A as Un,B as dl,a as ul,J as ml,w as hl,d as gl,L as fl,e as On,F as pl}from"./app-Bv7sA21o.js";/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Cn(s){class e extends s{disableCssTransitions(){this._isCssTransitionsDisabled=!0}enableCssTransitions(){this._isCssTransitionsDisabled=!1}constructor(...n){super(...n),this.set("_isCssTransitionsDisabled",!1),this.initializeCssTransitionDisablerMixin()}initializeCssTransitionDisablerMixin(){this.extendTemplate({attributes:{class:[this.bindTemplate.if("_isCssTransitionsDisabled","ck-transitions-disabled")]}})}}return e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function kt({view:s}){s.listenTo(s.element,"submit",(e,t)=>{t.preventDefault(),s.fire("submit")},{useCapture:!0})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ns({keystrokeHandler:s,focusTracker:e,gridItems:t,numberOfColumns:n,uiLanguageDirection:i}){const o=typeof n=="number"?()=>n:n;s.set("arrowright",r((c,d)=>i==="rtl"?a(c,d.length):l(c,d.length))),s.set("arrowleft",r((c,d)=>i==="rtl"?l(c,d.length):a(c,d.length))),s.set("arrowup",r((c,d)=>{let u=c-o();return u<0&&(u=c+o()*Math.floor(d.length/o()),u>d.length-1&&(u-=o())),u})),s.set("arrowdown",r((c,d)=>{let u=c+o();return u>d.length-1&&(u=c%o()),u}));function r(c){return d=>{const u=t.find(g=>g.element===e.focusedElement),m=t.getIndex(u),h=c(m,t);t.get(h).focus(),d.stopPropagation(),d.preventDefault()}}function l(c,d){return c===d-1?0:c+1}function a(c,d){return c===0?d-1:c-1}}function bl(s,e,t){var n=s.length;return t=t===void 0?n:t,!e&&t>=n?s:wr(s,e,t)}var wl="\\ud800-\\udfff",vl="\\u0300-\\u036f",Cl="\\ufe20-\\ufe2f",kl="\\u20d0-\\u20ff",yl=vl+Cl+kl,_l="\\ufe0e\\ufe0f",Il="\\u200d",Tl=RegExp("["+Il+wl+yl+_l+"]");function zs(s){return Tl.test(s)}function El(s){return s.split("")}var Hs="\\ud800-\\udfff",Al="\\u0300-\\u036f",Sl="\\ufe20-\\ufe2f",xl="\\u20d0-\\u20ff",Rl=Al+Sl+xl,Vl="\\ufe0e\\ufe0f",Pl="["+Hs+"]",jt="["+Rl+"]",Kt="\\ud83c[\\udffb-\\udfff]",Bl="(?:"+jt+"|"+Kt+")",$s="[^"+Hs+"]",Ws="(?:\\ud83c[\\udde6-\\uddff]){2}",qs="[\\ud800-\\udbff][\\udc00-\\udfff]",Ll="\\u200d",Gs=Bl+"?",js="["+Vl+"]?",Dl="(?:"+Ll+"(?:"+[$s,Ws,qs].join("|")+")"+js+Gs+")*",Fl=js+Gs+Dl,Ml="(?:"+[$s+jt+"?",jt,Ws,qs,Pl].join("|")+")",Ul=RegExp(Kt+"(?="+Kt+")|"+Ml+Fl,"g");function Ol(s){return s.match(Ul)||[]}function Nl(s){return zs(s)?Ol(s):El(s)}function zl(s){return function(e){e=vr(e);var t=zs(e)?Nl(e):void 0,n=t?t[0]:e.charAt(0),i=t?bl(t,1).join(""):e.slice(1);return n[s]()+i}}var Hl=zl("toUpperCase"),$l=1,Wl=2;function ql(s,e,t,n){var i=t.length,o=i,r=!n;if(s==null)return!o;for(s=Object(s);i--;){var l=t[i];if(r&&l[2]?l[1]!==s[l[0]]:!(l[0]in s))return!1}for(;++i<o;){l=t[i];var a=l[0],c=s[a],d=l[1];if(r&&l[2]){if(c===void 0&&!(a in s))return!1}else{var u=new Cr;if(n)var m=n(c,d,a,s,e,u);if(!(m===void 0?vs(d,c,$l|Wl,n,u):m))return!1}}return!0}function Ks(s){return s===s&&!hn(s)}function Gl(s){for(var e=Cs(s),t=e.length;t--;){var n=e[t],i=s[n];e[t]=[n,i,Ks(i)]}return e}function Qs(s,e){return function(t){return t==null?!1:t[s]===e&&(e!==void 0||s in Object(t))}}function jl(s){var e=Gl(s);return e.length==1&&e[0][2]?Qs(e[0][0],e[0][1]):function(t){return t===s||ql(t,s,e)}}function Kl(s,e){return s!=null&&e in Object(s)}function Ql(s,e,t){e=kr(e,s);for(var n=-1,i=e.length,o=!1;++n<i;){var r=gn(e[n]);if(!(o=s!=null&&t(s,r)))break;s=s[r]}return o||++n!=i?o:(i=s==null?0:s.length,!!i&&yr(i)&&_r(r,i)&&(ks(s)||Ir(s)))}function Zl(s,e){return s!=null&&Ql(s,e,Kl)}var Xl=1,Yl=2;function Jl(s,e){return ys(s)&&Ks(e)?Qs(gn(s),e):function(t){var n=Tr(t,s);return n===void 0&&n===e?Zl(t,s):vs(e,n,Xl|Yl)}}function ea(s){return function(e){return e==null?void 0:e[s]}}function ta(s){return function(e){return Er(e,s)}}function na(s){return ys(s)?ea(gn(s)):ta(s)}function ia(s){return typeof s=="function"?s:s==null?ve:typeof s=="object"?ks(s)?Jl(s[0],s[1]):jl(s):na(s)}function sa(s,e){return s&&Ar(s,e,Cs)}function oa(s,e){var t={};return e=ia(e),sa(s,function(n,i,o){Sr(t,i,e(n,i,o))}),t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nn extends k{constructor(){super(...arguments),this._childCommandsDefinitions=[]}refresh(){}execute(...e){const t=this._getFirstEnabledCommand();return!!t&&t.execute(e)}registerChildCommand(e,t={}){xr(this._childCommandsDefinitions,{command:e,priority:t.priority||"normal"}),e.on("change:isEnabled",()=>this._checkEnabled()),this._checkEnabled()}_checkEnabled(){this.isEnabled=!!this._getFirstEnabledCommand()}_getFirstEnabledCommand(){const e=this._childCommandsDefinitions.find(({command:t})=>t.isEnabled);return e&&e.command}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zs extends Z(){constructor(e){super(),this.context=e}destroy(){this.stopListening()}static get isContextPlugin(){return!0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ra extends vt{constructor(){super(...arguments),this.domEventType="click"}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yt extends vt{constructor(){super(...arguments),this.domEventType=["mousedown","mouseup","mouseover","mouseout"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class se{constructor(e){this.document=e}createDocumentFragment(e){return new Rr(this.document,e)}createElement(e,t,n){return new Pn(this.document,e,t,n)}createText(e){return new Vr(this.document,e)}clone(e,t=!1){return e._clone(t)}appendChild(e,t){return t._appendChild(e)}insertChild(e,t,n){return n._insertChild(e,t)}removeChildren(e,t,n){return n._removeChildren(e,t)}remove(e){const t=e.parent;return t?this.removeChildren(t.getChildIndex(e),1,t):[]}replace(e,t){const n=e.parent;if(n){const i=n.getChildIndex(e);return this.removeChildren(i,1,n),this.insertChild(i,t,n),!0}return!1}unwrapElement(e){const t=e.parent;if(t){const n=t.getChildIndex(e);this.remove(e),this.insertChild(n,e.getChildren(),t)}}rename(e,t){const n=new Pn(this.document,e,t.getAttributes(),t.getChildren());return this.replace(t,n)?n:null}setAttribute(e,t,n){n._setAttribute(e,t)}removeAttribute(e,t){t._removeAttribute(e)}addClass(e,t){t._addClass(e)}removeClass(e,t){t._removeClass(e)}setStyle(e,t,n){Pr(e)&&n===void 0?t._setStyle(e):n._setStyle(e,t)}removeStyle(e,t){t._removeStyle(e)}setCustomProperty(e,t,n){n._setCustomProperty(e,t)}removeCustomProperty(e,t){return t._removeCustomProperty(e)}createPositionAt(e,t){return Et._createAt(e,t)}createPositionAfter(e){return Et._createAfter(e)}createPositionBefore(e){return Et._createBefore(e)}createRange(e,t){return new At(e,t)}createRangeOn(e){return At._createOn(e)}createRangeIn(e){return At._createIn(e)}createSelection(...e){return new Br(...e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const la=/^#([0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/i,aa=/^rgb\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}[0-9]{1,3}[ %]?\)$/i,ca=/^rgba\([ ]?([0-9]{1,3}[ %]?,[ ]?){3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,da=/^hsl\([ ]?([0-9]{1,3}[ %]?[,]?[ ]*){3}(1|[0-9]+%|[0]?\.?[0-9]+)?\)$/i,ua=/^hsla\([ ]?([0-9]{1,3}[ %]?,[ ]?){2,3}(1|[0-9]+%|[0]?\.?[0-9]+)\)$/i,ma=/\w+\((?:[^()]|\([^()]*\))*\)|\S+/gi,ha=new Set(["black","silver","gray","white","maroon","red","purple","fuchsia","green","lime","olive","yellow","navy","blue","teal","aqua","orange","aliceblue","antiquewhite","aquamarine","azure","beige","bisque","blanchedalmond","blueviolet","brown","burlywood","cadetblue","chartreuse","chocolate","coral","cornflowerblue","cornsilk","crimson","cyan","darkblue","darkcyan","darkgoldenrod","darkgray","darkgreen","darkgrey","darkkhaki","darkmagenta","darkolivegreen","darkorange","darkorchid","darkred","darksalmon","darkseagreen","darkslateblue","darkslategray","darkslategrey","darkturquoise","darkviolet","deeppink","deepskyblue","dimgray","dimgrey","dodgerblue","firebrick","floralwhite","forestgreen","gainsboro","ghostwhite","gold","goldenrod","greenyellow","grey","honeydew","hotpink","indianred","indigo","ivory","khaki","lavender","lavenderblush","lawngreen","lemonchiffon","lightblue","lightcoral","lightcyan","lightgoldenrodyellow","lightgray","lightgreen","lightgrey","lightpink","lightsalmon","lightseagreen","lightskyblue","lightslategray","lightslategrey","lightsteelblue","lightyellow","limegreen","linen","magenta","mediumaquamarine","mediumblue","mediumorchid","mediumpurple","mediumseagreen","mediumslateblue","mediumspringgreen","mediumturquoise","mediumvioletred","midnightblue","mintcream","mistyrose","moccasin","navajowhite","oldlace","olivedrab","orangered","orchid","palegoldenrod","palegreen","paleturquoise","palevioletred","papayawhip","peachpuff","peru","pink","plum","powderblue","rosybrown","royalblue","saddlebrown","salmon","sandybrown","seagreen","seashell","sienna","skyblue","slateblue","slategray","slategrey","snow","springgreen","steelblue","tan","thistle","tomato","turquoise","violet","wheat","whitesmoke","yellowgreen","activeborder","activecaption","appworkspace","background","buttonface","buttonhighlight","buttonshadow","buttontext","captiontext","graytext","highlight","highlighttext","inactiveborder","inactivecaption","inactivecaptiontext","infobackground","infotext","menu","menutext","scrollbar","threeddarkshadow","threedface","threedhighlight","threedlightshadow","threedshadow","window","windowframe","windowtext","rebeccapurple","currentcolor","transparent"]);function ga(s){return s.startsWith("#")?la.test(s):s.startsWith("rgb")?aa.test(s)||ca.test(s):s.startsWith("hsl")?da.test(s)||ua.test(s):ha.has(s.toLowerCase())}const fa=/^([+-]?[0-9]*([.][0-9]+)?(px|cm|mm|in|pc|pt|ch|em|ex|rem|vh|vw|vmin|vmax)|0)$/;function pa(s){return fa.test(s)}const ba=/^[+-]?[0-9]*([.][0-9]+)?%$/;function wa(s){return ba.test(s)}const va=["repeat-x","repeat-y","repeat","space","round","no-repeat"];function Ca(s){return va.includes(s)}const ka=["center","top","bottom","left","right"];function ya(s){return ka.includes(s)}const _a=["fixed","scroll","local"];function Ia(s){return _a.includes(s)}const Ta=/^url\(/;function Ea(s){return Ta.test(s)}function Aa(s=""){if(s==="")return{top:void 0,right:void 0,bottom:void 0,left:void 0};const e=Xs(s),t=e[0],n=e[2]||t,i=e[1]||t,o=e[3]||i;return{top:t,bottom:n,right:i,left:o}}function Sa(s){return e=>{const{top:t,right:n,bottom:i,left:o}=e,r=[];return[t,n,o,i].every(l=>!!l)?r.push([s,xa(e)]):(t&&r.push([s+"-top",t]),n&&r.push([s+"-right",n]),i&&r.push([s+"-bottom",i]),o&&r.push([s+"-left",o])),r}}function xa({top:s,right:e,bottom:t,left:n}){const i=[];return n!==e?i.push(s,e,t,n):t!==s?i.push(s,e,t):e!==s?i.push(s,e):i.push(s),i.join(" ")}function Ra(s){return e=>({path:s,value:Aa(e)})}function Xs(s){const e=s.matchAll(ma);return Array.from(e).map(t=>t[0])}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Va(s){s.setNormalizer("background",Pa()),s.setNormalizer("background-color",Ba()),s.setReducer("background",La()),s.setStyleRelation("background",["background-color"])}function Pa(){return s=>{const e={},t=Xs(s);for(const n of t)Ca(n)?(e.repeat=e.repeat||[],e.repeat.push(n)):ya(n)?(e.position=e.position||[],e.position.push(n)):Ia(n)?e.attachment=n:ga(n)?e.color=n:Ea(n)&&(e.image=n);return{path:"background",value:e}}}function Ba(){return s=>({path:"background.color",value:s})}function La(){return s=>{const e=[];return e.push(["background-color",s.color]),e}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Da(s){s.setNormalizer("margin",Ra("margin")),s.setNormalizer("margin-top",e=>({path:"margin.top",value:e})),s.setNormalizer("margin-right",e=>({path:"margin.right",value:e})),s.setNormalizer("margin-bottom",e=>({path:"margin.bottom",value:e})),s.setNormalizer("margin-left",e=>({path:"margin.left",value:e})),s.setReducer("margin",Sa("margin")),s.setStyleRelation("margin",["margin-top","margin-right","margin-bottom","margin-left"])}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ut extends Zs{static get pluginName(){return"PendingActions"}init(){this.set("hasAny",!1),this._actions=new te({idProperty:"_id"}),this._actions.delegate("add","remove").to(this)}add(e){if(typeof e!="string")throw new L("pendingactions-add-invalid-message",this);const t=new(Z());return t.set("message",e),this._actions.add(t),this.hasAny=!0,t}remove(e){this._actions.remove(e),this.hasAny=!!this._actions.length}get first(){return this._actions.get(0)}[Symbol.iterator](){return this._actions[Symbol.iterator]()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fa extends T{constructor(e,t){super(e);const n=e.t,i=new _s;i.text=n("Help Contents. To close this dialog press ESC."),this.setTemplate({tag:"div",attributes:{class:["ck","ck-accessibility-help-dialog__content"],"aria-labelledby":i.id,role:"document",tabindex:-1},children:[H(document,"p",{},n("Below, you can find a list of keyboard shortcuts that can be used in the editor.")),...this._createCategories(Array.from(t.values())),i]})}focus(){this.element.focus()}_createCategories(e){return e.map(t=>{const n=[H(document,"h3",{},t.label),...Array.from(t.groups.values()).map(i=>this._createGroup(i)).flat()];return t.description&&n.splice(1,0,H(document,"p",{},t.description)),H(document,"section",{},n)})}_createGroup(e){const t=e.keystrokes.sort((i,o)=>i.label.localeCompare(o.label)).map(i=>this._createGroupRow(i)).flat(),n=[H(document,"dl",{},t)];return e.label&&n.unshift(H(document,"h4",{},e.label)),n}_createGroupRow(e){const t=this.locale.t,n=H(document,"dt"),i=H(document,"dd"),o=Ua(e.keystroke),r=[];for(const l of o)r.push(l.map(Ma).join(""));return n.innerHTML=e.label,i.innerHTML=r.join(", ")+(e.mayRequireFn&&S.isMac?` ${t("(may require <kbd>Fn</kbd>)")}`:""),[n,i]}}function Ma(s){return Is(s).split("+").map(e=>`<kbd>${e}</kbd>`).join("+")}function Ua(s){return typeof s=="string"?[[s]]:typeof s[0]=="string"?[s]:s}const zn='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 6.628a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z"/><path d="M8.5 9.125a.3.3 0 0 0-.253-.296L5.11 8.327a.75.75 0 1 1 .388-1.449l4.04.716c.267.072.624.08.893.009l4.066-.724a.75.75 0 1 1 .388 1.45l-3.132.5a.3.3 0 0 0-.253.296v1.357a.3.3 0 0 0 .018.102l1.615 4.438a.75.75 0 0 1-1.41.513l-1.35-3.71a.3.3 0 0 0-.281-.197h-.209a.3.3 0 0 0-.282.198l-1.35 3.711a.75.75 0 0 1-1.41-.513l1.64-4.509a.3.3 0 0 0 .019-.103V9.125Z"/><path clip-rule="evenodd" d="M10 18.5a8.5 8.5 0 1 1 0-17 8.5 8.5 0 0 1 0 17Zm0 1.5c5.523 0 10-4.477 10-10S15.523 0 10 0 0 4.477 0 10s4.477 10 10 10Z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Oa extends f{constructor(){super(...arguments),this.contentView=null}static get requires(){return[J]}static get pluginName(){return"AccessibilityHelp"}init(){const e=this.editor,t=e.locale.t;e.ui.componentFactory.add("accessibilityHelp",n=>{const i=new y(n);return i.set({label:t("Accessibility help"),tooltip:!0,withText:!1,keystroke:"Alt+0",icon:zn}),i.on("execute",()=>this._showDialog()),i}),e.keystrokes.set("Alt+0",(n,i)=>{this._showDialog(),i()}),this._setupRootLabels()}_setupRootLabels(){const e=this.editor,t=e.editing.view,n=e.t;e.ui.on("ready",()=>{t.change(o=>{for(const r of t.document.roots)i(o,r)}),e.on("addRoot",(o,r)=>{const l=e.editing.view.document.getRoot(r.rootName);t.change(a=>i(a,l))},{priority:"low"})});function i(o,r){const a=`${r.getAttribute("aria-label")}. ${n("Press %0 for help.",[Is("Alt+0")])}`;o.setAttribute("aria-label",a,r)}}_showDialog(){const e=this.editor,t=e.plugins.get("Dialog"),n=e.locale.t;this.contentView||(this.contentView=new Fa(e.locale,e.accessibility.keystrokeInfos)),t.show({id:"accessibilityHelp",className:"ck-accessibility-help-dialog",title:n("Accessibility help"),icon:zn,hasCloseButton:!0,content:this.contentView})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ys extends T{constructor(e,t){super(e);const n=this.bindTemplate;this.set("isCollapsed",!1),this.set("label",""),this.buttonView=this._createButtonView(),this.children=this.createCollection(),this.set("_collapsibleAriaLabelUid",void 0),t&&this.children.addMany(t),this.setTemplate({tag:"div",attributes:{class:["ck","ck-collapsible",n.if("isCollapsed","ck-collapsible_collapsed")]},children:[this.buttonView,{tag:"div",attributes:{class:["ck","ck-collapsible__children"],role:"region",hidden:n.if("isCollapsed","hidden"),"aria-labelledby":n.to("_collapsibleAriaLabelUid")},children:this.children}]})}render(){super.render(),this._collapsibleAriaLabelUid=this.buttonView.labelView.element.id}focus(){this.buttonView.focus()}_createButtonView(){const e=new y(this.locale),t=e.bindTemplate;return e.set({withText:!0,icon:Lr}),e.extendTemplate({attributes:{"aria-expanded":t.to("isOn",n=>String(n))}}),e.bind("label").to(this),e.bind("isOn").to(this,"isCollapsed",n=>!n),e.on("execute",()=>{this.isCollapsed=!this.isCollapsed}),e}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Na(s,e){const t=s.t,n={Black:t("Black"),"Dim grey":t("Dim grey"),Grey:t("Grey"),"Light grey":t("Light grey"),White:t("White"),Red:t("Red"),Orange:t("Orange"),Yellow:t("Yellow"),"Light green":t("Light green"),Green:t("Green"),Aquamarine:t("Aquamarine"),Turquoise:t("Turquoise"),"Light blue":t("Light blue"),Blue:t("Blue"),Purple:t("Purple")};return e.map(i=>{const o=n[i.label];return o&&o!=i.label&&(i.label=o),i})}function za(s){return s.map(Ha).filter(e=>!!e)}function Ha(s){return typeof s=="string"?{model:s,label:s,hasBorder:!1,view:{name:"span",styles:{color:s}}}:{model:s.color,label:s.label||s.color,hasBorder:s.hasBorder===void 0?!1:s.hasBorder,view:{name:"span",styles:{color:`${s.color}`}}}}const $a='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path class="ck-icon__fill" d="M16.935 5.328a2 2 0 0 1 0 2.829l-7.778 7.778a2 2 0 0 1-2.829 0L3.5 13.107a1.999 1.999 0 1 1 2.828-2.829l.707.707a1 1 0 0 0 1.414 0l5.658-5.657a2 2 0 0 1 2.828 0z"/><path d="M14.814 6.035 8.448 12.4a1 1 0 0 1-1.414 0l-1.413-1.415A1 1 0 1 0 4.207 12.4l2.829 2.829a1 1 0 0 0 1.414 0l7.778-7.778a1 1 0 1 0-1.414-1.415z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Js extends y{constructor(e){super(e);const t=this.bindTemplate;this.set("color",void 0),this.set("hasBorder",!1),this.icon=$a,this.extendTemplate({attributes:{style:{backgroundColor:t.to("color")},class:["ck","ck-color-grid__tile",t.if("hasBorder","ck-color-selector__color-tile_bordered")]}})}render(){super.render(),this.iconView.fillColor="hsl(0, 0%, 100%)"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Hn extends T{constructor(e,t){super(e);const n=t&&t.colorDefinitions?t.colorDefinitions:[];this.columns=t&&t.columns?t.columns:5;const i={gridTemplateColumns:`repeat( ${this.columns}, 1fr)`};this.set("selectedColor",void 0),this.items=this.createCollection(),this.focusTracker=new X,this.keystrokes=new ne,this.items.on("add",(o,r)=>{r.isOn=r.color===this.selectedColor}),n.forEach(o=>{const r=new Js;r.set({color:o.color,label:o.label,tooltip:!0,hasBorder:o.options.hasBorder}),r.on("execute",()=>{this.fire("execute",{value:o.color,hasBorder:o.options.hasBorder,label:o.label})}),this.items.add(r)}),this.setTemplate({tag:"div",children:this.items,attributes:{class:["ck","ck-color-grid"],style:i}}),this.on("change:selectedColor",(o,r,l)=>{for(const a of this.items)a.isOn=a.color===l})}focus(){this.items.length&&this.items.first.focus()}focusLast(){this.items.length&&this.items.last.focus()}render(){super.render();for(const e of this.items)this.focusTracker.add(e.element);this.items.on("add",(e,t)=>{this.focusTracker.add(t.element)}),this.items.on("remove",(e,t)=>{this.focusTracker.remove(t.element)}),this.keystrokes.listenTo(this.element),Ns({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:this.columns,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}}var $n={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};function Wn(s){var e,t=[],n=1,i;if(typeof s=="string")if(Bn[s])t=Bn[s].slice(),i="rgb";else if(s==="transparent")n=0,i="rgb",t=[0,0,0];else if(/^#[A-Fa-f0-9]+$/.test(s)){var o=s.slice(1),r=o.length,l=r<=4;n=1,l?(t=[parseInt(o[0]+o[0],16),parseInt(o[1]+o[1],16),parseInt(o[2]+o[2],16)],r===4&&(n=parseInt(o[3]+o[3],16)/255)):(t=[parseInt(o[0]+o[1],16),parseInt(o[2]+o[3],16),parseInt(o[4]+o[5],16)],r===8&&(n=parseInt(o[6]+o[7],16)/255)),t[0]||(t[0]=0),t[1]||(t[1]=0),t[2]||(t[2]=0),i="rgb"}else if(e=/^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\s*\(([^\)]*)\)/.exec(s)){var a=e[1],c=a==="rgb",o=a.replace(/a$/,"");i=o;var r=o==="cmyk"?4:o==="gray"?1:3;t=e[2].trim().split(/\s*[,\/]\s*|\s+/).map(function(m,h){if(/%$/.test(m))return h===r?parseFloat(m)/100:o==="rgb"?parseFloat(m)*255/100:parseFloat(m);if(o[h]==="h"){if(/deg$/.test(m))return parseFloat(m);if($n[m]!==void 0)return $n[m]}return parseFloat(m)}),a===o&&t.push(1),n=c||t[r]===void 0?1:t[r],t=t.slice(0,r)}else s.length>10&&/[0-9](?:\s|\/)/.test(s)&&(t=s.match(/([0-9]+)/g).map(function(d){return parseFloat(d)}),i=s.match(/([a-z])/ig).join("").toLowerCase());else isNaN(s)?Array.isArray(s)||s.length?(t=[s[0],s[1],s[2]],i="rgb",n=s.length===4?s[3]:1):s instanceof Object&&(s.r!=null||s.red!=null||s.R!=null?(i="rgb",t=[s.r||s.red||s.R||0,s.g||s.green||s.G||0,s.b||s.blue||s.B||0]):(i="hsl",t=[s.h||s.hue||s.H||0,s.s||s.saturation||s.S||0,s.l||s.lightness||s.L||s.b||s.brightness]),n=s.a||s.alpha||s.opacity||1,s.opacity!=null&&(n/=100)):(i="rgb",t=[s>>>16,(s&65280)>>>8,s&255]);return{space:i,values:t,alpha:n}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function eo(s,e){if(!s)return"";const t=to(s);if(!t)return"";if(t.space===e)return s;if(!ja(t))return"";const i=Ts[t.space][e];if(!i)return"";const o=i(t.space==="hex"?t.hexValue:t.values);return Ga(o,e)}function Wa(s){if(!s)return"";const e=to(s);return e?e.space==="hex"?e.hexValue:eo(s,"hex"):"#000"}function qa(s,e){customElements.get(s)===void 0&&customElements.define(s,e)}function Ga(s,e){switch(e){case"hex":return`#${s}`;case"rgb":return`rgb( ${s[0]}, ${s[1]}, ${s[2]} )`;case"hsl":return`hsl( ${s[0]}, ${s[1]}%, ${s[2]}% )`;case"hwb":return`hwb( ${s[0]}, ${s[1]}, ${s[2]} )`;case"lab":return`lab( ${s[0]}% ${s[1]} ${s[2]} )`;case"lch":return`lch( ${s[0]}% ${s[1]} ${s[2]} )`;default:return""}}function to(s){if(s.startsWith("#")){const t=Wn(s);return{space:"hex",values:t.values,hexValue:s,alpha:t.alpha}}const e=Wn(s);return e.space?e:null}function ja(s){return Object.keys(Ts).includes(s.space)}const Me=(s,e=0,t=1)=>s>t?t:s<e?e:s,B=(s,e=0,t=Math.pow(10,e))=>Math.round(t*s)/t,Ka=s=>Ja(Qt(s)),Qt=s=>(s[0]==="#"&&(s=s.substring(1)),s.length<6?{r:parseInt(s[0]+s[0],16),g:parseInt(s[1]+s[1],16),b:parseInt(s[2]+s[2],16),a:s.length===4?B(parseInt(s[3]+s[3],16)/255,2):1}:{r:parseInt(s.substring(0,2),16),g:parseInt(s.substring(2,4),16),b:parseInt(s.substring(4,6),16),a:s.length===8?B(parseInt(s.substring(6,8),16)/255,2):1}),Qa=s=>Ya(Xa(s)),Za=({h:s,s:e,v:t,a:n})=>{const i=(200-e)*t/100;return{h:B(s),s:B(i>0&&i<200?e*t/100/(i<=100?i:200-i)*100:0),l:B(i/2),a:B(n,2)}},Zt=s=>{const{h:e,s:t,l:n}=Za(s);return`hsl(${e}, ${t}%, ${n}%)`},Xa=({h:s,s:e,v:t,a:n})=>{s=s/360*6,e=e/100,t=t/100;const i=Math.floor(s),o=t*(1-e),r=t*(1-(s-i)*e),l=t*(1-(1-s+i)*e),a=i%6;return{r:B([t,r,o,o,l,t][a]*255),g:B([l,t,t,r,o,o][a]*255),b:B([o,o,l,t,t,r][a]*255),a:B(n,2)}},Ze=s=>{const e=s.toString(16);return e.length<2?"0"+e:e},Ya=({r:s,g:e,b:t,a:n})=>{const i=n<1?Ze(B(n*255)):"";return"#"+Ze(s)+Ze(e)+Ze(t)+i},Ja=({r:s,g:e,b:t,a:n})=>{const i=Math.max(s,e,t),o=i-Math.min(s,e,t),r=o?i===s?(e-t)/o:i===e?2+(t-s)/o:4+(s-e)/o:0;return{h:B(60*(r<0?r+6:r)),s:B(i?o/i*100:0),v:B(i/255*100),a:n}},no=(s,e)=>{if(s===e)return!0;for(const t in s)if(s[t]!==e[t])return!1;return!0},ec=(s,e)=>s.toLowerCase()===e.toLowerCase()?!0:no(Qt(s),Qt(e)),qn={},io=s=>{let e=qn[s];return e||(e=document.createElement("template"),e.innerHTML=s,qn[s]=e),e},kn=(s,e,t)=>{s.dispatchEvent(new CustomEvent(e,{bubbles:!0,detail:t}))};let ye=!1;const Xt=s=>"touches"in s,tc=s=>ye&&!Xt(s)?!1:(ye||(ye=Xt(s)),!0),Gn=(s,e)=>{const t=Xt(e)?e.touches[0]:e,n=s.el.getBoundingClientRect();kn(s.el,"move",s.getMove({x:Me((t.pageX-(n.left+window.pageXOffset))/n.width),y:Me((t.pageY-(n.top+window.pageYOffset))/n.height)}))},nc=(s,e)=>{const t=e.keyCode;t>40||s.xy&&t<37||t<33||(e.preventDefault(),kn(s.el,"move",s.getMove({x:t===39?.01:t===37?-.01:t===34?.05:t===33?-.05:t===35?1:t===36?-1:0,y:t===40?.01:t===38?-.01:0},!0)))};class so{constructor(e,t,n,i){const o=io(`<div role="slider" tabindex="0" part="${t}" ${n}><div part="${t}-pointer"></div></div>`);e.appendChild(o.content.cloneNode(!0));const r=e.querySelector(`[part=${t}]`);r.addEventListener("mousedown",this),r.addEventListener("touchstart",this),r.addEventListener("keydown",this),this.el=r,this.xy=i,this.nodes=[r.firstChild,r]}set dragging(e){const t=e?document.addEventListener:document.removeEventListener;t(ye?"touchmove":"mousemove",this),t(ye?"touchend":"mouseup",this)}handleEvent(e){switch(e.type){case"mousedown":case"touchstart":if(e.preventDefault(),!tc(e)||!ye&&e.button!=0)return;this.el.focus(),Gn(this,e),this.dragging=!0;break;case"mousemove":case"touchmove":e.preventDefault(),Gn(this,e);break;case"mouseup":case"touchend":this.dragging=!1;break;case"keydown":nc(this,e);break}}style(e){e.forEach((t,n)=>{for(const i in t)this.nodes[n].style.setProperty(i,t[i])})}}class ic extends so{constructor(e){super(e,"hue",'aria-label="Hue" aria-valuemin="0" aria-valuemax="360"',!1)}update({h:e}){this.h=e,this.style([{left:`${e/360*100}%`,color:Zt({h:e,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuenow",`${B(e)}`)}getMove(e,t){return{h:t?Me(this.h+e.x*360,0,360):360*e.x}}}class sc extends so{constructor(e){super(e,"saturation",'aria-label="Color"',!0)}update(e){this.hsva=e,this.style([{top:`${100-e.v}%`,left:`${e.s}%`,color:Zt(e)},{"background-color":Zt({h:e.h,s:100,v:100,a:1})}]),this.el.setAttribute("aria-valuetext",`Saturation ${B(e.s)}%, Brightness ${B(e.v)}%`)}getMove(e,t){return{s:t?Me(this.hsva.s+e.x*100,0,100):e.x*100,v:t?Me(this.hsva.v-e.y*100,0,100):Math.round(100-e.y*100)}}}const oc=':host{display:flex;flex-direction:column;position:relative;width:200px;height:200px;user-select:none;-webkit-user-select:none;cursor:default}:host([hidden]){display:none!important}[role=slider]{position:relative;touch-action:none;user-select:none;-webkit-user-select:none;outline:0}[role=slider]:last-child{border-radius:0 0 8px 8px}[part$=pointer]{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;display:flex;place-content:center center;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}[part$=pointer]::after{content:"";width:100%;height:100%;border-radius:inherit;background-color:currentColor}[role=slider]:focus [part$=pointer]{transform:translate(-50%,-50%) scale(1.1)}',rc="[part=hue]{flex:0 0 24px;background:linear-gradient(to right,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red 100%)}[part=hue-pointer]{top:50%;z-index:2}",lc="[part=saturation]{flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(to top,#000,transparent),linear-gradient(to right,#fff,rgba(255,255,255,0));box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}[part=saturation-pointer]{z-index:3}",Xe=Symbol("same"),xt=Symbol("color"),jn=Symbol("hsva"),Rt=Symbol("update"),Kn=Symbol("parts"),Qn=Symbol("css"),Zn=Symbol("sliders");class ac extends HTMLElement{static get observedAttributes(){return["color"]}get[Qn](){return[oc,rc,lc]}get[Zn](){return[sc,ic]}get color(){return this[xt]}set color(e){if(!this[Xe](e)){const t=this.colorModel.toHsva(e);this[Rt](t),this[xt]=e}}constructor(){super();const e=io(`<style>${this[Qn].join("")}</style>`),t=this.attachShadow({mode:"open"});t.appendChild(e.content.cloneNode(!0)),t.addEventListener("move",this),this[Kn]=this[Zn].map(n=>new n(t))}connectedCallback(){if(this.hasOwnProperty("color")){const e=this.color;delete this.color,this.color=e}else this.color||(this.color=this.colorModel.defaultColor)}attributeChangedCallback(e,t,n){const i=this.colorModel.fromAttr(n);this[Xe](i)||(this.color=i)}handleEvent(e){const t=this[jn],n={...t,...e.detail};this[Rt](n);let i;!no(n,t)&&!this[Xe](i=this.colorModel.fromHsva(n))&&(this[xt]=i,kn(this,"color-changed",{value:i}))}[Xe](e){return this.color&&this.colorModel.equal(e,this.color)}[Rt](e){this[jn]=e,this[Kn].forEach(t=>t.update(e))}}const cc={defaultColor:"#000",toHsva:Ka,fromHsva:({h:s,s:e,v:t})=>Qa({h:s,s:e,v:t,a:1}),equal:ec,fromAttr:s=>s};class dc extends ac{get colorModel(){return cc}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const uc=150;class mc extends T{constructor(e,t={}){super(e),this.set({color:"",_hexColor:""}),this.hexInputRow=this._createInputRow();const n=this.createCollection();t.hideInput||n.add(this.hexInputRow),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker"],tabindex:-1},children:n}),this._config=t,this._debounceColorPickerEvent=Dr(i=>{this.set("color",i),this.fire("colorSelected",{color:this.color})},uc,{leading:!0}),this.on("set:color",(i,o,r)=>{i.return=eo(r,this._config.format||"hsl")}),this.on("change:color",()=>{this._hexColor=Vt(this.color)}),this.on("change:_hexColor",()=>{document.activeElement!==this.picker&&this.picker.setAttribute("color",this._hexColor),Vt(this.color)!=Vt(this._hexColor)&&(this.color=this._hexColor)})}render(){if(super.render(),qa("hex-color-picker",dc),this.picker=A.document.createElement("hex-color-picker"),this.picker.setAttribute("class","hex-color-picker"),this.picker.setAttribute("tabindex","-1"),this._createSlidersView(),this.element){this.hexInputRow.element?this.element.insertBefore(this.picker,this.hexInputRow.element):this.element.appendChild(this.picker);const e=document.createElement("style");e.textContent='[role="slider"]:focus [part$="pointer"] {border: 1px solid #fff;outline: 1px solid var(--ck-color-focus-border);box-shadow: 0 0 0 2px #fff;}',this.picker.shadowRoot.appendChild(e)}this.picker.addEventListener("color-changed",e=>{const t=e.detail.value;this._debounceColorPickerEvent(t)})}focus(){/* istanbul ignore next -- @preserve */!this._config.hideInput&&(S.isGecko||S.isiOS||S.isSafari)&&this.hexInputRow.children.get(1).focus(),this.slidersView.first.focus()}_createSlidersView(){const n=[...this.picker.shadowRoot.children].filter(i=>i.getAttribute("role")==="slider").map(i=>new hc(i));this.slidersView=this.createCollection(),n.forEach(i=>{this.slidersView.add(i)})}_createInputRow(){const e=new gc,t=this._createColorInput();return new fc(this.locale,[e,t])}_createColorInput(){const e=new ze(this.locale,He),{t}=this.locale;return e.set({label:t("HEX"),class:"color-picker-hex-input"}),e.fieldView.bind("value").to(this,"_hexColor",n=>e.isFocused?e.fieldView.value:n.startsWith("#")?n.substring(1):n),e.fieldView.on("input",()=>{const n=e.fieldView.element.value;if(n){const i=n.trim(),o=i.startsWith("#")?i.substring(1):i;[3,4,6,8].includes(o.length)&&/(([0-9a-fA-F]{2}){3,4}|([0-9a-fA-F]){3,4})/.test(o)&&this._debounceColorPickerEvent("#"+o)}}),e}}function Vt(s){let e=Wa(s);return e||(e="#000"),e.length===4&&(e="#"+[e[1],e[1],e[2],e[2],e[3],e[3]].join("")),e.toLowerCase()}class hc extends T{constructor(e){super(),this.element=e}focus(){this.element.focus()}}class gc extends T{constructor(e){super(e),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker__hash-view"]},children:"#"})}}class fc extends T{constructor(e,t){super(e),this.children=this.createCollection(t),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-picker__row"]},children:this.children})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pc extends Z(te){constructor(e){super(e),this.set("isEmpty",!0),this.on("change",()=>{this.set("isEmpty",this.length===0)})}add(e,t){return this.find(n=>n.color===e.color)?this:super.add(e,t)}hasColor(e){return!!this.find(t=>t.color===e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const{eraser:bc,colorPalette:wc}=C;class vc extends T{constructor(e,{colors:t,columns:n,removeButtonLabel:i,documentColorsLabel:o,documentColorsCount:r,colorPickerLabel:l,focusTracker:a,focusables:c}){super(e);const d=this.bindTemplate;this.set("isVisible",!0),this.focusTracker=a,this.items=this.createCollection(),this.colorDefinitions=t,this.columns=n,this.documentColors=new pc,this.documentColorsCount=r,this._focusables=c,this._removeButtonLabel=i,this._colorPickerLabel=l,this._documentColorsLabel=o,this.setTemplate({tag:"div",attributes:{class:["ck-color-grids-fragment",d.if("isVisible","ck-hidden",u=>!u)]},children:this.items}),this.removeColorButtonView=this._createRemoveColorButton(),this.items.add(this.removeColorButtonView)}updateDocumentColors(e,t){const n=e.document,i=this.documentColorsCount;this.documentColors.clear();for(const o of n.getRoots()){const r=e.createRangeIn(o);for(const l of r.getItems())if(l.is("$textProxy")&&l.hasAttribute(t)&&(this._addColorToDocumentColors(l.getAttribute(t)),this.documentColors.length>=i))return}}updateSelectedColors(){const e=this.documentColorsGrid,t=this.staticColorsGrid,n=this.selectedColor;t.selectedColor=n,e&&(e.selectedColor=n)}render(){if(super.render(),this.staticColorsGrid=this._createStaticColorsGrid(),this.items.add(this.staticColorsGrid),this.documentColorsCount){const e=dt.bind(this.documentColors,this.documentColors),t=new _s(this.locale);t.text=this._documentColorsLabel,t.extendTemplate({attributes:{class:["ck","ck-color-grid__label",e.if("isEmpty","ck-hidden")]}}),this.items.add(t),this.documentColorsGrid=this._createDocumentColorsGrid(),this.items.add(this.documentColorsGrid)}this._createColorPickerButton(),this._addColorSelectorElementsToFocusTracker()}focus(){this.removeColorButtonView.focus()}destroy(){super.destroy()}addColorPickerButton(){this.colorPickerButtonView&&(this.items.add(this.colorPickerButtonView),this.focusTracker.add(this.colorPickerButtonView.element),this._focusables.add(this.colorPickerButtonView))}_addColorSelectorElementsToFocusTracker(){this.focusTracker.add(this.removeColorButtonView.element),this._focusables.add(this.removeColorButtonView),this.staticColorsGrid&&(this.focusTracker.add(this.staticColorsGrid.element),this._focusables.add(this.staticColorsGrid)),this.documentColorsGrid&&(this.focusTracker.add(this.documentColorsGrid.element),this._focusables.add(this.documentColorsGrid))}_createColorPickerButton(){this.colorPickerButtonView=new y,this.colorPickerButtonView.set({label:this._colorPickerLabel,withText:!0,icon:wc,class:"ck-color-selector__color-picker"}),this.colorPickerButtonView.on("execute",()=>{this.fire("colorPicker:show")})}_createRemoveColorButton(){const e=new y;return e.set({withText:!0,icon:bc,label:this._removeButtonLabel}),e.class="ck-color-selector__remove-color",e.on("execute",()=>{this.fire("execute",{value:null,source:"removeColorButton"})}),e.render(),e}_createStaticColorsGrid(){const e=new Hn(this.locale,{colorDefinitions:this.colorDefinitions,columns:this.columns});return e.on("execute",(t,n)=>{this.fire("execute",{value:n.value,source:"staticColorsGrid"})}),e}_createDocumentColorsGrid(){const e=dt.bind(this.documentColors,this.documentColors),t=new Hn(this.locale,{columns:this.columns});return t.extendTemplate({attributes:{class:e.if("isEmpty","ck-hidden")}}),t.items.bindTo(this.documentColors).using(n=>{const i=new Js;return i.set({color:n.color,hasBorder:n.options&&n.options.hasBorder}),n.label&&i.set({label:n.label,tooltip:!0}),i.on("execute",()=>{this.fire("execute",{value:n.color,source:"documentColorsGrid"})}),i}),this.documentColors.on("change:isEmpty",(n,i,o)=>{o&&(t.selectedColor=null)}),t}_addColorToDocumentColors(e){const t=this.colorDefinitions.find(n=>n.color===e);t?this.documentColors.add(Object.assign({},t)):this.documentColors.add({color:e,label:e,options:{hasBorder:!1}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Cc extends T{constructor(e,{focusTracker:t,focusables:n,keystrokes:i,colorPickerViewConfig:o}){super(e),this.items=this.createCollection(),this.focusTracker=t,this.keystrokes=i,this.set("isVisible",!1),this.set("selectedColor",void 0),this._focusables=n,this._colorPickerViewConfig=o;const r=this.bindTemplate,{saveButtonView:l,cancelButtonView:a}=this._createActionButtons();this.saveButtonView=l,this.cancelButtonView=a,this.actionBarView=this._createActionBarView({saveButtonView:l,cancelButtonView:a}),this.setTemplate({tag:"div",attributes:{class:["ck-color-picker-fragment",r.if("isVisible","ck-hidden",c=>!c)]},children:this.items})}render(){super.render();const e=new mc(this.locale,{...this._colorPickerViewConfig});this.colorPickerView=e,this.colorPickerView.render(),this.selectedColor&&(e.color=this.selectedColor),this.listenTo(this,"change:selectedColor",(t,n,i)=>{e.color=i}),this.items.add(this.colorPickerView),this.items.add(this.actionBarView),this._addColorPickersElementsToFocusTracker(),this._stopPropagationOnArrowsKeys(),this._executeOnEnterPress(),this._executeUponColorChange()}destroy(){super.destroy()}focus(){this.colorPickerView.focus()}_executeOnEnterPress(){this.keystrokes.set("enter",e=>{this.isVisible&&this.focusTracker.focusedElement!==this.cancelButtonView.element&&(this.fire("execute",{value:this.selectedColor}),e.stopPropagation(),e.preventDefault())})}_stopPropagationOnArrowsKeys(){const e=t=>t.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}_addColorPickersElementsToFocusTracker(){for(const t of this.colorPickerView.slidersView)this.focusTracker.add(t.element),this._focusables.add(t);const e=this.colorPickerView.hexInputRow.children.get(1);e.element&&(this.focusTracker.add(e.element),this._focusables.add(e)),this.focusTracker.add(this.saveButtonView.element),this._focusables.add(this.saveButtonView),this.focusTracker.add(this.cancelButtonView.element),this._focusables.add(this.cancelButtonView)}_createActionBarView({saveButtonView:e,cancelButtonView:t}){const n=new T,i=this.createCollection();return i.add(e),i.add(t),n.setTemplate({tag:"div",attributes:{class:["ck","ck-color-selector_action-bar"]},children:i}),n}_createActionButtons(){const e=this.locale,t=e.t,n=new y(e),i=new y(e);return n.set({icon:C.check,class:"ck-button-save",type:"button",withText:!1,label:t("Accept")}),i.set({icon:C.cancel,class:"ck-button-cancel",type:"button",withText:!1,label:t("Cancel")}),n.on("execute",()=>{this.fire("execute",{source:"colorPickerSaveButton",value:this.selectedColor})}),i.on("execute",()=>{this.fire("colorPicker:cancel")}),{saveButtonView:n,cancelButtonView:i}}_executeUponColorChange(){this.colorPickerView.on("colorSelected",(e,t)=>{this.fire("execute",{value:t.color,source:"colorPicker"}),this.set("selectedColor",t.color)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kc extends T{constructor(e,{colors:t,columns:n,removeButtonLabel:i,documentColorsLabel:o,documentColorsCount:r,colorPickerLabel:l,colorPickerViewConfig:a}){super(e),this.items=this.createCollection(),this.focusTracker=new X,this.keystrokes=new ne,this._focusables=new de,this._colorPickerViewConfig=a,this._focusCycler=new ue({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.colorGridsFragmentView=new vc(e,{colors:t,columns:n,removeButtonLabel:i,documentColorsLabel:o,documentColorsCount:r,colorPickerLabel:l,focusTracker:this.focusTracker,focusables:this._focusables}),this.colorPickerFragmentView=new Cc(e,{focusables:this._focusables,focusTracker:this.focusTracker,keystrokes:this.keystrokes,colorPickerViewConfig:a}),this.set("_isColorGridsFragmentVisible",!0),this.set("_isColorPickerFragmentVisible",!1),this.set("selectedColor",void 0),this.colorGridsFragmentView.bind("isVisible").to(this,"_isColorGridsFragmentVisible"),this.colorPickerFragmentView.bind("isVisible").to(this,"_isColorPickerFragmentVisible"),this.on("change:selectedColor",(c,d,u)=>{this.colorGridsFragmentView.set("selectedColor",u),this.colorPickerFragmentView.set("selectedColor",u)}),this.colorGridsFragmentView.on("change:selectedColor",(c,d,u)=>{this.set("selectedColor",u)}),this.colorPickerFragmentView.on("change:selectedColor",(c,d,u)=>{this.set("selectedColor",u)}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-color-selector"]},children:this.items})}render(){super.render(),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}appendUI(){this._appendColorGridsFragment(),this._colorPickerViewConfig&&this._appendColorPickerFragment()}showColorPickerFragment(){!this.colorPickerFragmentView.colorPickerView||this._isColorPickerFragmentVisible||(this._isColorPickerFragmentVisible=!0,this.colorPickerFragmentView.focus(),this._isColorGridsFragmentVisible=!1)}showColorGridsFragment(){this._isColorGridsFragmentVisible||(this._isColorGridsFragmentVisible=!0,this.colorGridsFragmentView.focus(),this._isColorPickerFragmentVisible=!1)}focus(){this._focusCycler.focusFirst()}focusLast(){this._focusCycler.focusLast()}updateDocumentColors(e,t){this.colorGridsFragmentView.updateDocumentColors(e,t)}updateSelectedColors(){this.colorGridsFragmentView.updateSelectedColors()}_appendColorGridsFragment(){this.items.length||(this.items.add(this.colorGridsFragmentView),this.colorGridsFragmentView.delegate("execute").to(this),this.colorGridsFragmentView.delegate("colorPicker:show").to(this))}_appendColorPickerFragment(){this.items.length!==2&&(this.items.add(this.colorPickerFragmentView),this.colorGridsFragmentView.colorPickerButtonView&&this.colorGridsFragmentView.colorPickerButtonView.on("execute",()=>{this.showColorPickerFragment()}),this.colorGridsFragmentView.addColorPickerButton(),this.colorPickerFragmentView.delegate("execute").to(this),this.colorPickerFragmentView.delegate("colorPicker:cancel").to(this))}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class J extends f{static get pluginName(){return"Dialog"}constructor(e){super(e);const t=e.t;this._initShowHideListeners(),this._initFocusToggler(),this._initMultiRootIntegration(),this.set("id",null),e.accessibility.addKeystrokeInfos({categoryId:"navigation",keystrokes:[{label:t("Move focus in and out of an active dialog window"),keystroke:"Ctrl+F6",mayRequireFn:!0}]})}_initShowHideListeners(){this.on("show",(e,t)=>{this._show(t)}),this.on("show",(e,t)=>{t.onShow&&t.onShow(this)},{priority:"low"}),this.on("hide",()=>{J._visibleDialogPlugin&&J._visibleDialogPlugin._hide()}),this.on("hide",()=>{this._onHide&&(this._onHide(this),this._onHide=void 0)},{priority:"low"})}_initFocusToggler(){const e=this.editor;e.keystrokes.set("Ctrl+F6",(t,n)=>{!this.isOpen||this.view.isModal||(this.view.focusTracker.isFocused?e.editing.view.focus():this.view.focus(),n())})}_initMultiRootIntegration(){const e=this.editor.model;e.document.on("change:data",()=>{if(!this.view)return;const t=e.document.differ.getChangedRoots();for(const n of t)n.state&&this.view.updatePosition()})}show(e){this.hide(),this.fire(`show:${e.id}`,e)}_show({id:e,icon:t,title:n,hasCloseButton:i=!0,content:o,actionButtons:r,className:l,isModal:a,position:c,onHide:d}){const u=this.editor;this.view=new Fr(u.locale,{getCurrentDomRoot:()=>u.editing.view.getDomRoot(u.model.document.selection.anchor.root.rootName),getViewportOffset:()=>u.ui.viewportOffset});const m=this.view;m.on("close",()=>{this.hide()}),u.ui.view.body.add(m),u.ui.focusTracker.add(m.element),u.keystrokes.listenTo(m.element),c||(c=a?Ln.SCREEN_CENTER:Ln.EDITOR_CENTER),m.set({position:c,_isVisible:!0,className:l,isModal:a}),m.setupParts({icon:t,title:n,hasCloseButton:i,content:o,actionButtons:r}),this.id=e,d&&(this._onHide=d),this.isOpen=!0,J._visibleDialogPlugin=this}hide(){J._visibleDialogPlugin&&J._visibleDialogPlugin.fire(`hide:${J._visibleDialogPlugin.id}`)}_hide(){if(!this.view)return;const e=this.editor,t=this.view;t.contentView&&t.contentView.reset(),e.ui.view.body.remove(t),e.ui.focusTracker.remove(t.element),e.keystrokes.stopListening(t.element),t.destroy(),e.editing.view.focus(),this.id=null,this.isOpen=!1,J._visibleDialogPlugin=null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xn extends Zs{static get pluginName(){return"Notification"}init(){this.on("show:warning",(e,t)=>{window.alert(t.message)},{priority:"lowest"})}showSuccess(e,t={}){this._showNotification({message:e,type:"success",namespace:t.namespace,title:t.title})}showInfo(e,t={}){this._showNotification({message:e,type:"info",namespace:t.namespace,title:t.title})}showWarning(e,t={}){this._showNotification({message:e,type:"warning",namespace:t.namespace,title:t.title})}_showNotification(e){const t=e.namespace?`show:${e.type}:${e.namespace}`:`show:${e.type}`;this.fire(t,{message:e.message,type:e.type,title:e.title||""})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qe extends Z(){constructor(e,t){super(),t&&Mr(this,t),e&&this.set(e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ye=Es("px");class mt extends f{static get pluginName(){return"ContextualBalloon"}constructor(e){super(e),this._viewToStack=new Map,this._idToStack=new Map,this._view=null,this._rotatorView=null,this._fakePanelsView=null,this.positionLimiter=()=>{const t=this.editor.editing.view,i=t.document.selection.editableElement;return i?t.domConverter.mapViewToDom(i.root):null},this.set("visibleView",null),this.set("_numberOfStacks",0),this.set("_singleViewMode",!1)}destroy(){super.destroy(),this._view&&this._view.destroy(),this._rotatorView&&this._rotatorView.destroy(),this._fakePanelsView&&this._fakePanelsView.destroy()}get view(){return this._view||this._createPanelView(),this._view}hasView(e){return Array.from(this._viewToStack.keys()).includes(e)}add(e){if(this._view||this._createPanelView(),this.hasView(e.view))throw new L("contextualballoon-add-view-exist",[this,e]);const t=e.stackId||"main";if(!this._idToStack.has(t)){this._idToStack.set(t,new Map([[e.view,e]])),this._viewToStack.set(e.view,this._idToStack.get(t)),this._numberOfStacks=this._idToStack.size,(!this._visibleStack||e.singleViewMode)&&this.showStack(t);return}const n=this._idToStack.get(t);e.singleViewMode&&this.showStack(t),n.set(e.view,e),this._viewToStack.set(e.view,n),n===this._visibleStack&&this._showView(e)}remove(e){if(!this.hasView(e))throw new L("contextualballoon-remove-view-not-exist",[this,e]);const t=this._viewToStack.get(e);this._singleViewMode&&this.visibleView===e&&(this._singleViewMode=!1),this.visibleView===e&&(t.size===1?this._idToStack.size>1?this._showNextStack():(this.view.hide(),this.visibleView=null,this._rotatorView.hideView()):this._showView(Array.from(t.values())[t.size-2])),t.size===1?(this._idToStack.delete(this._getStackId(t)),this._numberOfStacks=this._idToStack.size):t.delete(e),this._viewToStack.delete(e)}updatePosition(e){e&&(this._visibleStack.get(this.visibleView).position=e),this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition()}showStack(e){this.visibleStack=e;const t=this._idToStack.get(e);if(!t)throw new L("contextualballoon-showstack-stack-not-exist",this);this._visibleStack!==t&&this._showView(Array.from(t.values()).pop())}_createPanelView(){this._view=new fn(this.editor.locale),this.editor.ui.view.body.add(this._view),this.editor.ui.focusTracker.add(this._view.element),this._rotatorView=this._createRotatorView(),this._fakePanelsView=this._createFakePanelsView()}get _visibleStack(){return this._viewToStack.get(this.visibleView)}_getStackId(e){return Array.from(this._idToStack.entries()).find(n=>n[1]===e)[0]}_showNextStack(){const e=Array.from(this._idToStack.values());let t=e.indexOf(this._visibleStack)+1;e[t]||(t=0),this.showStack(this._getStackId(e[t]))}_showPrevStack(){const e=Array.from(this._idToStack.values());let t=e.indexOf(this._visibleStack)-1;e[t]||(t=e.length-1),this.showStack(this._getStackId(e[t]))}_createRotatorView(){const e=new yc(this.editor.locale),t=this.editor.locale.t;return this.view.content.add(e),e.bind("isNavigationVisible").to(this,"_numberOfStacks",this,"_singleViewMode",(n,i)=>!i&&n>1),e.on("change:isNavigationVisible",()=>this.updatePosition(),{priority:"low"}),e.bind("counter").to(this,"visibleView",this,"_numberOfStacks",(n,i)=>{if(i<2)return"";const o=Array.from(this._idToStack.values()).indexOf(this._visibleStack)+1;return t("%0 of %1",[o,i])}),e.buttonNextView.on("execute",()=>{e.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showNextStack()}),e.buttonPrevView.on("execute",()=>{e.focusTracker.isFocused&&this.editor.editing.view.focus(),this._showPrevStack()}),e}_createFakePanelsView(){const e=new _c(this.editor.locale,this.view);return e.bind("numberOfPanels").to(this,"_numberOfStacks",this,"_singleViewMode",(t,n)=>!n&&t>=2?Math.min(t-1,2):0),e.listenTo(this.view,"change:top",()=>e.updatePosition()),e.listenTo(this.view,"change:left",()=>e.updatePosition()),this.editor.ui.view.body.add(e),e}_showView({view:e,balloonClassName:t="",withArrow:n=!0,singleViewMode:i=!1}){this.view.class=t,this.view.withArrow=n,this._rotatorView.showView(e),this.visibleView=e,this.view.pin(this._getBalloonPosition()),this._fakePanelsView.updatePosition(),i&&(this._singleViewMode=!0)}_getBalloonPosition(){let e=Array.from(this._visibleStack.values()).pop().position;return e&&(e.limiter||(e=Object.assign({},e,{limiter:this.positionLimiter})),e=Object.assign({},e,{viewportOffsetConfig:this.editor.ui.viewportOffset})),e}}class yc extends T{constructor(e){super(e);const t=e.t,n=this.bindTemplate;this.set("isNavigationVisible",!0),this.focusTracker=new X,this.buttonPrevView=this._createButtonView(t("Previous"),C.previousArrow),this.buttonNextView=this._createButtonView(t("Next"),C.nextArrow),this.content=this.createCollection(),this.setTemplate({tag:"div",attributes:{class:["ck","ck-balloon-rotator"],"z-index":"-1"},children:[{tag:"div",attributes:{class:["ck-balloon-rotator__navigation",n.to("isNavigationVisible",i=>i?"":"ck-hidden")]},children:[this.buttonPrevView,{tag:"span",attributes:{class:["ck-balloon-rotator__counter"]},children:[{text:n.to("counter")}]},this.buttonNextView]},{tag:"div",attributes:{class:"ck-balloon-rotator__content"},children:this.content}]})}render(){super.render(),this.focusTracker.add(this.element)}destroy(){super.destroy(),this.focusTracker.destroy()}showView(e){this.hideView(),this.content.add(e)}hideView(){this.content.clear()}_createButtonView(e,t){const n=new y(this.locale);return n.set({label:e,icon:t,tooltip:!0}),n}}class _c extends T{constructor(e,t){super(e);const n=this.bindTemplate;this.set("top",0),this.set("left",0),this.set("height",0),this.set("width",0),this.set("numberOfPanels",0),this.content=this.createCollection(),this._balloonPanelView=t,this.setTemplate({tag:"div",attributes:{class:["ck-fake-panel",n.to("numberOfPanels",i=>i?"":"ck-hidden")],style:{top:n.to("top",Ye),left:n.to("left",Ye),width:n.to("width",Ye),height:n.to("height",Ye)}},children:this.content}),this.on("change:numberOfPanels",(i,o,r,l)=>{r>l?this._addPanels(r-l):this._removePanels(l-r),this.updatePosition()})}_addPanels(e){for(;e--;){const t=new T;t.setTemplate({tag:"div"}),this.content.add(t),this.registerChild(t)}}_removePanels(e){for(;e--;){const t=this.content.last;this.content.remove(t),this.deregisterChild(t),t.destroy()}}updatePosition(){if(this.numberOfPanels){const{top:e,left:t}=this._balloonPanelView,{width:n,height:i}=new N(this._balloonPanelView.element);Object.assign(this,{top:e,left:t,width:n,height:i})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const yn=["left","right","center","justify"];function oo(s){return yn.includes(s)}function ro(s,e){return e.contentLanguageDirection=="rtl"?s==="right":s==="left"}function lo(s){const e=s.map(n=>{let i;return typeof n=="string"?i={name:n}:i=n,i}).filter(n=>{const i=yn.includes(n.name);return i||$("alignment-config-name-not-recognized",{option:n}),i}),t=e.filter(n=>!!n.className).length;if(t&&t<e.length)throw new L("alignment-config-classnames-are-missing",{configuredOptions:s});return e.forEach((n,i,o)=>{const r=o.slice(i+1);if(r.some(a=>a.name==n.name))throw new L("alignment-config-name-already-defined",{option:n,configuredOptions:s});if(n.className&&r.some(c=>c.className==n.className))throw new L("alignment-config-classname-already-defined",{option:n,configuredOptions:s})}),e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const _n="alignment";class Ic extends k{refresh(){const t=this.editor.locale,n=M(this.editor.model.document.selection.getSelectedBlocks());this.isEnabled=!!n&&this._canBeAligned(n),this.isEnabled&&n.hasAttribute("alignment")?this.value=n.getAttribute("alignment"):this.value=t.contentLanguageDirection==="rtl"?"right":"left"}execute(e={}){const t=this.editor,n=t.locale,i=t.model,o=i.document,r=e.value;i.change(l=>{const a=Array.from(o.selection.getSelectedBlocks()).filter(u=>this._canBeAligned(u)),c=a[0].getAttribute("alignment");ro(r,n)||c===r||!r?Tc(a,l):Ec(a,l,r)})}_canBeAligned(e){return this.editor.model.schema.checkAttribute(e,_n)}}function Tc(s,e){for(const t of s)e.removeAttribute(_n,t)}function Ec(s,e,t){for(const n of s)e.setAttribute(_n,t,n)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ac extends f{static get pluginName(){return"AlignmentEditing"}constructor(e){super(e),e.config.define("alignment",{options:yn.map(t=>({name:t}))})}init(){const e=this.editor,t=e.locale,n=e.model.schema,o=lo(e.config.get("alignment.options")).filter(c=>oo(c.name)&&!ro(c.name,t)),r=o.some(c=>!!c.className);n.extend("$block",{allowAttributes:"alignment"}),e.model.schema.setAttributeProperties("alignment",{isFormatting:!0}),r?e.conversion.attributeToAttribute(Vc(o)):e.conversion.for("downcast").attributeToAttribute(Sc(o));const l=xc(o);for(const c of l)e.conversion.for("upcast").attributeToAttribute(c);const a=Rc(o);for(const c of a)e.conversion.for("upcast").attributeToAttribute(c);e.commands.add("alignment",new Ic(e))}}function Sc(s){const e={};for(const{name:n}of s)e[n]={key:"style",value:{"text-align":n}};return{model:{key:"alignment",values:s.map(n=>n.name)},view:e}}function xc(s){const e=[];for(const{name:t}of s)e.push({view:{key:"style",value:{"text-align":t}},model:{key:"alignment",value:t}});return e}function Rc(s){const e=[];for(const{name:t}of s)e.push({view:{key:"align",value:t},model:{key:"alignment",value:t}});return e}function Vc(s){const e={};for(const n of s)e[n.name]={key:"class",value:n.className};return{model:{key:"alignment",values:s.map(n=>n.name)},view:e}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Je=new Map([["left",C.alignLeft],["right",C.alignRight],["center",C.alignCenter],["justify",C.alignJustify]]);class Pc extends f{get localizedOptionTitles(){const e=this.editor.t;return{left:e("Align left"),right:e("Align right"),center:e("Align center"),justify:e("Justify")}}static get pluginName(){return"AlignmentUI"}init(){const e=this.editor,t=e.ui.componentFactory,n=e.t,i=lo(e.config.get("alignment.options"));i.map(o=>o.name).filter(oo).forEach(o=>this._addButton(o)),t.add("alignment",o=>{const r=W(o);As(r,()=>i.map(c=>t.create(`alignment:${c.name}`)),{enableActiveItemFocusOnDropdownOpen:!0,isVertical:!0,ariaLabel:n("Text alignment toolbar")}),r.buttonView.set({label:n("Text alignment"),tooltip:!0}),r.extendTemplate({attributes:{class:"ck-alignment-dropdown"}});const l=o.contentLanguageDirection==="rtl"?Je.get("right"):Je.get("left"),a=e.commands.get("alignment");return r.buttonView.bind("icon").to(a,"value",c=>Je.get(c)||l),r.bind("isEnabled").to(a,"isEnabled"),this.listenTo(r,"execute",()=>{e.editing.view.focus()}),r})}_addButton(e){const t=this.editor;t.ui.componentFactory.add(`alignment:${e}`,n=>{const i=t.commands.get("alignment"),o=new y(n);return o.set({label:this.localizedOptionTitles[e],icon:Je.get(e),tooltip:!0,isToggleable:!0}),o.bind("isEnabled").to(i),o.bind("isOn").to(i,"value",r=>r===e),this.listenTo(o,"execute",()=>{t.execute("alignment",{value:e}),t.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bc extends f{static get requires(){return[Ac,Pc]}static get pluginName(){return"Alignment"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Lc extends k{constructor(e,t){super(e),this._buffer=new Ur(e.model,t),this._isEnabledBasedOnSelection=!1}get buffer(){return this._buffer}destroy(){super.destroy(),this._buffer.destroy()}execute(e={}){const t=this.editor.model,n=t.document,i=e.text||"",o=i.length;let r=n.selection;if(e.selection?r=e.selection:e.range&&(r=t.createSelection(e.range)),!t.canEditAt(r))return;const l=e.resultRange;t.enqueueChange(this._buffer.batch,a=>{this._buffer.lock();const c=Array.from(n.selection.getAttributes());t.deleteContent(r),i&&t.insertContent(a.createText(i,c),r),l?a.setSelection(l):r.is("documentSelection")||a.setSelection(r),this._buffer.unlock(),this._buffer.input(o)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Yn=["insertText","insertReplacementText"];class Dc extends Ss{constructor(e){super(e),this.focusObserver=e.getObserver(Or),S.isAndroid&&Yn.push("insertCompositionText");const t=e.document;t.on("beforeinput",(n,i)=>{if(!this.isEnabled)return;const{data:o,targetRanges:r,inputType:l,domEvent:a}=i;if(!Yn.includes(l))return;this.focusObserver.flush();const c=new pn(t,"insertText");t.fire(c,new Dn(e,a,{text:o,selection:e.createSelection(r)})),c.stop.called&&n.stop()}),t.on("compositionend",(n,{data:i,domEvent:o})=>{!this.isEnabled||S.isAndroid||i&&t.fire("insertText",new Dn(e,o,{text:i,selection:t.selection}))},{priority:"lowest"})}observe(){}stopObserving(){}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ao extends f{static get pluginName(){return"Input"}init(){const e=this.editor,t=e.model,n=e.editing.view,i=t.document.selection;n.addObserver(Dc);const o=new Lc(e,e.config.get("typing.undoStep")||20);e.commands.add("insertText",o),e.commands.add("input",o),this.listenTo(n.document,"insertText",(r,l)=>{n.document.isComposing||l.preventDefault();const{text:a,selection:c,resultRange:d}=l,u=Array.from(c.getRanges()).map(g=>e.editing.mapper.toModelRange(g));let m=a;if(S.isAndroid){const g=Array.from(u[0].getItems()).reduce((p,b)=>p+(b.is("$textProxy")?b.data:""),"");g&&(g.length<=m.length?m.startsWith(g)&&(m=m.substring(g.length),u[0].start=u[0].start.getShiftedBy(g.length)):g.startsWith(m)&&(u[0].start=u[0].start.getShiftedBy(m.length),m=""))}const h={text:m,selection:t.createSelection(u)};d&&(h.resultRange=e.editing.mapper.toModelRange(d)),e.execute("insertText",h),n.scrollToTheSelection()}),S.isAndroid?this.listenTo(n.document,"keydown",(r,l)=>{i.isCollapsed||l.keyCode!=229||!n.document.isComposing||Jn(t,o)}):this.listenTo(n.document,"compositionstart",()=>{i.isCollapsed||Jn(t,o)})}}function Jn(s,e){if(!e.isEnabled)return;const t=e.buffer;t.lock(),s.enqueueChange(t.batch,()=>{s.deleteContent(s.document.selection)}),t.unlock()}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fc extends f{static get requires(){return[ao,re]}static get pluginName(){return"Typing"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function co(s,e){let t=s.start;return{text:Array.from(s.getWalker({ignoreElementEnd:!1})).reduce((i,{item:o})=>o.is("$text")||o.is("$textProxy")?i+o.data:(t=e.createPositionAfter(o),""),""),range:e.createRange(t,s.end)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uo extends Z(){constructor(e,t){super(),this.model=e,this.testCallback=t,this._hasMatch=!1,this.set("isEnabled",!0),this.on("change:isEnabled",()=>{this.isEnabled?this._startListening():(this.stopListening(e.document.selection),this.stopListening(e.document))}),this._startListening()}get hasMatch(){return this._hasMatch}_startListening(){const t=this.model.document;this.listenTo(t.selection,"change:range",(n,{directChange:i})=>{if(i){if(!t.selection.isCollapsed){this.hasMatch&&(this.fire("unmatched"),this._hasMatch=!1);return}this._evaluateTextBeforeSelection("selection")}}),this.listenTo(t,"change:data",(n,i)=>{i.isUndo||!i.isLocal||this._evaluateTextBeforeSelection("data",{batch:i})})}_evaluateTextBeforeSelection(e,t={}){const n=this.model,o=n.document.selection,r=n.createRange(n.createPositionAt(o.focus.parent,0),o.focus),{text:l,range:a}=co(r,n),c=this.testCallback(l);if(!c&&this.hasMatch&&this.fire("unmatched"),this._hasMatch=!!c,c){const d=Object.assign(t,{text:l,range:a});typeof c=="object"&&Object.assign(d,c),this.fire(`matched:${e}`,d)}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ei extends f{static get pluginName(){return"TwoStepCaretMovement"}constructor(e){super(e),this._isNextGravityRestorationSkipped=!1,this.attributes=new Set,this._overrideUid=null}init(){const e=this.editor,t=e.model,n=e.editing.view,i=e.locale,o=t.document.selection;this.listenTo(n.document,"arrowKey",(r,l)=>{if(!o.isCollapsed||l.shiftKey||l.altKey||l.ctrlKey)return;const a=l.keyCode==Fe.arrowright,c=l.keyCode==Fe.arrowleft;if(!a&&!c)return;const d=i.contentLanguageDirection;let u=!1;d==="ltr"&&a||d==="rtl"&&c?u=this._handleForwardMovement(l):u=this._handleBackwardMovement(l),u===!0&&r.stop()},{context:"$text",priority:"highest"}),this.listenTo(o,"change:range",(r,l)=>{if(this._isNextGravityRestorationSkipped){this._isNextGravityRestorationSkipped=!1;return}this._isGravityOverridden&&(!l.directChange&&z(o.getFirstPosition(),this.attributes)||this._restoreGravity())}),this._enableClickingAfterNode(),this._enableInsertContentSelectionAttributesFixer(),this._handleDeleteContentAfterNode()}registerAttribute(e){this.attributes.add(e)}_handleForwardMovement(e){const t=this.attributes,n=this.editor.model,i=n.document.selection,o=i.getFirstPosition();return this._isGravityOverridden||o.isAtStart&&Y(i,t)?!1:z(o,t)?(xe(e),Y(i,t)&&z(o,t,!0)?Se(n,t):this._overrideGravity(),!0):!1}_handleBackwardMovement(e){const t=this.attributes,n=this.editor.model,i=n.document.selection,o=i.getFirstPosition();return this._isGravityOverridden?(xe(e),this._restoreGravity(),z(o,t,!0)?Se(n,t):et(n,t,o),!0):o.isAtStart?Y(i,t)?(xe(e),et(n,t,o),!0):!1:!Y(i,t)&&z(o,t,!0)?(xe(e),et(n,t,o),!0):ti(o,t)?o.isAtEnd&&!Y(i,t)&&z(o,t)?(xe(e),et(n,t,o),!0):(this._isNextGravityRestorationSkipped=!0,this._overrideGravity(),!1):!1}_enableClickingAfterNode(){const e=this.editor,t=e.model,n=t.document.selection,i=e.editing.view.document;e.editing.view.addObserver(yt);let o=!1;this.listenTo(i,"mousedown",()=>{o=!0}),this.listenTo(i,"selectionChange",()=>{const r=this.attributes;if(!o||(o=!1,!n.isCollapsed)||!Y(n,r))return;const l=n.getFirstPosition();z(l,r)&&(l.isAtStart||z(l,r,!0)?Se(t,r):this._isGravityOverridden||this._overrideGravity())})}_enableInsertContentSelectionAttributesFixer(){const t=this.editor.model,n=t.document.selection,i=this.attributes;this.listenTo(t,"insertContent",()=>{const o=n.getFirstPosition();Y(n,i)&&z(o,i)&&Se(t,i)},{priority:"low"})}_handleDeleteContentAfterNode(){const e=this.editor,t=e.model,n=t.document.selection,i=e.editing.view;let o=!1,r=!1;this.listenTo(i.document,"delete",(l,a)=>{o=a.direction==="backward"},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{if(!o)return;const l=n.getFirstPosition();r=Y(n,this.attributes)&&!ti(l,this.attributes)},{priority:"high"}),this.listenTo(t,"deleteContent",()=>{o&&(o=!1,!r&&e.model.enqueueChange(()=>{const l=n.getFirstPosition();Y(n,this.attributes)&&z(l,this.attributes)&&(l.isAtStart||z(l,this.attributes,!0)?Se(t,this.attributes):this._isGravityOverridden||this._overrideGravity())}))},{priority:"low"})}get _isGravityOverridden(){return!!this._overrideUid}_overrideGravity(){this._overrideUid=this.editor.model.change(e=>e.overrideSelectionGravity())}_restoreGravity(){this.editor.model.change(e=>{e.restoreSelectionGravity(this._overrideUid),this._overrideUid=null})}}function Y(s,e){for(const t of e)if(s.hasAttribute(t))return!0;return!1}function et(s,e,t){const n=t.nodeBefore;s.change(i=>{if(n){const o=[],r=s.schema.isObject(n)&&s.schema.isInline(n);for(const[l,a]of n.getAttributes())s.schema.checkAttribute("$text",l)&&(!r||s.schema.getAttributeProperties(l).copyFromObject!==!1)&&o.push([l,a]);i.setSelectionAttribute(o)}else i.removeSelectionAttribute(e)})}function Se(s,e){s.change(t=>{t.removeSelectionAttribute(e)})}function xe(s){s.preventDefault()}function ti(s,e){const t=s.getShiftedBy(-1);return z(t,e)}function z(s,e,t=!1){const{nodeBefore:n,nodeAfter:i}=s;for(const o of e){const r=n?n.getAttribute(o):void 0,l=i?i.getAttribute(o):void 0;if(!(t&&(r===void 0||l===void 0))&&l!==r)return!0}return!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ni={copyright:{from:"(c)",to:""},registeredTrademark:{from:"(r)",to:""},trademark:{from:"(tm)",to:""},oneHalf:{from:/(^|[^/a-z0-9])(1\/2)([^/a-z0-9])$/i,to:[null,"",null]},oneThird:{from:/(^|[^/a-z0-9])(1\/3)([^/a-z0-9])$/i,to:[null,"",null]},twoThirds:{from:/(^|[^/a-z0-9])(2\/3)([^/a-z0-9])$/i,to:[null,"",null]},oneForth:{from:/(^|[^/a-z0-9])(1\/4)([^/a-z0-9])$/i,to:[null,"",null]},threeQuarters:{from:/(^|[^/a-z0-9])(3\/4)([^/a-z0-9])$/i,to:[null,"",null]},lessThanOrEqual:{from:"<=",to:""},greaterThanOrEqual:{from:">=",to:""},notEqual:{from:"!=",to:""},arrowLeft:{from:"<-",to:""},arrowRight:{from:"->",to:""},horizontalEllipsis:{from:"...",to:""},enDash:{from:/(^| )(--)( )$/,to:[null,"",null]},emDash:{from:/(^| )(---)( )$/,to:[null,"",null]},quotesPrimary:{from:fe('"'),to:[null,"",null,""]},quotesSecondary:{from:fe("'"),to:[null,"",null,""]},quotesPrimaryEnGb:{from:fe("'"),to:[null,"",null,""]},quotesSecondaryEnGb:{from:fe('"'),to:[null,"",null,""]},quotesPrimaryPl:{from:fe('"'),to:[null,"",null,""]},quotesSecondaryPl:{from:fe("'"),to:[null,"",null,""]}},ii={symbols:["copyright","registeredTrademark","trademark"],mathematical:["oneHalf","oneThird","twoThirds","oneForth","threeQuarters","lessThanOrEqual","greaterThanOrEqual","notEqual","arrowLeft","arrowRight"],typography:["horizontalEllipsis","enDash","emDash"],quotes:["quotesPrimary","quotesSecondary"]},Mc=["symbols","mathematical","typography","quotes"];class Uc extends f{static get requires(){return["Delete","Input"]}static get pluginName(){return"TextTransformation"}constructor(e){super(e),e.config.define("typing",{transformations:{include:Mc}})}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTransformationWatchers()}_enableTransformationWatchers(){const e=this.editor,t=e.model,n=e.plugins.get("Delete"),i=Hc(e.config.get("typing.transformations")),o=l=>{for(const a of i)if(a.from.test(l))return{normalizedTransformation:a}},r=new uo(e.model,o);r.on("matched:data",(l,a)=>{if(!a.batch.isTyping)return;const{from:c,to:d}=a.normalizedTransformation,u=c.exec(a.text),m=d(u.slice(1)),h=a.range;let g=u.index;t.enqueueChange(p=>{for(let b=1;b<u.length;b++){const w=u[b],v=m[b-1];if(v==null){g+=w.length;continue}const I=h.start.getShiftedBy(g),x=t.createRange(I,I.getShiftedBy(w.length)),R=zc(I);t.insertContent(p.createText(v,R),x),g+=v.length}t.enqueueChange(()=>{n.requestUndoOnBackspace()})})}),r.bind("isEnabled").to(this)}}function Oc(s){return typeof s=="string"?new RegExp(`(${Nr(s)})$`):s}function Nc(s){return typeof s=="string"?()=>[s]:s instanceof Array?()=>s:s}function zc(s){return(s.textNode?s.textNode:s.nodeAfter).getAttributes()}function fe(s){return new RegExp(`(^|\\s)(${s})([^${s}]*)(${s})$`)}function Hc(s){const e=s.extra||[],t=s.remove||[],n=o=>!t.includes(o),i=s.include.concat(e).filter(n);return $c(i).filter(n).map(o=>typeof o=="string"&&ni[o]?ni[o]:o).filter(o=>typeof o=="object").map(o=>({from:Oc(o.from),to:Nc(o.to)}))}function $c(s){const e=new Set;for(const t of s)if(typeof t=="string"&&ii[t])for(const n of ii[t])e.add(n);else e.add(t);return Array.from(e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function _t(s,e,t,n){return n.createRange(si(s,e,t,!0,n),si(s,e,t,!1,n))}function si(s,e,t,n,i){let o=s.textNode||(n?s.nodeBefore:s.nodeAfter),r=null;for(;o&&o.getAttribute(e)==t;)r=o,o=n?o.previousSibling:o.nextSibling;return r?i.createPositionAt(r,n?"before":"after"):s}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Wc(s,e,t,n){const i=s.editing.view,o=new Set;i.document.registerPostFixer(r=>{const l=s.model.document.selection;let a=!1;if(l.hasAttribute(e)){const c=_t(l.getFirstPosition(),e,l.getAttribute(e),s.model),d=s.editing.mapper.toViewRange(c);for(const u of d.getItems())u.is("element",t)&&!u.hasClass(n)&&(r.addClass(n,u),o.add(u),a=!0)}return a}),s.conversion.for("editingDowncast").add(r=>{r.on("insert",l,{priority:"highest"}),r.on("remove",l,{priority:"highest"}),r.on("attribute",l,{priority:"highest"}),r.on("selection",l,{priority:"highest"});function l(){i.change(a=>{for(const c of o.values())a.removeClass(n,c),o.delete(c)})}})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function oe(s,e,t,n){let i,o=null;typeof n=="function"?i=n:(o=s.commands.get(n),i=()=>{s.execute(n)}),s.model.document.on("change:data",(r,l)=>{if(o&&!o.isEnabled||!e.isEnabled)return;const a=M(s.model.document.selection.getRanges());if(!a.isCollapsed||l.isUndo||!l.isLocal)return;const c=Array.from(s.model.document.differ.getChanges()),d=c[0];if(c.length!=1||d.type!=="insert"||d.name!="$text"||d.length!=1)return;const u=d.position.parent;if(u.is("element","codeBlock")||u.is("element","listItem")&&typeof n!="function"&&!["numberedList","bulletedList","todoList"].includes(n)||o&&o.value===!0)return;const m=u.getChild(0),h=s.model.createRangeOn(m);if(!h.containsRange(a)&&!a.end.isEqual(h.end))return;const g=t.exec(m.data.substr(0,a.end.offset));g&&s.model.enqueueChange(p=>{const b=p.createPositionAt(u,0),w=p.createPositionAt(u,g[0].length),v=new ke(b,w);if(i({match:g})!==!1){p.remove(v);const x=s.model.document.selection.getFirstRange(),R=p.createRangeIn(u);u.isEmpty&&!R.isEqual(x)&&!R.containsRange(x,!0)&&p.remove(u)}v.detach(),s.model.enqueueChange(()=>{s.plugins.get("Delete").requestUndoOnBackspace()})})})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function pe(s,e,t,n){let i,o;t instanceof RegExp?i=t:o=t,o=o||(r=>{let l;const a=[],c=[];for(;(l=i.exec(r))!==null&&!(l&&l.length<4);){let{index:d,"1":u,"2":m,"3":h}=l;const g=u+m+h;d+=l[0].length-g.length;const p=[d,d+u.length],b=[d+u.length+m.length,d+u.length+m.length+h.length];a.push(p),a.push(b),c.push([d+u.length,d+u.length+m.length])}return{remove:a,format:c}}),s.model.document.on("change:data",(r,l)=>{if(l.isUndo||!l.isLocal||!e.isEnabled)return;const a=s.model,c=a.document.selection;if(!c.isCollapsed)return;const d=Array.from(a.document.differ.getChanges()),u=d[0];if(d.length!=1||u.type!=="insert"||u.name!="$text"||u.length!=1)return;const m=c.focus,h=m.parent,{text:g,range:p}=qc(a.createRange(a.createPositionAt(h,0),m),a),b=o(g),w=oi(p.start,b.format,a),v=oi(p.start,b.remove,a);w.length&&v.length&&a.enqueueChange(I=>{if(n(I,w)!==!1){for(const R of v.reverse())I.remove(R);a.enqueueChange(()=>{s.plugins.get("Delete").requestUndoOnBackspace()})}})})}function oi(s,e,t){return e.filter(n=>n[0]!==void 0&&n[1]!==void 0).map(n=>t.createRange(s.getShiftedBy(n[0]),s.getShiftedBy(n[1])))}function qc(s,e){let t=s.start;return{text:Array.from(s.getItems()).reduce((i,o)=>!(o.is("$text")||o.is("$textProxy"))||o.getAttribute("code")?(t=e.createPositionAfter(o),""):i+o.data,""),range:e.createRange(t,s.end)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gc extends f{static get requires(){return[re]}static get pluginName(){return"Autoformat"}afterInit(){const e=this.editor,t=this.editor.t;this._addListAutoformats(),this._addBasicStylesAutoformats(),this._addHeadingAutoformats(),this._addBlockQuoteAutoformats(),this._addCodeBlockAutoformats(),this._addHorizontalLineAutoformats(),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Revert autoformatting action"),keystroke:"Backspace"}]})}_addListAutoformats(){const e=this.editor.commands;e.get("bulletedList")&&oe(this.editor,this,/^[*-]\s$/,"bulletedList"),e.get("numberedList")&&oe(this.editor,this,/^1[.|)]\s$/,"numberedList"),e.get("todoList")&&oe(this.editor,this,/^\[\s?\]\s$/,"todoList"),e.get("checkTodoList")&&oe(this.editor,this,/^\[\s?x\s?\]\s$/,()=>{this.editor.execute("todoList"),this.editor.execute("checkTodoList")})}_addBasicStylesAutoformats(){const e=this.editor.commands;if(e.get("bold")){const t=tt(this.editor,"bold");pe(this.editor,this,/(?:^|\s)(\*\*)([^*]+)(\*\*)$/g,t),pe(this.editor,this,/(?:^|\s)(__)([^_]+)(__)$/g,t)}if(e.get("italic")){const t=tt(this.editor,"italic");pe(this.editor,this,/(?:^|\s)(\*)([^*_]+)(\*)$/g,t),pe(this.editor,this,/(?:^|\s)(_)([^_]+)(_)$/g,t)}if(e.get("code")){const t=tt(this.editor,"code");pe(this.editor,this,/(`)([^`]+)(`)$/g,t)}if(e.get("strikethrough")){const t=tt(this.editor,"strikethrough");pe(this.editor,this,/(~~)([^~]+)(~~)$/g,t)}}_addHeadingAutoformats(){const e=this.editor.commands.get("heading");e&&e.modelElements.filter(t=>t.match(/^heading[1-6]$/)).forEach(t=>{const n=t[7],i=new RegExp(`^(#{${n}})\\s$`);oe(this.editor,this,i,()=>{if(!e.isEnabled||e.value===t)return!1;this.editor.execute("heading",{value:t})})})}_addBlockQuoteAutoformats(){this.editor.commands.get("blockQuote")&&oe(this.editor,this,/^>\s$/,"blockQuote")}_addCodeBlockAutoformats(){const e=this.editor,t=e.model.document.selection;e.commands.get("codeBlock")&&oe(e,this,/^```$/,()=>{if(t.getFirstPosition().parent.is("element","listItem"))return!1;this.editor.execute("codeBlock",{usePreviousLanguageChoice:!0})})}_addHorizontalLineAutoformats(){this.editor.commands.get("horizontalLine")&&oe(this.editor,this,/^---$/,"horizontalLine")}}function tt(s,e){return(t,n)=>{if(!s.commands.get(e).isEnabled)return!1;const o=s.model.schema.getValidRanges(n,e);for(const r of o)t.setAttribute(e,!0,r);t.removeSelectionAttribute(e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Te extends k{constructor(e,t){super(e),this.attributeKey=t}refresh(){const e=this.editor.model,t=e.document;this.value=this._getValueFromFirstAllowedNode(),this.isEnabled=e.schema.checkAttributeInSelection(t.selection,this.attributeKey)}execute(e={}){const t=this.editor.model,i=t.document.selection,o=e.forceValue===void 0?!this.value:e.forceValue;t.change(r=>{if(i.isCollapsed)o?r.setSelectionAttribute(this.attributeKey,!0):r.removeSelectionAttribute(this.attributeKey);else{const l=t.schema.getValidRanges(i.getRanges(),this.attributeKey);for(const a of l)o?r.setAttribute(this.attributeKey,o,a):r.removeAttribute(this.attributeKey,a)}})}_getValueFromFirstAllowedNode(){const e=this.editor.model,t=e.schema,n=e.document.selection;if(n.isCollapsed)return n.hasAttribute(this.attributeKey);for(const i of n.getRanges())for(const o of i.getItems())if(t.checkAttribute(o,this.attributeKey))return o.hasAttribute(this.attributeKey);return!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const be="bold";class jc extends f{static get pluginName(){return"BoldEditing"}init(){const e=this.editor,t=this.editor.t;e.model.schema.extend("$text",{allowAttributes:be}),e.model.schema.setAttributeProperties(be,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:be,view:"strong",upcastAlso:["b",n=>{const i=n.getStyle("font-weight");return i&&(i=="bold"||Number(i)>=600)?{name:!0,styles:["font-weight"]}:null}]}),e.commands.add(be,new Te(e,be)),e.keystrokes.set("CTRL+B",be),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Bold text"),keystroke:"CTRL+B"}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Pt="bold";class Kc extends f{static get pluginName(){return"BoldUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Pt,n=>{const i=e.commands.get(Pt),o=new y(n);return o.set({label:t("Bold"),icon:C.bold,keystroke:"CTRL+B",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(i,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Pt),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Qc extends f{static get requires(){return[jc,Kc]}static get pluginName(){return"Bold"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const we="italic";class Zc extends f{static get pluginName(){return"ItalicEditing"}init(){const e=this.editor,t=this.editor.t;e.model.schema.extend("$text",{allowAttributes:we}),e.model.schema.setAttributeProperties(we,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:we,view:"i",upcastAlso:["em",{styles:{"font-style":"italic"}}]}),e.commands.add(we,new Te(e,we)),e.keystrokes.set("CTRL+I",we),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Italic text"),keystroke:"CTRL+I"}]})}}const Xc='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m9.586 14.633.021.004c-.036.335.095.655.393.962.082.083.173.15.274.201h1.474a.6.6 0 1 1 0 1.2H5.304a.6.6 0 0 1 0-1.2h1.15c.474-.07.809-.182 1.005-.334.157-.122.291-.32.404-.597l2.416-9.55a1.053 1.053 0 0 0-.281-.823 1.12 1.12 0 0 0-.442-.296H8.15a.6.6 0 0 1 0-1.2h6.443a.6.6 0 1 1 0 1.2h-1.195c-.376.056-.65.155-.823.296-.215.175-.423.439-.623.79l-2.366 9.347z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Bt="italic";class Yc extends f{static get pluginName(){return"ItalicUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Bt,n=>{const i=e.commands.get(Bt),o=new y(n);return o.set({label:t("Italic"),icon:Xc,keystroke:"CTRL+I",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(i,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Bt),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jc extends f{static get requires(){return[Zc,Yc]}static get pluginName(){return"Italic"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Re="strikethrough";class ed extends f{static get pluginName(){return"StrikethroughEditing"}init(){const e=this.editor,t=this.editor.t;e.model.schema.extend("$text",{allowAttributes:Re}),e.model.schema.setAttributeProperties(Re,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:Re,view:"s",upcastAlso:["del","strike",{styles:{"text-decoration":"line-through"}}]}),e.commands.add(Re,new Te(e,Re)),e.keystrokes.set("CTRL+SHIFT+X","strikethrough"),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Strikethrough text"),keystroke:"CTRL+SHIFT+X"}]})}}const td='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M7 16.4c-.8-.4-1.5-.9-2.2-1.5a.6.6 0 0 1-.2-.5l.3-.6h1c1 1.2 2.1 1.7 3.7 1.7 1 0 1.8-.3 2.3-.6.6-.4.6-1.2.6-1.3.2-1.2-.9-2.1-.9-2.1h2.1c.3.7.4 1.2.4 1.7v.8l-.6 1.2c-.6.8-1.1 1-1.6 1.2a6 6 0 0 1-2.4.6c-1 0-1.8-.3-2.5-.6zM6.8 9 6 8.3c-.4-.5-.5-.8-.5-1.6 0-.7.1-1.3.5-1.8.4-.6 1-1 1.6-1.3a6.3 6.3 0 0 1 4.7 0 4 4 0 0 1 1.7 1l.3.7c0 .1.2.4-.2.7-.4.2-.9.1-1 0a3 3 0 0 0-1.2-1c-.4-.2-1-.3-2-.4-.7 0-1.4.2-2 .6-.8.6-1 .8-1 1.5 0 .8.5 1 1.2 1.5.6.4 1.1.7 1.9 1H6.8z"/><path d="M3 10.5V9h14v1.5z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Lt="strikethrough";class nd extends f{static get pluginName(){return"StrikethroughUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Lt,n=>{const i=e.commands.get(Lt),o=new y(n);return o.set({label:t("Strikethrough"),icon:td,keystroke:"CTRL+SHIFT+X",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(i,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Lt),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class id extends f{static get requires(){return[ed,nd]}static get pluginName(){return"Strikethrough"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ve="subscript";class sd extends f{static get pluginName(){return"SubscriptEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:Ve}),e.model.schema.setAttributeProperties(Ve,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:Ve,view:"sub",upcastAlso:[{styles:{"vertical-align":"sub"}}]}),e.commands.add(Ve,new Te(e,Ve))}}const od='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m7.03 10.349 3.818-3.819a.8.8 0 1 1 1.132 1.132L8.16 11.48l3.819 3.818a.8.8 0 1 1-1.132 1.132L7.03 12.61l-3.818 3.82a.8.8 0 1 1-1.132-1.132L5.9 11.48 2.08 7.662A.8.8 0 1 1 3.212 6.53l3.818 3.82zm8.147 7.829h2.549c.254 0 .447.05.58.152a.49.49 0 0 1 .201.413.54.54 0 0 1-.159.393c-.105.108-.266.162-.48.162h-3.594c-.245 0-.435-.066-.572-.197a.621.621 0 0 1-.205-.463c0-.114.044-.265.132-.453a1.62 1.62 0 0 1 .288-.444c.433-.436.824-.81 1.172-1.122.348-.312.597-.517.747-.615.267-.183.49-.368.667-.553.177-.185.312-.375.405-.57.093-.194.139-.384.139-.57a1.008 1.008 0 0 0-.554-.917 1.197 1.197 0 0 0-.56-.133c-.426 0-.761.182-1.005.546a2.332 2.332 0 0 0-.164.39 1.609 1.609 0 0 1-.258.488c-.096.114-.237.17-.423.17a.558.558 0 0 1-.405-.156.568.568 0 0 1-.161-.427c0-.218.05-.446.151-.683.101-.238.252-.453.452-.646s.454-.349.762-.467a2.998 2.998 0 0 1 1.081-.178c.498 0 .923.076 1.274.228a1.916 1.916 0 0 1 1.004 1.032 1.984 1.984 0 0 1-.156 1.794c-.2.32-.405.572-.613.754-.208.182-.558.468-1.048.857-.49.39-.826.691-1.008.906a2.703 2.703 0 0 0-.24.309z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Dt="subscript";class rd extends f{static get pluginName(){return"SubscriptUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Dt,n=>{const i=e.commands.get(Dt),o=new y(n);return o.set({label:t("Subscript"),icon:od,tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(i,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Dt),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ld extends f{static get requires(){return[sd,rd]}static get pluginName(){return"Subscript"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Pe="superscript";class ad extends f{static get pluginName(){return"SuperscriptEditing"}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:Pe}),e.model.schema.setAttributeProperties(Pe,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:Pe,view:"sup",upcastAlso:[{styles:{"vertical-align":"super"}}]}),e.commands.add(Pe,new Te(e,Pe))}}const cd='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M15.677 8.678h2.549c.254 0 .447.05.58.152a.49.49 0 0 1 .201.413.54.54 0 0 1-.159.393c-.105.108-.266.162-.48.162h-3.594c-.245 0-.435-.066-.572-.197a.621.621 0 0 1-.205-.463c0-.114.044-.265.132-.453a1.62 1.62 0 0 1 .288-.444c.433-.436.824-.81 1.172-1.122.348-.312.597-.517.747-.615.267-.183.49-.368.667-.553.177-.185.312-.375.405-.57.093-.194.139-.384.139-.57a1.008 1.008 0 0 0-.554-.917 1.197 1.197 0 0 0-.56-.133c-.426 0-.761.182-1.005.546a2.332 2.332 0 0 0-.164.39 1.609 1.609 0 0 1-.258.488c-.096.114-.237.17-.423.17a.558.558 0 0 1-.405-.156.568.568 0 0 1-.161-.427c0-.218.05-.446.151-.683.101-.238.252-.453.452-.646s.454-.349.762-.467a2.998 2.998 0 0 1 1.081-.178c.498 0 .923.076 1.274.228a1.916 1.916 0 0 1 1.004 1.032 1.984 1.984 0 0 1-.156 1.794c-.2.32-.405.572-.613.754-.208.182-.558.468-1.048.857-.49.39-.826.691-1.008.906a2.703 2.703 0 0 0-.24.309zM7.03 10.349l3.818-3.819a.8.8 0 1 1 1.132 1.132L8.16 11.48l3.819 3.818a.8.8 0 1 1-1.132 1.132L7.03 12.61l-3.818 3.82a.8.8 0 1 1-1.132-1.132L5.9 11.48 2.08 7.662A.8.8 0 1 1 3.212 6.53l3.818 3.82z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ft="superscript";class dd extends f{static get pluginName(){return"SuperscriptUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Ft,n=>{const i=e.commands.get(Ft),o=new y(n);return o.set({label:t("Superscript"),icon:cd,tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(i,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Ft),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ud extends f{static get requires(){return[ad,dd]}static get pluginName(){return"Superscript"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Be="underline";class md extends f{static get pluginName(){return"UnderlineEditing"}init(){const e=this.editor,t=this.editor.t;e.model.schema.extend("$text",{allowAttributes:Be}),e.model.schema.setAttributeProperties(Be,{isFormatting:!0,copyOnEnter:!0}),e.conversion.attributeToElement({model:Be,view:"u",upcastAlso:{styles:{"text-decoration":"underline"}}}),e.commands.add(Be,new Te(e,Be)),e.keystrokes.set("CTRL+U","underline"),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Underline text"),keystroke:"CTRL+U"}]})}}const hd='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M3 18v-1.5h14V18zm2.2-8V3.6c0-.4.4-.6.8-.6.3 0 .7.2.7.6v6.2c0 2 1.3 2.8 3.2 2.8 1.9 0 3.4-.9 3.4-2.9V3.6c0-.3.4-.5.8-.5.3 0 .7.2.7.5V10c0 2.7-2.2 4-4.9 4-2.6 0-4.7-1.2-4.7-4z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Mt="underline";class gd extends f{static get pluginName(){return"UnderlineUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add(Mt,n=>{const i=e.commands.get(Mt),o=new y(n);return o.set({label:t("Underline"),icon:hd,keystroke:"CTRL+U",tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(i,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute(Mt),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fd extends f{static get requires(){return[md,gd]}static get pluginName(){return"Underline"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pd extends k{execute(){const e=this.editor.model,t=e.document;e.change(n=>{wd(e,n,t.selection),this.fire("afterExecute",{writer:n})})}refresh(){const e=this.editor.model,t=e.document;this.isEnabled=bd(e.schema,t.selection)}}function bd(s,e){if(e.rangeCount>1)return!1;const t=e.anchor;if(!t||!s.checkChild(t,"softBreak"))return!1;const n=e.getFirstRange(),i=n.start.parent,o=n.end.parent;return!((Yt(i,s)||Yt(o,s))&&i!==o)}function wd(s,e,t){const n=t.isCollapsed,i=t.getFirstRange(),o=i.start.parent,r=i.end.parent,l=o==r;if(n){const a=zr(s.schema,t.getAttributes());ri(s,e,i.end),e.removeSelectionAttribute(t.getAttributeKeys()),e.setSelectionAttribute(a)}else{const a=!(i.start.isAtStart&&i.end.isAtEnd);s.deleteContent(t,{leaveUnmerged:a}),l?ri(s,e,t.focus):a&&e.setSelection(r,0)}}function ri(s,e,t){const n=e.createElement("softBreak");s.insertContent(n,t),e.setSelection(n,"after")}function Yt(s,e){return s.is("rootElement")?!1:e.isLimit(s)||Yt(s.parent,e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vd extends f{static get pluginName(){return"ShiftEnter"}init(){const e=this.editor,t=e.model.schema,n=e.conversion,i=e.editing.view,o=i.document,r=this.editor.t;t.register("softBreak",{allowWhere:"$text",isInline:!0}),n.for("upcast").elementToElement({model:"softBreak",view:"br"}),n.for("downcast").elementToElement({model:"softBreak",view:(l,{writer:a})=>a.createEmptyElement("br")}),i.addObserver(Hr),e.commands.add("shiftEnter",new pd(e)),this.listenTo(o,"enter",(l,a)=>{o.isComposing||a.preventDefault(),a.isSoft&&(e.execute("shiftEnter"),i.scrollToTheSelection())},{priority:"low"}),e.accessibility.addKeystrokeInfos({keystrokes:[{label:r("Insert a soft break (a <code>&lt;br&gt;</code> element)"),keystroke:"Shift+Enter"}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Cd extends k{refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=t.schema,i=t.document.selection,o=Array.from(i.getSelectedBlocks()),r=e.forceValue===void 0?!this.value:e.forceValue;t.change(l=>{if(!r)this._removeQuote(l,o.filter(nt));else{const a=o.filter(c=>nt(c)||ai(n,c));this._applyQuote(l,a)}})}_getValue(){const e=this.editor.model.document.selection,t=M(e.getSelectedBlocks());return!!(t&&nt(t))}_checkEnabled(){if(this.value)return!0;const e=this.editor.model.document.selection,t=this.editor.model.schema,n=M(e.getSelectedBlocks());return n?ai(t,n):!1}_removeQuote(e,t){li(e,t).reverse().forEach(n=>{if(n.start.isAtStart&&n.end.isAtEnd){e.unwrap(n.start.parent);return}if(n.start.isAtStart){const o=e.createPositionBefore(n.start.parent);e.move(n,o);return}n.end.isAtEnd||e.split(n.end);const i=e.createPositionAfter(n.end.parent);e.move(n,i)})}_applyQuote(e,t){const n=[];li(e,t).reverse().forEach(i=>{let o=nt(i.start);o||(o=e.createElement("blockQuote"),e.wrap(i,o)),n.push(o)}),n.reverse().reduce((i,o)=>i.nextSibling==o?(e.merge(e.createPositionAfter(i)),i):o)}}function nt(s){return s.parent.name=="blockQuote"?s.parent:null}function li(s,e){let t,n=0;const i=[];for(;n<e.length;){const o=e[n],r=e[n+1];t||(t=s.createPositionBefore(o)),(!r||o.nextSibling!=r)&&(i.push(s.createRange(t,s.createPositionAfter(o))),t=null),n++}return i}function ai(s,e){const t=s.checkChild(e.parent,"blockQuote"),n=s.checkChild(["$root","blockQuote"],e);return t&&n}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kd extends f{static get pluginName(){return"BlockQuoteEditing"}static get requires(){return[bn,re]}init(){const e=this.editor,t=e.model.schema;e.commands.add("blockQuote",new Cd(e)),t.register("blockQuote",{inheritAllFrom:"$container"}),e.conversion.elementToElement({model:"blockQuote",view:"blockquote"}),e.model.document.registerPostFixer(r=>{const l=e.model.document.differ.getChanges();for(const a of l)if(a.type=="insert"){const c=a.position.nodeAfter;if(!c)continue;if(c.is("element","blockQuote")&&c.isEmpty)return r.remove(c),!0;if(c.is("element","blockQuote")&&!t.checkChild(a.position,c))return r.unwrap(c),!0;if(c.is("element")){const d=r.createRangeIn(c);for(const u of d.getItems())if(u.is("element","blockQuote")&&!t.checkChild(r.createPositionBefore(u),u))return r.unwrap(u),!0}}else if(a.type=="remove"){const c=a.position.parent;if(c.is("element","blockQuote")&&c.isEmpty)return r.remove(c),!0}return!1});const n=this.editor.editing.view.document,i=e.model.document.selection,o=e.commands.get("blockQuote");this.listenTo(n,"enter",(r,l)=>{if(!i.isCollapsed||!o.value)return;i.getLastPosition().parent.isEmpty&&(e.execute("blockQuote"),e.editing.view.scrollToTheSelection(),l.preventDefault(),r.stop())},{context:"blockquote"}),this.listenTo(n,"delete",(r,l)=>{if(l.direction!="backward"||!i.isCollapsed||!o.value)return;const a=i.getLastPosition().parent;a.isEmpty&&!a.previousSibling&&(e.execute("blockQuote"),e.editing.view.scrollToTheSelection(),l.preventDefault(),r.stop())},{context:"blockquote"})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yd extends f{static get pluginName(){return"BlockQuoteUI"}init(){const e=this.editor,t=e.t;e.ui.componentFactory.add("blockQuote",n=>{const i=e.commands.get("blockQuote"),o=new y(n);return o.set({label:t("Block quote"),icon:C.quote,tooltip:!0,isToggleable:!0}),o.bind("isOn","isEnabled").to(i,"value","isEnabled"),this.listenTo(o,"execute",()=>{e.execute("blockQuote"),e.editing.view.focus()}),o})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _d extends f{static get requires(){return[kd,yd]}static get pluginName(){return"BlockQuote"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ue extends vt{constructor(e){super(e),this.domEventType=["paste","copy","cut","drop","dragover","dragstart","dragend","dragenter","dragleave"];const t=this.document;this.listenTo(t,"paste",n("clipboardInput"),{priority:"low"}),this.listenTo(t,"drop",n("clipboardInput"),{priority:"low"}),this.listenTo(t,"dragover",n("dragging"),{priority:"low"});function n(i){return(o,r)=>{r.preventDefault();const l=r.dropRange?[r.dropRange]:null,a=new pn(t,i);t.fire(a,{dataTransfer:r.dataTransfer,method:o.name,targetRanges:l,target:r.target,domEvent:r.domEvent}),a.stop.called&&r.stopPropagation()}}}onDomEvent(e){const t="clipboardData"in e?e.clipboardData:e.dataTransfer,n=e.type=="drop"||e.type=="paste",i={dataTransfer:new $r(t,{cacheFiles:n})};(e.type=="drop"||e.type=="dragover")&&(i.dropRange=Id(this.view,e)),this.fire(e.type,e,i)}}function Id(s,e){const t=e.target.ownerDocument,n=e.clientX,i=e.clientY;let o;return t.caretRangeFromPoint&&t.caretRangeFromPoint(n,i)?o=t.caretRangeFromPoint(n,i):e.rangeParent&&(o=t.createRange(),o.setStart(e.rangeParent,e.rangeOffset),o.collapse(!0)),o?s.domConverter.domRangeToView(o):null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Td(s){return s=s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r?\n\r?\n/g,"</p><p>").replace(/\r?\n/g,"<br>").replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;").replace(/^\s/,"&nbsp;").replace(/\s$/,"&nbsp;").replace(/\s\s/g," &nbsp;"),(s.includes("</p><p>")||s.includes("<br>"))&&(s=`<p>${s}</p>`),s}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ed(s){return s.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length==1?" ":t).replace(/<!--[\s\S]*?-->/g,"")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ci=["figcaption","li"],di=["ol","ul"];function mo(s){if(s.is("$text")||s.is("$textProxy"))return s.data;if(s.is("element","img")&&s.hasAttribute("alt"))return s.getAttribute("alt");if(s.is("element","br"))return`
`;let e="",t=null;for(const n of s.getChildren())e+=Ad(n,t)+mo(n),t=n;return e}function Ad(s,e){return e?s.is("element","li")&&!s.isEmpty&&s.getChild(0).is("containerElement")||di.includes(s.name)&&di.includes(e.name)?`

`:!s.is("containerElement")&&!e.is("containerElement")?"":ci.includes(s.name)||ci.includes(e.name)?`
`:`

`:""}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Le extends f{constructor(){super(...arguments),this._markersToCopy=new Map}static get pluginName(){return"ClipboardMarkersUtils"}_registerMarkerToCopy(e,t){const n=Array.isArray(t)?t:this._mapRestrictionPresetToActions(t);n.length&&this._markersToCopy.set(e,n)}_mapRestrictionPresetToActions(e){switch(e){case"always":return["copy","cut","dragstart"];case"default":return["cut","dragstart"];case"never":return[];default:return[]}}_copySelectedFragmentWithMarkers(e,t,n=i=>i.model.getSelectedContent(i.model.document.selection)){return this.editor.model.change(i=>{const o=i.model.document.selection;i.setSelection(t);const r=this._insertFakeMarkersIntoSelection(i,i.model.document.selection,e),l=n(i),a=this._removeFakeMarkersInsideElement(i,l);for(const[c,d]of Object.entries(r)){a[c]||(a[c]=i.createRangeIn(l));for(const u of d)i.remove(u)}l.markers.clear();for(const[c,d]of Object.entries(a))l.markers.set(c,d);return i.setSelection(o),l})}_pasteMarkersIntoTransformedElement(e,t){const n=this._getCopyableMarkersFromRangeMap(e);return this.editor.model.change(i=>{const o=this._insertFakeMarkersElements(i,n),r=t(i),l=this._removeFakeMarkersInsideElement(i,r);for(const a of Object.values(o).flat())i.remove(a);for(const[a,c]of Object.entries(l)){const d=i.model.markers.has(a)?this._getUniqueMarkerName(a):a;i.addMarker(d,{usingOperation:!0,affectsData:!0,range:c})}return r})}_forceMarkersCopy(e,t){const n=this._markersToCopy.get(e);this._markersToCopy.set(e,this._mapRestrictionPresetToActions("always")),t(),n?this._markersToCopy.set(e,n):this._markersToCopy.delete(e)}_canPerformMarkerClipboardAction(e,t){const[n]=e.split(":");return t?(this._markersToCopy.get(n)||[]).includes(t):this._markersToCopy.has(n)}_setUniqueMarkerNamesInFragment(e){const t=Array.from(e.markers);e.markers.clear();for(const[n,i]of t){const o=this._canPerformMarkerClipboardAction(n,null)?this._getUniqueMarkerName(n):n;e.markers.set(o,i)}}_insertFakeMarkersIntoSelection(e,t,n){const i=this._getCopyableMarkersFromSelection(e,t,n);return this._insertFakeMarkersElements(e,i)}_getCopyableMarkersFromSelection(e,t,n){return Array.from(t.getRanges()).flatMap(i=>Array.from(e.model.markers.getMarkersIntersectingRange(i))).filter(i=>this._canPerformMarkerClipboardAction(i.name,n)).map(i=>({name:i.name,range:i.getRange()}))}_getCopyableMarkersFromRangeMap(e,t=null){return(e instanceof Map?Array.from(e.entries()):Object.entries(e)).map(([i,o])=>({name:i,range:o})).filter(i=>this._canPerformMarkerClipboardAction(i.name,t))}_insertFakeMarkersElements(e,t){const n={},i=t.flatMap(o=>{const{start:r,end:l}=o.range;return[{position:r,marker:o,type:"start"},{position:l,marker:o,type:"end"}]}).sort(({position:o},{position:r})=>o.isBefore(r)?1:-1);for(const{position:o,marker:r,type:l}of i){const a=e.createElement("$marker",{"data-name":r.name,"data-type":l});n[r.name]||(n[r.name]=[]),n[r.name].push(a),e.insert(a,o)}return n}_removeFakeMarkersInsideElement(e,t){const i=this._getAllFakeMarkersFromElement(e,t).reduce((o,r)=>{const l=r.markerElement&&e.createPositionBefore(r.markerElement);let a=o[r.name];return a&&a.start&&a.end&&(o[this._getUniqueMarkerName(r.name)]=o[r.name],a=null),o[r.name]={...a,[r.type]:l},r.markerElement&&e.remove(r.markerElement),o},{});return oa(i,o=>new Wr(o.start||e.createPositionFromPath(t,[0]),o.end||e.createPositionAt(t,"end")))}_getAllFakeMarkersFromElement(e,t){const n=Array.from(e.createRangeIn(t)).flatMap(({item:r})=>{if(!r.is("element","$marker"))return[];const l=r.getAttribute("data-name"),a=r.getAttribute("data-type");return[{markerElement:r,name:l,type:a}]}),i=[],o=[];for(const r of n)r.type==="end"&&(n.some(a=>a.name===r.name&&a.type==="start")||i.push({markerElement:null,name:r.name,type:"start"})),r.type==="start"&&(n.some(a=>a.name===r.name&&a.type==="end")||o.unshift({markerElement:null,name:r.name,type:"end"}));return[...i,...n,...o]}_getUniqueMarkerName(e){const t=e.split(":"),n=Ct().substring(1,6);return t.length===3?`${t.slice(0,2).join(":")}:${n}`:`${t.join(":")}:${n}`}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class q extends f{static get pluginName(){return"ClipboardPipeline"}static get requires(){return[Le]}init(){this.editor.editing.view.addObserver(Ue),this._setupPasteDrop(),this._setupCopyCut()}_fireOutputTransformationEvent(e,t,n){const o=this.editor.plugins.get("ClipboardMarkersUtils")._copySelectedFragmentWithMarkers(n,t);this.fire("outputTransformation",{dataTransfer:e,content:o,method:n})}_setupPasteDrop(){const e=this.editor,t=e.model,n=e.editing.view,i=n.document,o=this.editor.plugins.get("ClipboardMarkersUtils");this.listenTo(i,"clipboardInput",(r,l)=>{l.method=="paste"&&!e.model.canEditAt(e.model.document.selection)&&r.stop()},{priority:"highest"}),this.listenTo(i,"clipboardInput",(r,l)=>{const a=l.dataTransfer;let c;if(l.content)c=l.content;else{let u="";a.getData("text/html")?u=Ed(a.getData("text/html")):a.getData("text/plain")&&(u=Td(a.getData("text/plain"))),c=this.editor.data.htmlProcessor.toView(u)}const d=new pn(this,"inputTransformation");this.fire(d,{content:c,dataTransfer:a,targetRanges:l.targetRanges,method:l.method}),d.stop.called&&r.stop(),n.scrollToTheSelection()},{priority:"low"}),this.listenTo(this,"inputTransformation",(r,l)=>{if(l.content.isEmpty)return;const c=this.editor.data.toModel(l.content,"$clipboardHolder");c.childCount!=0&&(r.stop(),t.change(()=>{this.fire("contentInsertion",{content:c,method:l.method,dataTransfer:l.dataTransfer,targetRanges:l.targetRanges})}))},{priority:"low"}),this.listenTo(this,"contentInsertion",(r,l)=>{o._setUniqueMarkerNamesInFragment(l.content)},{priority:"highest"}),this.listenTo(this,"contentInsertion",(r,l)=>{l.resultRange=t.insertContent(l.content)},{priority:"low"})}_setupCopyCut(){const e=this.editor,t=e.model.document,i=e.editing.view.document,o=(r,l)=>{const a=l.dataTransfer;l.preventDefault(),this._fireOutputTransformationEvent(a,t.selection,r.name)};this.listenTo(i,"copy",o,{priority:"low"}),this.listenTo(i,"cut",(r,l)=>{e.model.canEditAt(e.model.document.selection)?o(r,l):l.preventDefault()},{priority:"low"}),this.listenTo(this,"outputTransformation",(r,l)=>{const a=e.data.toView(l.content);i.fire("clipboardOutput",{dataTransfer:l.dataTransfer,content:a,method:l.method})},{priority:"low"}),this.listenTo(i,"clipboardOutput",(r,l)=>{l.content.isEmpty||(l.dataTransfer.setData("text/html",this.editor.data.htmlProcessor.toData(l.content)),l.dataTransfer.setData("text/plain",mo(l.content))),l.method=="cut"&&e.model.deleteContent(t.selection)},{priority:"low"})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Sd(s){const e=s.model;return(t,n)=>{const i=n.keyCode==Fe.arrowup,o=n.keyCode==Fe.arrowdown,r=n.shiftKey,l=e.document.selection;if(!i&&!o)return;const a=o;if(r&&Vd(l,a))return;const c=xd(s,l,a);if(c){if(c.isCollapsed){if(l.isCollapsed)return;if(r)return}(c.isCollapsed||Rd(s,c,a))&&(e.change(d=>{const u=a?c.end:c.start;if(r){const m=e.createSelection(l.anchor);m.setFocus(u),d.setSelection(m)}else d.setSelection(u)}),t.stop(),n.preventDefault(),n.stopPropagation())}}}function xd(s,e,t){const n=s.model;if(t){const i=e.isCollapsed?e.focus:e.getLastPosition(),o=ui(n,i,"forward");if(!o)return null;const r=n.createRange(i,o),l=mi(n.schema,r,"backward");return l?n.createRange(i,l):null}else{const i=e.isCollapsed?e.focus:e.getFirstPosition(),o=ui(n,i,"backward");if(!o)return null;const r=n.createRange(o,i),l=mi(n.schema,r,"forward");return l?n.createRange(l,i):null}}function ui(s,e,t){const n=s.schema,i=s.createRangeIn(e.root),o=t=="forward"?"elementStart":"elementEnd";for(const{previousPosition:r,item:l,type:a}of i.getWalker({startPosition:e,direction:t})){if(n.isLimit(l)&&!n.isInline(l))return r;if(a==o&&n.isBlock(l))return null}return null}function mi(s,e,t){const n=t=="backward"?e.end:e.start;if(s.checkChild(n,"$text"))return n;for(const{nextPosition:i}of e.getWalker({direction:t}))if(s.checkChild(i,"$text"))return i;return null}function Rd(s,e,t){const n=s.model,i=s.view.domConverter;if(t){const c=n.createSelection(e.start);n.modifySelection(c),!c.focus.isAtEnd&&!e.start.isEqual(c.focus)&&(e=n.createRange(c.focus,e.end))}const o=s.mapper.toViewRange(e),r=i.viewRangeToDom(o),l=N.getDomRangeRects(r);let a;for(const c of l){if(a===void 0){a=Math.round(c.bottom);continue}if(Math.round(c.top)>=a)return!1;a=Math.max(a,Math.round(c.bottom))}return!0}function Vd(s,e){return!s.isCollapsed&&s.isBackward==e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ge extends f{constructor(){super(...arguments),this._previouslySelected=new Set}static get pluginName(){return"Widget"}static get requires(){return[qr,re]}init(){const e=this.editor,t=e.editing.view,n=t.document,i=e.t;this.editor.editing.downcastDispatcher.on("selection",(o,r,l)=>{const a=l.writer,c=r.selection;if(c.isCollapsed)return;const d=c.getSelectedElement();if(!d)return;const u=e.editing.mapper.toViewElement(d);D(u)&&l.consumable.consume(c,"selection")&&a.setSelection(a.createRangeOn(u),{fake:!0,label:Gr(u)})}),this.editor.editing.downcastDispatcher.on("selection",(o,r,l)=>{this._clearPreviouslySelectedWidgets(l.writer);const a=l.writer,c=a.document.selection;let d=null;for(const u of c.getRanges())for(const m of u){const h=m.item;D(h)&&!Bd(h,d)&&(a.addClass(Fn,h),this._previouslySelected.add(h),d=h)}},{priority:"low"}),t.addObserver(yt),this.listenTo(n,"mousedown",(...o)=>this._onMousedown(...o)),this.listenTo(n,"arrowKey",(...o)=>{this._handleSelectionChangeOnArrowKeyPress(...o)},{context:[D,"$text"]}),this.listenTo(n,"arrowKey",(...o)=>{this._preventDefaultOnArrowKeyPress(...o)},{context:"$root"}),this.listenTo(n,"arrowKey",Sd(this.editor.editing),{context:"$text"}),this.listenTo(n,"delete",(o,r)=>{this._handleDelete(r.direction=="forward")&&(r.preventDefault(),o.stop())},{context:"$root"}),e.accessibility.addKeystrokeInfoGroup({id:"widget",label:i("Keystrokes that can be used when a widget is selected (for example: image, table, etc.)"),keystrokes:[{label:i("Insert a new paragraph directly after a widget"),keystroke:"Enter"},{label:i("Insert a new paragraph directly before a widget"),keystroke:"Shift+Enter"},{label:i("Move the caret to allow typing directly before a widget"),keystroke:[["arrowup"],["arrowleft"]]},{label:i("Move the caret to allow typing directly after a widget"),keystroke:[["arrowdown"],["arrowright"]]}]})}_onMousedown(e,t){const n=this.editor,i=n.editing.view,o=i.document;let r=t.target;if(t.domEvent.detail>=3){this._selectBlockContent(r)&&t.preventDefault();return}if(Pd(r)||!D(r)&&(r=r.findAncestor(D),!r))return;S.isAndroid&&t.preventDefault(),o.isFocused||i.focus();const l=n.editing.mapper.toModelElement(r);this._setSelectionOverElement(l)}_selectBlockContent(e){const t=this.editor,n=t.model,i=t.editing.mapper,o=n.schema,r=i.findMappedViewAncestor(this.editor.editing.view.createPositionAt(e,0)),l=Ld(i.toModelElement(r),n.schema);return l?(n.change(a=>{const c=o.isLimit(l)?null:Dd(a.createPositionAfter(l),o),d=a.createPositionAt(l,0),u=c?a.createPositionAt(c,0):a.createPositionAt(l,"end");a.setSelection(a.createRange(d,u))}),!0):!1}_handleSelectionChangeOnArrowKeyPress(e,t){const n=t.keyCode,i=this.editor.model,o=i.schema,r=i.document.selection,l=r.getSelectedElement(),a=xs(n,this.editor.locale.contentLanguageDirection),c=a=="down"||a=="right",d=a=="up"||a=="down";if(l&&o.isObject(l)){const m=c?r.getLastPosition():r.getFirstPosition(),h=o.getNearestSelectionRange(m,c?"forward":"backward");h&&(i.change(g=>{g.setSelection(h)}),t.preventDefault(),e.stop());return}if(!r.isCollapsed&&!t.shiftKey){const m=r.getFirstPosition(),h=r.getLastPosition(),g=m.nodeAfter,p=h.nodeBefore;(g&&o.isObject(g)||p&&o.isObject(p))&&(i.change(b=>{b.setSelection(c?h:m)}),t.preventDefault(),e.stop());return}if(!r.isCollapsed)return;const u=this._getObjectElementNextToSelection(c);if(u&&o.isObject(u)){if(o.isInline(u)&&d)return;this._setSelectionOverElement(u),t.preventDefault(),e.stop()}}_preventDefaultOnArrowKeyPress(e,t){const n=this.editor.model,i=n.schema,o=n.document.selection.getSelectedElement();o&&i.isObject(o)&&(t.preventDefault(),e.stop())}_handleDelete(e){const n=this.editor.model.document.selection;if(!this.editor.model.canEditAt(n)||!n.isCollapsed)return;const i=this._getObjectElementNextToSelection(e);if(i)return this.editor.model.change(o=>{let r=n.anchor.parent;for(;r.isEmpty;){const l=r;r=l.parent,o.remove(l)}this._setSelectionOverElement(i)}),!0}_setSelectionOverElement(e){this.editor.model.change(t=>{t.setSelection(t.createRangeOn(e))})}_getObjectElementNextToSelection(e){const t=this.editor.model,n=t.schema,i=t.document.selection,o=t.createSelection(i);if(t.modifySelection(o,{direction:e?"forward":"backward"}),o.isEqual(i))return null;const r=e?o.focus.nodeBefore:o.focus.nodeAfter;return r&&n.isObject(r)?r:null}_clearPreviouslySelectedWidgets(e){for(const t of this._previouslySelected)e.removeClass(Fn,t);this._previouslySelected.clear()}}function Pd(s){let e=s;for(;e;){if(e.is("editableElement")&&!e.is("rootElement"))return!0;if(D(e))return!1;e=e.parent}return!1}function Bd(s,e){return e?Array.from(s.getAncestors()).includes(e):!1}function Ld(s,e){for(const t of s.getAncestors({includeSelf:!0,parentFirst:!0})){if(e.checkChild(t,"$text"))return t;if(e.isLimit(t)&&!e.isObject(t))break}return null}function Dd(s,e){const t=new jr({startPosition:s});for(const{item:n}of t){if(e.isLimit(n)||!n.is("element"))return null;if(e.checkChild(n,"$text"))return n}return null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ht extends f{constructor(){super(...arguments),this._toolbarDefinitions=new Map}static get requires(){return[mt]}static get pluginName(){return"WidgetToolbarRepository"}init(){const e=this.editor;if(e.plugins.has("BalloonToolbar")){const t=e.plugins.get("BalloonToolbar");this.listenTo(t,"show",n=>{Fd(e.editing.view.document.selection)&&n.stop()},{priority:"high"})}this._balloon=this.editor.plugins.get("ContextualBalloon"),this.on("change:isEnabled",()=>{this._updateToolbarsVisibility()}),this.listenTo(e.ui,"update",()=>{this._updateToolbarsVisibility()}),this.listenTo(e.ui.focusTracker,"change:isFocused",()=>{this._updateToolbarsVisibility()},{priority:"low"})}destroy(){super.destroy();for(const e of this._toolbarDefinitions.values())e.view.destroy()}register(e,{ariaLabel:t,items:n,getRelatedElement:i,balloonClassName:o="ck-toolbar-container"}){if(!n.length){$("widget-toolbar-no-items",{toolbarId:e});return}const r=this.editor,l=r.t,a=new Kr(r.locale);if(a.ariaLabel=t||l("Widget toolbar"),this._toolbarDefinitions.has(e))throw new L("widget-toolbar-duplicated",this,{toolbarId:e});const c={view:a,getRelatedElement:i,balloonClassName:o,itemsConfig:n,initialized:!1};r.ui.addToolbar(a,{isContextual:!0,beforeFocus:()=>{const d=i(r.editing.view.document.selection);d&&this._showToolbar(c,d)},afterBlur:()=>{this._hideToolbar(c)}}),this._toolbarDefinitions.set(e,c)}_updateToolbarsVisibility(){let e=0,t=null,n=null;for(const i of this._toolbarDefinitions.values()){const o=i.getRelatedElement(this.editor.editing.view.document.selection);if(!this.isEnabled||!o)this._isToolbarInBalloon(i)&&this._hideToolbar(i);else if(!this.editor.ui.focusTracker.isFocused)this._isToolbarVisible(i)&&this._hideToolbar(i);else{const r=o.getAncestors().length;r>e&&(e=r,t=o,n=i)}}n&&this._showToolbar(n,t)}_hideToolbar(e){this._balloon.remove(e.view),this.stopListening(this._balloon,"change:visibleView")}_showToolbar(e,t){this._isToolbarVisible(e)?hi(this.editor,t):this._isToolbarInBalloon(e)||(e.initialized||(e.initialized=!0,e.view.fillFromConfig(e.itemsConfig,this.editor.ui.componentFactory)),this._balloon.add({view:e.view,position:ho(this.editor,t),balloonClassName:e.balloonClassName}),this.listenTo(this._balloon,"change:visibleView",()=>{for(const n of this._toolbarDefinitions.values())if(this._isToolbarVisible(n)){const i=n.getRelatedElement(this.editor.editing.view.document.selection);hi(this.editor,i)}}))}_isToolbarVisible(e){return this._balloon.visibleView===e.view}_isToolbarInBalloon(e){return this._balloon.hasView(e.view)}}function hi(s,e){const t=s.plugins.get("ContextualBalloon"),n=ho(s,e);t.updatePosition(n)}function ho(s,e){const t=s.editing.view,n=fn.defaultPositions;return{target:t.domConverter.mapViewToDom(e),positions:[n.northArrowSouth,n.northArrowSouthWest,n.northArrowSouthEast,n.southArrowNorth,n.southArrowNorthWest,n.southArrowNorthEast,n.viewportStickyNorth]}}function Fd(s){const e=s.getSelectedElement();return!!(e&&D(e))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Md extends Z(){constructor(e){super(),this.set("activeHandlePosition",null),this.set("proposedWidthPercents",null),this.set("proposedWidth",null),this.set("proposedHeight",null),this.set("proposedHandleHostWidth",null),this.set("proposedHandleHostHeight",null),this._options=e,this._referenceCoordinates=null}get originalWidth(){return this._originalWidth}get originalHeight(){return this._originalHeight}get originalWidthPercents(){return this._originalWidthPercents}get aspectRatio(){return this._aspectRatio}begin(e,t,n){const i=new N(t);this.activeHandlePosition=zd(e),this._referenceCoordinates=Od(t,Hd(this.activeHandlePosition)),this._originalWidth=i.width,this._originalHeight=i.height,this._aspectRatio=i.width/i.height;const o=n.style.width;o&&o.match(/^\d+(\.\d*)?%$/)?this._originalWidthPercents=parseFloat(o):this._originalWidthPercents=Ud(n,i)}update(e){this.proposedWidth=e.width,this.proposedHeight=e.height,this.proposedWidthPercents=e.widthPercents,this.proposedHandleHostWidth=e.handleHostWidth,this.proposedHandleHostHeight=e.handleHostHeight}}function Ud(s,e){const t=s.parentElement;let n=parseFloat(t.ownerDocument.defaultView.getComputedStyle(t).width);const i=5;let o=0,r=t;for(;isNaN(n);){if(r=r.parentElement,++o>i)return 0;n=parseFloat(t.ownerDocument.defaultView.getComputedStyle(r).width)}return e.width/n*100}function Od(s,e){const t=new N(s),n=e.split("-"),i={x:n[1]=="right"?t.right:t.left,y:n[0]=="bottom"?t.bottom:t.top};return i.x+=s.ownerDocument.defaultView.scrollX,i.y+=s.ownerDocument.defaultView.scrollY,i}function Nd(s){return`ck-widget__resizer__handle-${s}`}function zd(s){const e=["top-left","top-right","bottom-right","bottom-left"];for(const t of e)if(s.classList.contains(Nd(t)))return t}function Hd(s){const e=s.split("-"),t={top:"bottom",bottom:"top",left:"right",right:"left"};return`${t[e[0]]}-${t[e[1]]}`}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $d extends T{constructor(){super();const e=this.bindTemplate;this.setTemplate({tag:"div",attributes:{class:["ck","ck-size-view",e.to("_viewPosition",t=>t?`ck-orientation-${t}`:"")],style:{display:e.if("_isVisible","none",t=>!t)}},children:[{text:e.to("_label")}]})}_bindToState(e,t){this.bind("_isVisible").to(t,"proposedWidth",t,"proposedHeight",(n,i)=>n!==null&&i!==null),this.bind("_label").to(t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",t,"proposedWidthPercents",(n,i,o)=>e.unit==="px"?`${n}${i}`:`${o}%`),this.bind("_viewPosition").to(t,"activeHandlePosition",t,"proposedHandleHostWidth",t,"proposedHandleHostHeight",(n,i,o)=>i<50||o<50?"above-center":n)}_dismiss(){this.unbind(),this._isVisible=!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gi extends Z(){constructor(e){super(),this._viewResizerWrapper=null,this._options=e,this.set("isEnabled",!0),this.set("isSelected",!1),this.bind("isVisible").to(this,"isEnabled",this,"isSelected",(t,n)=>t&&n),this.decorate("begin"),this.decorate("cancel"),this.decorate("commit"),this.decorate("updateSize"),this.on("commit",t=>{!this.state.proposedWidth&&!this.state.proposedWidthPercents&&(this._cleanup(),t.stop())},{priority:"high"})}get state(){return this._state}show(){this._options.editor.editing.view.change(t=>{t.removeClass("ck-hidden",this._viewResizerWrapper)})}hide(){this._options.editor.editing.view.change(t=>{t.addClass("ck-hidden",this._viewResizerWrapper)})}attach(){const e=this,t=this._options.viewElement;this._options.editor.editing.view.change(i=>{const o=i.createUIElement("div",{class:"ck ck-reset_all ck-widget__resizer"},function(r){const l=this.toDomElement(r);return e._appendHandles(l),e._appendSizeUI(l),l});i.insert(i.createPositionAt(t,"end"),o),i.addClass("ck-widget_with-resizer",t),this._viewResizerWrapper=o,this.isVisible||this.hide()}),this.on("change:isVisible",()=>{this.isVisible?(this.show(),this.redraw()):this.hide()})}begin(e){this._state=new Md(this._options),this._sizeView._bindToState(this._options,this.state),this._initialViewWidth=this._options.viewElement.getStyle("width"),this.state.begin(e,this._getHandleHost(),this._getResizeHost())}updateSize(e){const t=this._proposeNewSize(e);this._options.editor.editing.view.change(c=>{const d=this._options.unit||"%",u=(d==="%"?t.widthPercents:t.width)+d;c.setStyle("width",u,this._options.viewElement)});const i=this._getHandleHost(),o=new N(i),r=Math.round(o.width),l=Math.round(o.height),a=new N(i);t.width=Math.round(a.width),t.height=Math.round(a.height),this.redraw(o),this.state.update({...t,handleHostWidth:r,handleHostHeight:l})}commit(){const e=this._options.unit||"%",t=(e==="%"?this.state.proposedWidthPercents:this.state.proposedWidth)+e;this._options.editor.editing.view.change(()=>{this._cleanup(),this._options.onCommit(t)})}cancel(){this._cleanup()}destroy(){this.cancel()}redraw(e){const t=this._domResizerWrapper;if(!Gd(t))return;const n=t.parentElement,i=this._getHandleHost(),o=this._viewResizerWrapper,r=[o.getStyle("width"),o.getStyle("height"),o.getStyle("left"),o.getStyle("top")];let l;if(n.isSameNode(i)){const a=e||new N(i);l=[a.width+"px",a.height+"px",void 0,void 0]}else l=[i.offsetWidth+"px",i.offsetHeight+"px",i.offsetLeft+"px",i.offsetTop+"px"];Qr(r,l)!=="same"&&this._options.editor.editing.view.change(a=>{a.setStyle({width:l[0],height:l[1],left:l[2],top:l[3]},o)})}containsHandle(e){return this._domResizerWrapper.contains(e)}static isResizeHandle(e){return e.classList.contains("ck-widget__resizer__handle")}_cleanup(){this._sizeView._dismiss(),this._options.editor.editing.view.change(t=>{t.setStyle("width",this._initialViewWidth,this._options.viewElement)})}_proposeNewSize(e){const t=this.state,n=qd(e),i=this._options.isCentered?this._options.isCentered(this):!0,o={x:t._referenceCoordinates.x-(n.x+t.originalWidth),y:n.y-t.originalHeight-t._referenceCoordinates.y};i&&t.activeHandlePosition.endsWith("-right")&&(o.x=n.x-(t._referenceCoordinates.x+t.originalWidth)),i&&(o.x*=2);let r=Math.abs(t.originalWidth+o.x),l=Math.abs(t.originalHeight+o.y);return(r/t.aspectRatio>l?"width":"height")=="width"?l=r/t.aspectRatio:r=l*t.aspectRatio,{width:Math.round(r),height:Math.round(l),widthPercents:Math.min(Math.round(t.originalWidthPercents/t.originalWidth*r*100)/100,100)}}_getResizeHost(){const e=this._domResizerWrapper.parentElement;return this._options.getResizeHost(e)}_getHandleHost(){const e=this._domResizerWrapper.parentElement;return this._options.getHandleHost(e)}get _domResizerWrapper(){return this._options.editor.editing.view.domConverter.mapViewToDom(this._viewResizerWrapper)}_appendHandles(e){const t=["top-left","top-right","bottom-right","bottom-left"];for(const n of t)e.appendChild(new dt({tag:"div",attributes:{class:`ck-widget__resizer__handle ${Wd(n)}`}}).render())}_appendSizeUI(e){this._sizeView=new $d,this._sizeView.render(),e.appendChild(this._sizeView.element)}}function Wd(s){return`ck-widget__resizer__handle-${s}`}function qd(s){return{x:s.pageX,y:s.pageY}}function Gd(s){return s&&s.ownerDocument&&s.ownerDocument.contains(s)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ut extends f{constructor(){super(...arguments),this._resizers=new Map}static get pluginName(){return"WidgetResize"}init(){const e=this.editor.editing,t=A.window.document;this.set("selectedResizer",null),this.set("_activeResizer",null),e.view.addObserver(yt),this._observer=new($e()),this.listenTo(e.view.document,"mousedown",this._mouseDownListener.bind(this),{priority:"high"}),this._observer.listenTo(t,"mousemove",this._mouseMoveListener.bind(this)),this._observer.listenTo(t,"mouseup",this._mouseUpListener.bind(this)),this._redrawSelectedResizerThrottled=Gt(()=>this.redrawSelectedResizer(),200),this.editor.ui.on("update",this._redrawSelectedResizerThrottled),this.editor.model.document.on("change",()=>{for(const[i,o]of this._resizers)i.isAttached()||(this._resizers.delete(i),o.destroy())},{priority:"lowest"}),this._observer.listenTo(A.window,"resize",this._redrawSelectedResizerThrottled);const n=this.editor.editing.view.document.selection;n.on("change",()=>{const i=n.getSelectedElement(),o=this.getResizerByViewElement(i)||null;o?this.select(o):this.deselect()})}redrawSelectedResizer(){this.selectedResizer&&this.selectedResizer.isVisible&&this.selectedResizer.redraw()}destroy(){super.destroy(),this._observer.stopListening();for(const e of this._resizers.values())e.destroy();this._redrawSelectedResizerThrottled.cancel()}select(e){this.deselect(),this.selectedResizer=e,this.selectedResizer.isSelected=!0}deselect(){this.selectedResizer&&(this.selectedResizer.isSelected=!1),this.selectedResizer=null}attachTo(e){const t=new gi(e),n=this.editor.plugins;if(t.attach(),n.has("WidgetToolbarRepository")){const r=n.get("WidgetToolbarRepository");t.on("begin",()=>{r.forceDisabled("resize")},{priority:"lowest"}),t.on("cancel",()=>{r.clearForceDisabled("resize")},{priority:"highest"}),t.on("commit",()=>{r.clearForceDisabled("resize")},{priority:"highest"})}this._resizers.set(e.viewElement,t);const o=this.editor.editing.view.document.selection.getSelectedElement();return this.getResizerByViewElement(o)==t&&this.select(t),t}getResizerByViewElement(e){return this._resizers.get(e)}_getResizerByHandle(e){for(const t of this._resizers.values())if(t.containsHandle(e))return t}_mouseDownListener(e,t){const n=t.domTarget;gi.isResizeHandle(n)&&(this._activeResizer=this._getResizerByHandle(n)||null,this._activeResizer&&(this._activeResizer.begin(n),e.stop(),t.preventDefault()))}_mouseMoveListener(e,t){this._activeResizer&&this._activeResizer.updateSize(t)}_mouseUpListener(){this._activeResizer&&(this._activeResizer.commit(),this._activeResizer=null)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 *//* istanbul ignore file -- @preserve */const Ot=Es("px");class jd extends T{constructor(){super();const e=this.bindTemplate;this.set({isVisible:!1,left:null,top:null,width:null}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-clipboard-drop-target-line",e.if("isVisible","ck-hidden",t=>!t)],style:{left:e.to("left",t=>Ot(t)),top:e.to("top",t=>Ot(t)),width:e.to("width",t=>Ot(t))}}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class it extends f{constructor(){super(...arguments),this.removeDropMarkerDelayed=Rs(()=>this.removeDropMarker(),40),this._updateDropMarkerThrottled=Gt(e=>this._updateDropMarker(e),40),this._reconvertMarkerThrottled=Gt(()=>{this.editor.model.markers.has("drop-target")&&this.editor.editing.reconvertMarker("drop-target")},0),this._dropTargetLineView=new jd,this._domEmitter=new($e()),this._scrollables=new Map}static get pluginName(){return"DragDropTarget"}init(){this._setupDropMarker()}destroy(){this._domEmitter.stopListening();for(const{resizeObserver:e}of this._scrollables.values())e.destroy();return this._updateDropMarkerThrottled.cancel(),this.removeDropMarkerDelayed.cancel(),this._reconvertMarkerThrottled.cancel(),super.destroy()}updateDropMarker(e,t,n,i,o,r){this.removeDropMarkerDelayed.cancel();const l=fi(this.editor,e,t,n,i,o,r);/* istanbul ignore next -- @preserve */if(l){if(r&&r.containsRange(l))return this.removeDropMarker();this._updateDropMarkerThrottled(l)}}getFinalDropRange(e,t,n,i,o,r){const l=fi(this.editor,e,t,n,i,o,r);return this.removeDropMarker(),l}removeDropMarker(){const e=this.editor.model;this.removeDropMarkerDelayed.cancel(),this._updateDropMarkerThrottled.cancel(),this._dropTargetLineView.isVisible=!1,e.markers.has("drop-target")&&e.change(t=>{t.removeMarker("drop-target")})}_setupDropMarker(){const e=this.editor;e.ui.view.body.add(this._dropTargetLineView),e.conversion.for("editingDowncast").markerToHighlight({model:"drop-target",view:{classes:["ck-clipboard-drop-target-range"]}}),e.conversion.for("editingDowncast").markerToElement({model:"drop-target",view:(t,{writer:n})=>{if(e.model.schema.checkChild(t.markerRange.start,"$text"))return this._dropTargetLineView.isVisible=!1,this._createDropTargetPosition(n);t.markerRange.isCollapsed?this._updateDropTargetLine(t.markerRange):this._dropTargetLineView.isVisible=!1}})}_updateDropMarker(e){const t=this.editor,n=t.model.markers;t.model.change(i=>{n.has("drop-target")?n.get("drop-target").getRange().isEqual(e)||i.updateMarker("drop-target",{range:e}):i.addMarker("drop-target",{range:e,usingOperation:!1,affectsData:!1})})}_createDropTargetPosition(e){return e.createUIElement("span",{class:"ck ck-clipboard-drop-target-position"},function(t){const n=this.toDomElement(t);return n.append("",t.createElement("span"),""),n})}_updateDropTargetLine(e){const t=this.editor.editing,n=e.start.nodeBefore,i=e.start.nodeAfter,o=e.start.parent,r=n?t.mapper.toViewElement(n):null,l=r?t.view.domConverter.mapViewToDom(r):null,a=i?t.mapper.toViewElement(i):null,c=a?t.view.domConverter.mapViewToDom(a):null,d=t.mapper.toViewElement(o);if(!d)return;const u=t.view.domConverter.mapViewToDom(d),m=this._getScrollableRect(d),{scrollX:h,scrollY:g}=A.window,p=l?new N(l):null,b=c?new N(c):null,w=new N(u).excludeScrollbarsAndBorders(),v=p?p.bottom:w.top,I=b?b.top:w.bottom,x=A.window.getComputedStyle(u),R=v<=I?(v+I)/2:I;if(m.top<R&&R<m.bottom){const Ee=w.left+parseFloat(x.paddingLeft),ge=w.right-parseFloat(x.paddingRight),Vn=Math.max(Ee+h,m.left),br=Math.min(ge+h,m.right);this._dropTargetLineView.set({isVisible:!0,left:Vn,top:R+g,width:br-Vn})}else this._dropTargetLineView.isVisible=!1}_getScrollableRect(e){const t=e.root.rootName;let n;if(this._scrollables.has(t))n=this._scrollables.get(t).domElement;else{const i=this.editor.editing.view.domConverter.mapViewToDom(e);n=Qd(i),this._domEmitter.listenTo(n,"scroll",this._reconvertMarkerThrottled,{usePassive:!0});const o=new Zr(n,this._reconvertMarkerThrottled);this._scrollables.set(t,{domElement:n,resizeObserver:o})}return new N(n).excludeScrollbarsAndBorders()}}function fi(s,e,t,n,i,o,r){const l=s.model,a=s.editing.mapper;let d=pi(s,e);for(;d;){if(!o){if(l.schema.checkChild(d,"$text")){if(t){const u=t[0].start,m=a.toModelPosition(u);if(!r||Array.from(r.getItems()).every(g=>l.schema.checkChild(m,g))){if(l.schema.checkChild(m,"$text"))return l.createRange(m);if(u)return st(s,pi(s,u.parent),n,i)}}}else if(l.schema.isInline(d))return st(s,d,n,i)}if(l.schema.isBlock(d))return st(s,d,n,i);if(l.schema.checkChild(d,"$block")){const u=Array.from(d.getChildren()).filter(g=>g.is("element")&&!Kd(s,g));let m=0,h=u.length;if(h==0)return l.createRange(l.createPositionAt(d,"end"));for(;m<h-1;){const g=Math.floor((m+h)/2);go(s,u[g],n,i)=="before"?h=g:m=g}return st(s,u[m],n,i)}d=d.parent}return null}function Kd(s,e){const t=s.editing.mapper,n=s.editing.view.domConverter,i=t.toViewElement(e);if(!i)return!0;const o=n.mapViewToDom(i);return A.window.getComputedStyle(o).float!="none"}function st(s,e,t,n){const i=s.model;return i.createRange(i.createPositionAt(e,go(s,e,t,n)))}function go(s,e,t,n){const i=s.editing.mapper,o=s.editing.view.domConverter,r=i.toViewElement(e),l=o.mapViewToDom(r),a=new N(l);return s.model.schema.isInline(e)?t<(a.left+a.right)/2?"before":"after":n<(a.top+a.bottom)/2?"before":"after"}function pi(s,e){const t=s.editing.mapper,n=s.editing.view,i=t.toModelElement(e);if(i)return i;const o=n.createPositionBefore(e),r=t.findMappedViewAncestor(o);return t.toModelElement(r)}function Qd(s){let e=s;do{e=e.parentElement;const t=A.window.getComputedStyle(e).overflowY;if(t=="auto"||t=="scroll")break}while(e.tagName!="BODY");return e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Zd extends f{constructor(){super(...arguments),this._isBlockDragging=!1,this._domEmitter=new($e())}static get pluginName(){return"DragDropBlockToolbar"}init(){const e=this.editor;if(this.listenTo(e,"change:isReadOnly",(t,n,i)=>{i?(this.forceDisabled("readOnlyMode"),this._isBlockDragging=!1):this.clearForceDisabled("readOnlyMode")}),S.isAndroid&&this.forceDisabled("noAndroidSupport"),e.plugins.has("BlockToolbar")){const n=e.plugins.get("BlockToolbar").buttonView.element;this._domEmitter.listenTo(n,"dragstart",(i,o)=>this._handleBlockDragStart(o)),this._domEmitter.listenTo(A.document,"dragover",(i,o)=>this._handleBlockDragging(o)),this._domEmitter.listenTo(A.document,"drop",(i,o)=>this._handleBlockDragging(o)),this._domEmitter.listenTo(A.document,"dragend",()=>this._handleBlockDragEnd(),{useCapture:!0}),this.isEnabled&&n.setAttribute("draggable","true"),this.on("change:isEnabled",(i,o,r)=>{n.setAttribute("draggable",r?"true":"false")})}}destroy(){return this._domEmitter.stopListening(),super.destroy()}_handleBlockDragStart(e){if(!this.isEnabled)return;const t=this.editor.model,n=t.document.selection,i=this.editor.editing.view,o=Array.from(n.getSelectedBlocks()),r=t.createRange(t.createPositionBefore(o[0]),t.createPositionAfter(o[o.length-1]));t.change(l=>l.setSelection(r)),this._isBlockDragging=!0,i.focus(),i.getObserver(Ue).onDomEvent(e)}_handleBlockDragging(e){if(!this.isEnabled||!this._isBlockDragging)return;const t=e.clientX+(this.editor.locale.contentLanguageDirection=="ltr"?100:-100),n=e.clientY,i=document.elementFromPoint(t,n),o=this.editor.editing.view;!i||!i.closest(".ck-editor__editable")||o.getObserver(Ue).onDomEvent({...e,type:e.type,dataTransfer:e.dataTransfer,target:i,clientX:t,clientY:n,preventDefault:()=>e.preventDefault(),stopPropagation:()=>e.stopPropagation()})}_handleBlockDragEnd(){this._isBlockDragging=!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Xd extends f{constructor(){super(...arguments),this._clearDraggableAttributesDelayed=Rs(()=>this._clearDraggableAttributes(),40),this._blockMode=!1,this._domEmitter=new($e())}static get pluginName(){return"DragDrop"}static get requires(){return[q,Ge,it,Zd]}init(){const e=this.editor,t=e.editing.view;this._draggedRange=null,this._draggingUid="",this._draggableElement=null,t.addObserver(Ue),t.addObserver(yt),this._setupDragging(),this._setupContentInsertionIntegration(),this._setupClipboardInputIntegration(),this._setupDraggableAttributeHandling(),this.listenTo(e,"change:isReadOnly",(n,i,o)=>{o?this.forceDisabled("readOnlyMode"):this.clearForceDisabled("readOnlyMode")}),this.on("change:isEnabled",(n,i,o)=>{o||this._finalizeDragging(!1)}),S.isAndroid&&this.forceDisabled("noAndroidSupport")}destroy(){return this._draggedRange&&(this._draggedRange.detach(),this._draggedRange=null),this._previewContainer&&this._previewContainer.remove(),this._domEmitter.stopListening(),this._clearDraggableAttributesDelayed.cancel(),super.destroy()}_setupDragging(){const e=this.editor,t=e.model,n=e.editing.view,i=n.document,o=e.plugins.get(it);this.listenTo(i,"dragstart",(r,l)=>{if(l.target&&l.target.is("editableElement")){l.preventDefault();return}if(this._prepareDraggedRange(l.target),!this._draggedRange){l.preventDefault();return}this._draggingUid=Ct(),l.dataTransfer.effectAllowed=this.isEnabled?"copyMove":"copy",l.dataTransfer.setData("application/ckeditor5-dragging-uid",this._draggingUid);const a=t.createSelection(this._draggedRange.toRange());this.editor.plugins.get("ClipboardPipeline")._fireOutputTransformationEvent(l.dataTransfer,a,"dragstart");const{dataTransfer:d,domTarget:u,domEvent:m}=l,{clientX:h}=m;this._updatePreview({dataTransfer:d,domTarget:u,clientX:h}),l.stopPropagation(),this.isEnabled||(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid="")},{priority:"low"}),this.listenTo(i,"dragend",(r,l)=>{this._finalizeDragging(!l.dataTransfer.isCanceled&&l.dataTransfer.dropEffect=="move")},{priority:"low"}),this._domEmitter.listenTo(A.document,"dragend",()=>{this._blockMode=!1},{useCapture:!0}),this.listenTo(i,"dragenter",()=>{this.isEnabled&&n.focus()}),this.listenTo(i,"dragleave",()=>{o.removeDropMarkerDelayed()}),this.listenTo(i,"dragging",(r,l)=>{if(!this.isEnabled){l.dataTransfer.dropEffect="none";return}const{clientX:a,clientY:c}=l.domEvent;o.updateDropMarker(l.target,l.targetRanges,a,c,this._blockMode,this._draggedRange),this._draggedRange||(l.dataTransfer.dropEffect="copy"),S.isGecko||(l.dataTransfer.effectAllowed=="copy"?l.dataTransfer.dropEffect="copy":["all","copyMove"].includes(l.dataTransfer.effectAllowed)&&(l.dataTransfer.dropEffect="move")),r.stop()},{priority:"low"})}_setupClipboardInputIntegration(){const e=this.editor,n=e.editing.view.document,i=e.plugins.get(it);this.listenTo(n,"clipboardInput",(o,r)=>{if(r.method!="drop")return;const{clientX:l,clientY:a}=r.domEvent,c=i.getFinalDropRange(r.target,r.targetRanges,l,a,this._blockMode,this._draggedRange);if(!c){this._finalizeDragging(!1),o.stop();return}if(this._draggedRange&&this._draggingUid!=r.dataTransfer.getData("application/ckeditor5-dragging-uid")&&(this._draggedRange.detach(),this._draggedRange=null,this._draggingUid=""),bi(r.dataTransfer)=="move"&&this._draggedRange&&this._draggedRange.containsRange(c,!0)){this._finalizeDragging(!1),o.stop();return}r.targetRanges=[e.editing.mapper.toViewRange(c)]},{priority:"high"})}_setupContentInsertionIntegration(){const e=this.editor.plugins.get(q);e.on("contentInsertion",(t,n)=>{if(!this.isEnabled||n.method!=="drop")return;const i=n.targetRanges.map(o=>this.editor.editing.mapper.toModelRange(o));this.editor.model.change(o=>o.setSelection(i))},{priority:"high"}),e.on("contentInsertion",(t,n)=>{if(!this.isEnabled||n.method!=="drop")return;const i=bi(n.dataTransfer)=="move",o=!n.resultRange||!n.resultRange.isCollapsed;this._finalizeDragging(o&&i)},{priority:"lowest"})}_setupDraggableAttributeHandling(){const e=this.editor,t=e.editing.view,n=t.document;this.listenTo(n,"mousedown",(i,o)=>{if(S.isAndroid||!o)return;this._clearDraggableAttributesDelayed.cancel();let r=wi(o.target);if(S.isBlink&&!e.isReadOnly&&!r&&!n.selection.isCollapsed){const l=n.selection.getSelectedElement();(!l||!D(l))&&(r=n.selection.editableElement)}r&&(t.change(l=>{l.setAttribute("draggable","true",r)}),this._draggableElement=e.editing.mapper.toModelElement(r))}),this.listenTo(n,"mouseup",()=>{S.isAndroid||this._clearDraggableAttributesDelayed()})}_clearDraggableAttributes(){const e=this.editor.editing;e.view.change(t=>{this._draggableElement&&this._draggableElement.root.rootName!="$graveyard"&&t.removeAttribute("draggable",e.mapper.toViewElement(this._draggableElement)),this._draggableElement=null})}_finalizeDragging(e){const t=this.editor,n=t.model;t.plugins.get(it).removeDropMarker(),this._clearDraggableAttributes(),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").clearForceDisabled("dragDrop"),this._draggingUid="",this._previewContainer&&(this._previewContainer.remove(),this._previewContainer=void 0),this._draggedRange&&(e&&this.isEnabled&&n.change(o=>{const r=n.createSelection(this._draggedRange);n.deleteContent(r,{doNotAutoparagraph:!0});const l=r.getFirstPosition().parent;l.isEmpty&&!n.schema.checkChild(l,"$text")&&n.schema.checkChild(l,"paragraph")&&o.insertElement("paragraph",l,0)}),this._draggedRange.detach(),this._draggedRange=null)}_prepareDraggedRange(e){const t=this.editor,n=t.model,i=n.document.selection,o=e?wi(e):null;if(o){const c=t.editing.mapper.toModelElement(o);this._draggedRange=ke.fromRange(n.createRangeOn(c)),this._blockMode=n.schema.isBlock(c),t.plugins.has("WidgetToolbarRepository")&&t.plugins.get("WidgetToolbarRepository").forceDisabled("dragDrop");return}if(i.isCollapsed&&!i.getFirstPosition().parent.isEmpty)return;const r=Array.from(i.getSelectedBlocks()),l=i.getFirstRange();if(r.length==0){this._draggedRange=ke.fromRange(l);return}const a=fo(n,r);if(r.length>1)this._draggedRange=ke.fromRange(a),this._blockMode=!0;else if(r.length==1){const c=l.start.isTouching(a.start)&&l.end.isTouching(a.end);this._draggedRange=ke.fromRange(c?a:l),this._blockMode=c}n.change(c=>c.setSelection(this._draggedRange.toRange()))}_updatePreview({dataTransfer:e,domTarget:t,clientX:n}){const i=this.editor.editing.view,o=i.document.selection.editableElement,r=i.domConverter.mapViewToDom(o),l=A.window.getComputedStyle(r);this._previewContainer?this._previewContainer.firstElementChild&&this._previewContainer.removeChild(this._previewContainer.firstElementChild):(this._previewContainer=H(A.document,"div",{style:"position: fixed; left: -999999px;"}),A.document.body.appendChild(this._previewContainer));const a=new N(r);if(r.contains(t))return;const c=parseFloat(l.paddingLeft),d=H(A.document,"div");d.className="ck ck-content",d.style.width=l.width,d.style.paddingLeft=`${a.left-n+c}px`,S.isiOS&&(d.style.backgroundColor="white"),d.innerHTML=e.getData("text/html"),e.setDragImage(d,0,0),this._previewContainer.appendChild(d)}}function bi(s){return S.isGecko?s.dropEffect:["all","copyMove"].includes(s.effectAllowed)?"move":"copy"}function wi(s){if(s.is("editableElement"))return null;if(s.hasClass("ck-widget__selection-handle"))return s.findAncestor(D);if(D(s))return s;const e=s.findAncestor(t=>D(t)||t.is("editableElement"));return D(e)?e:null}function fo(s,e){const t=e[0],n=e[e.length-1],i=t.getCommonAncestor(n),o=s.createPositionBefore(t),r=s.createPositionAfter(n);if(i&&i.is("element")&&!s.schema.isLimit(i)){const l=s.createRangeOn(i),a=o.isTouching(l.start),c=r.isTouching(l.end);if(a&&c)return fo(s,[i])}return s.createRange(o,r)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yd extends f{static get pluginName(){return"PastePlainText"}static get requires(){return[q]}init(){const e=this.editor,t=e.model,n=e.editing.view,i=n.document,o=t.document.selection;let r=!1;n.addObserver(Ue),this.listenTo(i,"keydown",(l,a)=>{r=a.shiftKey}),e.plugins.get(q).on("contentInsertion",(l,a)=>{!r&&!Jd(a.content,t.schema)||t.change(c=>{const d=Array.from(o.getAttributes()).filter(([m])=>t.schema.getAttributeProperties(m).isFormatting);o.isCollapsed||t.deleteContent(o,{doNotAutoparagraph:!0}),d.push(...o.getAttributes());const u=c.createRangeIn(a.content);for(const m of u.getItems())m.is("$textProxy")&&c.setAttributes(d,m)})})}}function Jd(s,e){if(s.childCount>1)return!1;const t=s.getChild(0);return e.isObject(t)?!1:Array.from(t.getAttributeKeys()).length==0}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class po extends f{static get pluginName(){return"Clipboard"}static get requires(){return[Le,q,Xd,Yd]}init(){const e=this.editor,t=this.editor.t;e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Copy selected content"),keystroke:"CTRL+C"},{label:t("Paste content"),keystroke:"CTRL+V"},{label:t("Paste content as plain text"),keystroke:"CTRL+SHIFT+V"}]})}}const eu='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M.75 15.5a.75.75 0 0 1 .75.75V18l.008.09A.5.5 0 0 0 2 18.5h1.75a.75.75 0 1 1 0 1.5H1.5l-.144-.007a1.5 1.5 0 0 1-1.35-1.349L0 18.5v-2.25a.75.75 0 0 1 .75-.75zm18.5 0a.75.75 0 0 1 .75.75v2.25l-.007.144a1.5 1.5 0 0 1-1.349 1.35L18.5 20h-2.25a.75.75 0 1 1 0-1.5H18a.5.5 0 0 0 .492-.41L18.5 18v-1.75a.75.75 0 0 1 .75-.75zm-10.45 3c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2v-1.1c0-.11.09-.2.2-.2h1.6zm.45-5.5a.75.75 0 1 1 0 1.5h-8.5a.75.75 0 1 1 0-1.5h8.5zM1.3 11c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2v-1.6c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5H4.75a.75.75 0 1 1 0-1.5h10.5zM1.3 7c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2H.2a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm18.5 0c.11 0 .2.09.2.2v1.6a.2.2 0 0 1-.2.2h-1.1a.2.2 0 0 1-.2-.2V7.2c0-.11.09-.2.2-.2h1.1zm-4.55-2a.75.75 0 1 1 0 1.5h-2.5a.75.75 0 1 1 0-1.5h2.5zm-5 0a.75.75 0 1 1 0 1.5h-5.5a.75.75 0 0 1 0-1.5h5.5zm-6.5-5a.75.75 0 0 1 0 1.5H2a.5.5 0 0 0-.492.41L1.5 2v1.75a.75.75 0 0 1-1.5 0V1.5l.007-.144A1.5 1.5 0 0 1 1.356.006L1.5 0h2.25zM18.5 0l.144.007a1.5 1.5 0 0 1 1.35 1.349L20 1.5v2.25a.75.75 0 1 1-1.5 0V2l-.008-.09A.5.5 0 0 0 18 1.5h-1.75a.75.75 0 1 1 0-1.5h2.25zM8.8 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2H7.2a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6zm4 0c.11 0 .2.09.2.2v1.1a.2.2 0 0 1-.2.2h-1.6a.2.2 0 0 1-.2-.2V.2c0-.11.09-.2.2-.2h1.6z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tu extends f{static get pluginName(){return"SelectAllUI"}init(){const e=this.editor;e.ui.componentFactory.add("selectAll",t=>{const n=e.commands.get("selectAll"),i=new y(t),o=t.t;return i.set({label:o("Select all"),icon:eu,keystroke:"Ctrl+A",tooltip:!0}),i.bind("isEnabled").to(n,"isEnabled"),this.listenTo(i,"execute",()=>{e.execute("selectAll"),e.editing.view.focus()}),i})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nu extends f{static get requires(){return[Xr,tu]}static get pluginName(){return"SelectAll"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bo extends k{constructor(e){super(e),this._stack=[],this._createdBatches=new WeakSet,this.refresh(),this._isEnabledBasedOnSelection=!1,this.listenTo(e.data,"set",(t,n)=>{n[1]={...n[1]};const i=n[1];i.batchType||(i.batchType={isUndoable:!1})},{priority:"high"}),this.listenTo(e.data,"set",(t,n)=>{n[1].batchType.isUndoable||this.clearStack()})}refresh(){this.isEnabled=this._stack.length>0}get createdBatches(){return this._createdBatches}addBatch(e){const t=this.editor.model.document.selection,n={ranges:t.hasOwnRange?Array.from(t.getRanges()):[],isBackward:t.isBackward};this._stack.push({batch:e,selection:n}),this.refresh()}clearStack(){this._stack=[],this.refresh()}_restoreSelection(e,t,n){const i=this.editor.model,o=i.document,r=[],l=e.map(c=>c.getTransformedByOperations(n)),a=l.flat();for(const c of l){const d=c.filter(u=>u.root!=o.graveyard).filter(u=>!su(u,a));d.length&&(iu(d),r.push(d[0]))}r.length&&i.change(c=>{c.setSelection(r,{backward:t})})}_undo(e,t){const n=this.editor.model,i=n.document;this._createdBatches.add(t);const o=e.operations.slice().filter(r=>r.isDocumentOperation);o.reverse();for(const r of o){const l=r.baseVersion+1,a=Array.from(i.history.getOperations(l)),d=Yr([r.getReversed()],a,{useRelations:!0,document:this.editor.model.document,padWithNoOps:!1,forceWeakRemove:!0}).operationsA;for(let u of d){const m=u.affectedSelectable;m&&!n.canEditAt(m)&&(u=new Jr(u.baseVersion)),t.addOperation(u),n.applyOperation(u),i.history.setOperationAsUndone(r,u)}}}}function iu(s){s.sort((e,t)=>e.start.isBefore(t.start)?-1:1);for(let e=1;e<s.length;e++){const n=s[e-1].getJoined(s[e],!0);n&&(e--,s.splice(e,2,n))}}function su(s,e){return e.some(t=>t!==s&&t.containsRange(s,!0))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ou extends bo{execute(e=null){const t=e?this._stack.findIndex(o=>o.batch==e):this._stack.length-1,n=this._stack.splice(t,1)[0],i=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(i,()=>{this._undo(n.batch,i);const o=this.editor.model.document.history.getOperations(n.batch.baseVersion);this._restoreSelection(n.selection.ranges,n.selection.isBackward,o)}),this.fire("revert",n.batch,i),this.refresh()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ru extends bo{execute(){const e=this._stack.pop(),t=this.editor.model.createBatch({isUndo:!0});this.editor.model.enqueueChange(t,()=>{const i=e.batch.operations[e.batch.operations.length-1].baseVersion+1,o=this.editor.model.document.history.getOperations(i);this._restoreSelection(e.selection.ranges,e.selection.isBackward,o),this._undo(e.batch,t)}),this.refresh()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lu extends f{constructor(){super(...arguments),this._batchRegistry=new WeakSet}static get pluginName(){return"UndoEditing"}init(){const e=this.editor,t=e.t;this._undoCommand=new ou(e),this._redoCommand=new ru(e),e.commands.add("undo",this._undoCommand),e.commands.add("redo",this._redoCommand),this.listenTo(e.model,"applyOperation",(n,i)=>{const o=i[0];if(!o.isDocumentOperation)return;const r=o.batch,l=this._redoCommand.createdBatches.has(r),a=this._undoCommand.createdBatches.has(r);this._batchRegistry.has(r)||(this._batchRegistry.add(r),r.isUndoable&&(l?this._undoCommand.addBatch(r):a||(this._undoCommand.addBatch(r),this._redoCommand.clearStack())))},{priority:"highest"}),this.listenTo(this._undoCommand,"revert",(n,i,o)=>{this._redoCommand.addBatch(o)}),e.keystrokes.set("CTRL+Z","undo"),e.keystrokes.set("CTRL+Y","redo"),e.keystrokes.set("CTRL+SHIFT+Z","redo"),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Undo"),keystroke:"CTRL+Z"},{label:t("Redo"),keystroke:[["CTRL+Y"],["CTRL+SHIFT+Z"]]}]})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class au extends f{static get pluginName(){return"UndoUI"}init(){const e=this.editor,t=e.locale,n=e.t,i=t.uiLanguageDirection=="ltr"?C.undo:C.redo,o=t.uiLanguageDirection=="ltr"?C.redo:C.undo;this._addButton("undo",n("Undo"),"CTRL+Z",i),this._addButton("redo",n("Redo"),"CTRL+Y",o)}_addButton(e,t,n,i){const o=this.editor;o.ui.componentFactory.add(e,r=>{const l=o.commands.get(e),a=new y(r);return a.set({label:t,icon:i,keystroke:n,tooltip:!0}),a.bind("isEnabled").to(l,"isEnabled"),this.listenTo(a,"execute",()=>{o.execute(e),o.editing.view.focus()}),a})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wo extends f{static get requires(){return[lu,au]}static get pluginName(){return"Undo"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cu extends f{static get requires(){return[Oa,po,bn,nu,vd,Fc,wo]}static get pluginName(){return"Essentials"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class It extends k{constructor(e,t){super(e),this.attributeKey=t}refresh(){const e=this.editor.model,t=e.document;this.value=t.selection.getAttribute(this.attributeKey),this.isEnabled=e.schema.checkAttributeInSelection(t.selection,this.attributeKey)}execute(e={}){const t=this.editor.model,i=t.document.selection,o=e.value,r=e.batch,l=a=>{if(i.isCollapsed)o?a.setSelectionAttribute(this.attributeKey,o):a.removeSelectionAttribute(this.attributeKey);else{const c=t.schema.getValidRanges(i.getRanges(),this.attributeKey);for(const d of c)o?a.setAttribute(this.attributeKey,o,d):a.removeAttribute(this.attributeKey,d)}};r?t.enqueueChange(r,a=>{l(a)}):t.change(a=>{l(a)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const U="fontSize",O="fontFamily",Q="fontColor",ee="fontBackgroundColor";function vo(s,e){const t={model:{key:s,values:[]},view:{},upcastAlso:{}};for(const n of e)t.model.values.push(n.model),t.view[n.model]=n.view,n.upcastAlso&&(t.upcastAlso[n.model]=n.upcastAlso);return t}function Co(s){return e=>uu(e.getStyle(s))}function ko(s){return(e,{writer:t})=>t.createAttributeElement("span",{style:`${s}:${e}`},{priority:7})}function du({dropdownView:s,colors:e,columns:t,removeButtonLabel:n,colorPickerLabel:i,documentColorsLabel:o,documentColorsCount:r,colorPickerViewConfig:l}){const a=s.locale,c=new kc(a,{colors:e,columns:t,removeButtonLabel:n,colorPickerLabel:i,documentColorsLabel:o,documentColorsCount:r,colorPickerViewConfig:l});return s.colorSelectorView=c,s.panelView.children.add(c),c}function uu(s){return s.replace(/\s/g,"")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mu extends It{constructor(e){super(e,O)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function yo(s){return s.map(hu).filter(e=>e!==void 0)}function hu(s){if(typeof s=="object")return s;if(s==="default")return{title:"Default",model:void 0};if(typeof s=="string")return gu(s)}function gu(s){const e=s.replace(/"|'/g,"").split(","),t=e[0],n=e.map(fu).join(", ");return{title:t,model:n,view:{name:"span",styles:{"font-family":n},priority:7}}}function fu(s){return s=s.trim(),s.indexOf(" ")>0&&(s=`'${s}'`),s}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pu extends f{static get pluginName(){return"FontFamilyEditing"}constructor(e){super(e),e.config.define(O,{options:["default","Arial, Helvetica, sans-serif","Courier New, Courier, monospace","Georgia, serif","Lucida Sans Unicode, Lucida Grande, sans-serif","Tahoma, Geneva, sans-serif","Times New Roman, Times, serif","Trebuchet MS, Helvetica, sans-serif","Verdana, Geneva, sans-serif"],supportAllValues:!1})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:O}),e.model.schema.setAttributeProperties(O,{isFormatting:!0,copyOnEnter:!0});const t=yo(e.config.get("fontFamily.options")).filter(i=>i.model),n=vo(O,t);e.config.get("fontFamily.supportAllValues")?(this._prepareAnyValueConverters(),this._prepareCompatibilityConverter()):e.conversion.attributeToElement(n),e.commands.add(O,new mu(e))}_prepareAnyValueConverters(){const e=this.editor;e.conversion.for("downcast").attributeToElement({model:O,view:(t,{writer:n})=>n.createAttributeElement("span",{style:"font-family:"+t},{priority:7})}),e.conversion.for("upcast").elementToAttribute({model:{key:O,value:t=>t.getStyle("font-family")},view:{name:"span",styles:{"font-family":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{face:/.*/}},model:{key:O,value:t=>t.getAttribute("face")}})}}const bu='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M11.03 3h6.149a.75.75 0 1 1 0 1.5h-5.514L11.03 3zm1.27 3h4.879a.75.75 0 1 1 0 1.5h-4.244L12.3 6zm1.27 3h3.609a.75.75 0 1 1 0 1.5h-2.973L13.57 9zm-2.754 2.5L8.038 4.785 5.261 11.5h5.555zm.62 1.5H4.641l-1.666 4.028H1.312l5.789-14h1.875l5.789 14h-1.663L11.436 13z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wu extends f{static get pluginName(){return"FontFamilyUI"}init(){const e=this.editor,t=e.t,n=this._getLocalizedOptions(),i=e.commands.get(O),o=t("Font Family");e.ui.componentFactory.add(O,r=>{const l=W(r);return We(l,()=>vu(n,i),{role:"menu",ariaLabel:o}),l.buttonView.set({label:o,icon:bu,tooltip:!0}),l.extendTemplate({attributes:{class:"ck-font-family-dropdown"}}),l.bind("isEnabled").to(i),this.listenTo(l,"execute",a=>{e.execute(a.source.commandName,{value:a.source.commandParam}),e.editing.view.focus()}),l})}_getLocalizedOptions(){const e=this.editor,t=e.t;return yo(e.config.get(O).options).map(i=>(i.title==="Default"&&(i.title=t("Default")),i))}}function vu(s,e){const t=new te;for(const n of s){const i={type:"button",model:new qe({commandName:O,commandParam:n.model,label:n.title,role:"menuitemradio",withText:!0})};i.model.bind("isOn").to(e,"value",o=>o===n.model?!0:!o||!n.model?!1:o.split(",")[0].replace(/'/g,"").toLowerCase()===n.model.toLowerCase()),n.view&&typeof n.view!="string"&&n.view.styles&&i.model.set("labelStyle",`font-family: ${n.view.styles["font-family"]}`),t.add(i)}return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Cu extends f{static get requires(){return[pu,wu]}static get pluginName(){return"FontFamily"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ku extends It{constructor(e){super(e,U)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function In(s){return s.map(e=>yu(e)).filter(e=>e!==void 0)}const vi={get tiny(){return{title:"Tiny",model:"tiny",view:{name:"span",classes:"text-tiny",priority:7}}},get small(){return{title:"Small",model:"small",view:{name:"span",classes:"text-small",priority:7}}},get big(){return{title:"Big",model:"big",view:{name:"span",classes:"text-big",priority:7}}},get huge(){return{title:"Huge",model:"huge",view:{name:"span",classes:"text-huge",priority:7}}}};function yu(s){if(typeof s=="number"&&(s=String(s)),typeof s=="object"&&Tu(s))return Jt(s);const e=Iu(s);if(e)return Jt(e);if(s==="default")return{model:void 0,title:"Default"};if(!Eu(s))return _u(s)}function _u(s){return typeof s=="string"&&(s={title:s,model:`${parseFloat(s)}px`}),s.view={name:"span",styles:{"font-size":s.model}},Jt(s)}function Jt(s){return s.view&&typeof s.view!="string"&&!s.view.priority&&(s.view.priority=7),s}function Iu(s){return typeof s=="string"?vi[s]:vi[s.model]}function Tu(s){return s.title&&s.model&&s.view}function Eu(s){let e;if(typeof s=="object")if(s.model)e=parseFloat(s.model);else throw new L("font-size-invalid-definition",null,s);else e=parseFloat(s);return isNaN(e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Ci=["x-small","x-small","small","medium","large","x-large","xx-large","xxx-large"];class Au extends f{static get pluginName(){return"FontSizeEditing"}constructor(e){super(e),e.config.define(U,{options:["tiny","small","default","big","huge"],supportAllValues:!1})}init(){const e=this.editor;e.model.schema.extend("$text",{allowAttributes:U}),e.model.schema.setAttributeProperties(U,{isFormatting:!0,copyOnEnter:!0});const t=e.config.get("fontSize.supportAllValues"),n=In(this.editor.config.get("fontSize.options")).filter(o=>o.model),i=vo(U,n);t?(this._prepareAnyValueConverters(i),this._prepareCompatibilityConverter()):e.conversion.attributeToElement(i),e.commands.add(U,new ku(e))}_prepareAnyValueConverters(e){const t=this.editor,n=e.model.values.filter(i=>!pa(String(i))&&!wa(String(i)));if(n.length)throw new L("font-size-invalid-use-of-named-presets",null,{presets:n});t.conversion.for("downcast").attributeToElement({model:U,view:(i,{writer:o})=>{if(i)return o.createAttributeElement("span",{style:"font-size:"+i},{priority:7})}}),t.conversion.for("upcast").elementToAttribute({model:{key:U,value:i=>i.getStyle("font-size")},view:{name:"span",styles:{"font-size":/.*/}}})}_prepareCompatibilityConverter(){this.editor.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{size:/^[+-]?\d{1,3}$/}},model:{key:U,value:t=>{const n=t.getAttribute("size"),i=n[0]==="-"||n[0]==="+";let o=parseInt(n,10);i&&(o=3+o);const r=Ci.length-1,l=Math.min(Math.max(o,0),r);return Ci[l]}}})}}const Su='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.816 11.5 7.038 4.785 4.261 11.5h5.555zm.62 1.5H3.641l-1.666 4.028H.312l5.789-14h1.875l5.789 14h-1.663L10.436 13zm7.55 2.279.779-.779.707.707-2.265 2.265-2.193-2.265.707-.707.765.765V4.825c0-.042 0-.083.002-.123l-.77.77-.707-.707L17.207 2.5l2.265 2.265-.707.707-.782-.782c.002.043.003.089.003.135v10.454z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xu extends f{static get pluginName(){return"FontSizeUI"}init(){const e=this.editor,t=e.t,n=this._getLocalizedOptions(),i=e.commands.get(U),o=t("Font Size");e.ui.componentFactory.add(U,r=>{const l=W(r);return We(l,()=>Ru(n,i),{role:"menu",ariaLabel:o}),l.buttonView.set({label:o,icon:Su,tooltip:!0}),l.extendTemplate({attributes:{class:["ck-font-size-dropdown"]}}),l.bind("isEnabled").to(i),this.listenTo(l,"execute",a=>{e.execute(a.source.commandName,{value:a.source.commandParam}),e.editing.view.focus()}),l})}_getLocalizedOptions(){const e=this.editor,t=e.t,n={Default:t("Default"),Tiny:t("Tiny"),Small:t("Small"),Big:t("Big"),Huge:t("Huge")};return In(e.config.get(U).options).map(o=>{const r=n[o.title];return r&&r!=o.title&&(o=Object.assign({},o,{title:r})),o})}}function Ru(s,e){const t=new te;for(const n of s){const i={type:"button",model:new qe({commandName:U,commandParam:n.model,label:n.title,class:"ck-fontsize-option",role:"menuitemradio",withText:!0})};n.view&&typeof n.view!="string"&&(n.view.styles&&i.model.set("labelStyle",`font-size:${n.view.styles["font-size"]}`),n.view.classes&&i.model.set("class",`${i.model.class} ${n.view.classes}`)),i.model.bind("isOn").to(e,"value",o=>o===n.model),t.add(i)}return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vu extends f{static get requires(){return[Au,xu]}static get pluginName(){return"FontSize"}normalizeSizeOptions(e){return In(e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pu extends It{constructor(e){super(e,Q)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bu extends f{static get pluginName(){return"FontColorEditing"}constructor(e){super(e),e.config.define(Q,{colors:[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}],columns:5}),e.conversion.for("upcast").elementToAttribute({view:{name:"span",styles:{color:/[\s\S]+/}},model:{key:Q,value:Co("color")}}),e.conversion.for("upcast").elementToAttribute({view:{name:"font",attributes:{color:/^#?\w+$/}},model:{key:Q,value:t=>t.getAttribute("color")}}),e.conversion.for("downcast").attributeToElement({model:Q,view:ko("color")}),e.commands.add(Q,new Pu(e)),e.model.schema.extend("$text",{allowAttributes:Q}),e.model.schema.setAttributeProperties(Q,{isFormatting:!0,copyOnEnter:!0})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _o extends f{constructor(e,{commandName:t,componentName:n,icon:i,dropdownLabel:o}){super(e),this.commandName=t,this.componentName=n,this.icon=i,this.dropdownLabel=o,this.columns=e.config.get(`${this.componentName}.columns`)}init(){const e=this.editor,t=e.locale,n=t.t,i=e.commands.get(this.commandName),o=e.config.get(this.componentName),r=za(o.colors),l=Na(t,r),a=o.documentColors,c=o.colorPicker!==!1;e.ui.componentFactory.add(this.componentName,d=>{const u=W(d);let m=!1;const h=du({dropdownView:u,colors:l.map(g=>({label:g.label,color:g.model,options:{hasBorder:g.hasBorder}})),columns:this.columns,removeButtonLabel:n("Remove color"),colorPickerLabel:n("Color picker"),documentColorsLabel:a!==0?n("Document colors"):"",documentColorsCount:a===void 0?this.columns:a,colorPickerViewConfig:c?o.colorPicker||{}:!1});return h.bind("selectedColor").to(i,"value"),u.buttonView.set({label:this.dropdownLabel,icon:this.icon,tooltip:!0}),u.extendTemplate({attributes:{class:"ck-color-ui-dropdown"}}),u.bind("isEnabled").to(i),h.on("execute",(g,p)=>{u.isOpen&&e.execute(this.commandName,{value:p.value,batch:this._undoStepBatch}),p.source!=="colorPicker"&&e.editing.view.focus(),p.source==="colorPickerSaveButton"&&(u.isOpen=!1)}),h.on("colorPicker:show",()=>{this._undoStepBatch=e.model.createBatch()}),h.on("colorPicker:cancel",()=>{this._undoStepBatch.operations.length&&(u.isOpen=!1,e.execute("undo",this._undoStepBatch)),e.editing.view.focus()}),u.on("change:isOpen",(g,p,b)=>{m||(m=!0,u.colorSelectorView.appendUI()),b&&(a!==0&&h.updateDocumentColors(e.model,this.componentName),h.updateSelectedColors(),h.showColorGridsFragment())}),el(u,()=>u.colorSelectorView.colorGridsFragmentView.staticColorsGrid.items.find(g=>g.isOn)),u})}}const Lu='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M12.4 10.3 10 4.5l-2.4 5.8h4.8zm.5 1.2H7.1L5.7 15H4.2l5-12h1.6l5 12h-1.5L13 11.5zm3.1 7H4a1 1 0 0 1 0-2h12a1 1 0 0 1 0 2z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Du extends _o{constructor(e){const t=e.locale.t;super(e,{commandName:Q,componentName:Q,icon:Lu,dropdownLabel:t("Font Color")})}static get pluginName(){return"FontColorUI"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Fu extends f{static get requires(){return[Bu,Du]}static get pluginName(){return"FontColor"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mu extends It{constructor(e){super(e,ee)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Uu extends f{static get pluginName(){return"FontBackgroundColorEditing"}constructor(e){super(e),e.config.define(ee,{colors:[{color:"hsl(0, 0%, 0%)",label:"Black"},{color:"hsl(0, 0%, 30%)",label:"Dim grey"},{color:"hsl(0, 0%, 60%)",label:"Grey"},{color:"hsl(0, 0%, 90%)",label:"Light grey"},{color:"hsl(0, 0%, 100%)",label:"White",hasBorder:!0},{color:"hsl(0, 75%, 60%)",label:"Red"},{color:"hsl(30, 75%, 60%)",label:"Orange"},{color:"hsl(60, 75%, 60%)",label:"Yellow"},{color:"hsl(90, 75%, 60%)",label:"Light green"},{color:"hsl(120, 75%, 60%)",label:"Green"},{color:"hsl(150, 75%, 60%)",label:"Aquamarine"},{color:"hsl(180, 75%, 60%)",label:"Turquoise"},{color:"hsl(210, 75%, 60%)",label:"Light blue"},{color:"hsl(240, 75%, 60%)",label:"Blue"},{color:"hsl(270, 75%, 60%)",label:"Purple"}],columns:5}),e.data.addStyleProcessorRules(Va),e.conversion.for("upcast").elementToAttribute({view:{name:"span",styles:{"background-color":/[\s\S]+/}},model:{key:ee,value:Co("background-color")}}),e.conversion.for("downcast").attributeToElement({model:ee,view:ko("background-color")}),e.commands.add(ee,new Mu(e)),e.model.schema.extend("$text",{allowAttributes:ee}),e.model.schema.setAttributeProperties(ee,{isFormatting:!0,copyOnEnter:!0})}}const Ou='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M4 2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm8.38 9.262H7.62L10 5.506l2.38 5.756zm.532 1.285L14.34 16h1.426L10.804 4H9.196L4.234 16H5.66l1.428-3.453h5.824z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nu extends _o{constructor(e){const t=e.locale.t;super(e,{commandName:ee,componentName:ee,icon:Ou,dropdownLabel:t("Font Background Color")})}static get pluginName(){return"FontBackgroundColorUI"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zu extends f{static get requires(){return[Uu,Nu]}static get pluginName(){return"FontBackgroundColor"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Hu extends f{static get requires(){return[Cu,Vu,Fu,zu]}static get pluginName(){return"Font"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $u extends k{constructor(e,t){super(e),this.modelElements=t}refresh(){const e=M(this.editor.model.document.selection.getSelectedBlocks());this.value=!!e&&this.modelElements.includes(e.name)&&e.name,this.isEnabled=!!e&&this.modelElements.some(t=>ki(e,t,this.editor.model.schema))}execute(e){const t=this.editor.model,n=t.document,i=e.value;t.change(o=>{const r=Array.from(n.selection.getSelectedBlocks()).filter(l=>ki(l,i,t.schema));for(const l of r)l.is("element",i)||o.rename(l,i)})}}function ki(s,e,t){return t.checkChild(s.parent,e)&&!t.isObject(s)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const yi="paragraph";class Wu extends f{static get pluginName(){return"HeadingEditing"}constructor(e){super(e),e.config.define("heading",{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"},{model:"heading3",view:"h4",title:"Heading 3",class:"ck-heading_heading3"}]})}static get requires(){return[Vs]}init(){const e=this.editor,t=e.config.get("heading.options"),n=[];for(const i of t)i.model!=="paragraph"&&(e.model.schema.register(i.model,{inheritAllFrom:"$block"}),e.conversion.elementToElement(i),n.push(i.model));this._addDefaultH1Conversion(e),e.commands.add("heading",new $u(e,n))}afterInit(){const e=this.editor,t=e.commands.get("enter"),n=e.config.get("heading.options");t&&this.listenTo(t,"afterExecute",(i,o)=>{const r=e.model.document.selection.getFirstPosition().parent;n.some(a=>r.is("element",a.model))&&!r.is("element",yi)&&r.childCount===0&&o.writer.rename(r,yi)})}_addDefaultH1Conversion(e){e.conversion.for("upcast").elementToElement({model:"heading1",view:"h1",converterPriority:tl.low+1})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function qu(s){const e=s.t,t={Paragraph:e("Paragraph"),"Heading 1":e("Heading 1"),"Heading 2":e("Heading 2"),"Heading 3":e("Heading 3"),"Heading 4":e("Heading 4"),"Heading 5":e("Heading 5"),"Heading 6":e("Heading 6")};return s.config.get("heading.options").map(n=>{const i=t[n.title];return i&&i!=n.title&&(n.title=i),n})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gu extends f{static get pluginName(){return"HeadingUI"}init(){const e=this.editor,t=e.t,n=qu(e),i=t("Choose heading"),o=t("Heading");e.ui.componentFactory.add("heading",r=>{const l={},a=new te,c=e.commands.get("heading"),d=e.commands.get("paragraph"),u=[c];for(const h of n){const g={type:"button",model:new qe({label:h.title,class:h.class,role:"menuitemradio",withText:!0})};h.model==="paragraph"?(g.model.bind("isOn").to(d,"value"),g.model.set("commandName","paragraph"),u.push(d)):(g.model.bind("isOn").to(c,"value",p=>p===h.model),g.model.set({commandName:"heading",commandValue:h.model})),a.add(g),l[h.model]=h.title}const m=W(r);return We(m,a,{ariaLabel:o,role:"menu"}),m.buttonView.set({ariaLabel:o,ariaLabelledBy:void 0,isOn:!1,withText:!0,tooltip:o}),m.extendTemplate({attributes:{class:["ck-heading-dropdown"]}}),m.bind("isEnabled").toMany(u,"isEnabled",(...h)=>h.some(g=>g)),m.buttonView.bind("label").to(c,"value",d,"value",(h,g)=>{const p=h||g&&"paragraph";return typeof p=="boolean"||!l[p]?i:l[p]}),this.listenTo(m,"execute",h=>{const{commandName:g,commandValue:p}=h.source;e.execute(g,p?{value:p}:void 0),e.editing.view.focus()}),m})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ju extends f{static get requires(){return[Wu,Gu]}static get pluginName(){return"Heading"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ku(s){return s.createContainerElement("span",{class:"image-inline"},s.createEmptyElement("img"))}function _i(s){return s.createContainerElement("figure",{class:"image"},[s.createEmptyElement("img"),s.createSlot("children")])}function Io(s,e){const t=s.plugins.get("ImageUtils"),n=s.plugins.has("ImageInlineEditing")&&s.plugins.has("ImageBlockEditing");return o=>t.isInlineImageView(o)?n&&(o.getStyle("display")=="block"||o.findAncestor(t.isBlockImageView)?"imageBlock":"imageInline")!==e?null:i(o):null;function i(o){const r={name:!0};return o.hasAttribute("src")&&(r.attributes=["src"]),r}}function Tn(s,e){const t=M(e.getSelectedBlocks());return!t||s.isObject(t)||t.isEmpty&&t.name!="listItem"?"imageBlock":"imageInline"}function gt(s){return s&&s.endsWith("px")?parseInt(s):null}function ft(s){const e=gt(s.getStyle("width")),t=gt(s.getStyle("height"));return!!(e&&t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Qu=/^(image|image-inline)$/;class F extends f{constructor(){super(...arguments),this._domEmitter=new($e())}static get pluginName(){return"ImageUtils"}isImage(e){return this.isInlineImage(e)||this.isBlockImage(e)}isInlineImageView(e){return!!e&&e.is("element","img")}isBlockImageView(e){return!!e&&e.is("element","figure")&&e.hasClass("image")}insertImage(e={},t=null,n=null,i={}){const o=this.editor,r=o.model,l=r.document.selection,a=To(o,t||l,n);e={...Object.fromEntries(l.getAttributes()),...e};for(const c in e)r.schema.checkAttribute(a,c)||delete e[c];return r.change(c=>{const{setImageSizes:d=!0}=i,u=c.createElement(a,e);return r.insertObject(u,t,null,{setSelection:"on",findOptimalPosition:!t&&a!="imageInline"?"auto":void 0}),u.parent?(d&&this.setImageNaturalSizeAttributes(u),u):null})}setImageNaturalSizeAttributes(e){const t=e.getAttribute("src");t&&(e.getAttribute("width")||e.getAttribute("height")||this.editor.model.change(n=>{const i=new A.window.Image;this._domEmitter.listenTo(i,"load",()=>{!e.getAttribute("width")&&!e.getAttribute("height")&&this.editor.model.enqueueChange(n.batch,o=>{o.setAttribute("width",i.naturalWidth,e),o.setAttribute("height",i.naturalHeight,e)}),this._domEmitter.stopListening(i,"load")}),i.src=t}))}getClosestSelectedImageWidget(e){const t=e.getFirstPosition();if(!t)return null;const n=e.getSelectedElement();if(n&&this.isImageWidget(n))return n;let i=t.parent;for(;i;){if(i.is("element")&&this.isImageWidget(i))return i;i=i.parent}return null}getClosestSelectedImageElement(e){const t=e.getSelectedElement();return this.isImage(t)?t:e.getFirstPosition().findAncestor("imageBlock")}getImageWidgetFromImageView(e){return e.findAncestor({classes:Qu})}isImageAllowed(){const t=this.editor.model.document.selection;return Zu(this.editor,t)&&Xu(t)}toImageWidget(e,t,n){return t.setCustomProperty("image",!0,e),wn(e,t,{label:()=>{const r=this.findViewImgElement(e).getAttribute("alt");return r?`${r} ${n}`:n}})}isImageWidget(e){return!!e.getCustomProperty("image")&&D(e)}isBlockImage(e){return!!e&&e.is("element","imageBlock")}isInlineImage(e){return!!e&&e.is("element","imageInline")}findViewImgElement(e){if(this.isInlineImageView(e))return e;const t=this.editor.editing.view;for(const{item:n}of t.createRangeIn(e))if(this.isInlineImageView(n))return n}destroy(){return this._domEmitter.stopListening(),super.destroy()}}function Zu(s,e){if(To(s,e,null)=="imageBlock"){const n=Yu(e,s.model);if(s.model.schema.checkChild(n,"imageBlock"))return!0}else if(s.model.schema.checkChild(e.focus,"imageInline"))return!0;return!1}function Xu(s){return[...s.focus.getAncestors()].every(e=>!e.is("element","imageBlock"))}function Yu(s,e){const n=Ps(s,e).start.parent;return n.isEmpty&&!n.is("element","$root")?n.parent:n}function To(s,e,t){const n=s.model.schema,i=s.config.get("image.insert.type");return s.plugins.has("ImageBlockEditing")?s.plugins.has("ImageInlineEditing")?t||(i==="inline"?"imageInline":i!=="auto"?"imageBlock":e.is("selection")?Tn(n,e):n.checkChild(e,"imageInline")?"imageInline":"imageBlock"):"imageBlock":"imageInline"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ju extends k{refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled&&n.hasAttribute("alt")?this.value=n.getAttribute("alt"):this.value=!1}execute(e){const t=this.editor,n=t.plugins.get("ImageUtils"),i=t.model,o=n.getClosestSelectedImageElement(i.document.selection);i.change(r=>{r.setAttribute("alt",e.newValue,o)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class em extends f{static get requires(){return[F]}static get pluginName(){return"ImageTextAlternativeEditing"}init(){this.editor.commands.add("imageTextAlternative",new Ju(this.editor))}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class tm extends T{constructor(e){super(e);const t=this.locale.t;this.focusTracker=new X,this.keystrokes=new ne,this.labeledInput=this._createLabeledInputView(),this.saveButtonView=this._createButton(t("Save"),C.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(t("Cancel"),C.cancel,"ck-button-cancel","cancel"),this._focusables=new de,this._focusCycler=new ue({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"form",attributes:{class:["ck","ck-text-alternative-form","ck-responsive-form"],tabindex:"-1"},children:[this.labeledInput,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),this.keystrokes.listenTo(this.element),kt({view:this}),[this.labeledInput,this.saveButtonView,this.cancelButtonView].forEach(e=>{this._focusables.add(e),this.focusTracker.add(e.element)})}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createButton(e,t,n,i){const o=new y(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),i&&o.delegate("execute").to(this,i),o}_createLabeledInputView(){const e=this.locale.t,t=new ze(this.locale,He);return t.label=e("Text alternative"),t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function nm(s){const e=s.plugins.get("ContextualBalloon");if(s.plugins.get("ImageUtils").getClosestSelectedImageWidget(s.editing.view.document.selection)){const n=Eo(s);e.updatePosition(n)}}function Eo(s){const e=s.editing.view,t=fn.defaultPositions,n=s.plugins.get("ImageUtils");return{target:e.domConverter.mapViewToDom(n.getClosestSelectedImageWidget(e.document.selection)),positions:[t.northArrowSouth,t.northArrowSouthWest,t.northArrowSouthEast,t.southArrowNorth,t.southArrowNorthWest,t.southArrowNorthEast,t.viewportStickyNorth]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class im extends f{static get requires(){return[mt]}static get pluginName(){return"ImageTextAlternativeUI"}init(){this._createButton()}destroy(){super.destroy(),this._form&&this._form.destroy()}_createButton(){const e=this.editor,t=e.t;e.ui.componentFactory.add("imageTextAlternative",n=>{const i=e.commands.get("imageTextAlternative"),o=new y(n);return o.set({label:t("Change image text alternative"),icon:C.textAlternative,tooltip:!0}),o.bind("isEnabled").to(i,"isEnabled"),o.bind("isOn").to(i,"value",r=>!!r),this.listenTo(o,"execute",()=>{this._showForm()}),o})}_createForm(){const e=this.editor,n=e.editing.view.document,i=e.plugins.get("ImageUtils");this._balloon=this.editor.plugins.get("ContextualBalloon"),this._form=new(Cn(tm))(e.locale),this._form.render(),this.listenTo(this._form,"submit",()=>{e.execute("imageTextAlternative",{newValue:this._form.labeledInput.fieldView.element.value}),this._hideForm(!0)}),this.listenTo(this._form,"cancel",()=>{this._hideForm(!0)}),this._form.keystrokes.set("Esc",(o,r)=>{this._hideForm(!0),r()}),this.listenTo(e.ui,"update",()=>{i.getClosestSelectedImageWidget(n.selection)?this._isVisible&&nm(e):this._hideForm(!0)}),Bs({emitter:this._form,activator:()=>this._isVisible,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideForm()})}_showForm(){if(this._isVisible)return;this._form||this._createForm();const e=this.editor,t=e.commands.get("imageTextAlternative"),n=this._form.labeledInput;this._form.disableCssTransitions(),this._isInBalloon||this._balloon.add({view:this._form,position:Eo(e)}),n.fieldView.value=n.fieldView.element.value=t.value||"",this._form.labeledInput.fieldView.select(),this._form.enableCssTransitions()}_hideForm(e=!1){this._isInBalloon&&(this._form.focusTracker.isFocused&&this._form.saveButtonView.focus(),this._balloon.remove(this._form),e&&this.editor.editing.view.focus())}get _isVisible(){return!!this._balloon&&this._balloon.visibleView===this._form}get _isInBalloon(){return!!this._balloon&&this._balloon.hasView(this._form)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ao extends f{static get requires(){return[em,im]}static get pluginName(){return"ImageTextAlternative"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function sm(s){const e=(t,n,i)=>{if(!i.consumable.test(n.viewItem,{name:!0,classes:"image"}))return;const o=s.findViewImgElement(n.viewItem);if(!o||!i.consumable.test(o,{name:!0}))return;i.consumable.consume(n.viewItem,{name:!0,classes:"image"});const r=i.convertItem(o,n.modelCursor),l=M(r.modelRange.getItems());if(!l){i.consumable.revert(n.viewItem,{name:!0,classes:"image"});return}i.convertChildren(n.viewItem,l),i.updateConversionResult(l,n)};return t=>{t.on("element:figure",e)}}function So(s,e){const t=(n,i,o)=>{if(!o.consumable.consume(i.item,n.name))return;const r=o.writer,l=o.mapper.toViewElement(i.item),a=s.findViewImgElement(l);i.attributeNewValue===null?(r.removeAttribute("srcset",a),r.removeAttribute("sizes",a)):i.attributeNewValue&&(r.setAttribute("srcset",i.attributeNewValue,a),r.setAttribute("sizes","100vw",a))};return n=>{n.on(`attribute:srcset:${e}`,t)}}function pt(s,e,t){const n=(i,o,r)=>{if(!r.consumable.consume(o.item,i.name))return;const l=r.writer,a=r.mapper.toViewElement(o.item),c=s.findViewImgElement(a);l.setAttribute(o.attributeKey,o.attributeNewValue||"",c)};return i=>{i.on(`attribute:${t}:${e}`,n)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class En extends Ss{observe(e){this.listenTo(e,"load",(t,n)=>{const i=n.target;this.checkShouldIgnoreEventFromTarget(i)||i.tagName=="IMG"&&this._fireEvents(n)},{useCapture:!0})}stopObserving(e){this.stopListening(e)}_fireEvents(e){this.isEnabled&&(this.document.fire("layoutChanged"),this.document.fire("imageLoaded",e))}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class om extends k{constructor(e){super(e);const t=e.config.get("image.insert.type");e.plugins.has("ImageBlockEditing")||t==="block"&&$("image-block-plugin-required"),e.plugins.has("ImageInlineEditing")||t==="inline"&&$("image-inline-plugin-required")}refresh(){const e=this.editor.plugins.get("ImageUtils");this.isEnabled=e.isImageAllowed()}execute(e){const t=ie(e.source),n=this.editor.model.document.selection,i=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(n.getAttributes());t.forEach((r,l)=>{const a=n.getSelectedElement();if(typeof r=="string"&&(r={src:r}),l&&a&&i.isImage(a)){const c=this.editor.model.createPositionAfter(a);i.insertImage({...r,...o},c)}else i.insertImage({...r,...o})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rm extends k{constructor(e){super(e),this.decorate("cleanupImage")}refresh(){const t=this.editor.plugins.get("ImageUtils"),n=this.editor.model.document.selection.getSelectedElement();this.isEnabled=t.isImage(n),this.value=this.isEnabled?n.getAttribute("src"):null}execute(e){const t=this.editor.model.document.selection.getSelectedElement(),n=this.editor.plugins.get("ImageUtils");this.editor.model.change(i=>{i.setAttribute("src",e.source,t),this.cleanupImage(i,t),n.setImageNaturalSizeAttributes(t)})}cleanupImage(e,t){e.removeAttribute("srcset",t),e.removeAttribute("sizes",t),e.removeAttribute("sources",t),e.removeAttribute("width",t),e.removeAttribute("height",t),e.removeAttribute("alt",t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xo extends f{static get requires(){return[F]}static get pluginName(){return"ImageEditing"}init(){const e=this.editor,t=e.conversion;e.editing.view.addObserver(En),t.for("upcast").attributeToAttribute({view:{name:"img",key:"alt"},model:"alt"}).attributeToAttribute({view:{name:"img",key:"srcset"},model:"srcset"});const n=new om(e),i=new rm(e);e.commands.add("insertImage",n),e.commands.add("replaceImageSource",i),e.commands.add("imageInsert",n)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ro extends f{static get requires(){return[F]}static get pluginName(){return"ImageSizeAttributes"}afterInit(){this._registerSchema(),this._registerConverters("imageBlock"),this._registerConverters("imageInline")}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["width","height"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["width","height"]})}_registerConverters(e){const t=this.editor,n=t.plugins.get("ImageUtils"),i=e==="imageBlock"?"figure":"img";t.conversion.for("upcast").attributeToAttribute({view:{name:i,styles:{width:/.+/}},model:{key:"width",value:r=>ft(r)?gt(r.getStyle("width")):null}}).attributeToAttribute({view:{name:i,key:"width"},model:"width"}).attributeToAttribute({view:{name:i,styles:{height:/.+/}},model:{key:"height",value:r=>ft(r)?gt(r.getStyle("height")):null}}).attributeToAttribute({view:{name:i,key:"height"},model:"height"}),t.conversion.for("editingDowncast").add(r=>{o(r,"width","width",!0),o(r,"height","height",!0)}),t.conversion.for("dataDowncast").add(r=>{o(r,"width","width",!1),o(r,"height","height",!1)});function o(r,l,a,c){r.on(`attribute:${l}:${e}`,(d,u,m)=>{if(!m.consumable.consume(u.item,d.name))return;const h=m.writer,g=m.mapper.toViewElement(u.item),p=n.findViewImgElement(g);if(u.attributeNewValue!==null?h.setAttribute(a,u.attributeNewValue,p):h.removeAttribute(a,p),u.item.hasAttribute("sources"))return;const b=u.item.hasAttribute("resizedWidth");if(e==="imageInline"&&!b&&!c)return;const w=u.item.getAttribute("width"),v=u.item.getAttribute("height");w&&v&&h.setStyle("aspect-ratio",`${w}/${v}`,p)})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Vo extends k{constructor(e,t){super(e),this._modelElementName=t}refresh(){const t=this.editor.plugins.get("ImageUtils"),n=t.getClosestSelectedImageElement(this.editor.model.document.selection);this._modelElementName==="imageBlock"?this.isEnabled=t.isInlineImage(n):this.isEnabled=t.isBlockImage(n)}execute(e={}){const t=this.editor,n=this.editor.model,i=t.plugins.get("ImageUtils"),o=i.getClosestSelectedImageElement(n.document.selection),r=Object.fromEntries(o.getAttributes());return!r.src&&!r.uploadId?null:n.change(l=>{const{setImageSizes:a=!0}=e,c=Array.from(n.markers).filter(m=>m.getRange().containsItem(o)),d=i.insertImage(r,n.createSelection(o,"on"),this._modelElementName,{setImageSizes:a});if(!d)return null;const u=l.createRangeOn(d);for(const m of c){const h=m.getRange(),g=h.root.rootName!="$graveyard"?h.getJoined(u,!0):u;l.updateMarker(m,{range:g})}return{oldElement:o,newElement:d}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Po extends f{static get requires(){return[F]}static get pluginName(){return"ImagePlaceholder"}afterInit(){this._setupSchema(),this._setupConversion(),this._setupLoadListener()}_setupSchema(){const e=this.editor.model.schema;e.isRegistered("imageBlock")&&e.extend("imageBlock",{allowAttributes:["placeholder"]}),e.isRegistered("imageInline")&&e.extend("imageInline",{allowAttributes:["placeholder"]})}_setupConversion(){const e=this.editor,t=e.conversion,n=e.plugins.get("ImageUtils");t.for("editingDowncast").add(i=>{i.on("attribute:placeholder",(o,r,l)=>{if(!l.consumable.test(r.item,o.name)||!r.item.is("element","imageBlock")&&!r.item.is("element","imageInline"))return;l.consumable.consume(r.item,o.name);const a=l.writer,c=l.mapper.toViewElement(r.item),d=n.findViewImgElement(c);r.attributeNewValue?(a.addClass("image_placeholder",d),a.setStyle("background-image",`url(${r.attributeNewValue})`,d),a.setCustomProperty("editingPipeline:doNotReuseOnce",!0,d)):(a.removeClass("image_placeholder",d),a.removeStyle("background-image",d))})})}_setupLoadListener(){const e=this.editor,t=e.model,n=e.editing,i=n.view,o=e.plugins.get("ImageUtils");i.addObserver(En),this.listenTo(i.document,"imageLoaded",(r,l)=>{const a=i.domConverter.mapDomToView(l.target);if(!a)return;const c=o.getImageWidgetFromImageView(a);if(!c)return;const d=n.mapper.toModelElement(c);!d||!d.hasAttribute("placeholder")||t.enqueueChange({isUndoable:!1},u=>{u.removeAttribute("placeholder",d)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bo extends f{static get requires(){return[xo,Ro,F,Po,q]}static get pluginName(){return"ImageBlockEditing"}init(){const e=this.editor;e.model.schema.register("imageBlock",{inheritAllFrom:"$blockObject",allowAttributes:["alt","src","srcset"]}),this._setupConversion(),e.plugins.has("ImageInlineEditing")&&(e.commands.add("imageTypeBlock",new Vo(this.editor,"imageBlock")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,n=e.conversion,i=e.plugins.get("ImageUtils");n.for("dataDowncast").elementToStructure({model:"imageBlock",view:(o,{writer:r})=>_i(r)}),n.for("editingDowncast").elementToStructure({model:"imageBlock",view:(o,{writer:r})=>i.toImageWidget(_i(r),r,t("image widget"))}),n.for("downcast").add(pt(i,"imageBlock","src")).add(pt(i,"imageBlock","alt")).add(So(i,"imageBlock")),n.for("upcast").elementToElement({view:Io(e,"imageBlock"),model:(o,{writer:r})=>r.createElement("imageBlock",o.hasAttribute("src")?{src:o.getAttribute("src")}:void 0)}).add(sm(i))}_setupClipboardIntegration(){const e=this.editor,t=e.model,n=e.editing.view,i=e.plugins.get("ImageUtils"),o=e.plugins.get("ClipboardPipeline");this.listenTo(o,"inputTransformation",(r,l)=>{const a=Array.from(l.content.getChildren());let c;if(!a.every(i.isInlineImageView))return;l.targetRanges?c=e.editing.mapper.toModelRange(l.targetRanges[0]):c=t.document.selection.getFirstRange();const d=t.createSelection(c);if(Tn(t.schema,d)==="imageBlock"){const u=new se(n.document),m=a.map(h=>u.createElement("figure",{class:"image"},h));l.content=u.createDocumentFragment(m)}}),this.listenTo(o,"contentInsertion",(r,l)=>{l.method==="paste"&&t.change(a=>{const c=a.createRangeIn(l.content);for(const d of c.getItems())d.is("element","imageBlock")&&i.setImageNaturalSizeAttributes(d)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lm extends T{constructor(e,t=[]){super(e),this.focusTracker=new X,this.keystrokes=new ne,this._focusables=new de,this.children=this.createCollection(),this._focusCycler=new ue({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});for(const n of t)this.children.add(n),this._focusables.add(n),n instanceof Ys&&this._focusables.addMany(n.children);if(this._focusables.length>1)for(const n of this._focusables)am(n)&&(n.focusCycler.on("forwardCycle",i=>{this._focusCycler.focusNext(),i.stop()}),n.focusCycler.on("backwardCycle",i=>{this._focusCycler.focusPrevious(),i.stop()}));this.setTemplate({tag:"form",attributes:{class:["ck","ck-image-insert-form"],tabindex:-1},children:this.children})}render(){super.render(),kt({view:this});for(const t of this._focusables)this.focusTracker.add(t.element);this.keystrokes.listenTo(this.element);const e=t=>t.stopPropagation();this.keystrokes.set("arrowright",e),this.keystrokes.set("arrowleft",e),this.keystrokes.set("arrowup",e),this.keystrokes.set("arrowdown",e)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}}function am(s){return"focusCycler"in s}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class je extends f{static get pluginName(){return"ImageInsertUI"}static get requires(){return[F]}constructor(e){super(e),this._integrations=new Map,e.config.define("image.insert.integrations",["upload","assetManager","url"])}init(){const e=this.editor,t=e.model.document.selection,n=e.plugins.get("ImageUtils");this.set("isImageSelected",!1),this.listenTo(e.model.document,"change",()=>{this.isImageSelected=n.isImage(t.getSelectedElement())});const i=o=>this._createToolbarComponent(o);e.ui.componentFactory.add("insertImage",i),e.ui.componentFactory.add("imageInsert",i)}registerIntegration({name:e,observable:t,buttonViewCreator:n,formViewCreator:i,requiresForm:o}){this._integrations.has(e)&&$("image-insert-integration-exists",{name:e}),this._integrations.set(e,{observable:t,buttonViewCreator:n,formViewCreator:i,requiresForm:!!o})}_createToolbarComponent(e){const t=this.editor,n=e.t,i=this._prepareIntegrations();if(!i.length)return null;let o;const r=i[0];if(i.length==1){if(!r.requiresForm)return r.buttonViewCreator(!0);o=r.buttonViewCreator(!0)}else{const c=r.buttonViewCreator(!1);o=new vn(e,c),o.tooltip=!0,o.bind("label").to(this,"isImageSelected",d=>n(d?"Replace image":"Insert image"))}const l=this.dropdownView=W(e,o),a=i.map(({observable:c})=>typeof c=="function"?c():c);return l.bind("isEnabled").toMany(a,"isEnabled",(...c)=>c.some(d=>d)),l.once("change:isOpen",()=>{const c=i.map(({formViewCreator:u})=>u(i.length==1)),d=new lm(t.locale,c);l.panelView.children.add(d)}),l}_prepareIntegrations(){const t=this.editor.config.get("image.insert.integrations"),n=[];if(!t.length)return $("image-insert-integrations-not-specified"),n;for(const i of t){if(!this._integrations.has(i)){["upload","assetManager","url"].includes(i)||$("image-insert-unknown-integration",{item:i});continue}n.push(this._integrations.get(i))}return n.length||$("image-insert-integrations-not-registered"),n}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cm extends f{static get requires(){return[Bo,Ge,Ao,je]}static get pluginName(){return"ImageBlock"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class dm extends f{static get requires(){return[xo,Ro,F,Po,q]}static get pluginName(){return"ImageInlineEditing"}init(){const e=this.editor,t=e.model.schema;t.register("imageInline",{inheritAllFrom:"$inlineObject",allowAttributes:["alt","src","srcset"]}),t.addChildCheck((n,i)=>{if(n.endsWith("caption")&&i.name==="imageInline")return!1}),this._setupConversion(),e.plugins.has("ImageBlockEditing")&&(e.commands.add("imageTypeInline",new Vo(this.editor,"imageInline")),this._setupClipboardIntegration())}_setupConversion(){const e=this.editor,t=e.t,n=e.conversion,i=e.plugins.get("ImageUtils");n.for("dataDowncast").elementToElement({model:"imageInline",view:(o,{writer:r})=>r.createEmptyElement("img")}),n.for("editingDowncast").elementToStructure({model:"imageInline",view:(o,{writer:r})=>i.toImageWidget(Ku(r),r,t("image widget"))}),n.for("downcast").add(pt(i,"imageInline","src")).add(pt(i,"imageInline","alt")).add(So(i,"imageInline")),n.for("upcast").elementToElement({view:Io(e,"imageInline"),model:(o,{writer:r})=>r.createElement("imageInline",o.hasAttribute("src")?{src:o.getAttribute("src")}:void 0)})}_setupClipboardIntegration(){const e=this.editor,t=e.model,n=e.editing.view,i=e.plugins.get("ImageUtils"),o=e.plugins.get("ClipboardPipeline");this.listenTo(o,"inputTransformation",(r,l)=>{const a=Array.from(l.content.getChildren());let c;if(!a.every(i.isBlockImageView))return;l.targetRanges?c=e.editing.mapper.toModelRange(l.targetRanges[0]):c=t.document.selection.getFirstRange();const d=t.createSelection(c);if(Tn(t.schema,d)==="imageInline"){const u=new se(n.document),m=a.map(h=>h.childCount===1?(Array.from(h.getAttributes()).forEach(g=>u.setAttribute(...g,i.findViewImgElement(h))),h.getChild(0)):h);l.content=u.createDocumentFragment(m)}}),this.listenTo(o,"contentInsertion",(r,l)=>{l.method==="paste"&&t.change(a=>{const c=a.createRangeIn(l.content);for(const d of c.getItems())d.is("element","imageInline")&&i.setImageNaturalSizeAttributes(d)})})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class um extends f{static get requires(){return[dm,Ge,Ao,je]}static get pluginName(){return"ImageInline"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mm extends f{static get requires(){return[cm,um]}static get pluginName(){return"Image"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Lo extends f{static get pluginName(){return"ImageCaptionUtils"}static get requires(){return[F]}getCaptionFromImageModelElement(e){for(const t of e.getChildren())if(t&&t.is("element","caption"))return t;return null}getCaptionFromModelSelection(e){const t=this.editor.plugins.get("ImageUtils"),n=e.getFirstPosition().findAncestor("caption");return n&&t.isBlockImage(n.parent)?n:null}matchImageCaptionViewElement(e){const t=this.editor.plugins.get("ImageUtils");return e.name=="figcaption"&&t.isBlockImageView(e.parent)?{name:!0}:null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class hm extends k{refresh(){const e=this.editor,t=e.plugins.get("ImageCaptionUtils"),n=e.plugins.get("ImageUtils");if(!e.plugins.has(Bo)){this.isEnabled=!1,this.value=!1;return}const i=e.model.document.selection,o=i.getSelectedElement();if(!o){const r=t.getCaptionFromModelSelection(i);this.isEnabled=!!r,this.value=!!r;return}this.isEnabled=n.isImage(o),this.isEnabled?this.value=!!t.getCaptionFromImageModelElement(o):this.value=!1}execute(e={}){const{focusCaptionOnShow:t}=e;this.editor.model.change(n=>{this.value?this._hideImageCaption(n):this._showImageCaption(n,t)})}_showImageCaption(e,t){const i=this.editor.model.document.selection,o=this.editor.plugins.get("ImageCaptionEditing"),r=this.editor.plugins.get("ImageUtils");let l=i.getSelectedElement();const a=o._getSavedCaption(l);r.isInlineImage(l)&&(this.editor.execute("imageTypeBlock"),l=i.getSelectedElement());const c=a||e.createElement("caption");e.append(c,l),t&&e.setSelection(c,"in")}_hideImageCaption(e){const t=this.editor,n=t.model.document.selection,i=t.plugins.get("ImageCaptionEditing"),o=t.plugins.get("ImageCaptionUtils");let r=n.getSelectedElement(),l;r?l=o.getCaptionFromImageModelElement(r):(l=o.getCaptionFromModelSelection(n),r=l.parent),i._saveCaption(r,l),e.setSelection(r,"on"),e.remove(l)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gm extends f{static get requires(){return[F,Lo]}static get pluginName(){return"ImageCaptionEditing"}constructor(e){super(e),this._savedCaptionsMap=new WeakMap}init(){const e=this.editor,t=e.model.schema;t.isRegistered("caption")?t.extend("caption",{allowIn:"imageBlock"}):t.register("caption",{allowIn:"imageBlock",allowContentOf:"$block",isLimit:!0}),e.commands.add("toggleImageCaption",new hm(this.editor)),this._setupConversion(),this._setupImageTypeCommandsIntegration(),this._registerCaptionReconversion()}_setupConversion(){const e=this.editor,t=e.editing.view,n=e.plugins.get("ImageUtils"),i=e.plugins.get("ImageCaptionUtils"),o=e.t;e.conversion.for("upcast").elementToElement({view:r=>i.matchImageCaptionViewElement(r),model:"caption"}),e.conversion.for("dataDowncast").elementToElement({model:"caption",view:(r,{writer:l})=>n.isBlockImage(r.parent)?l.createContainerElement("figcaption"):null}),e.conversion.for("editingDowncast").elementToElement({model:"caption",view:(r,{writer:l})=>{if(!n.isBlockImage(r.parent))return null;const a=l.createEditableElement("figcaption");l.setCustomProperty("imageCaption",!0,a),a.placeholder=o("Enter image caption"),nl({view:t,element:a,keepOnFocus:!0});const c=r.parent.getAttribute("alt"),d=c?o("Caption for image: %0",[c]):o("Caption for the image");return Ls(a,l,{label:d})}})}_setupImageTypeCommandsIntegration(){const e=this.editor,t=e.plugins.get("ImageUtils"),n=e.plugins.get("ImageCaptionUtils"),i=e.commands.get("imageTypeInline"),o=e.commands.get("imageTypeBlock"),r=l=>{if(!l.return)return;const{oldElement:a,newElement:c}=l.return;/* istanbul ignore if: paranoid check -- @preserve */if(!a)return;if(t.isBlockImage(a)){const u=n.getCaptionFromImageModelElement(a);if(u){this._saveCaption(c,u);return}}const d=this._getSavedCaption(a);d&&this._saveCaption(c,d)};i&&this.listenTo(i,"execute",r,{priority:"low"}),o&&this.listenTo(o,"execute",r,{priority:"low"})}_getSavedCaption(e){const t=this._savedCaptionsMap.get(e);return t?il.fromJSON(t):null}_saveCaption(e,t){this._savedCaptionsMap.set(e,t.toJSON())}_registerCaptionReconversion(){const e=this.editor,t=e.model,n=e.plugins.get("ImageUtils"),i=e.plugins.get("ImageCaptionUtils");t.document.on("change:data",()=>{const o=t.document.differ.getChanges();for(const r of o){if(r.attributeKey!=="alt")continue;const l=r.range.start.nodeAfter;if(n.isBlockImage(l)){const a=i.getCaptionFromImageModelElement(l);if(!a)return;e.editing.reconvertItem(a)}}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fm extends f{static get requires(){return[Lo]}static get pluginName(){return"ImageCaptionUI"}init(){const e=this.editor,t=e.editing.view,n=e.plugins.get("ImageCaptionUtils"),i=e.t;e.ui.componentFactory.add("toggleImageCaption",o=>{const r=e.commands.get("toggleImageCaption"),l=new y(o);return l.set({icon:C.caption,tooltip:!0,isToggleable:!0}),l.bind("isOn","isEnabled").to(r,"value","isEnabled"),l.bind("label").to(r,"value",a=>i(a?"Toggle caption off":"Toggle caption on")),this.listenTo(l,"execute",()=>{e.execute("toggleImageCaption",{focusCaptionOnShow:!0});const a=n.getCaptionFromModelSelection(e.model.document.selection);if(a){const c=e.editing.mapper.toViewElement(a);t.scrollToTheSelection(),t.change(d=>{d.addClass("image__caption_highlighted",c)})}e.editing.view.focus()}),l})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class pm extends f{static get requires(){return[gm,fm]}static get pluginName(){return"ImageCaption"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bm extends Z(){constructor(){super();const e=new window.FileReader;this._reader=e,this._data=void 0,this.set("loaded",0),e.onprogress=t=>{this.loaded=t.loaded}}get error(){return this._reader.error}get data(){return this._data}read(e){const t=this._reader;return this.total=e.size,new Promise((n,i)=>{t.onload=()=>{const o=t.result;this._data=o,n(o)},t.onerror=()=>{i("error")},t.onabort=()=>{i("aborted")},this._reader.readAsDataURL(e)})}abort(){this._reader.abort()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class De extends f{constructor(){super(...arguments),this.loaders=new te,this._loadersMap=new Map,this._pendingAction=null}static get pluginName(){return"FileRepository"}static get requires(){return[ut]}init(){this.loaders.on("change",()=>this._updatePendingAction()),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(e,t)=>t?e/t*100:0)}getLoader(e){return this._loadersMap.get(e)||null}createLoader(e){if(!this.createUploadAdapter)return $("filerepository-no-upload-adapter"),null;const t=new Ii(Promise.resolve(e),this.createUploadAdapter);return this.loaders.add(t),this._loadersMap.set(e,t),e instanceof Promise&&t.file.then(n=>{this._loadersMap.set(n,t)}).catch(()=>{}),t.on("change:uploaded",()=>{let n=0;for(const i of this.loaders)n+=i.uploaded;this.uploaded=n}),t.on("change:uploadTotal",()=>{let n=0;for(const i of this.loaders)i.uploadTotal&&(n+=i.uploadTotal);this.uploadTotal=n}),t}destroyLoader(e){const t=e instanceof Ii?e:this.getLoader(e);t._destroy(),this.loaders.remove(t),this._loadersMap.forEach((n,i)=>{n===t&&this._loadersMap.delete(i)})}_updatePendingAction(){const e=this.editor.plugins.get(ut);if(this.loaders.length){if(!this._pendingAction){const t=this.editor.t,n=i=>`${t("Upload in progress")} ${parseInt(i)}%.`;this._pendingAction=e.add(n(this.uploadedPercent)),this._pendingAction.bind("message").to(this,"uploadedPercent",n)}}else e.remove(this._pendingAction),this._pendingAction=null}}class Ii extends Z(){constructor(e,t){super(),this.id=Ct(),this._filePromiseWrapper=this._createFilePromiseWrapper(e),this._adapter=t(this),this._reader=new bm,this.set("status","idle"),this.set("uploaded",0),this.set("uploadTotal",null),this.bind("uploadedPercent").to(this,"uploaded",this,"uploadTotal",(n,i)=>i?n/i*100:0),this.set("uploadResponse",null)}get file(){return this._filePromiseWrapper?this._filePromiseWrapper.promise.then(e=>this._filePromiseWrapper?e:null):Promise.resolve(null)}get data(){return this._reader.data}read(){if(this.status!="idle")throw new L("filerepository-read-wrong-status",this);return this.status="reading",this.file.then(e=>this._reader.read(e)).then(e=>{if(this.status!=="reading")throw this.status;return this.status="idle",e}).catch(e=>{throw e==="aborted"?(this.status="aborted","aborted"):(this.status="error",this._reader.error?this._reader.error:e)})}upload(){if(this.status!="idle")throw new L("filerepository-upload-wrong-status",this);return this.status="uploading",this.file.then(()=>this._adapter.upload()).then(e=>(this.uploadResponse=e,this.status="idle",e)).catch(e=>{throw this.status==="aborted"?"aborted":(this.status="error",e)})}abort(){const e=this.status;this.status="aborted",this._filePromiseWrapper.isFulfilled?e=="reading"?this._reader.abort():e=="uploading"&&this._adapter.abort&&this._adapter.abort():(this._filePromiseWrapper.promise.catch(()=>{}),this._filePromiseWrapper.rejecter("aborted")),this._destroy()}_destroy(){this._filePromiseWrapper=void 0,this._reader=void 0,this._adapter=void 0,this.uploadResponse=void 0}_createFilePromiseWrapper(e){const t={};return t.promise=new Promise((n,i)=>{t.rejecter=i,t.isFulfilled=!1,e.then(o=>{t.isFulfilled=!0,n(o)}).catch(o=>{t.isFulfilled=!0,i(o)})}),t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wm extends y{constructor(e){super(e),this.buttonView=this,this._fileInputView=new vm(e),this._fileInputView.bind("acceptedType").to(this),this._fileInputView.bind("allowMultipleFiles").to(this),this._fileInputView.delegate("done").to(this),this.on("execute",()=>{this._fileInputView.open()}),this.extendTemplate({attributes:{class:"ck-file-dialog-button"}})}render(){super.render(),this.children.add(this._fileInputView)}}class vm extends T{constructor(e){super(e),this.set("acceptedType",void 0),this.set("allowMultipleFiles",!1);const t=this.bindTemplate;this.setTemplate({tag:"input",attributes:{class:["ck-hidden"],type:"file",tabindex:"-1",accept:t.to("acceptedType"),multiple:t.to("allowMultipleFiles")},on:{change:t.to(()=>{this.element&&this.element.files&&this.element.files.length&&this.fire("done",this.element.files),this.element.value=""})}})}open(){this.element.click()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Do(s){const e=s.map(t=>t.replace("+","\\+"));return new RegExp(`^image\\/(${e.join("|")})$`)}function Cm(s){return new Promise((e,t)=>{const n=s.getAttribute("src");fetch(n).then(i=>i.blob()).then(i=>{const o=Fo(i,n),l=`image.${o.replace("image/","")}`,a=new File([i],l,{type:o});e(a)}).catch(i=>i&&i.name==="TypeError"?ym(n).then(e).catch(t):t(i))})}function km(s,e){return!s.isInlineImageView(e)||!e.getAttribute("src")?!1:!!e.getAttribute("src").match(/^data:image\/\w+;base64,/g)||!!e.getAttribute("src").match(/^blob:/g)}function Fo(s,e){return s.type?s.type:e.match(/data:(image\/\w+);base64/)?e.match(/data:(image\/\w+);base64/)[1].toLowerCase():"image/jpeg"}function ym(s){return _m(s).then(e=>{const t=Fo(e,s),i=`image.${t.replace("image/","")}`;return new File([e],i,{type:t})})}function _m(s){return new Promise((e,t)=>{const n=A.document.createElement("img");n.addEventListener("load",()=>{const i=A.document.createElement("canvas");i.width=n.width,i.height=n.height,i.getContext("2d").drawImage(n,0,0),i.toBlob(r=>r?e(r):t())}),n.addEventListener("error",()=>t()),n.src=s})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Im extends f{static get pluginName(){return"ImageUploadUI"}init(){const e=this.editor,t=e.t,n=i=>{const o=new wm(i),r=e.commands.get("uploadImage"),l=e.config.get("image.upload.types"),a=Do(l);return o.set({acceptedType:l.map(c=>`image/${c}`).join(","),allowMultipleFiles:!0,label:t("Upload image from computer"),icon:C.imageUpload,tooltip:!0}),o.bind("isEnabled").to(r),o.on("done",(c,d)=>{const u=Array.from(d).filter(m=>a.test(m.type));u.length&&(e.execute("uploadImage",{file:u}),e.editing.view.focus())}),o};if(e.ui.componentFactory.add("uploadImage",n),e.ui.componentFactory.add("imageUpload",n),e.plugins.has("ImageInsertUI")){const i=e.plugins.get("ImageInsertUI");i.registerIntegration({name:"upload",observable:()=>e.commands.get("uploadImage"),buttonViewCreator:()=>{const o=e.ui.componentFactory.create("uploadImage");return o.bind("label").to(i,"isImageSelected",r=>t(r?"Replace image from computer":"Upload image from computer")),o},formViewCreator:()=>{const o=e.ui.componentFactory.create("uploadImage");return o.withText=!0,o.bind("label").to(i,"isImageSelected",r=>t(r?"Replace from computer":"Upload from computer")),o.on("execute",()=>{i.dropdownView.isOpen=!1}),o}})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Tm extends f{static get pluginName(){return"ImageUploadProgress"}constructor(e){super(e),this.uploadStatusChange=(t,n,i)=>{const o=this.editor,r=n.item,l=r.getAttribute("uploadId");if(!i.consumable.consume(n.item,t.name))return;const a=o.plugins.get("ImageUtils"),c=o.plugins.get(De),d=l?n.attributeNewValue:null,u=this.placeholder,m=o.editing.mapper.toViewElement(r),h=i.writer;if(d=="reading"){Ti(m,h),Ei(a,u,m,h);return}if(d=="uploading"){const g=c.loaders.get(l);Ti(m,h),g?(Ai(m,h),Am(m,h,g,o.editing.view),Pm(a,m,h,g)):Ei(a,u,m,h);return}d=="complete"&&c.loaders.get(l)&&xm(m,h,o.editing.view),Sm(m,h),Ai(m,h),Em(m,h)},this.placeholder="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="}init(){const e=this.editor;e.plugins.has("ImageBlockEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageBlock",this.uploadStatusChange),e.plugins.has("ImageInlineEditing")&&e.editing.downcastDispatcher.on("attribute:uploadStatus:imageInline",this.uploadStatusChange)}}function Ti(s,e){s.hasClass("ck-appear")||e.addClass("ck-appear",s)}function Em(s,e){e.removeClass("ck-appear",s)}function Ei(s,e,t,n){t.hasClass("ck-image-upload-placeholder")||n.addClass("ck-image-upload-placeholder",t);const i=s.findViewImgElement(t);i.getAttribute("src")!==e&&n.setAttribute("src",e,i),Mo(t,"placeholder")||n.insert(n.createPositionAfter(i),Vm(n))}function Ai(s,e){s.hasClass("ck-image-upload-placeholder")&&e.removeClass("ck-image-upload-placeholder",s),Uo(s,e,"placeholder")}function Am(s,e,t,n){const i=Rm(e);e.insert(e.createPositionAt(s,"end"),i),t.on("change:uploadedPercent",(o,r,l)=>{n.change(a=>{a.setStyle("width",l+"%",i)})})}function Sm(s,e){Uo(s,e,"progressBar")}function xm(s,e,t){const n=e.createUIElement("div",{class:"ck-image-upload-complete-icon"});e.insert(e.createPositionAt(s,"end"),n),setTimeout(()=>{t.change(i=>i.remove(i.createRangeOn(n)))},3e3)}function Rm(s){const e=s.createUIElement("div",{class:"ck-progress-bar"});return s.setCustomProperty("progressBar",!0,e),e}function Vm(s){const e=s.createUIElement("div",{class:"ck-upload-placeholder-loader"});return s.setCustomProperty("placeholder",!0,e),e}function Mo(s,e){for(const t of s.getChildren())if(t.getCustomProperty(e))return t}function Uo(s,e,t){const n=Mo(s,t);n&&e.remove(e.createRangeOn(n))}function Pm(s,e,t,n){if(n.data){const i=s.findViewImgElement(e);t.setAttribute("src",n.data,i)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bm extends k{refresh(){const e=this.editor,t=e.plugins.get("ImageUtils"),n=e.model.document.selection.getSelectedElement();this.isEnabled=t.isImageAllowed()||t.isImage(n)}execute(e){const t=ie(e.file),n=this.editor.model.document.selection,i=this.editor.plugins.get("ImageUtils"),o=Object.fromEntries(n.getAttributes());t.forEach((r,l)=>{const a=n.getSelectedElement();if(l&&a&&i.isImage(a)){const c=this.editor.model.createPositionAfter(a);this._uploadImage(r,o,c)}else this._uploadImage(r,o)})}_uploadImage(e,t,n){const i=this.editor,r=i.plugins.get(De).createLoader(e),l=i.plugins.get("ImageUtils");r&&l.insertImage({...t,uploadId:r.id},n)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Lm extends f{static get requires(){return[De,Xn,q,F]}static get pluginName(){return"ImageUploadEditing"}constructor(e){super(e),e.config.define("image",{upload:{types:["jpeg","png","gif","bmp","webp","tiff"]}}),this._uploadImageElements=new Map}init(){const e=this.editor,t=e.model.document,n=e.conversion,i=e.plugins.get(De),o=e.plugins.get("ImageUtils"),r=e.plugins.get("ClipboardPipeline"),l=Do(e.config.get("image.upload.types")),a=new Bm(e);e.commands.add("uploadImage",a),e.commands.add("imageUpload",a),n.for("upcast").attributeToAttribute({view:{name:"img",key:"uploadId"},model:"uploadId"}),this.listenTo(e.editing.view.document,"clipboardInput",(c,d)=>{if(Dm(d.dataTransfer))return;const u=Array.from(d.dataTransfer.files).filter(m=>m?l.test(m.type):!1);u.length&&(c.stop(),e.model.change(m=>{d.targetRanges&&m.setSelection(d.targetRanges.map(h=>e.editing.mapper.toModelRange(h))),e.execute("uploadImage",{file:u})}))}),this.listenTo(r,"inputTransformation",(c,d)=>{const u=Array.from(e.editing.view.createRangeIn(d.content)).map(h=>h.item).filter(h=>km(o,h)&&!h.getAttribute("uploadProcessed")).map(h=>({promise:Cm(h),imageElement:h}));if(!u.length)return;const m=new se(e.editing.view.document);for(const h of u){m.setAttribute("uploadProcessed",!0,h.imageElement);const g=i.createLoader(h.promise);g&&(m.setAttribute("src","",h.imageElement),m.setAttribute("uploadId",g.id,h.imageElement))}}),e.editing.view.document.on("dragover",(c,d)=>{d.preventDefault()}),t.on("change",()=>{const c=t.differ.getChanges({includeChangesInGraveyard:!0}).reverse(),d=new Set;for(const u of c)if(u.type=="insert"&&u.name!="$text"){const m=u.position.nodeAfter,h=u.position.root.rootName=="$graveyard";for(const g of Fm(e,m)){const p=g.getAttribute("uploadId");if(!p)continue;const b=i.loaders.get(p);b&&(h?d.has(p)||b.abort():(d.add(p),this._uploadImageElements.set(p,g),b.status=="idle"&&this._readAndUpload(b)))}}}),this.on("uploadComplete",(c,{imageElement:d,data:u})=>{const m=u.urls?u.urls:u;this.editor.model.change(h=>{h.setAttribute("src",m.default,d),this._parseAndSetSrcsetAttributeOnImage(m,d,h),o.setImageNaturalSizeAttributes(d)})},{priority:"low"})}afterInit(){const e=this.editor.model.schema;this.editor.plugins.has("ImageBlockEditing")&&e.extend("imageBlock",{allowAttributes:["uploadId","uploadStatus"]}),this.editor.plugins.has("ImageInlineEditing")&&e.extend("imageInline",{allowAttributes:["uploadId","uploadStatus"]})}_readAndUpload(e){const t=this.editor,n=t.model,i=t.locale.t,o=t.plugins.get(De),r=t.plugins.get(Xn),l=t.plugins.get("ImageUtils"),a=this._uploadImageElements;return n.enqueueChange({isUndoable:!1},d=>{d.setAttribute("uploadStatus","reading",a.get(e.id))}),e.read().then(()=>{const d=e.upload(),u=a.get(e.id);/* istanbul ignore next -- @preserve */if(S.isSafari){const m=t.editing.mapper.toViewElement(u),h=l.findViewImgElement(m);t.editing.view.once("render",()=>{if(!h.parent)return;const g=t.editing.view.domConverter.mapViewToDom(h.parent);if(!g)return;const p=g.style.display;g.style.display="none",g._ckHack=g.offsetHeight,g.style.display=p})}return n.enqueueChange({isUndoable:!1},m=>{m.setAttribute("uploadStatus","uploading",u)}),d}).then(d=>{n.enqueueChange({isUndoable:!1},u=>{const m=a.get(e.id);u.setAttribute("uploadStatus","complete",m),this.fire("uploadComplete",{data:d,imageElement:m})}),c()}).catch(d=>{if(e.status!=="error"&&e.status!=="aborted")throw d;e.status=="error"&&d&&r.showWarning(d,{title:i("Upload failed"),namespace:"upload"}),n.enqueueChange({isUndoable:!1},u=>{u.remove(a.get(e.id))}),c()});function c(){n.enqueueChange({isUndoable:!1},d=>{const u=a.get(e.id);d.removeAttribute("uploadId",u),d.removeAttribute("uploadStatus",u),a.delete(e.id)}),o.destroyLoader(e)}}_parseAndSetSrcsetAttributeOnImage(e,t,n){let i=0;const o=Object.keys(e).filter(r=>{const l=parseInt(r,10);if(!isNaN(l))return i=Math.max(i,l),!0}).map(r=>`${e[r]} ${r}w`).join(", ");if(o!=""){const r={srcset:o};!t.hasAttribute("width")&&!t.hasAttribute("height")&&(r.width=i),n.setAttributes(r,t)}}}function Dm(s){return Array.from(s.types).includes("text/html")&&s.getData("text/html")!==""}function Fm(s,e){const t=s.plugins.get("ImageUtils");return Array.from(s.model.createRangeOn(e)).filter(n=>t.isImage(n.item)).map(n=>n.item)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Oo extends f{static get pluginName(){return"ImageUpload"}static get requires(){return[Lm,Im,Tm]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Mm extends T{constructor(e){super(e),this.set("imageURLInputValue",""),this.set("isImageSelected",!1),this.set("isEnabled",!0),this.focusTracker=new X,this.keystrokes=new ne,this._focusables=new de,this.focusCycler=new ue({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.urlInputView=this._createUrlInputView(),this.insertButtonView=this._createInsertButton(),this.cancelButtonView=this._createCancelButton(),this._focusables.addMany([this.urlInputView,this.insertButtonView,this.cancelButtonView]),this.setTemplate({tag:"div",attributes:{class:["ck","ck-image-insert-url"]},children:[this.urlInputView,{tag:"div",attributes:{class:["ck","ck-image-insert-url__action-row"]},children:[this.insertButtonView,this.cancelButtonView]}]})}render(){super.render();for(const e of this._focusables)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}_createUrlInputView(){const e=this.locale,t=e.t,n=new ze(e,He);return n.bind("label").to(this,"isImageSelected",i=>t(i?"Update image URL":"Insert image via URL")),n.bind("isEnabled").to(this),n.fieldView.placeholder="https://example.com/image.png",n.fieldView.bind("value").to(this,"imageURLInputValue",i=>i||""),n.fieldView.on("input",()=>{this.imageURLInputValue=n.fieldView.element.value.trim()}),n}_createInsertButton(){const e=this.locale,t=e.t,n=new y(e);return n.set({icon:C.check,class:"ck-button-save",type:"submit",withText:!0}),n.bind("label").to(this,"isImageSelected",i=>t(i?"Update":"Insert")),n.bind("isEnabled").to(this,"imageURLInputValue",this,"isEnabled",(...i)=>i.every(o=>o)),n.delegate("execute").to(this,"submit"),n}_createCancelButton(){const e=this.locale,t=e.t,n=new y(e);return n.set({label:t("Cancel"),icon:C.cancel,class:"ck-button-cancel",withText:!0}),n.bind("isEnabled").to(this),n.delegate("execute").to(this,"cancel"),n}focus(e){e===-1?this.focusCycler.focusLast():this.focusCycler.focusFirst()}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Um extends f{static get pluginName(){return"ImageInsertViaUrlUI"}static get requires(){return[je]}afterInit(){this._imageInsertUI=this.editor.plugins.get("ImageInsertUI"),this._imageInsertUI.registerIntegration({name:"url",observable:()=>this.editor.commands.get("insertImage"),requiresForm:!0,buttonViewCreator:e=>this._createInsertUrlButton(e),formViewCreator:e=>this._createInsertUrlView(e)})}_createInsertUrlView(e){const t=this.editor,n=t.locale,i=n.t,o=t.commands.get("replaceImageSource"),r=t.commands.get("insertImage"),l=new Mm(n),a=e?null:new Ys(n,[l]);return l.bind("isImageSelected").to(this._imageInsertUI),l.bind("isEnabled").toMany([r,o],"isEnabled",(...c)=>c.some(d=>d)),l.imageURLInputValue=o.value||"",this._imageInsertUI.dropdownView.on("change:isOpen",()=>{this._imageInsertUI.dropdownView.isOpen&&(l.imageURLInputValue=o.value||"",a&&(a.isCollapsed=!0))},{priority:"low"}),l.on("submit",()=>{o.isEnabled?t.execute("replaceImageSource",{source:l.imageURLInputValue}):t.execute("insertImage",{source:l.imageURLInputValue}),this._closePanel()}),l.on("cancel",()=>this._closePanel()),a?(a.set({isCollapsed:!0}),a.bind("label").to(this._imageInsertUI,"isImageSelected",c=>i(c?"Update image URL":"Insert image via URL")),a):l}_createInsertUrlButton(e){const t=e?Ds:y,n=this.editor,i=new t(n.locale),o=n.locale.t;return i.set({icon:C.imageUrl,tooltip:!0}),i.bind("label").to(this._imageInsertUI,"isImageSelected",r=>o(r?"Update image URL":"Insert image via URL")),i}_closePanel(){this.editor.editing.view.focus(),this._imageInsertUI.dropdownView.isOpen=!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Om extends f{static get pluginName(){return"ImageInsertViaUrl"}static get requires(){return[Um,je]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nm extends f{static get pluginName(){return"ImageInsert"}static get requires(){return[Oo,Om,je]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zm extends k{refresh(){const e=this.editor,n=e.plugins.get("ImageUtils").getClosestSelectedImageElement(e.model.document.selection);this.isEnabled=!!n,!n||!n.hasAttribute("resizedWidth")?this.value=null:this.value={width:n.getAttribute("resizedWidth"),height:null}}execute(e){const t=this.editor,n=t.model,i=t.plugins.get("ImageUtils"),o=i.getClosestSelectedImageElement(n.document.selection);this.value={width:e.width,height:null},o&&n.change(r=>{r.setAttribute("resizedWidth",e.width,o),r.removeAttribute("resizedHeight",o),i.setImageNaturalSizeAttributes(o)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class No extends f{static get requires(){return[F]}static get pluginName(){return"ImageResizeEditing"}constructor(e){super(e),e.config.define("image",{resizeUnit:"%",resizeOptions:[{name:"resizeImage:original",value:null,icon:"original"},{name:"resizeImage:25",value:"25",icon:"small"},{name:"resizeImage:50",value:"50",icon:"medium"},{name:"resizeImage:75",value:"75",icon:"large"}]})}init(){const e=this.editor,t=new zm(e);this._registerConverters("imageBlock"),this._registerConverters("imageInline"),e.commands.add("resizeImage",t),e.commands.add("imageResize",t)}afterInit(){this._registerSchema()}_registerSchema(){this.editor.plugins.has("ImageBlockEditing")&&this.editor.model.schema.extend("imageBlock",{allowAttributes:["resizedWidth","resizedHeight"]}),this.editor.plugins.has("ImageInlineEditing")&&this.editor.model.schema.extend("imageInline",{allowAttributes:["resizedWidth","resizedHeight"]})}_registerConverters(e){const t=this.editor,n=t.plugins.get("ImageUtils");t.conversion.for("downcast").add(i=>i.on(`attribute:resizedWidth:${e}`,(o,r,l)=>{if(!l.consumable.consume(r.item,o.name))return;const a=l.writer,c=l.mapper.toViewElement(r.item);r.attributeNewValue!==null?(a.setStyle("width",r.attributeNewValue,c),a.addClass("image_resized",c)):(a.removeStyle("width",c),a.removeClass("image_resized",c))})),t.conversion.for("dataDowncast").attributeToAttribute({model:{name:e,key:"resizedHeight"},view:i=>({key:"style",value:{height:i}})}),t.conversion.for("editingDowncast").add(i=>i.on(`attribute:resizedHeight:${e}`,(o,r,l)=>{if(!l.consumable.consume(r.item,o.name))return;const a=l.writer,c=l.mapper.toViewElement(r.item),d=e==="imageInline"?n.findViewImgElement(c):c;r.attributeNewValue!==null?a.setStyle("height",r.attributeNewValue,d):a.removeStyle("height",d)})),t.conversion.for("upcast").attributeToAttribute({view:{name:e==="imageBlock"?"figure":"img",styles:{width:/.+/}},model:{key:"resizedWidth",value:i=>ft(i)?null:i.getStyle("width")}}),t.conversion.for("upcast").attributeToAttribute({view:{name:e==="imageBlock"?"figure":"img",styles:{height:/.+/}},model:{key:"resizedHeight",value:i=>ft(i)?null:i.getStyle("height")}})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Nt={small:C.objectSizeSmall,medium:C.objectSizeMedium,large:C.objectSizeLarge,original:C.objectSizeFull};class Hm extends f{static get requires(){return[No]}static get pluginName(){return"ImageResizeButtons"}constructor(e){super(e),this._resizeUnit=e.config.get("image.resizeUnit")}init(){const e=this.editor,t=e.config.get("image.resizeOptions"),n=e.commands.get("resizeImage");this.bind("isEnabled").to(n);for(const i of t)this._registerImageResizeButton(i);this._registerImageResizeDropdown(t)}_registerImageResizeButton(e){const t=this.editor,{name:n,value:i,icon:o}=e,r=i?i+this._resizeUnit:null;t.ui.componentFactory.add(n,l=>{const a=new y(l),c=t.commands.get("resizeImage"),d=this._getOptionLabelValue(e,!0);if(!Nt[o])throw new L("imageresizebuttons-missing-icon",t,e);return a.set({label:d,icon:Nt[o],tooltip:d,isToggleable:!0}),a.bind("isEnabled").to(this),a.bind("isOn").to(c,"value",Si(r)),this.listenTo(a,"execute",()=>{t.execute("resizeImage",{width:r})}),a})}_registerImageResizeDropdown(e){const t=this.editor,n=t.t,i=e.find(r=>!r.value),o=r=>{const l=t.commands.get("resizeImage"),a=W(r,Ds),c=a.buttonView,d=n("Resize image");return c.set({tooltip:d,commandValue:i.value,icon:Nt.medium,isToggleable:!0,label:this._getOptionLabelValue(i),withText:!0,class:"ck-resize-image-button",ariaLabel:d,ariaLabelledBy:void 0}),c.bind("label").to(l,"value",u=>u&&u.width?u.width:this._getOptionLabelValue(i)),a.bind("isEnabled").to(this),We(a,()=>this._getResizeDropdownListItemDefinitions(e,l),{ariaLabel:n("Image resize list"),role:"menu"}),this.listenTo(a,"execute",u=>{t.execute(u.source.commandName,{width:u.source.commandValue}),t.editing.view.focus()}),a};t.ui.componentFactory.add("resizeImage",o),t.ui.componentFactory.add("imageResize",o)}_getOptionLabelValue(e,t=!1){const n=this.editor.t;return e.label?e.label:t?e.value?n("Resize image to %0",e.value+this._resizeUnit):n("Resize image to the original size"):e.value?e.value+this._resizeUnit:n("Original")}_getResizeDropdownListItemDefinitions(e,t){const n=new te;return e.map(i=>{const o=i.value?i.value+this._resizeUnit:null,r={type:"button",model:new qe({commandName:"resizeImage",commandValue:o,label:this._getOptionLabelValue(i),role:"menuitemradio",withText:!0,icon:null})};r.model.bind("isOn").to(t,"value",Si(o)),n.add(r)}),n}}function Si(s){return e=>{const t=e;return s===null&&t===s?!0:t!==null&&t.width===s}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const $m="figure.image.ck-widget > img,figure.image.ck-widget > picture > img,figure.image.ck-widget > a > img,figure.image.ck-widget > a > picture > img,span.image-inline.ck-widget > img,span.image-inline.ck-widget > picture > img",zt="image_resized";class Wm extends f{static get requires(){return[Ut,F]}static get pluginName(){return"ImageResizeHandles"}init(){const e=this.editor.commands.get("resizeImage");this.bind("isEnabled").to(e),this._setupResizerCreator()}_setupResizerCreator(){const e=this.editor,t=e.editing.view,n=e.plugins.get("ImageUtils");t.addObserver(En),this.listenTo(t.document,"imageLoaded",(i,o)=>{if(!o.target.matches($m))return;const r=e.editing.view.domConverter,l=r.domToView(o.target),a=n.getImageWidgetFromImageView(l);let c=this.editor.plugins.get(Ut).getResizerByViewElement(a);if(c){c.redraw();return}const d=e.editing.mapper,u=d.toModelElement(a);c=e.plugins.get(Ut).attachTo({unit:e.config.get("image.resizeUnit"),modelElement:u,viewElement:a,editor:e,getHandleHost(m){return m.querySelector("img")},getResizeHost(){return r.mapViewToDom(d.toViewElement(u.parent))},isCentered(){return u.getAttribute("imageStyle")=="alignCenter"},onCommit(m){t.change(h=>{h.removeClass(zt,a)}),e.execute("resizeImage",{width:m})}}),c.on("updateSize",()=>{a.hasClass(zt)||t.change(h=>{h.addClass(zt,a)});const m=u.name==="imageInline"?l:a;m.getStyle("height")&&t.change(h=>{h.removeStyle("height",m)})}),c.bind("isEnabled").to(this)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qm extends f{static get requires(){return[No,Wm,Hm]}static get pluginName(){return"ImageResize"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Gm extends k{constructor(e,t){super(e),this._defaultStyles={imageBlock:!1,imageInline:!1},this._styles=new Map(t.map(n=>{if(n.isDefault)for(const i of n.modelElements)this._defaultStyles[i]=n.name;return[n.name,n]}))}refresh(){const n=this.editor.plugins.get("ImageUtils").getClosestSelectedImageElement(this.editor.model.document.selection);this.isEnabled=!!n,this.isEnabled?n.hasAttribute("imageStyle")?this.value=n.getAttribute("imageStyle"):this.value=this._defaultStyles[n.name]:this.value=!1}execute(e={}){const t=this.editor,n=t.model,i=t.plugins.get("ImageUtils");n.change(o=>{const r=e.value,{setImageSizes:l=!0}=e;let a=i.getClosestSelectedImageElement(n.document.selection);r&&this.shouldConvertImageType(r,a)&&(this.editor.execute(i.isBlockImage(a)?"imageTypeInline":"imageTypeBlock",{setImageSizes:l}),a=i.getClosestSelectedImageElement(n.document.selection)),!r||this._styles.get(r).isDefault?o.removeAttribute("imageStyle",a):o.setAttribute("imageStyle",r,a),l&&i.setImageNaturalSizeAttributes(a)})}shouldConvertImageType(e,t){return!this._styles.get(e).modelElements.includes(t.name)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const{objectFullWidth:jm,objectInline:zo,objectLeft:Ho,objectRight:en,objectCenter:tn,objectBlockLeft:$o,objectBlockRight:Wo}=C,at={get inline(){return{name:"inline",title:"In line",icon:zo,modelElements:["imageInline"],isDefault:!0}},get alignLeft(){return{name:"alignLeft",title:"Left aligned image",icon:Ho,modelElements:["imageBlock","imageInline"],className:"image-style-align-left"}},get alignBlockLeft(){return{name:"alignBlockLeft",title:"Left aligned image",icon:$o,modelElements:["imageBlock"],className:"image-style-block-align-left"}},get alignCenter(){return{name:"alignCenter",title:"Centered image",icon:tn,modelElements:["imageBlock"],className:"image-style-align-center"}},get alignRight(){return{name:"alignRight",title:"Right aligned image",icon:en,modelElements:["imageBlock","imageInline"],className:"image-style-align-right"}},get alignBlockRight(){return{name:"alignBlockRight",title:"Right aligned image",icon:Wo,modelElements:["imageBlock"],className:"image-style-block-align-right"}},get block(){return{name:"block",title:"Centered image",icon:tn,modelElements:["imageBlock"],isDefault:!0}},get side(){return{name:"side",title:"Side image",icon:en,modelElements:["imageBlock"],className:"image-style-side"}}},qo={full:jm,left:$o,right:Wo,center:tn,inlineLeft:Ho,inlineRight:en,inline:zo},Go=[{name:"imageStyle:wrapText",title:"Wrap text",defaultItem:"imageStyle:alignLeft",items:["imageStyle:alignLeft","imageStyle:alignRight"]},{name:"imageStyle:breakText",title:"Break text",defaultItem:"imageStyle:block",items:["imageStyle:alignBlockLeft","imageStyle:block","imageStyle:alignBlockRight"]}];function Km(s){return(s.configuredStyles.options||[]).map(n=>Xm(n)).filter(n=>Ym(n,s))}function Qm(s,e){return s&&e?{options:["inline","alignLeft","alignRight","alignCenter","alignBlockLeft","alignBlockRight","block","side"]}:s?{options:["block","side"]}:e?{options:["inline","alignLeft","alignRight"]}:{}}function Zm(s){return s.has("ImageBlockEditing")&&s.has("ImageInlineEditing")?[...Go]:[]}function Xm(s){return typeof s=="string"?at[s]?s={...at[s]}:s={name:s}:s=Jm(at[s.name],s),typeof s.icon=="string"&&(s.icon=qo[s.icon]||s.icon),s}function Ym(s,{isBlockPluginLoaded:e,isInlinePluginLoaded:t}){const{modelElements:n,name:i}=s;if(!n||!n.length||!i)return jo({style:s}),!1;{const o=[e?"imageBlock":null,t?"imageInline":null];if(!n.some(r=>o.includes(r)))return $("image-style-missing-dependency",{style:s,missingPlugins:n.map(r=>r==="imageBlock"?"ImageBlockEditing":"ImageInlineEditing")}),!1}return!0}function Jm(s,e){const t={...e};for(const n in s)Object.prototype.hasOwnProperty.call(e,n)||(t[n]=s[n]);return t}function jo(s){$("image-style-configuration-definition-invalid",s)}const nn={normalizeStyles:Km,getDefaultStylesConfiguration:Qm,getDefaultDropdownDefinitions:Zm,warnInvalidStyle:jo,DEFAULT_OPTIONS:at,DEFAULT_ICONS:qo,DEFAULT_DROPDOWN_DEFINITIONS:Go};/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function eh(s){return(e,t,n)=>{if(!n.consumable.consume(t.item,e.name))return;const i=xi(t.attributeNewValue,s),o=xi(t.attributeOldValue,s),r=n.mapper.toViewElement(t.item),l=n.writer;o&&l.removeClass(o.className,r),i&&l.addClass(i.className,r)}}function th(s){const e={imageInline:s.filter(t=>!t.isDefault&&t.modelElements.includes("imageInline")),imageBlock:s.filter(t=>!t.isDefault&&t.modelElements.includes("imageBlock"))};return(t,n,i)=>{if(!n.modelRange)return;const o=n.viewItem,r=M(n.modelRange.getItems());if(r&&i.schema.checkAttribute(r,"imageStyle"))for(const l of e[r.name])i.consumable.consume(o,{classes:l.className})&&i.writer.setAttribute("imageStyle",l.name,r)}}function xi(s,e){for(const t of e)if(t.name===s)return t}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ko extends f{static get pluginName(){return"ImageStyleEditing"}static get requires(){return[F]}init(){const{normalizeStyles:e,getDefaultStylesConfiguration:t}=nn,n=this.editor,i=n.plugins.has("ImageBlockEditing"),o=n.plugins.has("ImageInlineEditing");n.config.define("image.styles",t(i,o)),this.normalizedStyles=e({configuredStyles:n.config.get("image.styles"),isBlockPluginLoaded:i,isInlinePluginLoaded:o}),this._setupConversion(i,o),this._setupPostFixer(),n.commands.add("imageStyle",new Gm(n,this.normalizedStyles))}_setupConversion(e,t){const n=this.editor,i=n.model.schema,o=eh(this.normalizedStyles),r=th(this.normalizedStyles);n.editing.downcastDispatcher.on("attribute:imageStyle",o),n.data.downcastDispatcher.on("attribute:imageStyle",o),e&&(i.extend("imageBlock",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:figure",r,{priority:"low"})),t&&(i.extend("imageInline",{allowAttributes:"imageStyle"}),n.data.upcastDispatcher.on("element:img",r,{priority:"low"}))}_setupPostFixer(){const e=this.editor,t=e.model.document,n=e.plugins.get(F),i=new Map(this.normalizedStyles.map(o=>[o.name,o]));t.registerPostFixer(o=>{let r=!1;for(const l of t.differ.getChanges())if(l.type=="insert"||l.type=="attribute"&&l.attributeKey=="imageStyle"){let a=l.type=="insert"?l.position.nodeAfter:l.range.start.nodeAfter;if(a&&a.is("element","paragraph")&&a.childCount>0&&(a=a.getChild(0)),!n.isImage(a))continue;const c=a.getAttribute("imageStyle");if(!c)continue;const d=i.get(c);(!d||!d.modelElements.includes(a.name))&&(o.removeAttribute("imageStyle",a),r=!0)}return r})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class nh extends f{static get requires(){return[Ko]}static get pluginName(){return"ImageStyleUI"}get localizedDefaultStylesTitles(){const e=this.editor.t;return{"Wrap text":e("Wrap text"),"Break text":e("Break text"),"In line":e("In line"),"Full size image":e("Full size image"),"Side image":e("Side image"),"Left aligned image":e("Left aligned image"),"Centered image":e("Centered image"),"Right aligned image":e("Right aligned image")}}init(){const e=this.editor.plugins,t=this.editor.config.get("image.toolbar")||[],n=e.get("ImageStyleEditing"),i=Ri(n.normalizedStyles,this.localizedDefaultStylesTitles);for(const r of i)this._createButton(r);const o=Ri([...t.filter(hn),...nn.getDefaultDropdownDefinitions(e)],this.localizedDefaultStylesTitles);for(const r of o)this._createDropdown(r,i)}_createDropdown(e,t){const n=this.editor.ui.componentFactory;n.add(e.name,i=>{let o;const{defaultItem:r,items:l,title:a}=e,c=l.filter(h=>t.find(({name:g})=>Vi(g)===h)).map(h=>{const g=n.create(h);return h===r&&(o=g),g});l.length!==c.length&&nn.warnInvalidStyle({dropdown:e});const d=W(i,vn),u=d.buttonView,m=u.arrowView;return As(d,c,{enableActiveItemFocusOnDropdownOpen:!0}),u.set({label:Pi(a,o.label),class:null,tooltip:!0}),m.unbind("label"),m.set({label:a}),u.bind("icon").toMany(c,"isOn",(...h)=>{const g=h.findIndex(ve);return g<0?o.icon:c[g].icon}),u.bind("label").toMany(c,"isOn",(...h)=>{const g=h.findIndex(ve);return Pi(a,g<0?o.label:c[g].label)}),u.bind("isOn").toMany(c,"isOn",(...h)=>h.some(ve)),u.bind("class").toMany(c,"isOn",(...h)=>h.some(ve)?"ck-splitbutton_flatten":void 0),u.on("execute",()=>{c.some(({isOn:h})=>h)?d.isOpen=!d.isOpen:o.fire("execute")}),d.bind("isEnabled").toMany(c,"isEnabled",(...h)=>h.some(ve)),this.listenTo(d,"execute",()=>{this.editor.editing.view.focus()}),d})}_createButton(e){const t=e.name;this.editor.ui.componentFactory.add(Vi(t),n=>{const i=this.editor.commands.get("imageStyle"),o=new y(n);return o.set({label:e.title,icon:e.icon,tooltip:!0,isToggleable:!0}),o.bind("isEnabled").to(i,"isEnabled"),o.bind("isOn").to(i,"value",r=>r===t),o.on("execute",this._executeCommand.bind(this,t)),o})}_executeCommand(e){this.editor.execute("imageStyle",{value:e}),this.editor.editing.view.focus()}}function Ri(s,e){for(const t of s)e[t.title]&&(t.title=e[t.title]);return s}function Vi(s){return`imageStyle:${s}`}function Pi(s,e){return(s?s+": ":"")+e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ih extends f{static get requires(){return[Ko,nh]}static get pluginName(){return"ImageStyle"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class sh extends f{static get requires(){return[ht,F]}static get pluginName(){return"ImageToolbar"}afterInit(){const e=this.editor,t=e.t,n=e.plugins.get(ht),i=e.plugins.get("ImageUtils");n.register("image",{ariaLabel:t("Image toolbar"),items:oh(e.config.get("image.toolbar")||[]),getRelatedElement:o=>i.getClosestSelectedImageWidget(o)})}}function oh(s){return s.map(e=>hn(e)?e.name:e)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class rh extends f{static get pluginName(){return"IndentEditing"}init(){const e=this.editor;e.commands.add("indent",new Nn(e)),e.commands.add("outdent",new Nn(e))}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lh extends f{static get pluginName(){return"IndentUI"}init(){const e=this.editor,t=e.locale,n=e.t,i=t.uiLanguageDirection=="ltr"?C.indent:C.outdent,o=t.uiLanguageDirection=="ltr"?C.outdent:C.indent;this._defineButton("indent",n("Increase indent"),i),this._defineButton("outdent",n("Decrease indent"),o)}_defineButton(e,t,n){const i=this.editor;i.ui.componentFactory.add(e,o=>{const r=i.commands.get(e),l=new y(o);return l.set({label:t,icon:n,tooltip:!0}),l.bind("isEnabled").to(r,"isEnabled"),this.listenTo(l,"execute",()=>{i.execute(e),i.editing.view.focus()}),l})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ah extends f{static get pluginName(){return"Indent"}static get requires(){return[rh,lh]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ot extends k{constructor(e,t){super(e),this._indentBehavior=t}refresh(){const t=this.editor.model,n=M(t.document.selection.getSelectedBlocks());if(!n||!this._isIndentationChangeAllowed(n)){this.isEnabled=!1;return}this.isEnabled=this._indentBehavior.checkEnabled(n.getAttribute("blockIndent"))}execute(){const e=this.editor.model,t=this._getBlocksToChange();e.change(n=>{for(const i of t){const o=i.getAttribute("blockIndent"),r=this._indentBehavior.getNextIndent(o);r?n.setAttribute("blockIndent",r,i):n.removeAttribute("blockIndent",i)}})}_getBlocksToChange(){const t=this.editor.model.document.selection;return Array.from(t.getSelectedBlocks()).filter(i=>this._isIndentationChangeAllowed(i))}_isIndentationChangeAllowed(e){const t=this.editor;return t.model.schema.checkAttribute(e,"blockIndent")?!t.plugins.has("ListUtils")||!this._indentBehavior.isForward?!0:!t.plugins.get("ListUtils").isListItemBlock(e):!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Bi{constructor(e){this.isForward=e.direction==="forward",this.offset=e.offset,this.unit=e.unit}checkEnabled(e){const t=parseFloat(e||"0");return this.isForward||t>0}getNextIndent(e){const t=parseFloat(e||"0");if(!(!e||e.endsWith(this.unit)))return this.isForward?this.offset+this.unit:void 0;const i=this.isForward?this.offset:-this.offset,o=t+i;return o>0?o+this.unit:void 0}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Li{constructor(e){this.isForward=e.direction==="forward",this.classes=e.classes}checkEnabled(e){const t=this.classes.indexOf(e);return this.isForward?t<this.classes.length-1:t>=0}getNextIndent(e){const t=this.classes.indexOf(e),n=this.isForward?1:-1;return this.classes[t+n]}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ch=["paragraph","heading1","heading2","heading3","heading4","heading5","heading6"];class dh extends f{constructor(e){super(e),e.config.define("indentBlock",{offset:40,unit:"px"})}static get pluginName(){return"IndentBlock"}init(){const e=this.editor,t=e.config.get("indentBlock");t.classes&&t.classes.length?(this._setupConversionUsingClasses(t.classes),e.commands.add("indentBlock",new ot(e,new Li({direction:"forward",classes:t.classes}))),e.commands.add("outdentBlock",new ot(e,new Li({direction:"backward",classes:t.classes})))):(e.data.addStyleProcessorRules(Da),this._setupConversionUsingOffset(),e.commands.add("indentBlock",new ot(e,new Bi({direction:"forward",offset:t.offset,unit:t.unit}))),e.commands.add("outdentBlock",new ot(e,new Bi({direction:"backward",offset:t.offset,unit:t.unit}))))}afterInit(){const e=this.editor,t=e.model.schema,n=e.commands.get("indent"),i=e.commands.get("outdent"),o=e.config.get("heading.options");(o&&o.map(a=>a.model)||ch).forEach(a=>{t.isRegistered(a)&&t.extend(a,{allowAttributes:"blockIndent"})}),t.setAttributeProperties("blockIndent",{isFormatting:!0}),n.registerChildCommand(e.commands.get("indentBlock")),i.registerChildCommand(e.commands.get("outdentBlock"))}_setupConversionUsingOffset(){const e=this.editor.conversion,n=this.editor.locale.contentLanguageDirection==="rtl"?"margin-right":"margin-left";e.for("upcast").attributeToAttribute({view:{styles:{[n]:/[\s\S]+/}},model:{key:"blockIndent",value:i=>{if(!i.is("element","li"))return i.getStyle(n)}}}),e.for("downcast").attributeToAttribute({model:"blockIndent",view:i=>({key:"style",value:{[n]:i}})})}_setupConversionUsingClasses(e){const t={model:{key:"blockIndent",values:[]},view:{}};for(const n of e)t.model.values.push(n),t.view[n]={key:"class",value:[n]};this.editor.conversion.attributeToAttribute(t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class uh{constructor(){this._definitions=new Set}get length(){return this._definitions.size}add(e){Array.isArray(e)?e.forEach(t=>this._definitions.add(t)):this._definitions.add(e)}getDispatcher(){return e=>{e.on("attribute:linkHref",(t,n,i)=>{if(!i.consumable.test(n.item,"attribute:linkHref")||!(n.item.is("selection")||i.schema.isInline(n.item)))return;const o=i.writer,r=o.document.selection;for(const l of this._definitions){const a=o.createAttributeElement("a",l.attributes,{priority:5});l.classes&&o.addClass(l.classes,a);for(const c in l.styles)o.setStyle(c,l.styles[c],a);o.setCustomProperty("link",!0,a),l.callback(n.attributeNewValue)?n.item.is("selection")?o.wrap(r.getFirstRange(),a):o.wrap(i.mapper.toViewRange(n.range),a):o.unwrap(i.mapper.toViewRange(n.range),a)}},{priority:"high"})}}getDispatcherForLinkedImage(){return e=>{e.on("attribute:linkHref:imageBlock",(t,n,{writer:i,mapper:o})=>{const r=o.toViewElement(n.item),l=Array.from(r.getChildren()).find(a=>a.is("element","a"));for(const a of this._definitions){const c=Fs(a.attributes);if(a.callback(n.attributeNewValue)){for(const[d,u]of c)d==="class"?i.addClass(u,l):i.setAttribute(d,u,l);a.classes&&i.addClass(a.classes,l);for(const d in a.styles)i.setStyle(d,a.styles[d],l)}else{for(const[d,u]of c)d==="class"?i.removeClass(u,l):i.removeAttribute(d,l);a.classes&&i.removeClass(a.classes,l);for(const d in a.styles)i.removeStyle(d,l)}}})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const mh=/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205f\u3000]/g,hh="^(?:(?:<protocols>):|[^a-z]|[a-z+.-]+(?:[^a-z+.:-]|$))",gh=/^[\S]+@((?![-_])(?:[-\w\u00a1-\uffff]{0,63}[^-_]\.))+(?:[a-z\u00a1-\uffff]{2,})$/i,fh=/^((\w+:(\/{2,})?)|(\W))/i,ph=["https?","ftps?","mailto"],rt="Ctrl+K";function bh(s){return s.is("attributeElement")&&!!s.getCustomProperty("link")}function Di(s,{writer:e}){const t=e.createAttributeElement("a",{href:s},{priority:5});return e.setCustomProperty("link",!0,t),t}function Qo(s,e=ph){const t=String(s),n=e.join("|"),i=new RegExp(`${hh.replace("<protocols>",n)}`,"i");return wh(t,i)?t:"#"}function wh(s,e){return!!s.replace(mh,"").match(e)}function vh(s,e){const t={"Open in a new tab":s("Open in a new tab"),Downloadable:s("Downloadable")};return e.forEach(n=>("label"in n&&t[n.label]&&(n.label=t[n.label]),n)),e}function Ch(s){const e=[];if(s)for(const[t,n]of Object.entries(s)){const i=Object.assign({},n,{id:`link${Hl(t)}`});e.push(i)}return e}function sn(s,e){return s?e.checkAttribute(s.name,"linkHref"):!1}function kh(s){return gh.test(s)}function An(s,e){const t=kh(s)?"mailto:":e,n=!!t&&!Zo(s);return s&&n?t+s:s}function Zo(s){return fh.test(s)}function Fi(s){window.open(s,"_blank","noopener")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yh extends k{constructor(){super(...arguments),this.manualDecorators=new te,this.automaticDecorators=new uh}restoreManualDecoratorStates(){for(const e of this.manualDecorators)e.value=this._getDecoratorStateFromModel(e.id)}refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement()||M(t.getSelectedBlocks());sn(n,e.schema)?(this.value=n.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttribute(n,"linkHref")):(this.value=t.getAttribute("linkHref"),this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref"));for(const i of this.manualDecorators)i.value=this._getDecoratorStateFromModel(i.id)}execute(e,t={}){const n=this.editor.model,i=n.document.selection,o=[],r=[];for(const l in t)t[l]?o.push(l):r.push(l);n.change(l=>{if(i.isCollapsed){const a=i.getFirstPosition();if(i.hasAttribute("linkHref")){const c=Mi(i);let d=_t(a,"linkHref",i.getAttribute("linkHref"),n);i.getAttribute("linkHref")===c&&(d=this._updateLinkContent(n,l,d,e)),l.setAttribute("linkHref",e,d),o.forEach(u=>{l.setAttribute(u,!0,d)}),r.forEach(u=>{l.removeAttribute(u,d)}),l.setSelection(l.createPositionAfter(d.end.nodeBefore))}else if(e!==""){const c=Fs(i.getAttributes());c.set("linkHref",e),o.forEach(u=>{c.set(u,!0)});const{end:d}=n.insertContent(l.createText(e,c),a);l.setSelection(d)}["linkHref",...o,...r].forEach(c=>{l.removeSelectionAttribute(c)})}else{const a=n.schema.getValidRanges(i.getRanges(),"linkHref"),c=[];for(const u of i.getSelectedBlocks())n.schema.checkAttribute(u,"linkHref")&&c.push(l.createRangeOn(u));const d=c.slice();for(const u of a)this._isRangeToUpdate(u,c)&&d.push(u);for(const u of d){let m=u;if(d.length===1){const h=Mi(i);i.getAttribute("linkHref")===h&&(m=this._updateLinkContent(n,l,u,e),l.setSelection(l.createSelection(m)))}l.setAttribute("linkHref",e,m),o.forEach(h=>{l.setAttribute(h,!0,m)}),r.forEach(h=>{l.removeAttribute(h,m)})}}})}_getDecoratorStateFromModel(e){const t=this.editor.model,n=t.document.selection,i=n.getSelectedElement();return sn(i,t.schema)?i.getAttribute(e):n.getAttribute(e)}_isRangeToUpdate(e,t){for(const n of t)if(n.containsRange(e))return!1;return!0}_updateLinkContent(e,t,n,i){const o=t.createText(i,{linkHref:i});return e.insertContent(o,n)}}function Mi(s){if(s.isCollapsed){const e=s.getFirstPosition();return e.textNode&&e.textNode.data}else{const e=Array.from(s.getFirstRange().getItems());if(e.length>1)return null;const t=e[0];return t.is("$text")||t.is("$textProxy")?t.data:null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _h extends k{refresh(){const e=this.editor.model,t=e.document.selection,n=t.getSelectedElement();sn(n,e.schema)?this.isEnabled=e.schema.checkAttribute(n,"linkHref"):this.isEnabled=e.schema.checkAttributeInSelection(t,"linkHref")}execute(){const e=this.editor,t=this.editor.model,n=t.document.selection,i=e.commands.get("link");t.change(o=>{const r=n.isCollapsed?[_t(n.getFirstPosition(),"linkHref",n.getAttribute("linkHref"),t)]:t.schema.getValidRanges(n.getRanges(),"linkHref");for(const l of r)if(o.removeAttribute("linkHref",l),i)for(const a of i.manualDecorators)o.removeAttribute(a.id,l)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ih extends Z(){constructor({id:e,label:t,attributes:n,classes:i,styles:o,defaultValue:r}){super(),this.id=e,this.set("value",void 0),this.defaultValue=r,this.label=t,this.attributes=n,this.classes=i,this.styles=o}_createPattern(){return{attributes:this.attributes,classes:this.classes,styles:this.styles}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Th="ck-link_selected",Ui="automatic",Eh="manual",Ah=/^(https?:)?\/\//;class Xo extends f{static get pluginName(){return"LinkEditing"}static get requires(){return[ei,ao,q]}constructor(e){super(e),e.config.define("link",{allowCreatingEmptyLinks:!1,addTargetToExternalLinks:!1})}init(){const e=this.editor,t=this.editor.config.get("link.allowedProtocols");e.model.schema.extend("$text",{allowAttributes:"linkHref"}),e.conversion.for("dataDowncast").attributeToElement({model:"linkHref",view:Di}),e.conversion.for("editingDowncast").attributeToElement({model:"linkHref",view:(o,r)=>Di(Qo(o,t),r)}),e.conversion.for("upcast").elementToAttribute({view:{name:"a",attributes:{href:!0}},model:{key:"linkHref",value:o=>o.getAttribute("href")}}),e.commands.add("link",new yh(e)),e.commands.add("unlink",new _h(e));const n=vh(e.t,Ch(e.config.get("link.decorators")));this._enableAutomaticDecorators(n.filter(o=>o.mode===Ui)),this._enableManualDecorators(n.filter(o=>o.mode===Eh)),e.plugins.get(ei).registerAttribute("linkHref"),Wc(e,"linkHref","a",Th),this._enableLinkOpen(),this._enableSelectionAttributesFixer(),this._enableClipboardIntegration()}_enableAutomaticDecorators(e){const t=this.editor,i=t.commands.get("link").automaticDecorators;t.config.get("link.addTargetToExternalLinks")&&i.add({id:"linkIsExternal",mode:Ui,callback:o=>!!o&&Ah.test(o),attributes:{target:"_blank",rel:"noopener noreferrer"}}),i.add(e),i.length&&t.conversion.for("downcast").add(i.getDispatcher())}_enableManualDecorators(e){if(!e.length)return;const t=this.editor,i=t.commands.get("link").manualDecorators;e.forEach(o=>{t.model.schema.extend("$text",{allowAttributes:o.id});const r=new Ih(o);i.add(r),t.conversion.for("downcast").attributeToElement({model:r.id,view:(l,{writer:a,schema:c},{item:d})=>{if((d.is("selection")||c.isInline(d))&&l){const u=a.createAttributeElement("a",r.attributes,{priority:5});r.classes&&a.addClass(r.classes,u);for(const m in r.styles)a.setStyle(m,r.styles[m],u);return a.setCustomProperty("link",!0,u),u}}}),t.conversion.for("upcast").elementToAttribute({view:{name:"a",...r._createPattern()},model:{key:r.id}})})}_enableLinkOpen(){const e=this.editor,n=e.editing.view.document;this.listenTo(n,"click",(i,o)=>{if(!(S.isMac?o.domEvent.metaKey:o.domEvent.ctrlKey))return;let l=o.domTarget;if(l.tagName.toLowerCase()!="a"&&(l=l.closest("a")),!l)return;const a=l.getAttribute("href");a&&(i.stop(),o.preventDefault(),Fi(a))},{context:"$capture"}),this.listenTo(n,"keydown",(i,o)=>{const l=e.commands.get("link").value;l&&o.keyCode===Fe.enter&&o.altKey&&(i.stop(),Fi(l))})}_enableSelectionAttributesFixer(){const t=this.editor.model,n=t.document.selection;this.listenTo(n,"change:attribute",(i,{attributeKeys:o})=>{!o.includes("linkHref")||n.hasAttribute("linkHref")||t.change(r=>{Sh(r,xh(t.schema))})})}_enableClipboardIntegration(){const e=this.editor,t=e.model,n=this.editor.config.get("link.defaultProtocol");n&&this.listenTo(e.plugins.get("ClipboardPipeline"),"contentInsertion",(i,o)=>{t.change(r=>{const l=r.createRangeIn(o.content);for(const a of l.getItems())if(a.hasAttribute("linkHref")){const c=An(a.getAttribute("linkHref"),n);r.setAttribute("linkHref",c,a)}})})}}function Sh(s,e){s.removeSelectionAttribute("linkHref");for(const t of e)s.removeSelectionAttribute(t)}function xh(s){return s.getDefinition("$text").allowAttributes.filter(t=>t.startsWith("link"))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Rh extends T{constructor(e,t){super(e),this.focusTracker=new X,this.keystrokes=new ne,this._focusables=new de;const n=e.t;this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),C.check,"ck-button-save"),this.saveButtonView.type="submit",this.cancelButtonView=this._createButton(n("Cancel"),C.cancel,"ck-button-cancel","cancel"),this._manualDecoratorSwitches=this._createManualDecoratorSwitches(t),this.children=this._createFormChildren(t.manualDecorators),this._focusCycler=new ue({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}});const i=["ck","ck-link-form","ck-responsive-form"];t.manualDecorators.length&&i.push("ck-link-form_layout-vertical","ck-vertical-form"),this.setTemplate({tag:"form",attributes:{class:i,tabindex:"-1"},children:this.children})}getDecoratorSwitchesState(){return Array.from(this._manualDecoratorSwitches).reduce((e,t)=>(e[t.name]=t.isOn,e),{})}render(){super.render(),kt({view:this}),[this.urlInputView,...this._manualDecoratorSwitches,this.saveButtonView,this.cancelButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createUrlInput(){const e=this.locale.t,t=new ze(this.locale,He);return t.label=e("Link URL"),t}_createButton(e,t,n,i){const o=new y(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),i&&o.delegate("execute").to(this,i),o}_createManualDecoratorSwitches(e){const t=this.createCollection();for(const n of e.manualDecorators){const i=new Ms(this.locale);i.set({name:n.id,label:n.label,withText:!0}),i.bind("isOn").toMany([n,e],"value",(o,r)=>r===void 0&&o===void 0?!!n.defaultValue:!!o),i.on("execute",()=>{n.set("value",!i.isOn)}),t.add(i)}return t}_createFormChildren(e){const t=this.createCollection();if(t.add(this.urlInputView),e.length){const n=new T;n.setTemplate({tag:"ul",children:this._manualDecoratorSwitches.map(i=>({tag:"li",children:[i],attributes:{class:["ck","ck-list__item"]}})),attributes:{class:["ck","ck-reset","ck-list"]}}),t.add(n)}return t.add(this.saveButtonView),t.add(this.cancelButtonView),t}}const Vh='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184zm4.919 10.562-1.414 1.414a.75.75 0 1 1-1.06-1.06l1.414-1.415-1.415-1.414a.75.75 0 0 1 1.061-1.06l1.414 1.414 1.414-1.415a.75.75 0 0 1 1.061 1.061l-1.414 1.414 1.414 1.415a.75.75 0 0 1-1.06 1.06l-1.415-1.414z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ph extends T{constructor(e,t={}){super(e),this.focusTracker=new X,this.keystrokes=new ne,this._focusables=new de;const n=e.t;this.previewButtonView=this._createPreviewButton(),this.unlinkButtonView=this._createButton(n("Unlink"),Vh,"unlink"),this.editButtonView=this._createButton(n("Edit link"),C.pencil,"edit"),this.set("href",void 0),this._linkConfig=t,this._focusCycler=new ue({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this.setTemplate({tag:"div",attributes:{class:["ck","ck-link-actions","ck-responsive-form"],tabindex:"-1"},children:[this.previewButtonView,this.editButtonView,this.unlinkButtonView]})}render(){super.render(),[this.previewButtonView,this.editButtonView,this.unlinkButtonView].forEach(t=>{this._focusables.add(t),this.focusTracker.add(t.element)}),this.keystrokes.listenTo(this.element)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}_createButton(e,t,n){const i=new y(this.locale);return i.set({label:e,icon:t,tooltip:!0}),i.delegate("execute").to(this,n),i}_createPreviewButton(){const e=new y(this.locale),t=this.bindTemplate,n=this.t;return e.set({withText:!0,tooltip:n("Open link in new tab")}),e.extendTemplate({attributes:{class:["ck","ck-link-actions__preview"],href:t.to("href",i=>i&&Qo(i,this._linkConfig.allowedProtocols)),target:"_blank",rel:"noopener noreferrer"}}),e.bind("label").to(this,"href",i=>i||n("This link has no URL")),e.bind("isEnabled").to(this,"href",i=>!!i),e.template.tag="a",e.template.eventListeners={},e}}const Bh='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m11.077 15 .991-1.416a.75.75 0 1 1 1.229.86l-1.148 1.64a.748.748 0 0 1-.217.206 5.251 5.251 0 0 1-8.503-5.955.741.741 0 0 1 .12-.274l1.147-1.639a.75.75 0 1 1 1.228.86L4.933 10.7l.006.003a3.75 3.75 0 0 0 6.132 4.294l.006.004zm5.494-5.335a.748.748 0 0 1-.12.274l-1.147 1.639a.75.75 0 1 1-1.228-.86l.86-1.23a3.75 3.75 0 0 0-6.144-4.301l-.86 1.229a.75.75 0 0 1-1.229-.86l1.148-1.64a.748.748 0 0 1 .217-.206 5.251 5.251 0 0 1 8.503 5.955zm-4.563-2.532a.75.75 0 0 1 .184 1.045l-3.155 4.505a.75.75 0 1 1-1.229-.86l3.155-4.506a.75.75 0 0 1 1.045-.184z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const K="link-ui";class Lh extends f{constructor(){super(...arguments),this.actionsView=null,this.formView=null}static get requires(){return[mt]}static get pluginName(){return"LinkUI"}init(){const e=this.editor,t=this.editor.t;e.editing.view.addObserver(ra),this._balloon=e.plugins.get(mt),this._createToolbarLinkButton(),this._enableBalloonActivators(),e.conversion.for("editingDowncast").markerToHighlight({model:K,view:{classes:["ck-fake-link-selection"]}}),e.conversion.for("editingDowncast").markerToElement({model:K,view:{name:"span",classes:["ck-fake-link-selection","ck-fake-link-selection_collapsed"]}}),e.accessibility.addKeystrokeInfos({keystrokes:[{label:t("Create link"),keystroke:rt},{label:t("Move out of a link"),keystroke:[["arrowleft","arrowleft"],["arrowright","arrowright"]]}]})}destroy(){super.destroy(),this.formView&&this.formView.destroy(),this.actionsView&&this.actionsView.destroy()}_createViews(){this.actionsView=this._createActionsView(),this.formView=this._createFormView(),this._enableUserBalloonInteractions()}_createActionsView(){const e=this.editor,t=new Ph(e.locale,e.config.get("link")),n=e.commands.get("link"),i=e.commands.get("unlink");return t.bind("href").to(n,"value"),t.editButtonView.bind("isEnabled").to(n),t.unlinkButtonView.bind("isEnabled").to(i),this.listenTo(t,"edit",()=>{this._addFormView()}),this.listenTo(t,"unlink",()=>{e.execute("unlink"),this._hideUI()}),t.keystrokes.set("Esc",(o,r)=>{this._hideUI(),r()}),t.keystrokes.set(rt,(o,r)=>{this._addFormView(),r()}),t}_createFormView(){const e=this.editor,t=e.commands.get("link"),n=e.config.get("link.defaultProtocol"),i=e.config.get("link.allowCreatingEmptyLinks"),o=new(Cn(Rh))(e.locale,t);return o.urlInputView.fieldView.bind("value").to(t,"value"),o.urlInputView.bind("isEnabled").to(t,"isEnabled"),o.saveButtonView.bind("isEnabled").to(t,"isEnabled",o.urlInputView,"isEmpty",(r,l)=>r&&(i||!l)),this.listenTo(o,"submit",()=>{const{value:r}=o.urlInputView.fieldView.element,l=An(r,n);e.execute("link",l,o.getDecoratorSwitchesState()),this._closeFormView()}),this.listenTo(o,"cancel",()=>{this._closeFormView()}),o.keystrokes.set("Esc",(r,l)=>{this._closeFormView(),l()}),o}_createToolbarLinkButton(){const e=this.editor,t=e.commands.get("link"),n=e.t;e.ui.componentFactory.add("link",i=>{const o=new y(i);return o.isEnabled=!0,o.label=n("Link"),o.icon=Bh,o.keystroke=rt,o.tooltip=!0,o.isToggleable=!0,o.bind("isEnabled").to(t,"isEnabled"),o.bind("isOn").to(t,"value",r=>!!r),this.listenTo(o,"execute",()=>this._showUI(!0)),o})}_enableBalloonActivators(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"click",()=>{this._getSelectedLinkElement()&&this._showUI()}),e.keystrokes.set(rt,(n,i)=>{i(),e.commands.get("link").isEnabled&&this._showUI(!0)})}_enableUserBalloonInteractions(){this.editor.keystrokes.set("Tab",(e,t)=>{this._areActionsVisible&&!this.actionsView.focusTracker.isFocused&&(this.actionsView.focus(),t())},{priority:"high"}),this.editor.keystrokes.set("Esc",(e,t)=>{this._isUIVisible&&(this._hideUI(),t())}),Bs({emitter:this.formView,activator:()=>this._isUIInPanel,contextElements:()=>[this._balloon.view.element],callback:()=>this._hideUI()})}_addActionsView(){this.actionsView||this._createViews(),!this._areActionsInPanel&&this._balloon.add({view:this.actionsView,position:this._getBalloonPositionData()})}_addFormView(){if(this.formView||this._createViews(),this._isFormInPanel)return;const t=this.editor.commands.get("link");this.formView.disableCssTransitions(),this._balloon.add({view:this.formView,position:this._getBalloonPositionData()}),this.formView.urlInputView.fieldView.value=t.value||"",this._balloon.visibleView===this.formView&&this.formView.urlInputView.fieldView.select(),this.formView.enableCssTransitions()}_closeFormView(){const e=this.editor.commands.get("link");e.restoreManualDecoratorStates(),e.value!==void 0?this._removeFormView():this._hideUI()}_removeFormView(){this._isFormInPanel&&(this.formView.saveButtonView.focus(),this.formView.urlInputView.fieldView.reset(),this._balloon.remove(this.formView),this.editor.editing.view.focus(),this._hideFakeVisualSelection())}_showUI(e=!1){this.formView||this._createViews(),this._getSelectedLinkElement()?(this._areActionsVisible?this._addFormView():this._addActionsView(),e&&this._balloon.showStack("main")):(this._showFakeVisualSelection(),this._addActionsView(),e&&this._balloon.showStack("main"),this._addFormView()),this._startUpdatingUI()}_hideUI(){if(!this._isUIInPanel)return;const e=this.editor;this.stopListening(e.ui,"update"),this.stopListening(this._balloon,"change:visibleView"),e.editing.view.focus(),this._removeFormView(),this._balloon.remove(this.actionsView),this._hideFakeVisualSelection()}_startUpdatingUI(){const e=this.editor,t=e.editing.view.document;let n=this._getSelectedLinkElement(),i=r();const o=()=>{const l=this._getSelectedLinkElement(),a=r();n&&!l||!n&&a!==i?this._hideUI():this._isUIVisible&&this._balloon.updatePosition(this._getBalloonPositionData()),n=l,i=a};function r(){return t.selection.focus.getAncestors().reverse().find(l=>l.is("element"))}this.listenTo(e.ui,"update",o),this.listenTo(this._balloon,"change:visibleView",o)}get _isFormInPanel(){return!!this.formView&&this._balloon.hasView(this.formView)}get _areActionsInPanel(){return!!this.actionsView&&this._balloon.hasView(this.actionsView)}get _areActionsVisible(){return!!this.actionsView&&this._balloon.visibleView===this.actionsView}get _isUIInPanel(){return this._isFormInPanel||this._areActionsInPanel}get _isUIVisible(){const e=this._balloon.visibleView;return!!this.formView&&e==this.formView||this._areActionsVisible}_getBalloonPositionData(){const e=this.editor.editing.view,t=this.editor.model,n=e.document;let i;if(t.markers.has(K)){const o=Array.from(this.editor.editing.mapper.markerNameToElements(K)),r=e.createRange(e.createPositionBefore(o[0]),e.createPositionAfter(o[o.length-1]));i=e.domConverter.viewRangeToDom(r)}else i=()=>{const o=this._getSelectedLinkElement();return o?e.domConverter.mapViewToDom(o):e.domConverter.viewRangeToDom(n.selection.getFirstRange())};return{target:i}}_getSelectedLinkElement(){const e=this.editor.editing.view,t=e.document.selection,n=t.getSelectedElement();if(t.isCollapsed||n&&D(n))return Ht(t.getFirstPosition());{const i=t.getFirstRange().getTrimmed(),o=Ht(i.start),r=Ht(i.end);return!o||o!=r?null:e.createRangeIn(o).getTrimmed().isEqual(i)?o:null}}_showFakeVisualSelection(){const e=this.editor.model;e.change(t=>{const n=e.document.selection.getFirstRange();if(e.markers.has(K))t.updateMarker(K,{range:n});else if(n.start.isAtEnd){const i=n.start.getLastMatchingPosition(({item:o})=>!e.schema.isContent(o),{boundaries:n});t.addMarker(K,{usingOperation:!1,affectsData:!1,range:t.createRange(i,n.end)})}else t.addMarker(K,{usingOperation:!1,affectsData:!1,range:n})})}_hideFakeVisualSelection(){const e=this.editor.model;e.markers.has(K)&&e.change(t=>{t.removeMarker(K)})}}function Ht(s){return s.getAncestors().find(e=>bh(e))||null}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Dh=4,Yo=new RegExp("(^|\\s)(((?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(((?!www\\.)|(www\\.))(?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.)+(?:[a-z\\u00a1-\\uffff]{2,63})))(?::\\d{2,5})?(?:[/?#]\\S*)?)|((www.|(\\S+@))((?![-_])(?:[-_a-z0-9\\u00a1-\\uffff]{1,63}\\.))+(?:[a-z\\u00a1-\\uffff]{2,63})))$","i"),Fh=2;class Mh extends f{static get requires(){return[re,Xo]}static get pluginName(){return"AutoLink"}init(){const t=this.editor.model.document.selection;t.on("change:range",()=>{this.isEnabled=!t.anchor.parent.is("element","codeBlock")}),this._enableTypingHandling()}afterInit(){this._enableEnterHandling(),this._enableShiftEnterHandling(),this._enablePasteLinking()}_expandLinkRange(e,t){return t.textNode&&t.textNode.hasAttribute("linkHref")?_t(t,"linkHref",t.textNode.getAttribute("linkHref"),e):null}_selectEntireLinks(e,t){const i=this.editor.model,o=i.document.selection,r=o.getFirstPosition(),l=o.getLastPosition();let a=t.getJoined(this._expandLinkRange(i,r)||t);a&&(a=a.getJoined(this._expandLinkRange(i,l)||t)),a&&(a.start.isBefore(r)||a.end.isAfter(l))&&e.setSelection(a)}_enablePasteLinking(){const e=this.editor,t=e.model,n=t.document.selection,i=e.plugins.get("ClipboardPipeline"),o=e.commands.get("link");i.on("inputTransformation",(r,l)=>{if(!this.isEnabled||!o.isEnabled||n.isCollapsed||l.method!=="paste"||n.rangeCount>1)return;const a=n.getFirstRange(),c=l.dataTransfer.getData("text/plain");if(!c)return;const d=c.match(Yo);d&&d[2]===c&&(t.change(u=>{this._selectEntireLinks(u,a),o.execute(c)}),r.stop())},{priority:"high"})}_enableTypingHandling(){const e=this.editor,t=new uo(e.model,n=>{if(!Uh(n))return;const i=Oi(n.substr(0,n.length-1));if(i)return{url:i}});t.on("matched:data",(n,i)=>{const{batch:o,range:r,url:l}=i;if(!o.isTyping)return;const a=r.end.getShiftedBy(-1),c=a.getShiftedBy(-l.length),d=e.model.createRange(c,a);this._applyAutoLink(l,d)}),t.bind("isEnabled").to(this)}_enableEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("enter");n&&n.on("execute",()=>{const i=t.document.selection.getFirstPosition();if(!i.parent.previousSibling)return;const o=t.createRangeIn(i.parent.previousSibling);this._checkAndApplyAutoLinkOnRange(o)})}_enableShiftEnterHandling(){const e=this.editor,t=e.model,n=e.commands.get("shiftEnter");n&&n.on("execute",()=>{const i=t.document.selection.getFirstPosition(),o=t.createRange(t.createPositionAt(i.parent,0),i.getShiftedBy(-1));this._checkAndApplyAutoLinkOnRange(o)})}_checkAndApplyAutoLinkOnRange(e){const t=this.editor.model,{text:n,range:i}=co(e,t),o=Oi(n);if(o){const r=t.createRange(i.end.getShiftedBy(-o.length),i.end);this._applyAutoLink(o,r)}}_applyAutoLink(e,t){const n=this.editor.model,i=this.editor.config.get("link.defaultProtocol"),o=An(e,i);!this.isEnabled||!Oh(t,n)||!Zo(o)||Nh(t)||this._persistAutoLink(o,t)}_persistAutoLink(e,t){const n=this.editor.model,i=this.editor.plugins.get("Delete");n.enqueueChange(o=>{o.setAttribute("linkHref",e,t),n.enqueueChange(()=>{i.requestUndoOnBackspace()})})}}function Uh(s){return s.length>Dh&&s[s.length-1]===" "&&s[s.length-2]!==" "}function Oi(s){const e=Yo.exec(s);return e?e[Fh]:null}function Oh(s,e){return e.schema.checkAttributeInSelection(e.createSelection(s),"linkHref")}function Nh(s){const e=s.start.nodeAfter;return!!e&&e.hasAttribute("linkHref")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zh extends f{static get requires(){return[Xo,Lh,Mh]}static get pluginName(){return"Link"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class G{constructor(e,t){this._startElement=e,this._referenceIndent=e.getAttribute("listIndent"),this._isForward=t.direction=="forward",this._includeSelf=!!t.includeSelf,this._sameAttributes=ie(t.sameAttributes||[]),this._sameIndent=!!t.sameIndent,this._lowerIndent=!!t.lowerIndent,this._higherIndent=!!t.higherIndent}static first(e,t){const i=new this(e,t)[Symbol.iterator]();return M(i)}*[Symbol.iterator](){const e=[];for(const{node:t}of Ke(this._getStartNode(),this._isForward?"forward":"backward")){const n=t.getAttribute("listIndent");if(n<this._referenceIndent){if(!this._lowerIndent)break;this._referenceIndent=n}else if(n>this._referenceIndent){if(!this._higherIndent)continue;if(!this._isForward){e.push(t);continue}}else{if(!this._sameIndent){if(this._higherIndent){e.length&&(yield*e,e.length=0);break}continue}if(this._sameAttributes.some(i=>t.getAttribute(i)!==this._startElement.getAttribute(i)))break}e.length&&(yield*e,e.length=0),yield t}}_getStartNode(){return this._includeSelf?this._startElement:this._isForward?this._startElement.nextSibling:this._startElement.previousSibling}}function*Ke(s,e="forward"){const t=e=="forward",n=[];let i=null;for(;V(s);){let o=null;if(i){const r=s.getAttribute("listIndent"),l=i.getAttribute("listIndent");r>l?n[l]=i:r<l?(o=n[r],n.length=r):o=i}yield{node:s,previous:i,previousNodeInList:o},i=s,s=t?s.nextSibling:s.previousSibling}}class Hh{constructor(e){this._listHead=e}[Symbol.iterator](){return Ke(this._listHead,"forward")}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _e{static next(){return Ct()}}function V(s){return!!s&&s.is("element")&&s.hasAttribute("listItemId")}function Sn(s,e={}){return[...le(s,{...e,direction:"backward"}),...le(s,{...e,direction:"forward"})]}function le(s,e={}){const t=e.direction=="forward",n=Array.from(new G(s,{...e,includeSelf:t,sameIndent:!0,sameAttributes:"listItemId"}));return t?n:n.reverse()}function $h(s){return Array.from(new G(s,{direction:"forward",higherIndent:!0}))}function Jo(s){const e=new G(s,{sameIndent:!0,sameAttributes:"listType"}),t=new G(s,{sameIndent:!0,sameAttributes:"listType",includeSelf:!0,direction:"forward"});return[...Array.from(e).reverse(),...t]}function ce(s){return!G.first(s,{sameIndent:!0,sameAttributes:"listItemId"})}function Ni(s){return!G.first(s,{direction:"forward",sameIndent:!0,sameAttributes:"listItemId"})}function Qe(s,e={}){s=ie(s);const t=e.withNested!==!1,n=new Set;for(const i of s)for(const o of Sn(i,{higherIndent:t}))n.add(o);return me(n)}function Wh(s){s=ie(s);const e=new Set;for(const t of s)for(const n of Jo(t))e.add(n);return me(e)}function xn(s,e){const t=le(s,{direction:"forward"}),n=_e.next();for(const i of t)e.setAttribute("listItemId",n,i);return t}function on(s,e,t){const n={};for(const[o,r]of e.getAttributes())o.startsWith("list")&&(n[o]=r);const i=le(s,{direction:"forward"});for(const o of i)t.setAttributes(n,o);return i}function rn(s,e,{expand:t,indentBy:n=1}={}){s=ie(s);const i=t?Qe(s):s;for(const o of i){const r=o.getAttribute("listIndent")+n;r<0?Tt(o,e):e.setAttribute("listIndent",r,o)}return i}function qh(s,e){s=ie(s);const t=Qe(s),n=new Set,i=Math.min(...t.map(r=>r.getAttribute("listIndent"))),o=new Map;for(const r of t)o.set(r,G.first(r,{lowerIndent:!0}));for(const r of t){if(n.has(r))continue;n.add(r);const l=r.getAttribute("listIndent")-1;if(l<0){Tt(r,e);continue}if(r.getAttribute("listIndent")==i){const a=jh(r,o.get(r),e);for(const c of a)n.add(c);if(a.length)continue}e.setAttribute("listIndent",l,r)}return me(n)}function Tt(s,e){s=ie(s);for(const t of s)t.is("element","listItem")&&e.rename(t,"paragraph");for(const t of s)for(const n of t.getAttributeKeys())n.startsWith("list")&&e.removeAttribute(n,t);return s}function Oe(s){if(!s.length)return!1;const e=s[0].getAttribute("listItemId");return e?!s.some(t=>t.getAttribute("listItemId")!=e):!1}function Gh(s,e){const t=[];let n=Number.POSITIVE_INFINITY;for(const{node:i}of Ke(s.nextSibling,"forward")){const o=i.getAttribute("listIndent");if(o==0)break;o<n&&(n=o);const r=o-n;e.setAttribute("listIndent",r,i),t.push(i)}return t}function me(s){return Array.from(s).filter(e=>e.root.rootName!=="$graveyard").sort((e,t)=>e.index-t.index)}function Ne(s){const e=s.document.selection.getSelectedElement();return e&&s.schema.isObject(e)&&s.schema.isBlock(e)?e:null}function $t(s,e){return e.checkChild(s.parent,"listItem")&&e.checkChild(s,"$text")&&!e.isObject(s)}function jh(s,e,t){return le(e,{direction:"forward"}).pop().index>s.index?on(s,e,t):[]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class zi extends k{constructor(e,t){super(e),this._direction=t}refresh(){this.isEnabled=this._checkEnabled()}execute(){const e=this.editor.model,t=Hi(e.document.selection);e.change(n=>{const i=[];Oe(t)&&!ce(t[0])?(this._direction=="forward"&&i.push(...rn(t,n)),i.push(...xn(t[0],n))):this._direction=="forward"?i.push(...rn(t,n,{expand:!0})):i.push(...qh(t,n));for(const o of i){if(!o.hasAttribute("listType"))continue;const r=G.first(o,{sameIndent:!0});r&&n.setAttribute("listType",r.getAttribute("listType"),o)}this._fireAfterExecute(i)})}_fireAfterExecute(e){this.fire("afterExecute",me(new Set(e)))}_checkEnabled(){let e=Hi(this.editor.model.document.selection),t=e[0];if(!t)return!1;if(this._direction=="backward"||Oe(e)&&!ce(e[0]))return!0;e=Qe(e),t=e[0];const n=G.first(t,{sameIndent:!0});return n?n.getAttribute("listType")==t.getAttribute("listType"):!1}}function Hi(s){const e=Array.from(s.getSelectedBlocks()),t=e.findIndex(n=>!V(n));return t!=-1&&(e.length=t),e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class $i extends k{constructor(e,t){super(e),this.type=t}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(e={}){const t=this.editor.model,n=t.document,i=Ne(t),o=Array.from(n.selection.getSelectedBlocks()).filter(l=>t.schema.checkAttribute(l,"listType")||$t(l,t.schema)),r=e.forceValue!==void 0?!e.forceValue:this.value;t.change(l=>{if(r){const a=o[o.length-1],c=le(a,{direction:"forward"}),d=[];c.length>1&&d.push(...xn(c[1],l)),d.push(...Tt(o,l)),d.push(...Gh(a,l)),this._fireAfterExecute(d)}else if((i||n.selection.isCollapsed)&&V(o[0])){const a=Jo(i||o[0]);for(const c of a)l.setAttribute("listType",this.type,c);this._fireAfterExecute(a)}else{const a=[];for(const c of o)if(!c.hasAttribute("listType"))!c.is("element","listItem")&&$t(c,t.schema)&&l.rename(c,"listItem"),l.setAttributes({listIndent:0,listItemId:_e.next(),listType:this.type},c),a.push(c);else for(const d of Qe(c,{withNested:!1}))d.getAttribute("listType")!=this.type&&(l.setAttribute("listType",this.type,d),a.push(d));this._fireAfterExecute(a)}})}_fireAfterExecute(e){this.fire("afterExecute",me(new Set(e)))}_getValue(){const e=this.editor.model.document.selection,t=Array.from(e.getSelectedBlocks());if(!t.length)return!1;for(const n of t)if(n.getAttribute("listType")!=this.type)return!1;return!0}_checkEnabled(){const e=this.editor.model,t=e.schema,n=e.document.selection,i=Array.from(n.getSelectedBlocks());if(!i.length)return!1;if(this.value)return!0;for(const o of i)if(t.checkAttribute(o,"listType")||$t(o,t))return!0;return!1}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Wi extends k{constructor(e,t){super(e),this._direction=t}refresh(){this.isEnabled=this._checkEnabled()}execute({shouldMergeOnBlocksContentLevel:e=!1}={}){const t=this.editor.model,n=t.document.selection,i=[];t.change(o=>{const{firstElement:r,lastElement:l}=this._getMergeSubjectElements(n,e),a=r.getAttribute("listIndent")||0,c=l.getAttribute("listIndent"),d=l.getAttribute("listItemId");if(a!=c){const u=$h(l);i.push(...rn([l,...u],o,{indentBy:a-c,expand:a<c}))}if(e){let u=n;n.isCollapsed&&(u=o.createSelection(o.createRange(o.createPositionAt(r,"end"),o.createPositionAt(l,0)))),t.deleteContent(u,{doNotResetEntireContent:n.isCollapsed});const m=u.getLastPosition().parent,h=m.nextSibling;i.push(m),h&&h!==l&&h.getAttribute("listItemId")==d&&i.push(...on(h,m,o))}else i.push(...on(l,r,o));this._fireAfterExecute(i)})}_fireAfterExecute(e){this.fire("afterExecute",me(new Set(e)))}_checkEnabled(){const e=this.editor.model,t=e.document.selection,n=Ne(e);if(t.isCollapsed||n){const i=n||t.getFirstPosition().parent;if(!V(i))return!1;const o=this._direction=="backward"?i.previousSibling:i.nextSibling;if(!o||Oe([i,o]))return!1}else{const i=t.getLastPosition(),o=t.getFirstPosition();if(i.parent===o.parent||!V(i.parent))return!1}return!0}_getMergeSubjectElements(e,t){const n=this.editor.model,i=Ne(n);let o,r;if(e.isCollapsed||i){const l=i||e.getFirstPosition().parent,a=ce(l);this._direction=="backward"?(r=l,a&&!t?o=G.first(l,{sameIndent:!0,lowerIndent:!0}):o=l.previousSibling):(o=l,r=l.nextSibling)}else o=e.getFirstPosition().parent,r=e.getLastPosition().parent;return{firstElement:o,lastElement:r}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class qi extends k{constructor(e,t){super(e),this._direction=t}refresh(){this.isEnabled=this._checkEnabled()}execute(){this.editor.model.change(t=>{const n=xn(this._getStartBlock(),t);this._fireAfterExecute(n)})}_fireAfterExecute(e){this.fire("afterExecute",me(new Set(e)))}_checkEnabled(){const e=this.editor.model.document.selection,t=this._getStartBlock();return e.isCollapsed&&V(t)&&!ce(t)}_getStartBlock(){const t=this.editor.model.document.selection.getFirstPosition().parent;return this._direction=="before"?t:t.nextSibling}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Kh extends f{static get pluginName(){return"ListUtils"}expandListBlocksToCompleteList(e){return Wh(e)}isFirstBlockOfListItem(e){return ce(e)}isListItemBlock(e){return V(e)}expandListBlocksToCompleteItems(e,t={}){return Qe(e,t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function er(s){return s.is("element","ol")||s.is("element","ul")}function bt(s){return s.is("element","li")}function Qh(s){let e=0,t=s.parent;for(;t;){if(bt(t))e++;else{const n=t.previousSibling;n&&bt(n)&&e++}t=t.parent}return e}function Zh(s,e,t,n=nr(t,e)){return s.createAttributeElement(tr(t),null,{priority:2*e/100-100,id:n})}function Xh(s,e,t){return s.createAttributeElement("li",null,{priority:(2*e+1)/100-100,id:t})}function tr(s){return s=="numbered"?"ol":"ul"}function nr(s,e){return`list-${s}-${e}`}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function j(s,e){const t=s.nodeBefore;if(V(t)){let n=t;for(const{node:i}of Ke(n,"backward"))if(n=i,e.has(n))return;e.set(t,n)}else{const n=s.nodeAfter;V(n)&&e.set(n,n)}}function Yh(s,e){let t=0,n=-1,i=null,o=!1;for(const{node:r}of s){const l=r.getAttribute("listIndent");if(l>t){let a;i===null?(i=l-t,a=t):(i>l&&(i=l),a=l-i),a>n+1&&(a=n+1),e.setAttribute("listIndent",a,r),o=!0,n=a}else i=null,t=l+1,n=l}return o}function Jh(s,e,t){const n=new Set;let i=!1;for(const{node:o}of s){if(n.has(o))continue;let r=o.getAttribute("listType"),l=o.getAttribute("listItemId");if(e.has(l)&&(l=_e.next()),e.add(l),o.is("element","listItem")){o.getAttribute("listItemId")!=l&&(t.setAttribute("listItemId",l,o),i=!0);continue}for(const a of le(o,{direction:"forward"}))n.add(a),a.getAttribute("listType")!=r&&(l=_e.next(),r=a.getAttribute("listType")),a.getAttribute("listItemId")!=l&&(t.setAttribute("listItemId",l,a),i=!0)}return i}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function eg(){return(s,e,t)=>{const{writer:n,schema:i}=t;if(!e.modelRange)return;const o=Array.from(e.modelRange.getItems({shallow:!0})).filter(u=>i.checkAttribute(u,"listItemId"));if(!o.length)return;const r=_e.next(),l=Qh(e.viewItem);let a=e.viewItem.parent&&e.viewItem.parent.is("element","ol")?"numbered":"bulleted";const c=o[0].getAttribute("listType");c&&(a=c);const d={listItemId:r,listIndent:l,listType:a};for(const u of o)u.hasAttribute("listItemId")||n.setAttributes(d,u);o.length>1&&o[1].getAttribute("listItemId")!=d.listItemId&&t.keepEmptyElement(o[0])}}function Gi(){return(s,e,t)=>{if(!t.consumable.test(e.viewItem,{name:!0}))return;const n=new se(e.viewItem.document);for(const i of Array.from(e.viewItem.getChildren()))!bt(i)&&!er(i)&&n.remove(i)}}function tg(s,e,t,n){return()=>{const l=s.document.differ.getChanges(),a=[],c=new Map,d=new Set;for(const u of l)if(u.type=="insert"&&u.name!="$text")j(u.position,c),u.attributes.has("listItemId")?d.add(u.position.nodeAfter):j(u.position.getShiftedBy(u.length),c);else if(u.type=="remove"&&u.attributes.has("listItemId"))j(u.position,c);else if(u.type=="attribute"){const m=u.range.start.nodeAfter;t.includes(u.attributeKey)?(j(u.range.start,c),u.attributeNewValue===null?(j(u.range.start.getShiftedBy(1),c),o(m)&&a.push(m)):d.add(m)):V(m)&&o(m)&&a.push(m)}for(const u of c.values())a.push(...i(u,d));for(const u of new Set(a))e.reconvertItem(u)};function i(l,a){const c=[],d=new Set,u=[];for(const{node:m,previous:h}of Ke(l,"forward")){if(d.has(m))continue;const g=m.getAttribute("listIndent");h&&g<h.getAttribute("listIndent")&&(u.length=g+1),u[g]=Object.fromEntries(Array.from(m.getAttributes()).filter(([b])=>t.includes(b)));const p=le(m,{direction:"forward"});for(const b of p)d.add(b),(o(b,p)||r(b,u,a))&&c.push(b)}return c}function o(l,a){const c=e.mapper.toViewElement(l);if(!c)return!1;if(n.fire("checkElement",{modelElement:l,viewElement:c}))return!0;if(!l.is("element","paragraph")&&!l.is("element","listItem"))return!1;const u=ir(l,t,a);return u&&c.is("element","p")?!0:!!(!u&&c.is("element","span"))}function r(l,a,c){if(c.has(l))return!1;const d=e.mapper.toViewElement(l);let u=a.length-1;for(let m=d.parent;!m.is("editableElement");m=m.parent){const h=bt(m),g=er(m);if(!g&&!h)continue;const p=`checkAttributes:${h?"item":"list"}`;if(n.fire(p,{viewElement:m,modelAttributes:a[u]}))break;if(g&&(u--,u<0))return!1}return!0}}function ji(s,e,t,{dataPipeline:n}={}){const i=lg(s);return(o,r,l)=>{const{writer:a,mapper:c,consumable:d}=l,u=r.item;if(!s.includes(r.attributeKey)||!i(u,d))return;const m=ng(u,c,t);ig(m,a,c),og(m,a);const h=sg(u,m,e,a,{dataPipeline:n});rg(u,h,e,a)}}function Ki(s,{dataPipeline:e}={}){return(t,{writer:n})=>{if(!ir(t,s))return null;if(!e)return n.createContainerElement("span",{class:"ck-list-bogus-paragraph"});const i=n.createContainerElement("p");return n.setCustomProperty("dataPipeline:transparentRendering",!0,i),i}}function ng(s,e,t){const n=t.createRangeOn(s);return e.toViewRange(n).getTrimmed().end.nodeBefore}function ig(s,e,t){for(;s.parent.is("attributeElement")&&s.parent.getCustomProperty("listItemWrapper");)e.unwrap(e.createRangeIn(s.parent),s.parent);const n=e.createPositionBefore(s).getWalker({direction:"backward"}),i=[];for(const{item:o}of n){if(o.is("element")&&t.toModelElement(o))break;o.is("element")&&o.getCustomProperty("listItemMarker")&&i.push(o)}for(const o of i)e.remove(o)}function sg(s,e,t,n,{dataPipeline:i}){let o=n.createRangeOn(e);if(!ce(s))return o;for(const r of t){if(r.scope!="itemMarker")continue;const l=r.createElement(n,s,{dataPipeline:i});if(!l||(n.setCustomProperty("listItemMarker",!0,l),n.insert(o.start,l),o=n.createRange(n.createPositionBefore(l),n.createPositionAfter(e)),!r.createWrapperElement||!r.canWrapElement))continue;const a=r.createWrapperElement(n,s,{dataPipeline:i});n.setCustomProperty("listItemWrapper",!0,a),r.canWrapElement(s)?o=n.wrap(o,a):(o=n.wrap(n.createRangeOn(l),a),o=n.createRange(o.start,n.createPositionAfter(e)))}return o}function og(s,e){let t=s.parent;for(;t.is("attributeElement")&&["ul","ol","li"].includes(t.name);){const n=t.parent;e.unwrap(e.createRangeOn(s),t),t=n}}function rg(s,e,t,n){if(!s.hasAttribute("listIndent"))return;const i=s.getAttribute("listIndent");let o=s;for(let r=i;r>=0;r--){const l=Xh(n,r,o.getAttribute("listItemId")),a=Zh(n,r,o.getAttribute("listType"));for(const c of t)(c.scope=="list"||c.scope=="item")&&o.hasAttribute(c.attributeName)&&c.setAttributeOnDowncast(n,o.getAttribute(c.attributeName),c.scope=="list"?a:l);if(e=n.wrap(e,l),e=n.wrap(e,a),r==0||(o=G.first(o,{lowerIndent:!0}),!o))break}}function lg(s){return(e,t)=>{const n=[];for(const i of s)e.hasAttribute(i)&&n.push(`attribute:${i}`);return n.every(i=>t.test(e,i)!==!1)?(n.forEach(i=>t.consume(e,i)),!0):!1}}function ir(s,e,t=Sn(s)){if(!V(s))return!1;for(const n of s.getAttributeKeys())if(!n.startsWith("selection:")&&!e.includes(n))return!1;return t.length<2}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ct=["listType","listIndent","listItemId"];class ag extends f{static get pluginName(){return"ListEditing"}static get requires(){return[bn,re,Kh,q]}constructor(e){super(e),this._downcastStrategies=[],e.config.define("list.multiBlock",!0)}init(){const e=this.editor,t=e.model,n=e.config.get("list.multiBlock");if(e.plugins.has("LegacyListEditing"))throw new L("list-feature-conflict",this,{conflictPlugin:"LegacyListEditing"});t.schema.register("$listItem",{allowAttributes:ct}),n?(t.schema.extend("$container",{allowAttributesOf:"$listItem"}),t.schema.extend("$block",{allowAttributesOf:"$listItem"}),t.schema.extend("$blockObject",{allowAttributesOf:"$listItem"})):t.schema.register("listItem",{inheritAllFrom:"$block",allowAttributesOf:"$listItem"});for(const i of ct)t.schema.setAttributeProperties(i,{copyOnReplace:!0});e.commands.add("numberedList",new $i(e,"numbered")),e.commands.add("bulletedList",new $i(e,"bulleted")),e.commands.add("indentList",new zi(e,"forward")),e.commands.add("outdentList",new zi(e,"backward")),e.commands.add("splitListItemBefore",new qi(e,"before")),e.commands.add("splitListItemAfter",new qi(e,"after")),n&&(e.commands.add("mergeListItemBackward",new Wi(e,"backward")),e.commands.add("mergeListItemForward",new Wi(e,"forward"))),this._setupDeleteIntegration(),this._setupEnterIntegration(),this._setupTabIntegration(),this._setupClipboardIntegration(),this._setupAccessibilityIntegration()}afterInit(){const t=this.editor.commands,n=t.get("indent"),i=t.get("outdent");n&&n.registerChildCommand(t.get("indentList"),{priority:"high"}),i&&i.registerChildCommand(t.get("outdentList"),{priority:"lowest"}),this._setupModelPostFixing(),this._setupConversion()}registerDowncastStrategy(e){this._downcastStrategies.push(e)}getListAttributeNames(){return[...ct,...this._downcastStrategies.map(e=>e.attributeName)]}_setupDeleteIntegration(){const e=this.editor,t=e.commands.get("mergeListItemBackward"),n=e.commands.get("mergeListItemForward");this.listenTo(e.editing.view.document,"delete",(i,o)=>{const r=e.model.document.selection;Ne(e.model)||e.model.change(()=>{const l=r.getFirstPosition();if(r.isCollapsed&&o.direction=="backward"){if(!l.isAtStart)return;const a=l.parent;if(!V(a))return;if(!G.first(a,{sameAttributes:"listType",sameIndent:!0})&&a.getAttribute("listIndent")===0)Ni(a)||e.execute("splitListItemAfter"),e.execute("outdentList");else{if(!t||!t.isEnabled)return;t.execute({shouldMergeOnBlocksContentLevel:Qi(e.model,"backward")})}o.preventDefault(),i.stop()}else{if(r.isCollapsed&&!r.getLastPosition().isAtEnd||!n||!n.isEnabled)return;n.execute({shouldMergeOnBlocksContentLevel:Qi(e.model,"forward")}),o.preventDefault(),i.stop()}})},{context:"li"})}_setupEnterIntegration(){const e=this.editor,t=e.model,n=e.commands,i=n.get("enter");this.listenTo(e.editing.view.document,"enter",(o,r)=>{const l=t.document,a=l.selection.getFirstPosition().parent;if(l.selection.isCollapsed&&V(a)&&a.isEmpty&&!r.isSoft){const c=ce(a),d=Ni(a);c&&d?(e.execute("outdentList"),r.preventDefault(),o.stop()):c&&!d?(e.execute("splitListItemAfter"),r.preventDefault(),o.stop()):d&&(e.execute("splitListItemBefore"),r.preventDefault(),o.stop())}},{context:"li"}),this.listenTo(i,"afterExecute",()=>{const o=n.get("splitListItemBefore");if(o.refresh(),!o.isEnabled)return;const l=e.model.document.selection.getLastPosition().parent;Sn(l).length===2&&o.execute()})}_setupTabIntegration(){const e=this.editor;this.listenTo(e.editing.view.document,"tab",(t,n)=>{const i=n.shiftKey?"outdentList":"indentList";this.editor.commands.get(i).isEnabled&&(e.execute(i),n.stopPropagation(),n.preventDefault(),t.stop())},{context:"li"})}_setupConversion(){const e=this.editor,t=e.model,n=this.getListAttributeNames(),i=e.config.get("list.multiBlock"),o=i?"paragraph":"listItem";e.conversion.for("upcast").elementToElement({view:"li",model:(r,{writer:l})=>l.createElement(o,{listType:""})}).elementToElement({view:"p",model:(r,{writer:l})=>r.parent&&r.parent.is("element","li")?l.createElement(o,{listType:""}):null,converterPriority:"high"}).add(r=>{r.on("element:li",eg()),r.on("element:ul",Gi(),{priority:"high"}),r.on("element:ol",Gi(),{priority:"high"})}),i||e.conversion.for("downcast").elementToElement({model:"listItem",view:"p"}),e.conversion.for("editingDowncast").elementToElement({model:o,view:Ki(n),converterPriority:"high"}).add(r=>{r.on("attribute",ji(n,this._downcastStrategies,t))}),e.conversion.for("dataDowncast").elementToElement({model:o,view:Ki(n,{dataPipeline:!0}),converterPriority:"high"}).add(r=>{r.on("attribute",ji(n,this._downcastStrategies,t,{dataPipeline:!0}))}),this.listenTo(t.document,"change:data",tg(t,e.editing,n,this),{priority:"high"}),this.on("checkAttributes:item",(r,{viewElement:l,modelAttributes:a})=>{l.id!=a.listItemId&&(r.return=!0,r.stop())}),this.on("checkAttributes:list",(r,{viewElement:l,modelAttributes:a})=>{(l.name!=tr(a.listType)||l.id!=nr(a.listType,a.listIndent))&&(r.return=!0,r.stop())})}_setupModelPostFixing(){const e=this.editor.model,t=this.getListAttributeNames();e.document.registerPostFixer(n=>cg(e,n,t,this)),this.on("postFixer",(n,{listNodes:i,writer:o})=>{n.return=Yh(i,o)||n.return},{priority:"high"}),this.on("postFixer",(n,{listNodes:i,writer:o,seenIds:r})=>{n.return=Jh(i,r,o)||n.return},{priority:"high"})}_setupClipboardIntegration(){const e=this.editor.model,t=this.editor.plugins.get("ClipboardPipeline");this.listenTo(e,"insertContent",dg(e),{priority:"high"}),this.listenTo(t,"outputTransformation",(n,i)=>{e.change(o=>{const r=Array.from(i.content.getChildren()),l=r[r.length-1];if(r.length>1&&l.is("element")&&l.isEmpty&&r.slice(0,-1).every(V)&&o.remove(l),i.method=="copy"||i.method=="cut"){const a=Array.from(i.content.getChildren());Oe(a)&&Tt(a,o)}})})}_setupAccessibilityIntegration(){const e=this.editor,t=e.t;e.accessibility.addKeystrokeInfoGroup({id:"list",label:t("Keystrokes that can be used in a list"),keystrokes:[{label:t("Increase list item indent"),keystroke:"Tab"},{label:t("Decrease list item indent"),keystroke:"Shift+Tab"}]})}}function cg(s,e,t,n){const i=s.document.differ.getChanges(),o=new Map,r=n.editor.config.get("list.multiBlock");let l=!1;for(const c of i){if(c.type=="insert"&&c.name!="$text"){const d=c.position.nodeAfter;if(!s.schema.checkAttribute(d,"listItemId"))for(const u of Array.from(d.getAttributeKeys()))t.includes(u)&&(e.removeAttribute(u,d),l=!0);j(c.position,o),c.attributes.has("listItemId")||j(c.position.getShiftedBy(c.length),o);for(const{item:u,previousPosition:m}of s.createRangeIn(d))V(u)&&j(m,o)}else c.type=="remove"?j(c.position,o):c.type=="attribute"&&t.includes(c.attributeKey)&&(j(c.range.start,o),c.attributeNewValue===null&&j(c.range.start.getShiftedBy(1),o));if(!r&&c.type=="attribute"&&ct.includes(c.attributeKey)){const d=c.range.start.nodeAfter;c.attributeNewValue===null&&d&&d.is("element","listItem")?(e.rename(d,"paragraph"),l=!0):c.attributeOldValue===null&&d&&d.is("element")&&d.name!="listItem"&&(e.rename(d,"listItem"),l=!0)}}const a=new Set;for(const c of o.values())l=n.fire("postFixer",{listNodes:new Hh(c),listHead:c,writer:e,seenIds:a})||l;return l}function dg(s){return(e,[t,n])=>{const i=t.is("documentFragment")?Array.from(t.getChildren()):[t];if(!i.length)return;const r=(n?s.createSelection(n):s.document.selection).getFirstPosition();let l;if(V(r.parent))l=r.parent;else if(V(r.nodeBefore))l=r.nodeBefore;else return;s.change(a=>{const c=l.getAttribute("listType"),d=l.getAttribute("listIndent"),u=i[0].getAttribute("listIndent")||0,m=Math.max(d-u,0);for(const h of i){const g=V(h);l.is("element","listItem")&&h.is("element","paragraph")&&a.rename(h,"listItem"),a.setAttributes({listIndent:(g?h.getAttribute("listIndent"):0)+m,listItemId:g?h.getAttribute("listItemId"):_e.next(),listType:c},h)}})}}function Qi(s,e){const t=s.document.selection;if(!t.isCollapsed)return!Ne(s);if(e==="forward")return!0;const i=t.getFirstPosition().parent,o=i.previousSibling;return s.schema.isObject(o)?!1:o.isEmpty?!0:Oe([i,o])}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Zi(s,e,t,n){s.ui.componentFactory.add(e,i=>{const o=s.commands.get(e),r=new y(i);return r.set({label:t,icon:n,tooltip:!0,isToggleable:!0}),r.bind("isOn","isEnabled").to(o,"value","isEnabled"),r.on("execute",()=>{s.execute(e),s.editing.view.focus()}),r})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ug extends f{static get pluginName(){return"ListUI"}init(){const e=this.editor.t;Zi(this.editor,"numberedList",e("Numbered List"),C.numberedList),Zi(this.editor,"bulletedList",e("Bulleted List"),C.bulletedList)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class mg extends f{static get requires(){return[ag,ug]}static get pluginName(){return"List"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Xi(s,e){const t=(n,i,o)=>{if(!o.consumable.consume(i.item,n.name))return;const r=i.attributeNewValue,l=o.writer,a=o.mapper.toViewElement(i.item),c=[...a.getChildren()].find(u=>u.getCustomProperty("media-content"));l.remove(c);const d=s.getMediaViewElement(l,r,e);l.insert(l.createPositionAt(a,0),d)};return n=>{n.on("attribute:url:media",t)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function hg(s,e,t){return e.setCustomProperty("media",!0,s),wn(s,e,{label:t})}function Yi(s,e,t,n){return s.createContainerElement("figure",{class:"media"},[e.getMediaViewElement(s,t,n),s.createSlot()])}function Ji(s){const e=s.getSelectedElement();return e&&e.is("element","media")?e:null}function sr(s,e,t,n){s.change(i=>{const o=i.createElement("media",{url:e});s.insertObject(o,t,null,{setSelection:"on",findOptimalPosition:n?"auto":void 0})})}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gg extends k{refresh(){const e=this.editor.model,t=e.document.selection,n=Ji(t);this.value=n?n.getAttribute("url"):void 0,this.isEnabled=pg(t)||fg(t,e)}execute(e){const t=this.editor.model,n=t.document.selection,i=Ji(n);i?t.change(o=>{o.setAttribute("url",e,i)}):sr(t,e,n,!0)}}function fg(s,e){let n=Ps(s,e).start.parent;return n.isEmpty&&!e.schema.isLimit(n)&&(n=n.parent),e.schema.checkChild(n,"media")}function pg(s){const e=s.getSelectedElement();return!!e&&e.name==="media"}const bg='<svg viewBox="0 0 64 42" xmlns="http://www.w3.org/2000/svg"><path d="M47.426 17V3.713L63.102 0v19.389h-.001l.001.272c0 1.595-2.032 3.43-4.538 4.098-2.506.668-4.538-.083-4.538-1.678 0-1.594 2.032-3.43 4.538-4.098.914-.244 2.032-.565 2.888-.603V4.516L49.076 7.447v9.556A1.014 1.014 0 0 0 49 17h-1.574zM29.5 17h-8.343a7.073 7.073 0 1 0-4.657 4.06v3.781H3.3a2.803 2.803 0 0 1-2.8-2.804V8.63a2.803 2.803 0 0 1 2.8-2.805h4.082L8.58 2.768A1.994 1.994 0 0 1 10.435 1.5h8.985c.773 0 1.477.448 1.805 1.149l1.488 3.177H26.7c1.546 0 2.8 1.256 2.8 2.805V17zm-11.637 0H17.5a1 1 0 0 0-1 1v.05A4.244 4.244 0 1 1 17.863 17zm29.684 2c.97 0 .953-.048.953.889v20.743c0 .953.016.905-.953.905H19.453c-.97 0-.953.048-.953-.905V19.89c0-.937-.016-.889.97-.889h28.077zm-4.701 19.338V22.183H24.154v16.155h18.692zM20.6 21.375v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616v-1.616H20.6zm0 3.231v1.616h1.616V37.53H20.6zm24.233-16.155v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615v-1.616h-1.615zm0 3.231v1.616h1.615V37.53h-1.615zM29.485 25.283a.4.4 0 0 1 .593-.35l9.05 4.977a.4.4 0 0 1 0 .701l-9.05 4.978a.4.4 0 0 1-.593-.35v-9.956z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const wg="0 0 64 42";class vg{constructor(e,t){const n=t.providers,i=t.extraProviders||[],o=new Set(t.removeProviders),r=n.concat(i).filter(l=>{const a=l.name;return a?!o.has(a):($("media-embed-no-provider-name",{provider:l}),!1)});this.locale=e,this.providerDefinitions=r}hasMedia(e){return!!this._getMedia(e)}getMediaViewElement(e,t,n){return this._getMedia(t).getViewElement(e,n)}_getMedia(e){if(!e)return new es(this.locale);e=e.trim();for(const t of this.providerDefinitions){const n=t.html,i=ie(t.url);for(const o of i){const r=this._getUrlMatches(e,o);if(r)return new es(this.locale,e,r,n)}}return null}_getUrlMatches(e,t){let n=e.match(t);if(n)return n;let i=e.replace(/^https?:\/\//,"");return n=i.match(t),n||(i=i.replace(/^www\./,""),n=i.match(t),n)?n:null}}class es{constructor(e,t,n,i){this.url=this._getValidUrl(t),this._locale=e,this._match=n,this._previewRenderer=i}getViewElement(e,t){const n={};let i;if(t.renderForEditingView||t.renderMediaPreview&&this.url&&this._previewRenderer){this.url&&(n["data-oembed-url"]=this.url),t.renderForEditingView&&(n.class="ck-media__wrapper");const o=this._getPreviewHtml(t);i=e.createRawElement("div",n,(r,l)=>{l.setContentOf(r,o)})}else this.url&&(n.url=this.url),i=e.createEmptyElement(t.elementName,n);return e.setCustomProperty("media-content",!0,i),i}_getPreviewHtml(e){return this._previewRenderer?this._previewRenderer(this._match):this.url&&e.renderForEditingView?this._getPlaceholderHtml():""}_getPlaceholderHtml(){const e=new sl,t=this._locale.t;return e.content=bg,e.viewBox=wg,new dt({tag:"div",attributes:{class:"ck ck-reset_all ck-media__placeholder"},children:[{tag:"div",attributes:{class:"ck-media__placeholder__icon"},children:[e]},{tag:"a",attributes:{class:"ck-media__placeholder__url",target:"_blank",rel:"noopener noreferrer",href:this.url,"data-cke-tooltip-text":t("Open media in new tab")},children:[{tag:"span",attributes:{class:"ck-media__placeholder__url__text"},children:[this.url]}]}]}).render().outerHTML}_getValidUrl(e){return e?e.match(/^https?/)?e:"https://"+e:null}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class wt extends f{static get pluginName(){return"MediaEmbedEditing"}constructor(e){super(e),e.config.define("mediaEmbed",{elementName:"oembed",providers:[{name:"dailymotion",url:[/^dailymotion\.com\/video\/(\w+)/,/^dai.ly\/(\w+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; "><iframe src="https://www.dailymotion.com/embed/video/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" width="480" height="270" allowfullscreen allow="autoplay"></iframe></div>`},{name:"spotify",url:[/^open\.spotify\.com\/(artist\/\w+)/,/^open\.spotify\.com\/(album\/\w+)/,/^open\.spotify\.com\/(track\/\w+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 126%;"><iframe src="https://open.spotify.com/embed/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe></div>`},{name:"youtube",url:[/^(?:m\.)?youtube\.com\/watch\?v=([\w-]+)(?:&t=(\d+))?/,/^(?:m\.)?youtube\.com\/v\/([\w-]+)(?:\?t=(\d+))?/,/^youtube\.com\/embed\/([\w-]+)(?:\?start=(\d+))?/,/^youtu\.be\/([\w-]+)(?:\?t=(\d+))?/],html:t=>{const n=t[1],i=t[2];return`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;"><iframe src="https://www.youtube.com/embed/${n}${i?`?start=${i}`:""}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>`}},{name:"vimeo",url:[/^vimeo\.com\/(\d+)/,/^vimeo\.com\/[^/]+\/[^/]+\/video\/(\d+)/,/^vimeo\.com\/album\/[^/]+\/video\/(\d+)/,/^vimeo\.com\/channels\/[^/]+\/(\d+)/,/^vimeo\.com\/groups\/[^/]+\/videos\/(\d+)/,/^vimeo\.com\/ondemand\/[^/]+\/(\d+)/,/^player\.vimeo\.com\/video\/(\d+)/],html:t=>`<div style="position: relative; padding-bottom: 100%; height: 0; padding-bottom: 56.2493%;"><iframe src="https://player.vimeo.com/video/${t[1]}" style="position: absolute; width: 100%; height: 100%; top: 0; left: 0;" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe></div>`},{name:"instagram",url:/^instagram\.com\/p\/(\w+)/},{name:"twitter",url:/^twitter\.com/},{name:"googleMaps",url:[/^google\.com\/maps/,/^goo\.gl\/maps/,/^maps\.google\.com/,/^maps\.app\.goo\.gl/]},{name:"flickr",url:/^flickr\.com/},{name:"facebook",url:/^facebook\.com/}]}),this.registry=new vg(e.locale,e.config.get("mediaEmbed"))}init(){const e=this.editor,t=e.model.schema,n=e.t,i=e.conversion,o=e.config.get("mediaEmbed.previewsInData"),r=e.config.get("mediaEmbed.elementName"),l=this.registry;e.commands.add("mediaEmbed",new gg(e)),t.register("media",{inheritAllFrom:"$blockObject",allowAttributes:["url"]}),i.for("dataDowncast").elementToStructure({model:"media",view:(a,{writer:c})=>{const d=a.getAttribute("url");return Yi(c,l,d,{elementName:r,renderMediaPreview:!!d&&o})}}),i.for("dataDowncast").add(Xi(l,{elementName:r,renderMediaPreview:o})),i.for("editingDowncast").elementToStructure({model:"media",view:(a,{writer:c})=>{const d=a.getAttribute("url"),u=Yi(c,l,d,{elementName:r,renderForEditingView:!0});return hg(u,c,n("media widget"))}}),i.for("editingDowncast").add(Xi(l,{elementName:r,renderForEditingView:!0})),i.for("upcast").elementToElement({view:a=>["oembed",r].includes(a.name)&&a.getAttribute("url")?{name:!0}:null,model:(a,{writer:c})=>{const d=a.getAttribute("url");return l.hasMedia(d)?c.createElement("media",{url:d}):null}}).elementToElement({view:{name:"div",attributes:{"data-oembed-url":!0}},model:(a,{writer:c})=>{const d=a.getAttribute("data-oembed-url");return l.hasMedia(d)?c.createElement("media",{url:d}):null}}).add(a=>{const c=(d,u,m)=>{if(!m.consumable.consume(u.viewItem,{name:!0,classes:"media"}))return;const{modelRange:h,modelCursor:g}=m.convertChildren(u.viewItem,u.modelCursor);u.modelRange=h,u.modelCursor=g,M(h.getItems())||m.consumable.revert(u.viewItem,{name:!0,classes:"media"})};a.on("element:figure",c)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Cg=/^(?:http(s)?:\/\/)?[\w-]+\.[\w-.~:/?#[\]@!$&'()*+,;=%]+$/;class kg extends f{static get requires(){return[po,re,wo]}static get pluginName(){return"AutoMediaEmbed"}constructor(e){super(e),this._timeoutId=null,this._positionToInsert=null}init(){const e=this.editor,t=e.model.document,n=e.plugins.get("ClipboardPipeline");this.listenTo(n,"inputTransformation",()=>{const o=t.selection.getFirstRange(),r=St.fromPosition(o.start);r.stickiness="toPrevious";const l=St.fromPosition(o.end);l.stickiness="toNext",t.once("change:data",()=>{this._embedMediaBetweenPositions(r,l),r.detach(),l.detach()},{priority:"high"})}),e.commands.get("undo").on("execute",()=>{this._timeoutId&&(A.window.clearTimeout(this._timeoutId),this._positionToInsert.detach(),this._timeoutId=null,this._positionToInsert=null)},{priority:"high"})}_embedMediaBetweenPositions(e,t){const n=this.editor,i=n.plugins.get(wt).registry,o=new ke(e,t),r=o.getWalker({ignoreElementEnd:!0});let l="";for(const c of r)c.item.is("$textProxy")&&(l+=c.item.data);if(l=l.trim(),!l.match(Cg)){o.detach();return}if(!i.hasMedia(l)){o.detach();return}if(!n.commands.get("mediaEmbed").isEnabled){o.detach();return}this._positionToInsert=St.fromPosition(e),this._timeoutId=A.window.setTimeout(()=>{n.model.change(c=>{this._timeoutId=null,c.remove(o),o.detach();let d=null;this._positionToInsert.root.rootName!=="$graveyard"&&(d=this._positionToInsert),sr(n.model,l,d,!1),this._positionToInsert.detach(),this._positionToInsert=null}),n.plugins.get(re).requestUndoOnBackspace()},100)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class yg extends T{constructor(e,t){super(t);const n=t.t;this.focusTracker=new X,this.keystrokes=new ne,this.set("mediaURLInputValue",""),this.urlInputView=this._createUrlInput(),this.saveButtonView=this._createButton(n("Save"),C.check,"ck-button-save"),this.saveButtonView.type="submit",this.saveButtonView.bind("isEnabled").to(this,"mediaURLInputValue",i=>!!i),this.cancelButtonView=this._createButton(n("Cancel"),C.cancel,"ck-button-cancel","cancel"),this._focusables=new de,this._focusCycler=new ue({focusables:this._focusables,focusTracker:this.focusTracker,keystrokeHandler:this.keystrokes,actions:{focusPrevious:"shift + tab",focusNext:"tab"}}),this._validators=e,this.setTemplate({tag:"form",attributes:{class:["ck","ck-media-form","ck-responsive-form"],tabindex:"-1"},children:[this.urlInputView,this.saveButtonView,this.cancelButtonView]})}render(){super.render(),kt({view:this}),[this.urlInputView,this.saveButtonView,this.cancelButtonView].forEach(n=>{this._focusables.add(n),this.focusTracker.add(n.element)}),this.keystrokes.listenTo(this.element);const t=n=>n.stopPropagation();this.keystrokes.set("arrowright",t),this.keystrokes.set("arrowleft",t),this.keystrokes.set("arrowup",t),this.keystrokes.set("arrowdown",t)}destroy(){super.destroy(),this.focusTracker.destroy(),this.keystrokes.destroy()}focus(){this._focusCycler.focusFirst()}get url(){return this.urlInputView.fieldView.element.value.trim()}set url(e){this.urlInputView.fieldView.element.value=e.trim()}isValid(){this.resetFormStatus();for(const e of this._validators){const t=e(this);if(t)return this.urlInputView.errorText=t,!1}return!0}resetFormStatus(){this.urlInputView.errorText=null,this.urlInputView.infoText=this._urlInputViewInfoDefault}_createUrlInput(){const e=this.locale.t,t=new ze(this.locale,He),n=t.fieldView;return this._urlInputViewInfoDefault=e("Paste the media URL in the input."),this._urlInputViewInfoTip=e("Tip: Paste the URL into the content to embed faster."),t.label=e("Media URL"),t.infoText=this._urlInputViewInfoDefault,n.on("input",()=>{t.infoText=n.element.value?this._urlInputViewInfoTip:this._urlInputViewInfoDefault,this.mediaURLInputValue=n.element.value.trim()}),t}_createButton(e,t,n,i){const o=new y(this.locale);return o.set({label:e,icon:t,tooltip:!0}),o.extendTemplate({attributes:{class:n}}),i&&o.delegate("execute").to(this,i),o}}const _g='<svg viewBox="0 0 22 20" xmlns="http://www.w3.org/2000/svg"><path d="M1.587 1.5c-.612 0-.601-.029-.601.551v14.84c0 .59-.01.559.591.559h18.846c.602 0 .591.03.591-.56V2.052c0-.58.01-.55-.591-.55H1.587Zm.701.971h1.003v1H2.288v-1Zm16.448 0h1.003v1h-1.003v-1Zm-14.24 1h13.008v12H4.467l.029-12Zm-2.208 1h1.003v1H2.288v-1Zm16.448 0h1.003v1h-1.003v-1Zm-16.448 2h1.003v1H2.288v-1Zm16.448 0h1.003v1h-1.003v-1Zm-16.448 2h1.003v1H2.288v-1Zm16.448 0h1.003v1h-1.003v-1Zm-16.448 2h1.003v1H2.288v-1Zm16.448 0h1.003v1h-1.003v-1Zm-16.448 2h1.003l-.029 1h-.974v-1Zm16.448 0h1.003v1h-1.003v-1Zm-16.448 2h.974v1h-.974v-1Zm16.448 0h1.003v1h-1.003v-1Z"/><path d="M8.374 6.648a.399.399 0 0 1 .395-.4.402.402 0 0 1 .2.049l5.148 2.824a.4.4 0 0 1 0 .7l-5.148 2.824a.403.403 0 0 1-.595-.35V6.648Z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ig extends f{static get requires(){return[wt]}static get pluginName(){return"MediaEmbedUI"}init(){const e=this.editor,t=e.commands.get("mediaEmbed");e.ui.componentFactory.add("mediaEmbed",n=>{const i=W(n);return this._setUpDropdown(i,t),i})}_setUpDropdown(e,t){const n=this.editor,i=n.t,o=e.buttonView,r=n.plugins.get(wt).registry;e.once("change:isOpen",()=>{const l=new(Cn(yg))(Tg(n.t,r),n.locale);e.panelView.children.add(l),o.on("open",()=>{l.disableCssTransitions(),l.url=t.value||"",l.urlInputView.fieldView.select(),l.enableCssTransitions()},{priority:"low"}),e.on("submit",()=>{l.isValid()&&(n.execute("mediaEmbed",l.url),n.editing.view.focus())}),e.on("change:isOpen",()=>l.resetFormStatus()),e.on("cancel",()=>{n.editing.view.focus()}),l.delegate("submit","cancel").to(e),l.urlInputView.fieldView.bind("value").to(t,"value"),l.urlInputView.bind("isEnabled").to(t,"isEnabled")}),e.bind("isEnabled").to(t),o.set({label:i("Insert media"),icon:_g,tooltip:!0})}}function Tg(s,e){return[t=>{if(!t.url.length)return s("The URL must not be empty.")},t=>{if(!e.hasMedia(t.url))return s("This media URL is not supported.")}]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Eg extends f{static get requires(){return[wt,Ig,kg,Ge]}static get pluginName(){return"MediaEmbed"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Ag(s,e){if(!s.childCount)return;const t=new se(s.document),n=xg(s,t);if(!n.length)return;let i=null,o=1;n.forEach((r,l)=>{const a=Mg(n[l-1],r),c=a?null:n[l-1],d=Og(c,r);if(a&&(i=null,o=1),!i||d!==0){const m=Rg(r,e);if(!i)i=ts(m,r.element,t);else if(r.indent>o){const h=i.getChild(i.childCount-1),g=h.getChild(h.childCount-1);i=ts(m,g,t),o+=1}else if(r.indent<o){const h=o-r.indent;i=Ng(i,h),o=r.indent}r.indent<=o&&(i.is("element",m.type)||(i=t.rename(m.type,i)))}const u=Lg(r.element,t);t.appendChild(u,i)})}function Sg(s,e){for(const t of e.createRangeIn(s)){const n=t.item;if(n.is("element","li")){const i=n.getChild(0);i&&i.is("element","p")&&e.unwrapElement(i)}}}function xg(s,e){const t=e.createRangeIn(s),n=new Ie({name:/^p|h\d+$/,styles:{"mso-list":/.*/}}),i=[];for(const o of t)if(o.type==="elementStart"&&n.match(o.item)){const r=Dg(o.item);i.push({element:o.item,id:r.id,order:r.order,indent:r.indent})}return i}function Rg(s,e){const t=new RegExp(`@list l${s.id}:level${s.indent}\\s*({[^}]*)`,"gi"),n=/mso-level-number-format:([^;]{0,100});/gi,i=/mso-level-start-at:\s{0,100}([0-9]{0,10})\s{0,100};/gi,o=t.exec(e);let r="decimal",l="ol",a=null;if(o&&o[1]){const c=n.exec(o[1]);if(c&&c[1]&&(r=c[1].trim(),l=r!=="bullet"&&r!=="image"?"ol":"ul"),r==="bullet"){const d=Vg(s.element);d&&(r=d)}else{const d=i.exec(o[1]);d&&d[1]&&(a=parseInt(d[1]))}}return{type:l,startIndex:a,style:Bg(r)}}function Vg(s){const e=Pg(s);if(!e)return null;const t=e._data;return t==="o"?"circle":t===""?"disc":t===""?"square":null}function Pg(s){if(s.getChild(0).is("$text"))return null;for(const e of s.getChildren()){if(!e.is("element","span"))continue;const t=e.getChild(0);if(t)return t.is("$text")?t:t.getChild(0)}/* istanbul ignore next -- @preserve */return null}function Bg(s){if(s.startsWith("arabic-leading-zero"))return"decimal-leading-zero";switch(s){case"alpha-upper":return"upper-alpha";case"alpha-lower":return"lower-alpha";case"roman-upper":return"upper-roman";case"roman-lower":return"lower-roman";case"circle":case"disc":case"square":return s;default:return null}}function ts(s,e,t){const n=e.parent,i=t.createElement(s.type),o=n.getChildIndex(e)+1;return t.insertChild(o,i,n),s.style&&t.setStyle("list-style-type",s.style,i),s.startIndex&&s.startIndex>1&&t.setAttribute("start",s.startIndex,i),i}function Lg(s,e){return Fg(s,e),e.removeStyle("text-indent",s),e.rename("li",s)}function Dg(s){const e={},t=s.getStyle("mso-list");if(t){const n=t.match(/(^|\s{1,100})l(\d+)/i),i=t.match(/\s{0,100}lfo(\d+)/i),o=t.match(/\s{0,100}level(\d+)/i);n&&i&&o&&(e.id=n[2],e.order=i[1],e.indent=parseInt(o[1]))}return e}function Fg(s,e){const t=new Ie({name:"span",styles:{"mso-list":"Ignore"}}),n=e.createRangeIn(s);for(const i of n)i.type==="elementStart"&&t.match(i.item)&&e.remove(i.item)}function Mg(s,e){if(!s)return!0;if(s.id!==e.id)return e.indent-s.indent!==1;const t=e.element.previousSibling;return t?!Ug(t):!0}function Ug(s){return s.is("element","ol")||s.is("element","ul")}function Og(s,e){return s?e.indent-s.indent:e.indent-1}function Ng(s,e){const t=s.getAncestors({parentFirst:!0});let n=null,i=0;for(const o of t)if((o.is("element","ul")||o.is("element","ol"))&&i++,i===e){n=o;break}return n}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function zg(s,e){if(!s.childCount)return;const t=new se(s.document),n=$g(s,t);Wg(n,s,t),Gg(n,s,t),qg(s,t);const i=jg(s,t);i.length&&Qg(i,Kg(e),t)}function Hg(s){return btoa(s.match(/\w{2}/g).map(e=>String.fromCharCode(parseInt(e,16))).join(""))}function $g(s,e){const t=e.createRangeIn(s),n=new Ie({name:/v:(.+)/}),i=[];for(const o of t){if(o.type!="elementStart")continue;const r=o.item,l=r.previousSibling,a=l&&l.is("element")?l.name:null,c=["Chart"],d=n.match(r),u=r.getAttribute("o:gfxdata"),m=a==="v:shapetype",h=u&&c.some(g=>r.getAttribute("id").includes(g));d&&u&&!m&&!h&&i.push(o.item.getAttribute("id"))}return i}function Wg(s,e,t){const n=t.createRangeIn(e),i=new Ie({name:"img"}),o=[];for(const r of n)if(r.item.is("element")&&i.match(r.item)){const l=r.item,a=l.getAttribute("v:shapes")?l.getAttribute("v:shapes").split(" "):[];a.length&&a.every(c=>s.indexOf(c)>-1)?o.push(l):l.getAttribute("src")||o.push(l)}for(const r of o)t.remove(r)}function qg(s,e){const t=e.createRangeIn(s),n=new Ie({name:/v:(.+)/}),i=[];for(const o of t)o.type=="elementStart"&&n.match(o.item)&&i.push(o.item);for(const o of i)e.remove(o)}function Gg(s,e,t){const n=t.createRangeIn(e),i=[];for(const l of n)if(l.type=="elementStart"&&l.item.is("element","v:shape")){const a=l.item.getAttribute("id");if(s.includes(a))continue;o(l.item.parent.getChildren(),a)||i.push(l.item)}for(const l of i){const a={src:r(l)};l.hasAttribute("alt")&&(a.alt=l.getAttribute("alt"));const c=t.createElement("img",a);t.insertChild(l.index+1,c,l.parent)}function o(l,a){for(const c of l){/* istanbul ignore else -- @preserve */if(c.is("element")&&(c.name=="img"&&c.getAttribute("v:shapes")==a||o(c.getChildren(),a)))return!0}return!1}function r(l){for(const a of l.getChildren()){/* istanbul ignore else -- @preserve */if(a.is("element")&&a.getAttribute("src"))return a.getAttribute("src")}}}function jg(s,e){const t=e.createRangeIn(s),n=new Ie({name:"img"}),i=[];for(const o of t)o.item.is("element")&&n.match(o.item)&&o.item.getAttribute("src").startsWith("file://")&&i.push(o.item);return i}function Kg(s){if(!s)return[];const e=/{\\pict[\s\S]+?\\bliptag-?\d+(\\blipupi-?\d+)?({\\\*\\blipuid\s?[\da-fA-F]+)?[\s}]*?/,t=new RegExp("(?:("+e.source+"))([\\da-fA-F\\s]+)\\}","g"),n=s.match(t),i=[];if(n)for(const o of n){let r=!1;o.includes("\\pngblip")?r="image/png":o.includes("\\jpegblip")&&(r="image/jpeg"),r&&i.push({hex:o.replace(e,"").replace(/[^\da-fA-F]/g,""),type:r})}return i}function Qg(s,e,t){if(s.length===e.length)for(let n=0;n<s.length;n++){const i=`data:${e[n].type};base64,${Hg(e[n].hex)}`;t.setAttribute("src",i,s[n])}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Zg(s){const e=[],t=new se(s.document);for(const{item:n}of t.createRangeIn(s))if(n.is("element")){for(const i of n.getClassNames())/\bmso/gi.exec(i)&&t.removeClass(i,n);for(const i of n.getStyleNames())/\bmso/gi.exec(i)&&t.removeStyle(i,n);n.is("element","w:sdt")&&e.push(n)}for(const n of e){const i=n.parent,o=i.getChildIndex(n);t.insertChild(o,n.getChildren(),i),t.remove(n)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const Xg=/<meta\s*name="?generator"?\s*content="?microsoft\s*word\s*\d+"?\/?>/i,Yg=/xmlns:o="urn:schemas-microsoft-com/i;class Jg{constructor(e){this.document=e}isActive(e){return Xg.test(e)||Yg.test(e)}execute(e){const{body:t,stylesString:n}=e._parsedData;Ag(t,n),zg(t,e.dataTransfer.getData("text/rtf")),Zg(t),e.content=t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ef(s,e){for(const t of s.getChildren())if(t.is("element","b")&&t.getStyle("font-weight")==="normal"){const n=s.getChildIndex(t);e.remove(t),e.insertChild(n,t.getChildren(),s)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function tf(s,e){const t=new Us(e.document.stylesProcessor),n=new Os(t,{renderingMode:"data"}),i=n.blockElements,o=n.inlineObjectElements,r=[];for(const l of e.createRangeIn(s)){const a=l.item;if(a.is("element","br")){const c=ns(a,"forward",e,{blockElements:i,inlineObjectElements:o}),d=ns(a,"backward",e,{blockElements:i,inlineObjectElements:o}),u=is(c,i);(is(d,i)||u)&&r.push(a)}}for(const l of r)l.hasClass("Apple-interchange-newline")?e.remove(l):e.replace(l,e.createElement("p"))}function ns(s,e,t,{blockElements:n,inlineObjectElements:i}){let o=t.createPositionAt(s,e=="forward"?"after":"before");return o=o.getLastMatchingPosition(({item:r})=>r.is("element")&&!n.includes(r.name)&&!i.includes(r.name),{direction:e}),e=="forward"?o.nodeAfter:o.nodeBefore}function is(s,e){return!!s&&s.is("element")&&e.includes(s.name)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const nf=/id=("|')docs-internal-guid-[-0-9a-f]+("|')/i;class sf{constructor(e){this.document=e}isActive(e){return nf.test(e)}execute(e){const t=new se(this.document),{body:n}=e._parsedData;ef(n,t),Sg(n,t),tf(n,t),e.content=n}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function of(s,e){for(const t of s.getChildren())t.is("element","table")&&t.hasAttribute("xmlns")&&e.removeAttribute("xmlns",t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function rf(s,e){for(const t of s.getChildren())if(t.is("element","google-sheets-html-origin")){const n=s.getChildIndex(t);e.remove(t),e.insertChild(n,t.getChildren(),s)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function lf(s,e){for(const t of s.getChildren())t.is("element","table")&&t.getStyle("width")==="0px"&&e.removeStyle("width",t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function af(s,e){for(const t of Array.from(s.getChildren()))t.is("element","style")&&e.remove(t)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const cf=/<google-sheets-html-origin/i;class df{constructor(e){this.document=e}isActive(e){return cf.test(e)}execute(e){const t=new se(this.document),{body:n}=e._parsedData;rf(n,t),of(n,t),lf(n,t),af(n,t),e.content=n}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function uf(s){return ss(ss(s)).replace(/(<span\s+style=['"]mso-spacerun:yes['"]>[^\S\r\n]*?)[\r\n]+([^\S\r\n]*<\/span>)/g,"$1$2").replace(/<span\s+style=['"]mso-spacerun:yes['"]><\/span>/g,"").replace(/(<span\s+style=['"]letter-spacing:[^'"]+?['"]>)[\r\n]+(<\/span>)/g,"$1 $2").replace(/ <\//g,"</").replace(/ <o:p><\/o:p>/g,"<o:p></o:p>").replace(/<o:p>(&nbsp;|\u00A0)<\/o:p>/g,"").replace(/>([^\S\r\n]*[\r\n]\s*)</g,"><")}function mf(s){s.querySelectorAll("span[style*=spacerun]").forEach(e=>{const t=e,n=t.innerText.length||0;t.innerText=Array(n+1).join(" ").substr(0,n)})}function ss(s){return s.replace(/<span(?: class="Apple-converted-space"|)>(\s+)<\/span>/g,(e,t)=>t.length===1?" ":Array(t.length+1).join(" ").substr(0,t.length))}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function hf(s,e){const t=new DOMParser;s=s.replace(/<!--\[if gte vml 1]>/g,""),s=s.replace(/<o:SmartTagType(?:\s+[^\s>=]+(?:="[^"]*")?)*\s*\/?>/gi,"");const n=uf(pf(s)),i=t.parseFromString(n,"text/html");mf(i);const o=i.body.innerHTML,r=gf(i,e),l=ff(i);return{body:r,bodyString:o,styles:l.styles,stylesString:l.stylesString}}function gf(s,e){const t=new Us(e),n=new Os(t,{renderingMode:"data"}),i=s.createDocumentFragment(),o=s.body.childNodes;for(;o.length>0;)i.appendChild(o[0]);return n.domToView(i,{skipComments:!0})}function ff(s){const e=[],t=[],n=Array.from(s.getElementsByTagName("style"));for(const i of n)i.sheet&&i.sheet.cssRules&&i.sheet.cssRules.length&&(e.push(i.sheet),t.push(i.innerHTML));return{styles:e,stylesString:t.join(" ")}}function pf(s){const e="</body>",t="</html>",n=s.indexOf(e);if(n<0)return s;const i=s.indexOf(t,n+e.length);return s.substring(0,n+e.length)+(i>=0?s.substring(i):"")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class bf extends f{static get pluginName(){return"PasteFromOffice"}static get requires(){return[q]}init(){const e=this.editor,t=e.plugins.get("ClipboardPipeline"),n=e.editing.view.document,i=[];i.push(new Jg(n)),i.push(new sf(n)),i.push(new df(n)),t.on("inputTransformation",(o,r)=>{if(r._isTransformedWithPasteFromOffice||e.model.document.selection.getFirstPosition().parent.is("element","codeBlock"))return;const a=r.dataTransfer.getData("text/html"),c=i.find(d=>d.isActive(a));c&&(r._parsedData||(r._parsedData=hf(a,n.stylesProcessor)),c.execute(r),r._isTransformedWithPasteFromOffice=!0)},{priority:"high"})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function E(s,e,t,n,i=1){e!=null&&i!==void 0&&i!==null&&e>i?n.setAttribute(s,e,t):n.removeAttribute(s,t)}function he(s,e,t={}){const n=s.createElement("tableCell",t);return s.insertElement("paragraph",n),s.insert(n,e),n}function ln(s,e){const t=e.parent.parent,n=parseInt(t.getAttribute("headingColumns")||"0"),{column:i}=s.getCellLocation(e);return!!n&&i<n}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function wf(){return s=>{s.on("element:figure",(e,t,n)=>{if(!n.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;const i=kf(t.viewItem);if(!i||!n.consumable.test(i,{name:!0}))return;n.consumable.consume(t.viewItem,{name:!0,classes:"table"});const o=n.convertItem(i,t.modelCursor),r=M(o.modelRange.getItems());if(!r){n.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}n.convertChildren(t.viewItem,n.writer.createPositionAt(r,"end")),n.updateConversionResult(r,t)})}}function vf(){return s=>{s.on("element:table",(e,t,n)=>{const i=t.viewItem;if(!n.consumable.test(i,{name:!0}))return;const{rows:o,headingRows:r,headingColumns:l}=yf(i),a={};l&&(a.headingColumns=l),r&&(a.headingRows=r);const c=n.writer.createElement("table",a);if(n.safeInsert(c,t.modelCursor)){if(n.consumable.consume(i,{name:!0}),o.forEach(d=>n.convertItem(d,n.writer.createPositionAt(c,"end"))),n.convertChildren(i,n.writer.createPositionAt(c,"end")),c.isEmpty){const d=n.writer.createElement("tableRow");n.writer.insert(d,n.writer.createPositionAt(c,"end")),he(n.writer,n.writer.createPositionAt(d,"end"))}n.updateConversionResult(c,t)}})}}function Cf(){return s=>{s.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&t.modelCursor.index==0&&e.stop()},{priority:"high"})}}function os(s){return e=>{e.on(`element:${s}`,(t,n,{writer:i})=>{if(!n.modelRange)return;const o=n.modelRange.start.nodeAfter,r=i.createPositionAt(o,0);if(n.viewItem.isEmpty){i.insertElement("paragraph",r);return}const l=Array.from(o.getChildren());if(l.every(a=>a.is("element","$marker"))){const a=i.createElement("paragraph");i.insert(a,i.createPositionAt(o,0));for(const c of l)i.move(i.createRangeOn(c),i.createPositionAt(a,"end"))}},{priority:"low"})}}function kf(s){for(const e of s.getChildren())if(e.is("element","table"))return e}function yf(s){let e=0,t;const n=[],i=[];let o;for(const r of Array.from(s.getChildren())){if(r.name!=="tbody"&&r.name!=="thead"&&r.name!=="tfoot")continue;r.name==="thead"&&!o&&(o=r);const l=Array.from(r.getChildren()).filter(a=>a.is("element","tr"));for(const a of l)if(o&&r===o||r.name==="tbody"&&Array.from(a.getChildren()).length&&Array.from(a.getChildren()).every(c=>c.is("element","th")))e++,n.push(a);else{i.push(a);const c=_f(a);(!t||c<t)&&(t=c)}}return{headingRows:e,headingColumns:t||0,rows:[...n,...i]}}function _f(s){let e=0,t=0;const n=Array.from(s.getChildren()).filter(i=>i.name==="th"||i.name==="td");for(;t<n.length&&n[t].name==="th";){const i=n[t],o=parseInt(i.getAttribute("colspan")||"1");e=e+o,t++}return e}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class _{constructor(e,t={}){this._jumpedToStartRow=!1,this._table=e,this._startRow=t.row!==void 0?t.row:t.startRow||0,this._endRow=t.row!==void 0?t.row:t.endRow,this._startColumn=t.column!==void 0?t.column:t.startColumn||0,this._endColumn=t.column!==void 0?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();const e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0,value:void 0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null;const n=this._getSpanned();if(n)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(n.cell,n.row,n.column));else{const i=e.getChild(this._cellIndex);if(!i)return this._advanceToNextRow();const o=parseInt(i.getAttribute("colspan")||"1"),r=parseInt(i.getAttribute("rowspan")||"1");(o>1||r>1)&&this._recordSpans(i,r,o),this._shouldSkipSlot()||(t=this._formatOutValue(i)),this._nextCellAtColumn=this._column+o}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return this._endRow!==void 0&&this._row>this._endRow}_isOverEndColumn(){return this._endColumn!==void 0&&this._column>this._endColumn}_formatOutValue(e,t=this._row,n=this._column){return{done:!1,value:new If(this,e,t,n)}}_shouldSkipSlot(){const e=this._skipRows.has(this._row),t=this._row<this._startRow,n=this._column<this._startColumn,i=this._endColumn!==void 0&&this._column>this._endColumn;return e||t||n||i}_getSpanned(){const e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,n){const i={cell:e,row:this._row,column:this._column};for(let o=this._row;o<this._row+t;o++)for(let r=this._column;r<this._column+n;r++)(o!=this._row||r!=this._column)&&this._markSpannedCell(o,r,i)}_markSpannedCell(e,t,n){this._spannedCells.has(e)||this._spannedCells.set(e,new Map),this._spannedCells.get(e).set(t,n)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){const e=this._getRowLength(0);for(let t=this._startRow;!this._jumpedToStartRow;t--)e===this._getRowLength(t)&&(this._row=t,this._rowIndex=t,this._jumpedToStartRow=!0)}_getRowLength(e){return[...this._table.getChild(e).getChildren()].reduce((n,i)=>n+parseInt(i.getAttribute("colspan")||"1"),0)}}class If{constructor(e,t,n,i){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=n,this.cellAnchorColumn=i,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function rs(s,e){return(t,{writer:n})=>{const i=t.getAttribute("headingRows")||0,o=n.createContainerElement("table",null,[]),r=n.createContainerElement("figure",{class:"table"},o);i>0&&n.insert(n.createPositionAt(o,"end"),n.createContainerElement("thead",null,n.createSlot(l=>l.is("element","tableRow")&&l.index<i))),i<s.getRows(t)&&n.insert(n.createPositionAt(o,"end"),n.createContainerElement("tbody",null,n.createSlot(l=>l.is("element","tableRow")&&l.index>=i)));for(const{positionOffset:l,filter:a}of e.additionalSlots)n.insert(n.createPositionAt(o,l),n.createSlot(a));return n.insert(n.createPositionAt(o,"after"),n.createSlot(l=>l.is("element","tableRow")?!1:!e.additionalSlots.some(({filter:a})=>a(l)))),e.asWidget?Ef(r,n):r}}function Tf(){return(s,{writer:e})=>s.isEmpty?e.createEmptyElement("tr"):e.createContainerElement("tr")}function ls(s={}){return(e,{writer:t})=>{const n=e.parent,i=n.parent,o=i.getChildIndex(n),r=new _(i,{row:o}),l=i.getAttribute("headingRows")||0,a=i.getAttribute("headingColumns")||0;let c=null;for(const d of r)if(d.cell==e){const m=d.row<l||d.column<a?"th":"td";c=s.asWidget?Ls(t.createEditableElement(m),t):t.createContainerElement(m);break}return c}}function as(s={}){return(e,{writer:t})=>{if(!e.parent.is("element","tableCell")||!or(e))return null;if(s.asWidget)return t.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{const n=t.createContainerElement("p");return t.setCustomProperty("dataPipeline:transparentRendering",!0,n),n}}}function or(s){return s.parent.childCount==1&&!Af(s)}function Ef(s,e){return e.setCustomProperty("table",!0,s),wn(s,e,{hasSelectionHandle:!0})}function Af(s){return!s.getAttributeKeys().next().done}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Sf extends k{refresh(){const e=this.editor.model,t=e.document.selection,n=e.schema;this.isEnabled=xf(t,n)}execute(e={}){const t=this.editor,n=t.model,i=t.plugins.get("TableUtils"),o=t.config.get("table.defaultHeadings.rows"),r=t.config.get("table.defaultHeadings.columns");e.headingRows===void 0&&o&&(e.headingRows=o),e.headingColumns===void 0&&r&&(e.headingColumns=r),n.change(l=>{const a=i.createTable(l,e);n.insertObject(a,null,null,{findOptimalPosition:"auto"}),l.setSelection(l.createPositionAt(a.getNodeByPath([0,0,0]),0))})}}function xf(s,e){const t=s.getFirstPosition().parent,n=t===t.root?t:t.parent;return e.checkChild(n,"table")}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class cs extends k{constructor(e,t={}){super(e),this.order=t.order||"below"}refresh(){const e=this.editor.model.document.selection,n=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=n}execute(){const e=this.editor,t=e.model.document.selection,n=e.plugins.get("TableUtils"),i=this.order==="above",o=n.getSelectionAffectedTableCells(t),r=n.getRowIndexes(o),l=i?r.first:r.last,a=o[0].findAncestor("table");n.insertRows(a,{at:i?l:l+1,copyStructureFromAbove:!i})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ds extends k{constructor(e,t={}){super(e),this.order=t.order||"right"}refresh(){const e=this.editor.model.document.selection,n=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=n}execute(){const e=this.editor,t=e.model.document.selection,n=e.plugins.get("TableUtils"),i=this.order==="left",o=n.getSelectionAffectedTableCells(t),r=n.getColumnIndexes(o),l=i?r.first:r.last,a=o[0].findAncestor("table");n.insertColumns(a,{columns:1,at:i?l:l+1})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class us extends k{constructor(e,t={}){super(e),this.direction=t.direction||"horizontally"}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length===1}execute(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];this.direction==="horizontally"?e.splitCellHorizontally(t,2):e.splitCellVertically(t,2)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function rr(s,e,t){const{startRow:n,startColumn:i,endRow:o,endColumn:r}=e,l=t.createElement("table"),a=o-n+1;for(let d=0;d<a;d++)t.insertElement("tableRow",l,"end");const c=[...new _(s,{startRow:n,endRow:o,startColumn:i,endColumn:r,includeAllSlots:!0})];for(const{row:d,column:u,cell:m,isAnchor:h,cellAnchorRow:g,cellAnchorColumn:p}of c){const b=d-n,w=l.getChild(b);if(!h)(g<n||p<i)&&he(t,t.createPositionAt(w,"end"));else{const v=t.cloneElement(m);t.append(v,w),ur(v,d,u,o,r,t)}}return Rf(l,s,n,i,t),l}function lr(s,e,t=0){const n=[],i=new _(s,{startRow:t,endRow:e-1});for(const o of i){const{row:r,cellHeight:l}=o,a=r+l-1;r<e&&e<=a&&n.push(o)}return n}function ar(s,e,t){const n=s.parent,i=n.parent,o=n.index,r=parseInt(s.getAttribute("rowspan")),l=e-o,a={},c=r-l;c>1&&(a.rowspan=c);const d=parseInt(s.getAttribute("colspan")||"1");d>1&&(a.colspan=d);const u=o,m=u+l,h=[...new _(i,{startRow:u,endRow:m,includeAllSlots:!0})];let g=null,p;for(const b of h){const{row:w,column:v,cell:I}=b;I===s&&p===void 0&&(p=v),p!==void 0&&p===v&&w===m&&(g=he(t,b.getPositionBefore(),a))}return E("rowspan",l,s,t),g}function cr(s,e){const t=[],n=new _(s);for(const i of n){const{column:o,cellWidth:r}=i,l=o+r-1;o<e&&e<=l&&t.push(i)}return t}function dr(s,e,t,n){const i=parseInt(s.getAttribute("colspan")),o=t-e,r={},l=i-o;l>1&&(r.colspan=l);const a=parseInt(s.getAttribute("rowspan")||"1");a>1&&(r.rowspan=a);const c=he(n,n.createPositionAfter(s),r);return E("colspan",o,s,n),c}function ur(s,e,t,n,i,o){const r=parseInt(s.getAttribute("colspan")||"1"),l=parseInt(s.getAttribute("rowspan")||"1");if(t+r-1>i){const d=i-t+1;E("colspan",d,s,o,1)}if(e+l-1>n){const d=n-e+1;E("rowspan",d,s,o,1)}}function Rf(s,e,t,n,i){const o=parseInt(e.getAttribute("headingRows")||"0");if(o>0){const l=o-t;E("headingRows",l,s,i,0)}const r=parseInt(e.getAttribute("headingColumns")||"0");if(r>0){const l=r-n;E("headingColumns",l,s,i,0)}}function an(s,e){const t=e.getColumns(s),n=new Array(t).fill(0);for(const{column:o}of new _(s))n[o]++;const i=n.reduce((o,r,l)=>r?o:[...o,l],[]);if(i.length>0){const o=i[i.length-1];return e.removeColumns(s,{at:o}),!0}return!1}function cn(s,e){const t=[],n=e.getRows(s);for(let i=0;i<n;i++)s.getChild(i).isEmpty&&t.push(i);if(t.length>0){const i=t[t.length-1];return e.removeRows(s,{at:i}),!0}return!1}function Rn(s,e){an(s,e)||cn(s,e)}function mr(s,e){const t=Array.from(new _(s,{startColumn:e.firstColumn,endColumn:e.lastColumn,row:e.lastRow}));if(t.every(({cellHeight:o})=>o===1))return e.lastRow;const i=t[0].cellHeight-1;return e.lastRow+i}function hr(s,e){const t=Array.from(new _(s,{startRow:e.firstRow,endRow:e.lastRow,column:e.lastColumn}));if(t.every(({cellWidth:o})=>o===1))return e.lastColumn;const i=t[0].cellWidth-1;return e.lastColumn+i}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class lt extends k{constructor(e,t){super(e),this.direction=t.direction,this.isHorizontal=this.direction=="right"||this.direction=="left"}refresh(){const e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){const e=this.editor.model,t=e.document,i=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(t.selection)[0],o=this.value,r=this.direction;e.change(l=>{const a=r=="right"||r=="down",c=a?i:o,d=a?o:i,u=d.parent;Bf(d,c,l);const m=this.isHorizontal?"colspan":"rowspan",h=parseInt(i.getAttribute(m)||"1"),g=parseInt(o.getAttribute(m)||"1");l.setAttribute(m,h+g,c),l.setSelection(l.createRangeIn(c));const p=this.editor.plugins.get("TableUtils"),b=u.findAncestor("table");Rn(b,p)})}_getMergeableCell(){const t=this.editor.model.document,n=this.editor.plugins.get("TableUtils"),i=n.getTableCellsContainingSelection(t.selection)[0];if(!i)return;const o=this.isHorizontal?Vf(i,this.direction,n):Pf(i,this.direction,n);if(!o)return;const r=this.isHorizontal?"rowspan":"colspan",l=parseInt(i.getAttribute(r)||"1");if(parseInt(o.getAttribute(r)||"1")===l)return o}}function Vf(s,e,t){const i=s.parent.parent,o=e=="right"?s.nextSibling:s.previousSibling,r=(i.getAttribute("headingColumns")||0)>0;if(!o)return;const l=e=="right"?s:o,a=e=="right"?o:s,{column:c}=t.getCellLocation(l),{column:d}=t.getCellLocation(a),u=parseInt(l.getAttribute("colspan")||"1"),m=ln(t,l),h=ln(t,a);return r&&m!=h?void 0:c+u===d?o:void 0}function Pf(s,e,t){const n=s.parent,i=n.parent,o=i.getChildIndex(n);if(e=="down"&&o===t.getRows(i)-1||e=="up"&&o===0)return null;const r=parseInt(s.getAttribute("rowspan")||"1"),l=i.getAttribute("headingRows")||0,a=e=="down"&&o+r===l,c=e=="up"&&o===l;if(l&&(a||c))return null;const d=parseInt(s.getAttribute("rowspan")||"1"),u=e=="down"?o+d:o,m=[...new _(i,{endRow:u})],g=m.find(b=>b.cell===s).column,p=m.find(({row:b,cellHeight:w,column:v})=>v!==g?!1:e=="down"?b===u:u===b+w);return p&&p.cell?p.cell:null}function Bf(s,e,t){ms(s)||(ms(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(s),t.createPositionAt(e,"end"))),t.remove(s)}function ms(s){const e=s.getChild(0);return s.childCount==1&&e.is("element","paragraph")&&e.isEmpty}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Lf extends k{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),n=t[0];if(n){const i=n.findAncestor("table"),r=e.getRows(i)-1,l=e.getRowIndexes(t),a=l.first===0&&l.last===r;this.isEnabled=!a}else this.isEnabled=!1}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),n=t.getSelectionAffectedTableCells(e.document.selection),i=t.getRowIndexes(n),o=n[0],r=o.findAncestor("table"),l=t.getCellLocation(o).column;e.change(a=>{const c=i.last-i.first+1;t.removeRows(r,{at:i.first,rows:c});const d=Df(r,i.first,l,t.getRows(r));a.setSelection(a.createPositionAt(d,0))})}}function Df(s,e,t,n){const i=s.getChild(Math.min(e,n-1));let o=i.getChild(0),r=0;for(const l of i.getChildren()){if(r>t)return o;o=l,r+=parseInt(l.getAttribute("colspan")||"1")}return o}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ff extends k{refresh(){const e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),n=t[0];if(n){const i=n.findAncestor("table"),o=e.getColumns(i),{first:r,last:l}=e.getColumnIndexes(t);this.isEnabled=l-r<o-1}else this.isEnabled=!1}execute(){const e=this.editor.plugins.get("TableUtils"),[t,n]=Uf(this.editor.model.document.selection,e),i=t.parent.parent,o=[...new _(i)],r={first:o.find(a=>a.cell===t).column,last:o.find(a=>a.cell===n).column},l=Mf(o,t,n,r);this.editor.model.change(a=>{const c=r.last-r.first+1;e.removeColumns(i,{at:r.first,columns:c}),a.setSelection(a.createPositionAt(l,0))})}}function Mf(s,e,t,n){return parseInt(t.getAttribute("colspan")||"1")>1?t:e.previousSibling||t.nextSibling?t.nextSibling||e.previousSibling:n.first?s.reverse().find(({column:o})=>o<n.first).cell:s.reverse().find(({column:o})=>o>n.last).cell}function Uf(s,e){const t=e.getSelectionAffectedTableCells(s),n=t[0],i=t.pop(),o=[n,i];return n.isBefore(i)?o:o.reverse()}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Of extends k{refresh(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,n=e.getSelectionAffectedTableCells(t.document.selection),i=n.length>0;this.isEnabled=i,this.value=i&&n.every(o=>this._isInHeading(o,o.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),n=this.editor.model,i=t.getSelectionAffectedTableCells(n.document.selection),o=i[0].findAncestor("table"),{first:r,last:l}=t.getRowIndexes(i),a=this.value?r:l+1,c=o.getAttribute("headingRows")||0;n.change(d=>{if(a){const u=a>c?c:0,m=lr(o,a,u);for(const{cell:h}of m)ar(h,a,d)}E("headingRows",a,o,d,0)})}_isInHeading(e,t){const n=parseInt(t.getAttribute("headingRows")||"0");return!!n&&e.parent.index<n}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Nf extends k{refresh(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),n=t.getSelectionAffectedTableCells(e.document.selection),i=n.length>0;this.isEnabled=i,this.value=i&&n.every(o=>ln(t,o))}execute(e={}){if(e.forceValue===this.value)return;const t=this.editor.plugins.get("TableUtils"),n=this.editor.model,i=t.getSelectionAffectedTableCells(n.document.selection),o=i[0].findAncestor("table"),{first:r,last:l}=t.getColumnIndexes(i),a=this.value?r:l+1;n.change(c=>{if(a){const d=cr(o,a);for(const{cell:u,column:m}of d)dr(u,m,a,c)}E("headingColumns",a,o,c,0)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function zf(s){if(s.is("element","tableColumnGroup"))return s;const e=s.getChildren();return Array.from(e).find(t=>t.is("element","tableColumnGroup"))}function Hf(s){const e=zf(s);return e?Array.from(e.getChildren()):[]}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class P extends f{static get pluginName(){return"TableUtils"}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){const t=e.parent,n=t.parent,i=n.getChildIndex(t),o=new _(n,{row:i});for(const{cell:r,row:l,column:a}of o)if(r===e)return{row:l,column:a};/* istanbul ignore next -- @preserve */}createTable(e,t){const n=e.createElement("table"),i=t.rows||2,o=t.columns||2;return Wt(e,n,0,i,o),t.headingRows&&E("headingRows",Math.min(t.headingRows,i),n,e,0),t.headingColumns&&E("headingColumns",Math.min(t.headingColumns,o),n,e,0),n}insertRows(e,t={}){const n=this.editor.model,i=t.at||0,o=t.rows||1,r=t.copyStructureFromAbove!==void 0,l=t.copyStructureFromAbove?i-1:i,a=this.getRows(e),c=this.getColumns(e);if(i>a)throw new L("tableutils-insertrows-insert-out-of-range",this,{options:t});n.change(d=>{const u=e.getAttribute("headingRows")||0;if(u>i&&E("headingRows",u+o,e,d,0),!r&&(i===0||i===a)){Wt(d,e,i,o,c);return}const m=r?Math.max(i,l):i,h=new _(e,{endRow:m}),g=new Array(c).fill(1);for(const{row:p,column:b,cellHeight:w,cellWidth:v,cell:I}of h){const x=p+w-1,R=p<i&&i<=x,Ee=p<=l&&l<=x;R?(d.setAttribute("rowspan",w+o,I),g[b]=-v):r&&Ee&&(g[b]=v)}for(let p=0;p<o;p++){const b=d.createElement("tableRow");d.insert(b,e,i);for(let w=0;w<g.length;w++){const v=g[w],I=d.createPositionAt(b,"end");v>0&&he(d,I,v>1?{colspan:v}:void 0),w+=Math.abs(v)-1}}})}insertColumns(e,t={}){const n=this.editor.model,i=t.at||0,o=t.columns||1;n.change(r=>{const l=e.getAttribute("headingColumns");i<l&&r.setAttribute("headingColumns",l+o,e);const a=this.getColumns(e);if(i===0||a===i){for(const d of e.getChildren())d.is("element","tableRow")&&Ce(o,r,r.createPositionAt(d,i?"end":0));return}const c=new _(e,{column:i,includeAllSlots:!0});for(const d of c){const{row:u,cell:m,cellAnchorColumn:h,cellAnchorRow:g,cellWidth:p,cellHeight:b}=d;if(h<i){r.setAttribute("colspan",p+o,m);const w=g+b-1;for(let v=u;v<=w;v++)c.skipRow(v)}else Ce(o,r,d.getPositionBefore())}})}removeRows(e,t){const n=this.editor.model,i=t.rows||1,o=this.getRows(e),r=t.at,l=r+i-1;if(l>o-1)throw new L("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});n.change(a=>{const c={first:r,last:l},{cellsToMove:d,cellsToTrim:u}=qf(e,c);if(d.size){const m=l+1;Gf(e,m,d,a)}for(let m=l;m>=r;m--)a.remove(e.getChild(m));for(const{rowspan:m,cell:h}of u)E("rowspan",m,h,a);Wf(e,c,a),an(e,this)||cn(e,this)})}removeColumns(e,t){const n=this.editor.model,i=t.at,o=t.columns||1,r=t.at+o-1;n.change(l=>{$f(e,{first:i,last:r},l);const a=Hf(e);for(let c=r;c>=i;c--){for(const{cell:d,column:u,cellWidth:m}of[...new _(e)])u<=c&&m>1&&u+m>c?E("colspan",m-1,d,l):u===c&&l.remove(d);if(a[c]){const d=c===0?a[1]:a[c-1],u=parseFloat(a[c].getAttribute("columnWidth")),m=parseFloat(d.getAttribute("columnWidth"));l.remove(a[c]),l.setAttribute("columnWidth",u+m+"%",d)}}cn(e,this)||an(e,this)})}splitCellVertically(e,t=2){const n=this.editor.model,o=e.parent.parent,r=parseInt(e.getAttribute("rowspan")||"1"),l=parseInt(e.getAttribute("colspan")||"1");n.change(a=>{if(l>1){const{newCellsSpan:c,updatedSpan:d}=hs(l,t);E("colspan",d,e,a);const u={};c>1&&(u.colspan=c),r>1&&(u.rowspan=r);const m=l>t?t-1:l-1;Ce(m,a,a.createPositionAfter(e),u)}if(l<t){const c=t-l,d=[...new _(o)],{column:u}=d.find(({cell:p})=>p===e),m=d.filter(({cell:p,cellWidth:b,column:w})=>{const v=p!==e&&w===u,I=w<u&&w+b>u;return v||I});for(const{cell:p,cellWidth:b}of m)a.setAttribute("colspan",b+c,p);const h={};r>1&&(h.rowspan=r),Ce(c,a,a.createPositionAfter(e),h);const g=o.getAttribute("headingColumns")||0;g>u&&E("headingColumns",g+c,o,a)}})}splitCellHorizontally(e,t=2){const n=this.editor.model,i=e.parent,o=i.parent,r=o.getChildIndex(i),l=parseInt(e.getAttribute("rowspan")||"1"),a=parseInt(e.getAttribute("colspan")||"1");n.change(c=>{if(l>1){const d=[...new _(o,{startRow:r,endRow:r+l-1,includeAllSlots:!0})],{newCellsSpan:u,updatedSpan:m}=hs(l,t);E("rowspan",m,e,c);const{column:h}=d.find(({cell:p})=>p===e),g={};u>1&&(g.rowspan=u),a>1&&(g.colspan=a);for(const p of d){const{column:b,row:w}=p,v=w>=r+m,I=b===h,x=(w+r+m)%u===0;v&&I&&x&&Ce(1,c,p.getPositionBefore(),g)}}if(l<t){const d=t-l,u=[...new _(o,{startRow:0,endRow:r})];for(const{cell:g,cellHeight:p,row:b}of u)if(g!==e&&b+p>r){const w=p+d;c.setAttribute("rowspan",w,g)}const m={};a>1&&(m.colspan=a),Wt(c,o,r+1,d,1,m);const h=o.getAttribute("headingRows")||0;h>r&&E("headingRows",h+d,o,c)}})}getColumns(e){return[...e.getChild(0).getChildren()].filter(n=>n.is("element","tableCell")).reduce((n,i)=>{const o=parseInt(i.getAttribute("colspan")||"1");return n+o},0)}getRows(e){return Array.from(e.getChildren()).reduce((t,n)=>n.is("element","tableRow")?t+1:t,0)}createTableWalker(e,t={}){return new _(e,t)}getSelectedTableCells(e){const t=[];for(const n of this.sortRanges(e.getRanges())){const i=n.getContainedElement();i&&i.is("element","tableCell")&&t.push(i)}return t}getTableCellsContainingSelection(e){const t=[];for(const n of e.getRanges()){const i=n.start.findAncestor("tableCell");i&&t.push(i)}return t}getSelectionAffectedTableCells(e){const t=this.getSelectedTableCells(e);return t.length?t:this.getTableCellsContainingSelection(e)}getRowIndexes(e){const t=e.map(n=>n.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(e){const t=e[0].findAncestor("table"),i=[...new _(t)].filter(o=>e.includes(o.cell)).map(o=>o.column);return this._getFirstLastIndexesObject(i)}isSelectionRectangular(e){if(e.length<2||!this._areCellInTheSameTableSection(e))return!1;const t=new Set,n=new Set;let i=0;for(const r of e){const{row:l,column:a}=this.getCellLocation(r),c=parseInt(r.getAttribute("rowspan"))||1,d=parseInt(r.getAttribute("colspan"))||1;t.add(l),n.add(a),c>1&&t.add(l+c-1),d>1&&n.add(a+d-1),i+=c*d}return Kf(t,n)==i}sortRanges(e){return Array.from(e).sort(jf)}_getFirstLastIndexesObject(e){const t=e.sort((o,r)=>o-r),n=t[0],i=t[t.length-1];return{first:n,last:i}}_areCellInTheSameTableSection(e){const t=e[0].findAncestor("table"),n=this.getRowIndexes(e),i=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(n,i))return!1;const o=this.getColumnIndexes(e),r=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(o,r)}_areIndexesInSameSection({first:e,last:t},n){const i=e<n,o=t<n;return i===o}}function Wt(s,e,t,n,i,o={}){for(let r=0;r<n;r++){const l=s.createElement("tableRow");s.insert(l,e,t),Ce(i,s,s.createPositionAt(l,"end"),o)}}function Ce(s,e,t,n={}){for(let i=0;i<s;i++)he(e,t,n)}function hs(s,e){if(s<e)return{newCellsSpan:1,updatedSpan:1};const t=Math.floor(s/e),n=s-t*e+t;return{newCellsSpan:t,updatedSpan:n}}function $f(s,e,t){const n=s.getAttribute("headingColumns")||0;if(n&&e.first<n){const i=Math.min(n-1,e.last)-e.first+1;t.setAttribute("headingColumns",n-i,s)}}function Wf(s,{first:e,last:t},n){const i=s.getAttribute("headingRows")||0;if(e<i){const o=t<i?i-(t-e+1):e;E("headingRows",o,s,n,0)}}function qf(s,{first:e,last:t}){const n=new Map,i=[];for(const{row:o,column:r,cellHeight:l,cell:a}of new _(s,{endRow:t})){const c=o+l-1;if(o>=e&&o<=t&&c>t){const m=t-o+1,h=l-m;n.set(r,{cell:a,rowspan:h})}if(o<e&&c>=e){let m;c>=t?m=t-e+1:m=c-e+1,i.push({cell:a,rowspan:l-m})}}return{cellsToMove:n,cellsToTrim:i}}function Gf(s,e,t,n){const o=[...new _(s,{includeAllSlots:!0,row:e})],r=s.getChild(e);let l;for(const{column:a,cell:c,isAnchor:d}of o)if(t.has(a)){const{cell:u,rowspan:m}=t.get(a),h=l?n.createPositionAfter(l):n.createPositionAt(r,0);n.move(n.createRangeOn(u),h),E("rowspan",m,u,n),l=u}else d&&(l=c)}function jf(s,e){const t=s.start,n=e.start;return t.isBefore(n)?-1:1}function Kf(s,e){const t=Array.from(s.values()),n=Array.from(e.values()),i=Math.max(...t),o=Math.min(...t),r=Math.max(...n),l=Math.min(...n);return(i-o+1)*(r-l+1)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Qf extends k{refresh(){const e=this.editor.plugins.get(P),t=e.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=e.isSelectionRectangular(t)}execute(){const e=this.editor.model,t=this.editor.plugins.get(P);e.change(n=>{const i=t.getSelectedTableCells(e.document.selection),o=i.shift(),{mergeWidth:r,mergeHeight:l}=Xf(o,i,t);E("colspan",r,o,n),E("rowspan",l,o,n);for(const c of i)Zf(c,o,n);const a=o.findAncestor("table");Rn(a,t),n.setSelection(o,"in")})}}function Zf(s,e,t){gs(s)||(gs(e)&&t.remove(t.createRangeIn(e)),t.move(t.createRangeIn(s),t.createPositionAt(e,"end"))),t.remove(s)}function gs(s){const e=s.getChild(0);return s.childCount==1&&e.is("element","paragraph")&&e.isEmpty}function Xf(s,e,t){let n=0,i=0;for(const c of e){const{row:d,column:u}=t.getCellLocation(c);n=fs(c,u,n,"colspan"),i=fs(c,d,i,"rowspan")}const{row:o,column:r}=t.getCellLocation(s),l=n-r,a=i-o;return{mergeWidth:l,mergeHeight:a}}function fs(s,e,t,n){const i=parseInt(s.getAttribute(n)||"1");return Math.max(t,e+i)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Yf extends k{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.model,t=this.editor.plugins.get("TableUtils"),n=t.getSelectionAffectedTableCells(e.document.selection),i=t.getRowIndexes(n),o=n[0].findAncestor("table"),r=[];for(let l=i.first;l<=i.last;l++)for(const a of o.getChild(l).getChildren())r.push(e.createRangeOn(a));e.change(l=>{l.setSelection(r)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Jf extends k{constructor(e){super(e),this.affectsData=!1}refresh(){const t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=t.length>0}execute(){const e=this.editor.plugins.get("TableUtils"),t=this.editor.model,n=e.getSelectionAffectedTableCells(t.document.selection),i=n[0],o=n.pop(),r=i.findAncestor("table"),l=e.getCellLocation(i),a=e.getCellLocation(o),c=Math.min(l.column,a.column),d=Math.max(l.column,a.column),u=[];for(const m of new _(r,{startColumn:c,endColumn:d}))u.push(t.createRangeOn(m.cell));t.change(m=>{m.setSelection(u)})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function ep(s){s.document.registerPostFixer(e=>tp(e,s))}function tp(s,e){const t=e.document.differ.getChanges();let n=!1;const i=new Set;for(const o of t){let r=null;o.type=="insert"&&o.name=="table"&&(r=o.position.nodeAfter),(o.type=="insert"||o.type=="remove")&&(o.name=="tableRow"||o.name=="tableCell")&&(r=o.position.findAncestor("table")),rp(o)&&(r=o.range.start.findAncestor("table")),r&&!i.has(r)&&(n=np(r,s)||n,n=ip(r,s)||n,i.add(r))}return n}function np(s,e){let t=!1;const n=sp(s);if(n.length){t=!0;for(const i of n)E("rowspan",i.rowspan,i.cell,e,1)}return t}function ip(s,e){let t=!1;const n=op(s),i=[];for(const[a,c]of n.entries())!c&&s.getChild(a).is("element","tableRow")&&i.push(a);if(i.length){t=!0;for(const a of i.reverse())e.remove(s.getChild(a)),n.splice(a,1)}const o=n.filter((a,c)=>s.getChild(c).is("element","tableRow")),r=o[0];if(!o.every(a=>a===r)){const a=o.reduce((c,d)=>d>c?d:c,0);for(const[c,d]of o.entries()){const u=a-d;if(u){for(let m=0;m<u;m++)he(e,e.createPositionAt(s.getChild(c),"end"));t=!0}}}return t}function sp(s){const e=parseInt(s.getAttribute("headingRows")||"0"),t=Array.from(s.getChildren()).reduce((i,o)=>o.is("element","tableRow")?i+1:i,0),n=[];for(const{row:i,cell:o,cellHeight:r}of new _(s)){if(r<2)continue;const a=i<e?e:t;if(i+r>a){const c=a-i;n.push({cell:o,rowspan:c})}}return n}function op(s){const e=new Array(s.childCount).fill(0);for(const{rowIndex:t}of new _(s,{includeAllSlots:!0}))e[t]++;return e}function rp(s){if(s.type!=="attribute")return!1;const e=s.attributeKey;return e==="headingRows"||e==="colspan"||e==="rowspan"}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function lp(s){s.document.registerPostFixer(e=>ap(e,s))}function ap(s,e){const t=e.document.differ.getChanges();let n=!1;for(const i of t)i.type=="insert"&&i.name=="table"&&(n=cp(i.position.nodeAfter,s)||n),i.type=="insert"&&i.name=="tableRow"&&(n=gr(i.position.nodeAfter,s)||n),i.type=="insert"&&i.name=="tableCell"&&(n=dn(i.position.nodeAfter,s)||n),(i.type=="remove"||i.type=="insert")&&dp(i)&&(n=dn(i.position.parent,s)||n);return n}function cp(s,e){let t=!1;for(const n of s.getChildren())n.is("element","tableRow")&&(t=gr(n,e)||t);return t}function gr(s,e){let t=!1;for(const n of s.getChildren())t=dn(n,e)||t;return t}function dn(s,e){if(s.childCount==0)return e.insertElement("paragraph",s),!0;const t=Array.from(s.getChildren()).filter(n=>n.is("$text"));for(const n of t)e.wrap(e.createRangeOn(n),"paragraph");return!!t.length}function dp(s){return s.position.parent.is("element","tableCell")?s.type=="insert"&&s.name=="$text"||s.type=="remove":!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function up(s,e){const t=s.document.differ;for(const n of t.getChanges()){let i,o=!1;if(n.type=="attribute"){const c=n.range.start.nodeAfter;if(!c||!c.is("element","table")||n.attributeKey!="headingRows"&&n.attributeKey!="headingColumns")continue;i=c,o=n.attributeKey=="headingRows"}else(n.name=="tableRow"||n.name=="tableCell")&&(i=n.position.findAncestor("table"),o=n.name=="tableRow");if(!i)continue;const r=i.getAttribute("headingRows")||0,l=i.getAttribute("headingColumns")||0,a=new _(i);for(const c of a){const u=c.row<r||c.column<l?"th":"td",m=e.mapper.toViewElement(c.cell);m&&m.is("element")&&m.name!=u&&e.reconvertItem(o?c.cell.parent:c.cell)}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function mp(s,e){const t=s.document.differ,n=new Set;for(const i of t.getChanges()){const o=i.type=="attribute"?i.range.start.parent:i.position.parent;o.is("element","tableCell")&&n.add(o)}for(const i of n.values()){const o=Array.from(i.getChildren()).filter(r=>hp(r,e.mapper));for(const r of o)e.reconvertItem(r)}}function hp(s,e){if(!s.is("element","paragraph"))return!1;const t=e.toViewElement(s);return t?or(s)!==t.is("element","span"):!1}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class gp extends f{static get pluginName(){return"TableEditing"}static get requires(){return[P]}constructor(e){super(e),this._additionalSlots=[]}init(){const e=this.editor,t=e.model,n=t.schema,i=e.conversion,o=e.plugins.get(P);n.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),n.register("tableRow",{allowIn:"table",isLimit:!0}),n.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),i.for("upcast").add(wf()),i.for("upcast").add(vf()),i.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:rs(o,{asWidget:!0,additionalSlots:this._additionalSlots})}),i.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:rs(o,{additionalSlots:this._additionalSlots})}),i.for("upcast").elementToElement({model:"tableRow",view:"tr"}),i.for("upcast").add(Cf()),i.for("downcast").elementToElement({model:"tableRow",view:Tf()}),i.for("upcast").elementToElement({model:"tableCell",view:"td"}),i.for("upcast").elementToElement({model:"tableCell",view:"th"}),i.for("upcast").add(os("td")),i.for("upcast").add(os("th")),i.for("editingDowncast").elementToElement({model:"tableCell",view:ls({asWidget:!0})}),i.for("dataDowncast").elementToElement({model:"tableCell",view:ls()}),i.for("editingDowncast").elementToElement({model:"paragraph",view:as({asWidget:!0}),converterPriority:"high"}),i.for("dataDowncast").elementToElement({model:"paragraph",view:as(),converterPriority:"high"}),i.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),i.for("upcast").attributeToAttribute({model:{key:"colspan",value:ps("colspan")},view:"colspan"}),i.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),i.for("upcast").attributeToAttribute({model:{key:"rowspan",value:ps("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new Sf(e)),e.commands.add("insertTableRowAbove",new cs(e,{order:"above"})),e.commands.add("insertTableRowBelow",new cs(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new ds(e,{order:"left"})),e.commands.add("insertTableColumnRight",new ds(e,{order:"right"})),e.commands.add("removeTableRow",new Lf(e)),e.commands.add("removeTableColumn",new Ff(e)),e.commands.add("splitTableCellVertically",new us(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new us(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new Qf(e)),e.commands.add("mergeTableCellRight",new lt(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new lt(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new lt(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new lt(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new Nf(e)),e.commands.add("setTableRowHeader",new Of(e)),e.commands.add("selectTableRow",new Yf(e)),e.commands.add("selectTableColumn",new Jf(e)),ep(t),lp(t),this.listenTo(t.document,"change:data",()=>{up(t,e.editing),mp(t,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function ps(s){return e=>{const t=parseInt(e.getAttribute(s));return Number.isNaN(t)||t<=0?null:t}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class fp extends T{constructor(e){super(e);const t=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new ne,this.focusTracker=new X,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(n,i)=>`${i}  ${n}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:t.to("label")}]}],on:{mousedown:t.to(n=>{n.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(n,i)=>{const{row:o,column:r}=i.target.dataset;this.items.get((parseInt(o,10)-1)*10+(parseInt(r,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(n,i,o)=>{if(!o)return;const{row:r,column:l}=o.dataset;this.set({rows:parseInt(r),columns:parseInt(l)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){super.render(),Ns({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection});for(const e of this.items)this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){const e=this.rows,t=this.columns;this.items.map((n,i)=>{const o=Math.floor(i/10),r=i%10,l=o<e&&r<t;n.set("isOn",l)})}_createGridButton(e,t,n,i){const o=new y(e);return o.set({label:i,class:"ck-insert-table-dropdown-grid-box"}),o.extendTemplate({attributes:{"data-row":t,"data-column":n}}),o}_createGridCollection(){const e=[];for(let t=0;t<100;t++){const n=Math.floor(t/10),i=t%10,o=`${n+1}  ${i+1}`;e.push(this._createGridButton(this.locale,n+1,i+1,o))}return this.createCollection(e)}}const pp='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',bp='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',wp='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class vp extends f{static get pluginName(){return"TableUI"}init(){const e=this.editor,t=this.editor.t,i=e.locale.contentLanguageDirection==="ltr";e.ui.componentFactory.add("insertTable",o=>{const r=e.commands.get("insertTable"),l=W(o);l.bind("isEnabled").to(r),l.buttonView.set({icon:C.table,label:t("Insert table"),tooltip:!0});let a;return l.on("change:isOpen",()=>{a||(a=new fp(o),l.panelView.children.add(a),a.delegate("execute").to(l),l.on("execute",()=>{e.execute("insertTable",{rows:a.rows,columns:a.columns}),e.editing.view.focus()}))}),l}),e.ui.componentFactory.add("tableColumn",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:i?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:i?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),pp,r,o)}),e.ui.componentFactory.add("tableRow",o=>{const r=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),bp,r,o)}),e.ui.componentFactory.add("mergeTableCells",o=>{const r=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:i?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:i?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),wp,r,o)})}_prepareDropdown(e,t,n,i){const o=this.editor,r=W(i),l=this._fillDropdownWithListOptions(r,n);return r.buttonView.set({label:e,icon:t,tooltip:!0}),r.bind("isEnabled").toMany(l,"isEnabled",(...a)=>a.some(c=>c)),this.listenTo(r,"execute",a=>{o.execute(a.source.commandName),a.source instanceof Ms||o.editing.view.focus()}),r}_prepareMergeSplitButtonDropdown(e,t,n,i){const o=this.editor,r=W(i,vn),l="mergeTableCells",a=o.commands.get(l),c=this._fillDropdownWithListOptions(r,n);return r.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),r.bind("isEnabled").toMany([a,...c],"isEnabled",(...d)=>d.some(u=>u)),this.listenTo(r.buttonView,"execute",()=>{o.execute(l),o.editing.view.focus()}),this.listenTo(r,"execute",d=>{o.execute(d.source.commandName),o.editing.view.focus()}),r}_fillDropdownWithListOptions(e,t){const n=this.editor,i=[],o=new te;for(const r of t)Cp(r,n,i,o);return We(e,o),i}}function Cp(s,e,t,n){if(s.type==="button"||s.type==="switchbutton"){const i=s.model=new qe(s.model),{commandName:o,bindIsOn:r}=s.model,l=e.commands.get(o);t.push(l),i.set({commandName:o}),i.bind("isEnabled").to(l),r&&i.bind("isOn").to(l,"value"),i.set({withText:!0})}n.add(s)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class ae extends f{static get pluginName(){return"TableSelection"}static get requires(){return[P,P]}init(){const e=this.editor,t=e.model,n=e.editing.view;this.listenTo(t,"deleteContent",(i,o)=>this._handleDeleteContent(i,o),{priority:"high"}),this.listenTo(n.document,"insertText",(i,o)=>this._handleInsertTextEvent(i,o),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){const e=this.editor.plugins.get(P),t=this.editor.model.document.selection,n=e.getSelectedTableCells(t);return n.length==0?null:n}getSelectionAsFragment(){const e=this.editor.plugins.get(P),t=this.getSelectedTableCells();return t?this.editor.model.change(n=>{const i=n.createDocumentFragment(),{first:o,last:r}=e.getColumnIndexes(t),{first:l,last:a}=e.getRowIndexes(t),c=t[0].findAncestor("table");let d=a,u=r;if(e.isSelectionRectangular(t)){const g={firstColumn:o,lastColumn:r,firstRow:l,lastRow:a};d=mr(c,g),u=hr(c,g)}const h=rr(c,{startRow:l,startColumn:o,endRow:d,endColumn:u},n);return n.insert(h,i,0),i}):null}setCellSelection(e,t){const n=this._getCellsToSelect(e,t);this.editor.model.change(i=>{i.setSelection(n.cells.map(o=>i.createRangeOn(o)),{backward:n.backward})})}getFocusCell(){const n=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return n&&n.is("element","tableCell")?n:null}getAnchorCell(){const e=this.editor.model.document.selection,n=M(e.getRanges()).getContainedElement();return n&&n.is("element","tableCell")?n:null}_defineSelectionConverter(){const e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(i=>i.on("selection",(o,r,l)=>{const a=l.writer;n(a);const c=this.getSelectedTableCells();if(!c)return;for(const u of c){const m=l.mapper.toViewElement(u);a.addClass("ck-editor__editable_selected",m),t.add(m)}const d=l.mapper.toViewElement(c[c.length-1]);a.setSelection(d,0)},{priority:"lowest"}));function n(i){for(const o of t)i.removeClass("ck-editor__editable_selected",o);t.clear()}}_enablePluginDisabling(){const e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){const t=this.getSelectedTableCells();if(!t)return;e.model.change(n=>{const i=n.createPositionAt(t[0],0),o=e.model.schema.getNearestSelectionRange(i);n.setSelection(o)})}})}_handleDeleteContent(e,t){const n=this.editor.plugins.get(P),i=t[0],o=t[1],r=this.editor.model,l=!o||o.direction=="backward",a=n.getSelectedTableCells(i);a.length&&(e.stop(),r.change(c=>{const d=a[l?a.length-1:0];r.change(m=>{for(const h of a)r.deleteContent(m.createSelection(h,"in"))});const u=r.schema.getNearestSelectionRange(c.createPositionAt(d,0));i.is("documentSelection")?c.setSelection(u):i.setTo(u)}))}_handleInsertTextEvent(e,t){const n=this.editor,i=this.getSelectedTableCells();if(!i)return;const o=n.editing.view,r=n.editing.mapper,l=i.map(a=>o.createRangeOn(r.toViewElement(a)));t.selection=o.createSelection(l)}_getCellsToSelect(e,t){const n=this.editor.plugins.get("TableUtils"),i=n.getCellLocation(e),o=n.getCellLocation(t),r=Math.min(i.row,o.row),l=Math.max(i.row,o.row),a=Math.min(i.column,o.column),c=Math.max(i.column,o.column),d=new Array(l-r+1).fill(null).map(()=>[]),u={startRow:r,endRow:l,startColumn:a,endColumn:c};for(const{row:g,cell:p}of new _(e.findAncestor("table"),u))d[g-r].push(p);const m=o.row<i.row,h=o.column<i.column;return m&&d.reverse(),h&&d.forEach(g=>g.reverse()),{cells:d.flat(),backward:m||h}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class kp extends f{static get pluginName(){return"TableClipboard"}static get requires(){return[Le,q,ae,P]}init(){const e=this.editor,t=e.editing.view.document;this.listenTo(t,"copy",(n,i)=>this._onCopyCut(n,i)),this.listenTo(t,"cut",(n,i)=>this._onCopyCut(n,i)),this.listenTo(e.model,"insertContent",(n,[i,o])=>this._onInsertContent(n,i,o),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(e,t){const n=this.editor.editing.view,i=this.editor.plugins.get(ae),o=this.editor.plugins.get(Le);if(!i.getSelectedTableCells()||e.name=="cut"&&!this.editor.model.canEditAt(this.editor.model.document.selection))return;t.preventDefault(),e.stop();const r=o._copySelectedFragmentWithMarkers(e.name,this.editor.model.document.selection,()=>i.getSelectionAsFragment());n.document.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:this.editor.data.toView(r),method:e.name})}_onInsertContent(e,t,n){if(n&&!n.is("documentSelection"))return;const i=this.editor.model,o=this.editor.plugins.get(P),r=this.editor.plugins.get(Le),l=this.getTableIfOnlyTableInContent(t,i);if(!l)return;const a=o.getSelectionAffectedTableCells(i.document.selection);if(!a.length){Rn(l,o);return}e.stop(),t.is("documentFragment")?r._pasteMarkersIntoTransformedElement(t.markers,c=>this._replaceSelectedCells(l,a,c)):this.editor.model.change(c=>{this._replaceSelectedCells(l,a,c)})}_replaceSelectedCells(e,t,n){const i=this.editor.plugins.get(P),o={width:i.getColumns(e),height:i.getRows(e)},r=yp(t,o,n,i),l=r.lastRow-r.firstRow+1,a=r.lastColumn-r.firstColumn+1,c={startRow:0,startColumn:0,endRow:Math.min(l,o.height)-1,endColumn:Math.min(a,o.width)-1};e=rr(e,c,n);const d=t[0].findAncestor("table"),u=this._replaceSelectedCellsWithPasted(e,o,d,r,n);if(this.editor.plugins.get("TableSelection").isEnabled){const m=i.sortRanges(u.map(h=>n.createRangeOn(h)));n.setSelection(m)}else n.setSelection(u[0],0);return d}_replaceSelectedCellsWithPasted(e,t,n,i,o){const{width:r,height:l}=t,a=Ip(e,r,l),c=[...new _(n,{startRow:i.firstRow,endRow:i.lastRow,startColumn:i.firstColumn,endColumn:i.lastColumn,includeAllSlots:!0})],d=[];let u;for(const b of c){const{row:w,column:v}=b;v===i.firstColumn&&(u=b.getPositionBefore());const I=w-i.firstRow,x=v-i.firstColumn,R=a[I%l][x%r],Ee=R?o.cloneElement(R):null,ge=this._replaceTableSlotCell(b,Ee,u,o);ge&&(ur(ge,w,v,i.lastRow,i.lastColumn,o),d.push(ge),u=o.createPositionAfter(ge))}const m=parseInt(n.getAttribute("headingRows")||"0"),h=parseInt(n.getAttribute("headingColumns")||"0"),g=i.firstRow<m&&m<=i.lastRow,p=i.firstColumn<h&&h<=i.lastColumn;if(g){const b={first:i.firstColumn,last:i.lastColumn},w=un(n,m,b,o,i.firstRow);d.push(...w)}if(p){const b={first:i.firstRow,last:i.lastRow},w=mn(n,h,b,o);d.push(...w)}return d}_replaceTableSlotCell(e,t,n,i){const{cell:o,isAnchor:r}=e;return r&&i.remove(o),t?(i.insert(t,n),t):null}getTableIfOnlyTableInContent(e,t){if(!e.is("documentFragment")&&!e.is("element"))return null;if(e.is("element","table"))return e;if(e.childCount==1&&e.getChild(0).is("element","table"))return e.getChild(0);const n=t.createRangeIn(e);for(const i of n.getItems())if(i.is("element","table")){const o=t.createRange(n.start,t.createPositionBefore(i));if(t.hasContent(o,{ignoreWhitespaces:!0}))return null;const r=t.createRange(t.createPositionAfter(i),n.end);return t.hasContent(r,{ignoreWhitespaces:!0})?null:i}return null}}function yp(s,e,t,n){const i=s[0].findAncestor("table"),o=n.getColumnIndexes(s),r=n.getRowIndexes(s),l={firstColumn:o.first,lastColumn:o.last,firstRow:r.first,lastRow:r.last},a=s.length===1;return a&&(l.lastRow+=e.height-1,l.lastColumn+=e.width-1,_p(i,l.lastRow+1,l.lastColumn+1,n)),a||!n.isSelectionRectangular(s)?Tp(i,l,t):(l.lastRow=mr(i,l),l.lastColumn=hr(i,l)),l}function _p(s,e,t,n){const i=n.getColumns(s),o=n.getRows(s);t>i&&n.insertColumns(s,{at:i,columns:t-i}),e>o&&n.insertRows(s,{at:o,rows:e-o})}function Ip(s,e,t){const n=new Array(t).fill(null).map(()=>new Array(e).fill(null));for(const{column:i,row:o,cell:r}of new _(s))n[o][i]=r;return n}function Tp(s,e,t){const{firstRow:n,lastRow:i,firstColumn:o,lastColumn:r}=e,l={first:n,last:i},a={first:o,last:r};mn(s,o,l,t),mn(s,r+1,l,t),un(s,n,a,t),un(s,i+1,a,t,n)}function un(s,e,t,n,i=0){return e<1?void 0:lr(s,e,i).filter(({column:l,cellWidth:a})=>fr(l,a,t)).map(({cell:l})=>ar(l,e,n))}function mn(s,e,t,n){return e<1?void 0:cr(s,e).filter(({row:r,cellHeight:l})=>fr(r,l,t)).map(({cell:r,column:l})=>dr(r,l,e,n))}function fr(s,e,t){const n=s+e-1,{first:i,last:o}=t,r=s>=i&&s<=o,l=s<i&&n>=i;return r||l}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ep extends f{static get pluginName(){return"TableKeyboard"}static get requires(){return[ae,P]}init(){const e=this.editor,n=e.editing.view.document,i=e.t;this.listenTo(n,"arrowKey",(...o)=>this._onArrowKey(...o),{context:"table"}),this.listenTo(n,"tab",(...o)=>this._handleTabOnSelectedTable(...o),{context:"figure"}),this.listenTo(n,"tab",(...o)=>this._handleTab(...o),{context:["th","td"]}),e.accessibility.addKeystrokeInfoGroup({id:"table",label:i("Keystrokes that can be used in a table cell"),keystrokes:[{label:i("Move the selection to the next cell"),keystroke:"Tab"},{label:i("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:i("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:i("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(e,t){const n=this.editor,o=n.model.document.selection.getSelectedElement();!o||!o.is("element","table")||(t.preventDefault(),t.stopPropagation(),e.stop(),n.model.change(r=>{r.setSelection(r.createRangeIn(o.getChild(0).getChild(0)))}))}_handleTab(e,t){const n=this.editor,i=this.editor.plugins.get(P),o=this.editor.plugins.get("TableSelection"),r=n.model.document.selection,l=!t.shiftKey;let a=i.getTableCellsContainingSelection(r)[0];if(a||(a=o.getFocusCell()),!a)return;t.preventDefault(),t.stopPropagation(),e.stop();const c=a.parent,d=c.parent,u=d.getChildIndex(c),m=c.getChildIndex(a),h=m===0;if(!l&&h&&u===0){n.model.change(w=>{w.setSelection(w.createRangeOn(d))});return}const g=m===c.childCount-1,p=u===i.getRows(d)-1;if(l&&p&&g&&(n.execute("insertTableRowBelow"),u===i.getRows(d)-1)){n.model.change(w=>{w.setSelection(w.createRangeOn(d))});return}let b;if(l&&g)b=d.getChild(u+1).getChild(0);else if(!l&&h){const w=d.getChild(u-1);b=w.getChild(w.childCount-1)}else b=c.getChild(m+(l?1:-1));n.model.change(w=>{w.setSelection(w.createRangeIn(b))})}_onArrowKey(e,t){const n=this.editor,i=t.keyCode,o=xs(i,n.locale.contentLanguageDirection);this._handleArrowKeys(o,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){const n=this.editor.plugins.get(P),i=this.editor.plugins.get("TableSelection"),o=this.editor.model,r=o.document.selection,l=["right","down"].includes(e),a=n.getSelectedTableCells(r);if(a.length){let d;return t?d=i.getFocusCell():d=l?a[a.length-1]:a[0],this._navigateFromCellInDirection(d,e,t),!0}const c=r.focus.findAncestor("tableCell");/* istanbul ignore if: paranoid check -- @preserve */if(!c)return!1;if(!r.isCollapsed)if(t){if(r.isBackward==l&&!r.containsEntireContent(c))return!1}else{const d=r.getSelectedElement();if(!d||!o.schema.isObject(d))return!1}return this._isSelectionAtCellEdge(r,c,l)?(this._navigateFromCellInDirection(c,e,t),!0):!1}_isSelectionAtCellEdge(e,t,n){const i=this.editor.model,o=this.editor.model.schema,r=n?e.getLastPosition():e.getFirstPosition();if(!o.getLimitElement(r).is("element","tableCell"))return i.createPositionAt(t,n?"end":0).isTouching(r);const l=i.createSelection(r);return i.modifySelection(l,{direction:n?"forward":"backward"}),r.isEqual(l.focus)}_navigateFromCellInDirection(e,t,n=!1){const i=this.editor.model,o=e.findAncestor("table"),r=[...new _(o,{includeAllSlots:!0})],{row:l,column:a}=r[r.length-1],c=r.find(({cell:v})=>v==e);let{row:d,column:u}=c;switch(t){case"left":u--;break;case"up":d--;break;case"right":u+=c.cellWidth;break;case"down":d+=c.cellHeight;break}const m=d<0||d>l,h=u<0&&d<=0,g=u>a&&d>=l;if(m||h||g){i.change(v=>{v.setSelection(v.createRangeOn(o))});return}u<0?(u=n?0:a,d--):u>a&&(u=n?a:0,d++);const p=r.find(v=>v.row==d&&v.column==u).cell,b=["right","down"].includes(t),w=this.editor.plugins.get("TableSelection");if(n&&w.isEnabled){const v=w.getAnchorCell()||e;w.setCellSelection(v,p)}else{const v=i.createPositionAt(p,b?0:"end");i.change(I=>{I.setSelection(v)})}}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Ap extends vt{constructor(){super(...arguments),this.domEventType=["mousemove","mouseleave"]}onDomEvent(e){this.fire(e.type,e)}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Sp extends f{static get pluginName(){return"TableMouse"}static get requires(){return[ae,P]}init(){this.editor.editing.view.addObserver(Ap),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){const e=this.editor,t=e.plugins.get(P);let n=!1;const i=e.plugins.get(ae);this.listenTo(e.editing.view.document,"mousedown",(o,r)=>{const l=e.model.document.selection;if(!this.isEnabled||!i.isEnabled||!r.domEvent.shiftKey)return;const a=i.getAnchorCell()||t.getTableCellsContainingSelection(l)[0];if(!a)return;const c=this._getModelTableCellFromDomEvent(r);c&&bs(a,c)&&(n=!0,i.setCellSelection(a,c),r.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{n=!1}),this.listenTo(e.editing.view.document,"selectionChange",o=>{n&&o.stop()},{priority:"highest"})}_enableMouseDragSelection(){const e=this.editor;let t,n,i=!1,o=!1;const r=e.plugins.get(ae);this.listenTo(e.editing.view.document,"mousedown",(l,a)=>{!this.isEnabled||!r.isEnabled||a.domEvent.shiftKey||a.domEvent.ctrlKey||a.domEvent.altKey||(t=this._getModelTableCellFromDomEvent(a))}),this.listenTo(e.editing.view.document,"mousemove",(l,a)=>{if(!a.domEvent.buttons||!t)return;const c=this._getModelTableCellFromDomEvent(a);c&&bs(t,c)&&(n=c,!i&&n!=t&&(i=!0)),i&&(o=!0,r.setCellSelection(t,n),a.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{i=!1,o=!1,t=null,n=null}),this.listenTo(e.editing.view.document,"selectionChange",l=>{o&&l.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){const t=e.target,n=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(n).parent.findAncestor("tableCell",{includeSelf:!0})}}function bs(s,e){return s.parent.parent==e.parent.parent}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class xp extends f{static get requires(){return[gp,vp,ae,Sp,Ep,kp,Ge]}static get pluginName(){return"Table"}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Rp(s){const e=s.getSelectedElement();return e&&pr(e)?e:null}function Vp(s){const e=s.getFirstPosition();if(!e)return null;let t=e.parent;for(;t;){if(t.is("element")&&pr(t))return t;t=t.parent}return null}function pr(s){return!!s.getCustomProperty("table")&&D(s)}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */class Pp extends f{static get requires(){return[ht]}static get pluginName(){return"TableToolbar"}afterInit(){const e=this.editor,t=e.t,n=e.plugins.get(ht),i=e.config.get("table.contentToolbar"),o=e.config.get("table.tableToolbar");i&&n.register("tableContent",{ariaLabel:t("Table toolbar"),items:i,getRelatedElement:Vp}),o&&n.register("table",{ariaLabel:t("Table toolbar"),items:o,getRelatedElement:Rp})}}/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */function Bp(s){const e=[{name:"address",isVoid:!1},{name:"article",isVoid:!1},{name:"aside",isVoid:!1},{name:"blockquote",isVoid:!1},{name:"details",isVoid:!1},{name:"dialog",isVoid:!1},{name:"dd",isVoid:!1},{name:"div",isVoid:!1},{name:"dl",isVoid:!1},{name:"dt",isVoid:!1},{name:"fieldset",isVoid:!1},{name:"figcaption",isVoid:!1},{name:"figure",isVoid:!1},{name:"footer",isVoid:!1},{name:"form",isVoid:!1},{name:"h1",isVoid:!1},{name:"h2",isVoid:!1},{name:"h3",isVoid:!1},{name:"h4",isVoid:!1},{name:"h5",isVoid:!1},{name:"h6",isVoid:!1},{name:"header",isVoid:!1},{name:"hgroup",isVoid:!1},{name:"hr",isVoid:!0},{name:"li",isVoid:!1},{name:"main",isVoid:!1},{name:"nav",isVoid:!1},{name:"ol",isVoid:!1},{name:"p",isVoid:!1},{name:"section",isVoid:!1},{name:"table",isVoid:!1},{name:"tbody",isVoid:!1},{name:"td",isVoid:!1},{name:"th",isVoid:!1},{name:"thead",isVoid:!1},{name:"tr",isVoid:!1},{name:"ul",isVoid:!1}],t=e.map(r=>r.name).join("|"),n=s.replace(new RegExp(`</?(${t})( .*?)?>`,"g"),`
$&
`).replace(/<br[^>]*>/g,`$&
`).split(`
`);let i=0,o=!1;return n.filter(r=>r.length).map(r=>(o=Fp(r,o),Lp(r,e)?qt(r,i++):Dp(r,e)?qt(r,--i):o==="middle"||o==="last"?r:qt(r,i))).join(`
`)}function Lp(s,e){return e.some(t=>!(t.isVoid||!new RegExp(`<${t.name}( .*?)?>`).test(s)))}function Dp(s,e){return e.some(t=>new RegExp(`</${t.name}>`).test(s))}function qt(s,e,t="    "){return`${t.repeat(Math.max(0,e))}${s}`}function Fp(s,e){return new RegExp("<pre( .*?)?>").test(s)?"first":new RegExp("</pre>").test(s)?"last":e==="first"||e==="middle"?"middle":!1}const Mp='<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="m12.5 0 5 4.5v15.003h-16V0h11zM3 1.5v3.25l-1.497 1-.003 8 1.5 1v3.254L7.685 18l-.001 1.504H17.5V8.002L16 9.428l-.004-4.22-4.222-3.692L3 1.5z"/><path d="M4.06 6.64a.75.75 0 0 1 .958 1.15l-.085.07L2.29 9.75l2.646 1.89c.302.216.4.62.232.951l-.058.095a.75.75 0 0 1-.951.232l-.095-.058-3.5-2.5V9.14l3.496-2.5zm4.194 6.22a.75.75 0 0 1-.958-1.149l.085-.07 2.643-1.89-2.646-1.89a.75.75 0 0 1-.232-.952l.058-.095a.75.75 0 0 1 .95-.232l.096.058 3.5 2.5v1.22l-3.496 2.5zm7.644-.836 2.122 2.122-5.825 5.809-2.125-.005.003-2.116zm2.539-1.847 1.414 1.414a.5.5 0 0 1 0 .707l-1.06 1.06-2.122-2.12 1.061-1.061a.5.5 0 0 1 .707 0z"/></svg>';/**
 * @license Copyright (c) 2003-2024, CKSource Holding sp. z o.o. All rights reserved.
 * For licensing, see LICENSE.md or https://ckeditor.com/legal/ckeditor-oss-license
 */const ws="SourceEditingMode";class Up extends f{static get pluginName(){return"SourceEditing"}static get requires(){return[ut]}constructor(e){super(e),this.set("isSourceEditingMode",!1),this._elementReplacer=new ol,this._replacedRoots=new Map,this._dataFromRoots=new Map,e.config.define("sourceEditing.allowCollaborationFeatures",!1)}init(){this._checkCompatibility();const e=this.editor,t=e.t;e.ui.componentFactory.add("sourceEditing",n=>{const i=new y(n);return i.set({label:t("Source"),icon:Mp,tooltip:!0,withText:!0,class:"ck-source-editing-button"}),i.bind("isOn").to(this,"isSourceEditingMode"),i.bind("isEnabled").to(this,"isEnabled",e,"isReadOnly",e.plugins.get(ut),"hasAny",(o,r,l)=>!(!o||r||l)),this.listenTo(i,"execute",()=>{this.isSourceEditingMode=!this.isSourceEditingMode}),i}),this._isAllowedToHandleSourceEditingMode()&&(this.on("change:isSourceEditingMode",(n,i,o)=>{o?(this._hideVisibleDialog(),this._showSourceEditing(),this._disableCommands()):(this._hideSourceEditing(),this._enableCommands())}),this.on("change:isEnabled",(n,i,o)=>this._handleReadOnlyMode(!o)),this.listenTo(e,"change:isReadOnly",(n,i,o)=>this._handleReadOnlyMode(o))),e.data.on("get",()=>{this.isSourceEditingMode&&this.updateEditorData()},{priority:"high"})}updateEditorData(){const e=this.editor,t={};for(const[n,i]of this._replacedRoots){const o=this._dataFromRoots.get(n),r=i.dataset.value;o!==r&&(t[n]=r,this._dataFromRoots.set(n,r))}Object.keys(t).length&&e.data.set(t,{batchType:{isUndoable:!0},suppressErrorInCollaboration:!0})}_checkCompatibility(){const e=this.editor,t=e.config.get("sourceEditing.allowCollaborationFeatures");if(!t&&e.plugins.has("RealTimeCollaborativeEditing"))throw new L("source-editing-incompatible-with-real-time-collaboration",null);!t&&["CommentsEditing","TrackChangesEditing","RevisionHistory"].some(i=>e.plugins.has(i))&&console.warn("You initialized the editor with the source editing feature and at least one of the collaboration features. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the collaboration features."),e.plugins.has("RestrictedEditingModeEditing")&&console.warn("You initialized the editor with the source editing feature and restricted editing feature. Please be advised that the source editing feature may not work, and be careful when editing document source that contains markers created by the restricted editing feature.")}_showSourceEditing(){const e=this.editor,t=e.editing.view,n=e.model;n.change(i=>{i.setSelection(null),i.removeSelectionAttribute(n.document.selection.getAttributeKeys())});for(const[i,o]of t.domRoots){const r=Op(e.data.get({rootName:i})),l=H(o.ownerDocument,"textarea",{rows:"1","aria-label":"Source code editing area"}),a=H(o.ownerDocument,"div",{class:"ck-source-editing-area","data-value":r},[l]);l.value=r,l.setSelectionRange(0,0),l.addEventListener("input",()=>{a.dataset.value=l.value,e.ui.update()}),t.change(c=>{const d=t.document.getRoot(i);c.addClass("ck-hidden",d)}),e.ui.setEditableElement("sourceEditing:"+i,l),this._replacedRoots.set(i,a),this._elementReplacer.replace(o,a),this._dataFromRoots.set(i,r)}this._focusSourceEditing()}_hideSourceEditing(){const t=this.editor.editing.view;this.updateEditorData(),t.change(n=>{for(const[i]of this._replacedRoots)n.removeClass("ck-hidden",t.document.getRoot(i))}),this._elementReplacer.restore(),this._replacedRoots.clear(),this._dataFromRoots.clear(),t.focus()}_focusSourceEditing(){const e=this.editor,[t]=this._replacedRoots.values(),n=t.querySelector("textarea");e.editing.view.document.isFocused=!1,n.focus()}_disableCommands(){const e=this.editor;for(const t of e.commands.commands())t.forceDisabled(ws)}_enableCommands(){const e=this.editor;for(const t of e.commands.commands())t.clearForceDisabled(ws)}_handleReadOnlyMode(e){if(this.isSourceEditingMode)for(const[,t]of this._replacedRoots)t.querySelector("textarea").readOnly=e}_isAllowedToHandleSourceEditingMode(){const t=this.editor.ui.view.editable;return t&&!t.hasExternalElement}_hideVisibleDialog(){if(this.editor.plugins.has("Dialog")){const e=this.editor.plugins.get("Dialog");e.isOpen&&e.hide()}}}function Op(s){return Np(s)?Bp(s):s}function Np(s){return s.startsWith("<")}class zp{constructor(e){this.loader=e}upload(){return this.loader.file.then(e=>new Promise((t,n)=>{const i=new FormData;i.append("file",e),i.append("type","ckeditor"),ll.post("/api/upload",i).then(o=>{o.data.status?t({default:o.data.filepath}):n(o.data.message)}).catch(o=>{n("Upload failed")})}))}abort(){}}const Wp={__name:"ckeditor",props:al({name:String,rules:String,imageUpload:Boolean,mediaEmbed:Boolean,toolbar:Array},{data:{},dataModifiers:{}}),emits:["update:data"],setup(s){const e=cl(s,"data"),t=s,n=Ae(t,"name"),i=Ae(t,"rules"),o=Ae(t,"imageUpload"),r=Ae(t,"mediaEmbed"),l=Ae(t,"toolbar"),a=Mn(!0),c=Un(()=>{var p;let g=["undo","redo","|","sourceEditing","|","heading","|","alignment","fontColor","fontBackgroundColor","bold","italic","underline","blockQuote","strikethrough","subscript","superscript","|","link","|","bulletedList","numberedList","outdent","indent"];if(o.value){let b=g.indexOf("link");g.splice(b+1,0,"insertImage")}if(r.value){let b=o.value?g.indexOf("insertImage"):g.indexOf("link");g.splice(b+1,0,"mediaEmbed")}else if((p=l.value)!=null&&p.length)return g.filter(b=>l.value.includes(b));return g}),d=Un(()=>[{color:"#8AB445",label:"Apple Green"},{color:"#94D626",label:"Yellow Green"},{color:"#726659",label:"Pastel Brown",hasBorder:!0},{color:"#AAA096",label:"Greige"},{color:"#F1F2E3",label:"Ivory"},{color:"#E6DDD4",label:"Light Nude"},{color:"#F7F2EC",label:"Isabelline"},{color:"#F9F9F9",label:"White Smoke",hasBorder:!0},{color:"#343741",label:"Squid Ink"},{color:"#000000",label:"Black"},{color:"#231F20",label:"Raisin Black"},{color:"#ffffff",label:"White",hasBorder:!0}]),u=Mn({plugins:[Bc,Gc,_d,Qc,cu,Hu,ju,mm,pm,ih,sh,Oo,Nm,qm,ah,dh,Jc,zh,mg,Eg,Vs,bf,Up,id,ld,ud,Uc,xp,Pp,fd],toolbar:c,image:{toolbar:["imageTextAlternative","toggleImageCaption","imageStyle:inline","imageStyle:block","imageStyle:side"]},table:{contentToolbar:["tableColumn","tableRow","mergeTableCells"]},fontColor:{colors:d},fontBackgroundColor:{colors:d},extraPlugins:[m]});function m(g){g.plugins.get("FileRepository").createUploadAdapter=p=>new zp(p)}const h=g=>{g.ui.isReady&&(a.value=!1)};return(g,p)=>{const b=dl("ckeditor",!0);return ul(),ml(On(pl),{name:n.value,modelValue:e.value,"onUpdate:modelValue":p[0]||(p[0]=w=>e.value=w),rules:i.value},{default:hl(({field:w,value:v,handleChange:I,handleBlur:x,errorMessage:R})=>[gl(b,fl(w,{editor:On(rl),config:u.value,disableTwoWayDataBinding:a.value,class:{"border-danger":R},"model-value":v,onReady:h,onInput:I,onBlur:x}),null,16,["editor","config","disableTwoWayDataBinding","class","model-value","onInput","onBlur"])]),_:1},8,["name","modelValue","rules"])}}};export{Wp as _};
