import{u as O,z as Q,r as t,o as W,B as X,a as o,c as u,b as e,K as c,d as x,w as U,G as I,E as y,e as f,H as T,I as F,f as S,F as N,t as B}from"./app-Bv7sA21o.js";import{c as M}from"./common-iZsm-le3.js";import"./dayjs.min-CU4dOPv8.js";const Y={class:"page-wrap property-add"},Z={class:"page-title mb-4"},ee={class:"row gy-3 align-items-center"},ae={class:"col align-self-end"},te={class:"h2 mb-0"},le={class:"col-auto"},se=e("i",{class:"icon-list me-2"},null,-1),oe={class:"section"},ue={key:0,class:"d-flex justify-content-center py-5"},ne=e("div",{class:"spinner-border",role:"status"},null,-1),ce=[ne],de={class:"row"},ie={class:"col-12 col-md-3"},re={class:"text-primary m-0"},ve={class:"col-12 col-md-6 text-md-center"},me=e("i",{class:"bi bi-calendar2-check"},null,-1),pe=e("i",{class:"bi bi-calendar2-check"},null,-1),_e={class:"col-12 col-md-3 text-md-end"},he={class:"col-12 pt-3"},be={class:"bg-secondary text-white py-2 px-3 text-center rounded-5"},ye={key:0},fe={class:"border pb-2 mt-4"},ge={class:"table-wrap"},ke={class:"table-responsive"},we={class:"table align-middle mb-2"},Ve=e("thead",null,[e("tr",null,[e("th",null,"Name"),e("th",null,"Email"),e("th",null,"Amount"),e("th",null,"Payment Mode"),e("th",{class:"text-secondary fw-semibold"},"Action")])],-1),Re={class:"input-group"},qe={class:"text-danger"},xe={class:"text-danger"},Ce={class:"input-group flex-nowrap"},Ae=e("div",{class:"input-group-text"},"INR",-1),Ne={class:"input-group"},Ee=e("option",{value:"",selected:"",disabled:""},"Choose Payment Mode",-1),Pe=["value"],De={class:"text-danger"},Ie=["onClick"],Be={key:1},Me=["onClick"],Ue={key:2,class:"btn btn-secondary mt-1 text-white ms-2"},ze={__name:"payment-request",setup(Te){const $=O(),E=Q(),i=t(!1),k=t([]),r=t([]),h=t([]),L=t([]);t();const v=t(0),z=t(["Razorpay","NEFT","Cash"]),m=t([]),w=t([]),V=t([]),d=t(0),p=t([]),R=t([]),g=t([]),P=t(!0),D=t(0),q=t(!1),C=t(!0),A=t([]),j=a=>{g.value[a]=!1,P.value=!0,q.value=!1},G=()=>{if(i.value=!0,E.params.id){let a=10;for(let l=1;l<=a;l++)L.value.push(l),w.value.push(""),V.value.push("");i.value=!0,S.get(`/api/property/booking/${E.params.id}`).then(l=>{if(l.data.status){k.value=l.data.data,d.value=l.data.availableAmount,D.value=l.data.data.payable_amount;let b=l.data.data.customer_detail;r.value.push(b.email),h.value.push(l.data.availableAmount),m.value.push(""),p.value.push(b.first_name+" "+b.last_name),R.value.push(""),g.value.push(!1),A.value.push(""),v.value=1,setTimeout(()=>{i.value=!1},400)}}).catch(l=>{i.value=!1,console.log(l)})}},H=()=>{v.value=v.value-1,r.value.pop(),w.value.pop(),V.value.pop(),m.value.pop(),R.value.pop(),p.value.pop(),g.value.pop(),h.value.pop(),q.value=!0,C.value=!1},K=()=>{v.value,v.value=v.value+1,r.value.push(""),w.value.push(""),V.value.push(""),m.value.push(""),R.value.push(""),p.value.push(""),g.value.push(!1),h.value.push(d.value),q.value=!1,C.value=!0,A.value.push("")},J=a=>{V.value[a]=r.value[a]==""?"Please Enter Email ID":"",w.value[a]=m.value[a]==""?"Please Choose Payment Mode":"",R.value[a]=p.value[a]==""?"Please Enter Name":"";let l=!1;if(h.value[a]<=d.value?l=!0:B("Amount can't be greater than Net Payable Amount","error").show(),p.value[a]!=""&&r.value[a]!=""&&m.value[a]!=""&&l&&d.value>0){i.value=!0;let b={email:r.value[a],amount:h.value[a],property_booking_id:`${E.params.id}`,payment_mode:m.value[a],name:p.value[a],booking_request_id:A.value[a]};S.post("/api/property/booking/payment/request",b).then(_=>{_.data.status&&setTimeout(()=>{B(_.data.message,"success").show(),A.value[a]=_.data.data.booking_request_id,i.value=!1,g.value[a]=!0,d.value=_.data.propertyBookingDetail.payable_amount-_.data.propertyBookingDetail.paid_amount,d.value<=0&&(P.value=!1),q.value=!0,C.value=!1,d.value<=0&&$.push({name:"booking-list"})},400)}).catch(_=>{B(_.response.data.message,"error").show(),i.value=!1})}};return W(()=>{G()}),(a,l)=>{const b=X("router-link");return o(),u("div",Y,[e("div",Z,[e("div",ee,[e("div",ae,[e("h1",te,"Booking Payment Request (ID: "+c(k.value.booking_id)+")",1)]),e("div",le,[x(b,{to:{name:"booking-list"},class:"btn rounded-pill btn-secondary-light"},{default:U(()=>[se,y(" Manage ")]),_:1})])])]),e("section",oe,[i.value?(o(),u("div",ue,ce)):(o(),u(I,{key:1},[e("div",de,[e("div",ie,[e("h3",re,c(k.value.home_name),1)]),e("div",ve,[me,y(" Check-in: "),e("b",null,c(k.value.checkin_date),1),y(" | "),pe,y(" Check-out: "),e("b",null,c(k.value.checkout_date),1)]),e("div",_e,[y(" Total Amount: "),e("b",null,"INR "+c(f(M)(D.value)),1)]),e("div",he,[e("div",be,[y("Total/Remaining: "),e("b",null,"INR "+c(f(M)(D.value)),1),y(" / INR "+c(f(M)(d.value)),1)])])]),d.value>0?(o(),u("div",ye,[e("div",fe,[e("div",ge,[e("div",ke,[e("table",we,[Ve,e("tbody",null,[(o(!0),u(I,null,T(v.value,(_,s)=>(o(),u("tr",{key:s},[e("td",null,[e("div",Re,[x(f(N),{class:"form-control mw-150",type:"text",rules:"required",name:"customer_name[index]",modelValue:p.value[s],"onUpdate:modelValue":n=>p.value[s]=n,placeholder:"Enter Name"},null,8,["modelValue","onUpdate:modelValue"])]),e("span",qe,c(R.value[s]),1)]),e("td",null,[x(f(N),{class:"form-control mw-150",type:"text",rules:"required",name:"emails[index]",modelValue:r.value[s],"onUpdate:modelValue":n=>r.value[s]=n,placeholder:"Enter Email ID"},null,8,["modelValue","onUpdate:modelValue"]),e("span",xe,c(V.value[s]),1)]),e("td",null,[e("div",Ce,[Ae,x(f(N),{class:"form-control mw-100",type:"text",rules:"required",name:"amounts[index]",modelValue:h.value[s],"onUpdate:modelValue":n=>h.value[s]=n},null,8,["modelValue","onUpdate:modelValue"])])]),e("td",null,[e("div",Ne,[x(f(N),{class:"form-control mw-150",as:"select",rules:"required",name:"paymentModes[index]",modelValue:m.value[s],"onUpdate:modelValue":n=>m.value[s]=n},{default:U(()=>[Ee,(o(!0),u(I,null,T(z.value,(n,Fe)=>(o(),u("option",{value:n},c(n),9,Pe))),256))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),e("span",De,c(w.value[s]),1)]),e("td",null,[!g.value[s]&&P.value?(o(),u("button",{key:0,class:"btn btn-save btn-primary",onClick:n=>J(s)},"Save",8,Ie)):(o(),u("div",Be,[e("span",null,[e("i",{class:"bi bi-pencil-square",onClick:n=>j(s)},null,8,Me)])]))])]))),128))])])])]),v.value>1&&C.value?(o(),u("button",{key:0,class:"btn btn-danger mt-1 text-white",onClick:H},"- Remove")):F("",!0),q.value?(o(),u("button",{key:1,class:"btn btn-warning mt-1 text-white ms-2",onClick:K},"+ Add")):(o(),u("button",Ue,"+ Add"))])])):F("",!0)],64))])])}}};export{ze as default};
