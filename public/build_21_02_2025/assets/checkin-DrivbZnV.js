import{_ as I}from"./tooltip-BrvWqPPW.js";import{z as A,r as p,o as P,B as W,a as c,c as d,b as e,d as _,w as B,e as g,f as F,t as M,E as r,K as h,G as E,H as Y,I as f,F as V,g as $,W as H,h as K}from"./app-Bv7sA21o.js";import{d as z}from"./dayjs.min-CU4dOPv8.js";import{d as O}from"./modal-WLjbOo64.js";import{v as R}from"./validate-file-EZHt4CEQ.js";const J={class:"page-wrap"},Q={class:"page-title mb-4"},X={class:"row gy-3 align-items-center"},Z=e("div",{class:"col align-self-end"},[e("h1",{class:"h2 mb-0"},"Guest Check In")],-1),x={class:"col-auto"},j=e("i",{class:"icon-list me-2"},null,-1),ee={class:"section"},se={key:0,class:"d-flex justify-content-center py-5"},te=e("div",{class:"spinner-border",role:"status"},null,-1),oe=[te],ae={key:1,class:"page-content"},le={class:"row"},ie={class:"col-12"},ne={class:"form-group"},ce={class:"row gx-5"},de={class:"col-auto"},ue=e("span",{class:"fw-bold"},"Booking ID :",-1),re={class:"col-auto"},_e=e("span",{class:"fw-bold"},"Accommodation :",-1),me={class:"col-auto"},pe=e("span",{class:"fw-bold"},"CheckIn :",-1),he={class:"col-auto"},ve=e("span",{class:"fw-bold"},"Checkout :",-1),ge={class:"col-12"},fe={class:"form-group"},be={class:"row gx-5"},ke={class:"col-auto"},we=e("span",{class:"fw-bold"},"Note :",-1),ye={class:"col-12"},Fe={class:"row nth-row g-4"},Me={class:"col-12 col-lg-6"},Ve={class:"multi-row"},$e={class:"row"},De={class:"col-12"},Ce={class:"form-group"},Ne={class:"row"},Ue={class:"col"},qe={class:"small-action-btn"},Ie={class:"btn btn-icon btn-secondary-light pe-none"},Be={class:"row gx-3"},Ee={class:"col-lg-4"},Ye={class:"form-group"},ze={for:""},Le={key:0,class:"text-danger"},Se={class:"col-lg-4"},Ge={class:"form-group"},Te={for:""},Ae={key:0,class:"text-danger"},Pe={class:"col-lg-4"},We={class:"form-group"},He={for:""},Ke={key:0,class:"text-danger"},Oe={class:"col-12 col-lg-12"},Re={class:"row"},Je={class:"col-12"},Qe={class:"form-group"},Xe={for:""},Ze={key:0,class:"text-danger"},xe={class:"upload-info"},je=e("i",{class:"icon-upload"},null,-1),es={class:"upload-info-text"},ss=e("strong",null,[r("Drag & Drop Or "),e("span",{class:"text-primary"},"Browse"),r(" Your File.")],-1),ts=e("small",null,"Max size: 3mb",-1),os={class:"text-danger mt-2 fs-12"},as={class:"col-12"},ls={class:"image-wrapper"},is={class:"row g-3"},ns={class:"col-6 col-sm-4 col-md-4 col-xxl-2"},cs={class:"imgWrapper multifile-upload"},ds=["href"],us={key:0,class:"icon-wrap"},rs=e("i",{class:"bi bi-file-earmark-pdf"},null,-1),_s=[rs],ms=["src"],ps=["onClick"],hs=e("i",{class:"bi bi-trash"},null,-1),vs=[hs],gs={class:"row pt-4"},fs={class:"col-12"},bs={class:"form-group mb-0"},ks={type:"submit",class:"btn btn-save btn-primary"},ws={key:0,class:"spinner-border spinner-border-sm",role:"status"},ys={key:1},Ns={__name:"checkin",setup(Fs){const b=A(),m=p({}),L=p(""),k=p(!1),w=p(!1),D=p(""),C=p(""),a=p([{name:"",email:"",mobile_no:"",multipleFiles:[]}]),S=async(t,i,u)=>{const l=t.target.files,n=new FormData;for(let s=0;s<l.length;s++)if(R(l[s],i)!=!1){n.append("file",l[s]);try{const o=await F.post("/api/upload",n);o.data.status&&a.value[u].multipleFiles.push(o.data)}catch{}await n.delete("file")}t.target.value=null},G=(t,i,u,l,n,s)=>{var y;u==0||u?O("Are you sure you want to remove?",function(){F.post("/api/property/booking/deleteguestfile",{image_id:u,main_id:s,property_booking_id:b.params.id}).then(v=>{v.data.status&&(a.value[t].multipleFiles.splice(i,1),M(v.data.message,"success").show())}).catch(v=>{M(v.response.data.message,"error").show()})}).show():a.value[t].multipleFiles.splice(i,1);const o=(y=n[`multipleFiles${t}`])==null?void 0:y.filter((q,v)=>v!==t);l({values:{[`multipleFiles${i}`]:o}})},N=()=>{b.params.id&&(k.value=!0,F.get(`/api/property/booking/${b.params.id}`).then(t=>{if(t.data.status){D.value=t.data.data.booking_id,m.value=t.data.data;let i=t.data.data.bookingGuestsIds,u=parseInt(t.data.data.no_of_adult);u=u;let l=t.data.data.customer_detail;C.value=t.data.data.customer_detail.note;let n=l.first_name+" "+l.last_name;if(i.length){L.value=t.data.id_path,a.value=i;for(let s=0;s<i.length;s++)a.value[s].multipleFiles=a.value[s].id_proof_imgs}else for(let s=0;s<u;s++)s==0?(a.value[s].name=n,a.value[s].email=l.email,a.value[s].mobile_no=l.mobile_number,a.value[s].dob=l.dob,a.value[s].anniversary=l.anniversary,a.value[s].id="",a.value[s].multipleFiles=[]):a.value.push({name:"",email:"",mobile_no:"",id:"",dob:"",anniversary:"",multipleFiles:[]});setTimeout(()=>{k.value=!1},400)}}).catch(t=>{k.value=!1}))},U=({target:t},i,u)=>{a.value.forEach(async l=>{u=="email"?t.value&&t.value.toLowerCase()===l.email.toLowerCase()?a.value[i].guestUniqueEmailMessage=await"Email ID already taken":a.value[i].guestUniqueEmailMessage="":u=="number"&&(t.value&&t.value===l.mobile_no?a.value[i].guestUniqueNumberMessage=await"Mobile no already taken":a.value[i].guestUniqueNumberMessage="")})},T=t=>{w.value=!0,F.post("/api/property/booking/ids",{guest_list:a.value,property_booking_id:b.params.id,checkin_date:z(m.value.checkin_date).format("YYYY-MM-DD"),checkout_date:z(m.value.checkout_date).format("YYYY-MM-DD")}).then(i=>{i.data.status&&(M(i.data.message,"success").show(),setTimeout(()=>{w.value=!1,N()},400))}).catch(i=>{M(i.response.data.message,"error").show(),w.value=!1})};return P(()=>{N()}),(t,i)=>{const u=W("router-link");return c(),d("div",J,[e("div",Q,[e("div",X,[Z,e("div",x,[_(u,{to:{name:"booking-list"},class:"btn rounded-pill btn-secondary-light"},{default:B(()=>[j,r(" Manage ")]),_:1})])])]),e("section",ee,[k.value?(c(),d("div",se,oe)):(c(),d("div",ae,[_(g(K),{onSubmit:T},{default:B(({errors:l})=>[e("div",le,[e("div",ie,[e("div",ne,[e("div",ce,[e("div",de,[ue,r(" "+h(D.value),1)]),e("div",re,[_e,r(" "+h(m.value.home_name)+", "+h(m.value.location),1)]),e("div",me,[pe,r(" "+h(m.value.checkin_date),1)]),e("div",he,[ve,r(" "+h(m.value.checkout_date),1)])])])]),e("div",ge,[e("div",fe,[e("div",be,[e("div",ke,[we,r(" "+h(C.value),1)])])])]),e("div",ye,[e("div",Fe,[(c(!0),d(E,null,Y(a.value,(n,s)=>(c(),d("div",Me,[e("div",Ve,[e("div",$e,[e("div",De,[e("div",Ce,[e("div",Ne,[e("div",Ue,[e("div",qe,[e("div",Ie,h(s+1),1)])])])])]),e("div",Be,[e("div",Ee,[e("div",Ye,[e("label",ze,[r("Name"),s?f("",!0):(c(),d("span",Le,"*"))]),_(g(V),{type:"text",name:`name-${s}`,class:$(["form-control",{"border-danger":l[`name-${s}`]}]),modelValue:n.name,"onUpdate:modelValue":o=>n.name=o,rules:s?"":"required"},null,8,["name","class","modelValue","onUpdate:modelValue","rules"])])]),e("div",Se,[e("div",Ge,[e("label",Te,[r("Email"),s?f("",!0):(c(),d("span",Ae,"*"))]),_(g(V),{type:"text",name:`email-${s}`,class:$(["form-control",{"border-danger":l[`email-${s}`]}]),modelValue:n.email,"onUpdate:modelValue":o=>n.email=o,onInput:o=>U(o,s,"email"),rules:s?"email":"required|email","data-bs-toggle":"tooltip"},null,8,["name","class","modelValue","onUpdate:modelValue","onInput","rules"]),_(I,{error:n.guestUniqueEmailMessage},null,8,["error"])])]),e("div",Pe,[e("div",We,[e("label",He,[r("Mobile No"),s?f("",!0):(c(),d("span",Ke,"*"))]),_(g(V),{type:"text",name:`mobile_no-${s}`,class:$(["form-control",{"border-danger":l[`mobile_no-${s}`]}]),modelValue:n.mobile_no,"onUpdate:modelValue":o=>n.mobile_no=o,onInput:o=>U(o,s,"number"),rules:s?"numeric|max:16|min:8":"required|numeric|max:16|min:8","data-bs-toggle":"tooltip"},null,8,["name","class","modelValue","onUpdate:modelValue","onInput","rules"]),_(I,{error:n.guestUniqueNumberMessage},null,8,["error"])])])]),e("div",Oe,[e("div",Re,[e("div",Je,[e("div",Qe,[e("label",Xe,[r("Id Proof"),s?f("",!0):(c(),d("span",Ze,"*"))]),e("div",{class:$(["upload-wrapper",{"border-danger":l[`multipleFiles${s}`]}])},[_(g(V),{type:"file",name:`multipleFiles${s}`,id:`multipleFiles${s}`,multiple:"",onChange:o=>S(o,l[`multipleFiles${s}`],s),accept:"image/*,application/pdf",rules:n.multipleFiles.length?"size:3072|ext:jpg,jpeg,png,pdf":s?"":"required|size:3072|ext:jpg,jpeg,png,pdf"},null,8,["name","id","onChange","rules"]),e("div",xe,[je,e("div",es,[ss,ts,e("small",os,[_(g(H),{name:`multipleFiles${s}`},null,8,["name"])])])])],2)])]),e("div",as,[e("div",ls,[e("div",is,[(c(!0),d(E,null,Y(n.multipleFiles,(o,y)=>(c(),d("div",ns,[e("div",cs,[e("a",{href:o.filepath,class:"imgBoxNew",target:"_blank"},[o.extension=="pdf"?(c(),d("div",us,_s)):(c(),d("img",{key:1,src:o.filepath,class:"w-100"},null,8,ms))],8,ds),o.id||o.extension?(c(),d("button",{key:0,type:"button",onClick:q=>G(s,y,o.id,t.resetForm,t.values,n.id),class:"btn btn-light btn-sm"},vs,8,ps)):f("",!0)])]))),256))])])])])])])])]))),256))])])]),e("div",gs,[e("div",fs,[e("div",bs,[e("button",ks,[w.value?(c(),d("div",ws)):(c(),d("span",ys,"SUBMIT"))])])])])]),_:1})]))])])}}};export{Ns as default};
